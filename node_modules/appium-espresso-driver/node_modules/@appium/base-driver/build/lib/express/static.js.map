{"version":3,"file":"static.js","names":["STATIC_DIR","path","resolve","__dirname","_","isNull","match","guineaPigTemplate","req","res","page","delay","parseInt","params","query","throwError","serverTime","Date","userAgent","headers","comment","method","body","comments","log","debug","JSON","stringify","B","set","cookie","domain","send","getTemplate","guineaPig","guineaPigScrollable","guineaPigAppBanner","welcome","message","templateName","content","fs","readFile","template","toString"],"sources":["../../../lib/express/static.js"],"sourcesContent":["import path from 'path';\nimport log from './logger';\nimport _ from 'lodash';\nimport {fs} from '@appium/support';\nimport B from 'bluebird';\n\nlet STATIC_DIR = path.resolve(__dirname, '..', '..', '..', 'static');\nif (_.isNull(path.resolve(__dirname).match(/build[/\\\\]lib[/\\\\]express$/))) {\n  // in some contexts we are not in the build directory,\n  // so we don't want to go back the extra level\n  STATIC_DIR = path.resolve(__dirname, '..', '..', 'static');\n}\n\nasync function guineaPigTemplate(req, res, page) {\n  const delay = parseInt(req.params.delay || req.query.delay || 0, 10);\n  const throwError = req.params.throwError || req.query.throwError || '';\n  let params = {\n    throwError,\n    serverTime: new Date(),\n    userAgent: req.headers['user-agent'],\n    comment: 'None',\n  };\n  if (req.method === 'POST') {\n    params.comment = req.body.comments || params.comment;\n  }\n  log.debug(`Sending guinea pig response with params: ${JSON.stringify(params)}`);\n  if (delay) {\n    log.debug(`Waiting ${delay}ms before responding`);\n    await B.delay(delay);\n  }\n  res.set('content-type', 'text/html');\n  res.cookie('guineacookie1', 'i am a cookie value', {path: '/'});\n  res.cookie('guineacookie2', 'cooki√©2', {path: '/'});\n  res.cookie('guineacookie3', 'cant access this', {\n    domain: '.blargimarg.com',\n    path: '/',\n  });\n  res.send((await getTemplate(page))(params));\n}\n\n/*\n * Dynamic page mapped to /test/guinea-pig\n */\nasync function guineaPig(req, res) {\n  return await guineaPigTemplate(req, res, 'guinea-pig.html');\n}\n\n/*\n * Dynamic page mapped to /test/guinea-pig-scrollable\n */\nasync function guineaPigScrollable(req, res) {\n  return await guineaPigTemplate(req, res, 'guinea-pig-scrollable.html');\n}\n\n/*\n * Dynamic page mapped to /test/guinea-pig-app-banner\n */\nasync function guineaPigAppBanner(req, res) {\n  return await guineaPigTemplate(req, res, 'guinea-pig-app-banner.html');\n}\n\n/*\n * Dynamic page mapped to /welcome\n */\nasync function welcome(req, res) {\n  let params = {message: \"Let's browse!\"};\n  log.debug(`Sending welcome response with params: ${JSON.stringify(params)}`);\n  res.send((await getTemplate('welcome.html'))(params));\n}\n\nasync function getTemplate(templateName) {\n  let content = await fs.readFile(path.resolve(STATIC_DIR, 'test', templateName));\n  return _.template(content.toString());\n}\n\nexport {guineaPig, guineaPigScrollable, guineaPigAppBanner, welcome, STATIC_DIR};\n"],"mappings":"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"}