"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.STANDARD_CAPS = exports.PREFIXED_APPIUM_OPTS_CAP = exports.APPIUM_VENDOR_PREFIX = exports.APPIUM_OPTS_CAP = void 0;
exports.findNonPrefixedCaps = findNonPrefixedCaps;
exports.isStandardCap = isStandardCap;
exports.mergeCaps = mergeCaps;
exports.parseCaps = parseCaps;
exports.processCapabilities = processCapabilities;
exports.promoteAppiumOptions = promoteAppiumOptions;
exports.stripAppiumPrefixes = stripAppiumPrefixes;
exports.validateCaps = validateCaps;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _desiredCaps = require("./desired-caps");

var _support = require("@appium/support");

var _logger = _interopRequireDefault(require("./logger"));

var _errors = require("../protocol/errors");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const APPIUM_VENDOR_PREFIX = 'appium:';
exports.APPIUM_VENDOR_PREFIX = APPIUM_VENDOR_PREFIX;
const APPIUM_OPTS_CAP = 'options';
exports.APPIUM_OPTS_CAP = APPIUM_OPTS_CAP;
const PREFIXED_APPIUM_OPTS_CAP = `${APPIUM_VENDOR_PREFIX}${APPIUM_OPTS_CAP}`;
exports.PREFIXED_APPIUM_OPTS_CAP = PREFIXED_APPIUM_OPTS_CAP;

function mergeCaps(primary = {}, secondary = {}) {
  let result = { ...primary
  };

  for (let [name, value] of _lodash.default.toPairs(secondary)) {
    if (!_lodash.default.isUndefined(primary[name])) {
      throw new _errors.errors.InvalidArgumentError(`property '${name}' should not exist on both primary (${JSON.stringify(primary)}) and secondary (${JSON.stringify(secondary)}) object`);
    }

    result[name] = value;
  }

  return result;
}

function validateCaps(caps, constraints = {}, opts = {}) {
  let {
    skipPresenceConstraint
  } = opts;

  if (!_lodash.default.isPlainObject(caps)) {
    throw new _errors.errors.InvalidArgumentError(`must be a JSON object`);
  }

  constraints = _lodash.default.mapValues(constraints, skipPresenceConstraint ? constraint => _lodash.default.omit(constraint, 'presence') : constraint => {
    if (constraint.presence === true) {
      return { ..._lodash.default.omit(constraint, 'presence'),
        presence: {
          allowEmpty: false
        }
      };
    }

    return constraint;
  });

  const validationErrors = _desiredCaps.validator.validate(_lodash.default.pickBy(caps, _support.util.hasValue), constraints, {
    fullMessages: false
  });

  if (validationErrors) {
    let message = [];

    for (let [attribute, reasons] of _lodash.default.toPairs(validationErrors)) {
      for (let reason of reasons) {
        message.push(`'${attribute}' ${reason}`);
      }
    }

    throw new _errors.errors.InvalidArgumentError(message.join('; '));
  }

  return caps;
}

const STANDARD_CAPS = Object.freeze(new Set(['browserName', 'browserVersion', 'platformName', 'acceptInsecureCerts', 'pageLoadStrategy', 'proxy', 'setWindowRect', 'timeouts', 'unhandledPromptBehavior']));
exports.STANDARD_CAPS = STANDARD_CAPS;
const STANDARD_CAPS_LOWER = new Set([...STANDARD_CAPS].map(cap => cap.toLowerCase()));

function isStandardCap(cap) {
  return STANDARD_CAPS_LOWER.has(cap.toLowerCase());
}

function stripAppiumPrefixes(caps) {
  const [prefixedCaps, nonPrefixedCaps] = _lodash.default.partition(_lodash.default.keys(caps), cap => String(cap).startsWith(APPIUM_VENDOR_PREFIX));

  let strippedCaps = _lodash.default.pick(caps, nonPrefixedCaps);

  const badPrefixedCaps = [];

  for (let prefixedCap of prefixedCaps) {
    const strippedCapName = prefixedCap.substring(APPIUM_VENDOR_PREFIX.length);

    if (isStandardCap(strippedCapName)) {
      badPrefixedCaps.push(strippedCapName);

      if (_lodash.default.isNil(strippedCaps[strippedCapName])) {
        strippedCaps[strippedCapName] = caps[prefixedCap];
      } else {
        _logger.default.warn(`Ignoring capability '${prefixedCap}=${caps[prefixedCap]}' and ` + `using capability '${strippedCapName}=${strippedCaps[strippedCapName]}'`);
      }
    } else {
      strippedCaps[strippedCapName] = caps[prefixedCap];
    }
  }

  if (badPrefixedCaps.length > 0) {
    _logger.default.warn(`The capabilities ${JSON.stringify(badPrefixedCaps)} are standard capabilities and do not require "appium:" prefix`);
  }

  return strippedCaps;
}

function findNonPrefixedCaps({
  alwaysMatch = {},
  firstMatch = []
}) {
  return _lodash.default.chain([alwaysMatch, ...firstMatch]).reduce((unprefixedCaps, caps) => [...unprefixedCaps, ...Object.keys(caps).filter(cap => !cap.includes(':') && !isStandardCap(cap))], []).uniq().value();
}

function parseCaps(caps, constraints = {}, shouldValidateCaps = true) {
  if (!_lodash.default.isPlainObject(caps)) {
    throw new _errors.errors.InvalidArgumentError('The capabilities argument was not valid for the following reason(s): "capabilities" must be a JSON object.');
  }

  let {
    alwaysMatch: requiredCaps = {},
    firstMatch: allFirstMatchCaps = [{}]
  } = caps;

  if (!_lodash.default.isArray(allFirstMatchCaps)) {
    throw new _errors.errors.InvalidArgumentError('The capabilities.firstMatch argument was not valid for the following reason(s): "capabilities.firstMatch" must be a JSON array or undefined');
  }

  if (allFirstMatchCaps.length === 0) {
    _logger.default.warn(`The firstMatch array in the given capabilities has no entries. Adding an empty entry fo rnow, ` + `but it will require one or more entries as W3C spec.`);

    allFirstMatchCaps.push({});
  }

  let nonPrefixedCaps = findNonPrefixedCaps(caps);

  if (!_lodash.default.isEmpty(nonPrefixedCaps)) {
    throw new _errors.errors.InvalidArgumentError(`All non-standard capabilities should have a vendor prefix. The following capabilities did not have one: ${nonPrefixedCaps}`);
  }

  let strippedRequiredCaps = stripAppiumPrefixes(requiredCaps);
  let strippedAllFirstMatchCaps = allFirstMatchCaps.map(stripAppiumPrefixes);

  if (shouldValidateCaps) {
    strippedRequiredCaps = validateCaps(strippedRequiredCaps, constraints, {
      skipPresenceConstraint: true
    });
  }

  const filteredConstraints = _lodash.default.omitBy(constraints, (_, key) => key in strippedRequiredCaps);

  let validationErrors = [];

  let validatedFirstMatchCaps = _lodash.default.compact(strippedAllFirstMatchCaps.map(firstMatchCaps => {
    try {
      return shouldValidateCaps ? validateCaps(firstMatchCaps, filteredConstraints) : firstMatchCaps;
    } catch (e) {
      validationErrors.push(e.message);
    }
  }));

  let matchedCaps = null;

  for (let firstMatchCaps of validatedFirstMatchCaps) {
    try {
      matchedCaps = mergeCaps(strippedRequiredCaps, firstMatchCaps);

      if (matchedCaps) {
        break;
      }
    } catch (err) {
      _logger.default.warn(err.message);

      validationErrors.push(err.message);
    }
  }

  return {
    requiredCaps,
    allFirstMatchCaps,
    validatedFirstMatchCaps,
    matchedCaps,
    validationErrors
  };
}

function processCapabilities(w3cCaps, constraints = {}, shouldValidateCaps = true) {
  const {
    matchedCaps,
    validationErrors
  } = parseCaps(w3cCaps, constraints, shouldValidateCaps);

  if (!_support.util.hasValue(matchedCaps)) {
    if (_lodash.default.isArray(w3cCaps.firstMatch) && w3cCaps.firstMatch.length > 1) {
      throw new _errors.errors.InvalidArgumentError(`Could not find matching capabilities from ${JSON.stringify(w3cCaps)}:\n ${validationErrors.join('\n')}`);
    } else {
      throw new _errors.errors.InvalidArgumentError(validationErrors[0]);
    }
  }

  return matchedCaps ?? {};
}

function promoteAppiumOptions(originalCaps) {
  const appiumOptions = originalCaps[APPIUM_OPTS_CAP];

  if (!appiumOptions) {
    return originalCaps;
  }

  let caps = _lodash.default.cloneDeep(originalCaps);

  if (!_lodash.default.isPlainObject(appiumOptions)) {
    throw new _errors.errors.SessionNotCreatedError(`The ${APPIUM_OPTS_CAP} capability must be an object`);
  }

  const strippedAppiumOptions = stripAppiumPrefixes(appiumOptions);

  const overwrittenKeys = _lodash.default.intersection(Object.keys(caps), Object.keys(strippedAppiumOptions));

  if (overwrittenKeys.length > 0) {
    _logger.default.warn(`Found capabilities inside ${PREFIXED_APPIUM_OPTS_CAP} that will overwrite ` + `capabilities at the top level: ${JSON.stringify(overwrittenKeys)}`);
  }

  caps = { ...caps,
    ...strippedAppiumOptions
  };
  delete caps[APPIUM_OPTS_CAP];
  return caps;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJBUFBJVU1fVkVORE9SX1BSRUZJWCIsIkFQUElVTV9PUFRTX0NBUCIsIlBSRUZJWEVEX0FQUElVTV9PUFRTX0NBUCIsIm1lcmdlQ2FwcyIsInByaW1hcnkiLCJzZWNvbmRhcnkiLCJyZXN1bHQiLCJuYW1lIiwidmFsdWUiLCJfIiwidG9QYWlycyIsImlzVW5kZWZpbmVkIiwiZXJyb3JzIiwiSW52YWxpZEFyZ3VtZW50RXJyb3IiLCJKU09OIiwic3RyaW5naWZ5IiwidmFsaWRhdGVDYXBzIiwiY2FwcyIsImNvbnN0cmFpbnRzIiwib3B0cyIsInNraXBQcmVzZW5jZUNvbnN0cmFpbnQiLCJpc1BsYWluT2JqZWN0IiwibWFwVmFsdWVzIiwiY29uc3RyYWludCIsIm9taXQiLCJwcmVzZW5jZSIsImFsbG93RW1wdHkiLCJ2YWxpZGF0aW9uRXJyb3JzIiwidmFsaWRhdG9yIiwidmFsaWRhdGUiLCJwaWNrQnkiLCJ1dGlsIiwiaGFzVmFsdWUiLCJmdWxsTWVzc2FnZXMiLCJtZXNzYWdlIiwiYXR0cmlidXRlIiwicmVhc29ucyIsInJlYXNvbiIsInB1c2giLCJqb2luIiwiU1RBTkRBUkRfQ0FQUyIsIk9iamVjdCIsImZyZWV6ZSIsIlNldCIsIlNUQU5EQVJEX0NBUFNfTE9XRVIiLCJtYXAiLCJjYXAiLCJ0b0xvd2VyQ2FzZSIsImlzU3RhbmRhcmRDYXAiLCJoYXMiLCJzdHJpcEFwcGl1bVByZWZpeGVzIiwicHJlZml4ZWRDYXBzIiwibm9uUHJlZml4ZWRDYXBzIiwicGFydGl0aW9uIiwia2V5cyIsIlN0cmluZyIsInN0YXJ0c1dpdGgiLCJzdHJpcHBlZENhcHMiLCJwaWNrIiwiYmFkUHJlZml4ZWRDYXBzIiwicHJlZml4ZWRDYXAiLCJzdHJpcHBlZENhcE5hbWUiLCJzdWJzdHJpbmciLCJsZW5ndGgiLCJpc05pbCIsImxvZyIsIndhcm4iLCJmaW5kTm9uUHJlZml4ZWRDYXBzIiwiYWx3YXlzTWF0Y2giLCJmaXJzdE1hdGNoIiwiY2hhaW4iLCJyZWR1Y2UiLCJ1bnByZWZpeGVkQ2FwcyIsImZpbHRlciIsImluY2x1ZGVzIiwidW5pcSIsInBhcnNlQ2FwcyIsInNob3VsZFZhbGlkYXRlQ2FwcyIsInJlcXVpcmVkQ2FwcyIsImFsbEZpcnN0TWF0Y2hDYXBzIiwiaXNBcnJheSIsImlzRW1wdHkiLCJzdHJpcHBlZFJlcXVpcmVkQ2FwcyIsInN0cmlwcGVkQWxsRmlyc3RNYXRjaENhcHMiLCJmaWx0ZXJlZENvbnN0cmFpbnRzIiwib21pdEJ5Iiwia2V5IiwidmFsaWRhdGVkRmlyc3RNYXRjaENhcHMiLCJjb21wYWN0IiwiZmlyc3RNYXRjaENhcHMiLCJlIiwibWF0Y2hlZENhcHMiLCJlcnIiLCJwcm9jZXNzQ2FwYWJpbGl0aWVzIiwidzNjQ2FwcyIsInByb21vdGVBcHBpdW1PcHRpb25zIiwib3JpZ2luYWxDYXBzIiwiYXBwaXVtT3B0aW9ucyIsImNsb25lRGVlcCIsIlNlc3Npb25Ob3RDcmVhdGVkRXJyb3IiLCJzdHJpcHBlZEFwcGl1bU9wdGlvbnMiLCJvdmVyd3JpdHRlbktleXMiLCJpbnRlcnNlY3Rpb24iXSwic291cmNlcyI6WyIuLi8uLi8uLi9saWIvYmFzZWRyaXZlci9jYXBhYmlsaXRpZXMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQHRzLWNoZWNrXG5cbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQge3ZhbGlkYXRvcn0gZnJvbSAnLi9kZXNpcmVkLWNhcHMnO1xuaW1wb3J0IHt1dGlsfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQge2Vycm9yc30gZnJvbSAnLi4vcHJvdG9jb2wvZXJyb3JzJztcblxuY29uc3QgQVBQSVVNX1ZFTkRPUl9QUkVGSVggPSAnYXBwaXVtOic7XG5jb25zdCBBUFBJVU1fT1BUU19DQVAgPSAnb3B0aW9ucyc7XG5jb25zdCBQUkVGSVhFRF9BUFBJVU1fT1BUU19DQVAgPSBgJHtBUFBJVU1fVkVORE9SX1BSRUZJWH0ke0FQUElVTV9PUFRTX0NBUH1gO1xuXG4vKipcbiAqIFRha2VzIHByaW1hcnkgY2FwcyBvYmplY3QgYW5kIG1lcmdlcyBpdCBpbnRvIGEgc2Vjb25kYXJ5IGNhcHMgb2JqZWN0LlxuICogQHRlbXBsYXRlIHtDb25zdHJhaW50c30gW1Q9e31dXG4gKiBAdGVtcGxhdGUge0NvbnN0cmFpbnRzfSBbVT17fV1cbiAqIEBwYXJhbSB7Q2FwYWJpbGl0aWVzPFQ+fSBbcHJpbWFyeV1cbiAqIEBwYXJhbSB7Q2FwYWJpbGl0aWVzPFU+fSBbc2Vjb25kYXJ5XVxuICogQHJldHVybnMge2ltcG9ydCgndHlwZS1mZXN0JykuTWVyZ2U8Q2FwYWJpbGl0aWVzPFQ+LCBDYXBhYmlsaXRpZXM8VT4+fVxuICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvd2ViZHJpdmVyLyNkZm4tbWVyZ2luZy1jYXBhYmlsaXRpZXMpXG4gKi9cbmZ1bmN0aW9uIG1lcmdlQ2FwcyhwcmltYXJ5ID0ge30sIHNlY29uZGFyeSA9IHt9KSB7XG4gIGxldCByZXN1bHQgPSAvKiogQHR5cGUge2ltcG9ydCgndHlwZS1mZXN0JykuTWVyZ2U8Q2FwYWJpbGl0aWVzPFQ+LCBDYXBhYmlsaXRpZXM8VT4+fSAqLyAoe1xuICAgIC4uLnByaW1hcnksXG4gIH0pO1xuXG4gIGZvciAobGV0IFtuYW1lLCB2YWx1ZV0gb2YgLyoqIEB0eXBlIHtba2V5b2YgdHlwZW9mIHNlY29uZGFyeSwgYW55XX0gKi8gKF8udG9QYWlycyhzZWNvbmRhcnkpKSkge1xuICAgIC8vIE92ZXJ3cml0aW5nIGlzIG5vdCBhbGxvd2VkLiBQcmltYXJ5IGFuZCBzZWNvbmRhcnkgbXVzdCBoYXZlIGRpZmZlcmVudCBwcm9wZXJ0aWVzICh3M2MgcnVsZSA0LjQpXG4gICAgaWYgKCFfLmlzVW5kZWZpbmVkKHByaW1hcnlbbmFtZV0pKSB7XG4gICAgICB0aHJvdyBuZXcgZXJyb3JzLkludmFsaWRBcmd1bWVudEVycm9yKFxuICAgICAgICBgcHJvcGVydHkgJyR7bmFtZX0nIHNob3VsZCBub3QgZXhpc3Qgb24gYm90aCBwcmltYXJ5ICgke0pTT04uc3RyaW5naWZ5KFxuICAgICAgICAgIHByaW1hcnlcbiAgICAgICAgKX0pIGFuZCBzZWNvbmRhcnkgKCR7SlNPTi5zdHJpbmdpZnkoc2Vjb25kYXJ5KX0pIG9iamVjdGBcbiAgICAgICk7XG4gICAgfVxuICAgIHJlc3VsdFsvKiogQHR5cGUge2tleW9mIHR5cGVvZiByZXN1bHR9ICovIChuYW1lKV0gPSB2YWx1ZTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbi8vIFZhbGlkYXRlcyBjYXBzIGFnYWluc3QgYSBzZXQgb2YgY29uc3RyYWludHNcbi8qKlxuICogQHRlbXBsYXRlIHtDb25zdHJhaW50c30gW0M9e31dXG4gKiBAcGFyYW0ge0NhcGFiaWxpdGllczxDPn0gY2Fwc1xuICogQHBhcmFtIHtDfSBbY29uc3RyYWludHNdXG4gKiBAcGFyYW0ge1ZhbGlkYXRlQ2Fwc09wdHN9IFtvcHRzXVxuICogQHJldHVybnMge0NhcGFiaWxpdGllczxDPn1cbiAqL1xuZnVuY3Rpb24gdmFsaWRhdGVDYXBzKGNhcHMsIGNvbnN0cmFpbnRzID0gLyoqIEB0eXBlIHtDfSAqLyAoe30pLCBvcHRzID0ge30pIHtcbiAgbGV0IHtza2lwUHJlc2VuY2VDb25zdHJhaW50fSA9IG9wdHM7XG5cbiAgaWYgKCFfLmlzUGxhaW5PYmplY3QoY2FwcykpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLkludmFsaWRBcmd1bWVudEVycm9yKGBtdXN0IGJlIGEgSlNPTiBvYmplY3RgKTtcbiAgfVxuXG4gIC8vIFJlbW92ZSB0aGUgJ3ByZXNlbmNlJyBjb25zdHJhaW50IGlmIHdlJ3JlIG5vdCBjaGVja2luZyBmb3IgaXRcbiAgY29uc3RyYWludHMgPSAvKiogQHR5cGUge0N9ICovIChcbiAgICBfLm1hcFZhbHVlcyhcbiAgICAgIGNvbnN0cmFpbnRzLFxuICAgICAgc2tpcFByZXNlbmNlQ29uc3RyYWludFxuICAgICAgICA/IC8qKiBAcGFyYW0ge0NvbnN0cmFpbnR9IGNvbnN0cmFpbnQgKi9cbiAgICAgICAgICAoY29uc3RyYWludCkgPT4gXy5vbWl0KGNvbnN0cmFpbnQsICdwcmVzZW5jZScpXG4gICAgICAgIDogLyoqIEBwYXJhbSB7Q29uc3RyYWludH0gY29uc3RyYWludCAqL1xuICAgICAgICAgIChjb25zdHJhaW50KSA9PiB7XG4gICAgICAgICAgICBpZiAoY29uc3RyYWludC5wcmVzZW5jZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICByZXR1cm4gey4uLl8ub21pdChjb25zdHJhaW50LCAncHJlc2VuY2UnKSwgcHJlc2VuY2U6IHthbGxvd0VtcHR5OiBmYWxzZX19O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGNvbnN0cmFpbnQ7XG4gICAgICAgICAgfVxuICAgIClcbiAgKTtcblxuICBjb25zdCB2YWxpZGF0aW9uRXJyb3JzID0gdmFsaWRhdG9yLnZhbGlkYXRlKF8ucGlja0J5KGNhcHMsIHV0aWwuaGFzVmFsdWUpLCBjb25zdHJhaW50cywge1xuICAgIGZ1bGxNZXNzYWdlczogZmFsc2UsXG4gIH0pO1xuXG4gIGlmICh2YWxpZGF0aW9uRXJyb3JzKSB7XG4gICAgbGV0IG1lc3NhZ2UgPSBbXTtcbiAgICBmb3IgKGxldCBbYXR0cmlidXRlLCByZWFzb25zXSBvZiBfLnRvUGFpcnModmFsaWRhdGlvbkVycm9ycykpIHtcbiAgICAgIGZvciAobGV0IHJlYXNvbiBvZiByZWFzb25zKSB7XG4gICAgICAgIG1lc3NhZ2UucHVzaChgJyR7YXR0cmlidXRlfScgJHtyZWFzb259YCk7XG4gICAgICB9XG4gICAgfVxuICAgIHRocm93IG5ldyBlcnJvcnMuSW52YWxpZEFyZ3VtZW50RXJyb3IobWVzc2FnZS5qb2luKCc7ICcpKTtcbiAgfVxuXG4gIC8vIFJldHVybiBjYXBzXG4gIHJldHVybiBjYXBzO1xufVxuXG4vKipcbiAqIFN0YW5kYXJkLCBub24tcHJlZml4ZWQgY2FwYWJpbGl0aWVzXG4gKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi93ZWJkcml2ZXIvI2Rmbi10YWJsZS1vZi1zdGFuZGFyZC1jYXBhYmlsaXRpZXMpXG4gKi9cbmV4cG9ydCBjb25zdCBTVEFOREFSRF9DQVBTID0gT2JqZWN0LmZyZWV6ZShcbiAgbmV3IFNldChcbiAgICAvKiogQHR5cGUge2ltcG9ydCgndHlwZS1mZXN0JykuU3RyaW5nS2V5T2Y8aW1wb3J0KCdAYXBwaXVtL3R5cGVzJykuU3RhbmRhcmRDYXBhYmlsaXRpZXM+W119ICovIChbXG4gICAgICAnYnJvd3Nlck5hbWUnLFxuICAgICAgJ2Jyb3dzZXJWZXJzaW9uJyxcbiAgICAgICdwbGF0Zm9ybU5hbWUnLFxuICAgICAgJ2FjY2VwdEluc2VjdXJlQ2VydHMnLFxuICAgICAgJ3BhZ2VMb2FkU3RyYXRlZ3knLFxuICAgICAgJ3Byb3h5JyxcbiAgICAgICdzZXRXaW5kb3dSZWN0JyxcbiAgICAgICd0aW1lb3V0cycsXG4gICAgICAndW5oYW5kbGVkUHJvbXB0QmVoYXZpb3InLFxuICAgIF0pXG4gIClcbik7XG5cbmNvbnN0IFNUQU5EQVJEX0NBUFNfTE9XRVIgPSBuZXcgU2V0KFsuLi5TVEFOREFSRF9DQVBTXS5tYXAoKGNhcCkgPT4gY2FwLnRvTG93ZXJDYXNlKCkpKTtcblxuLyoqXG4gKiBAcGFyYW0ge3N0cmluZ30gY2FwXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAqL1xuZnVuY3Rpb24gaXNTdGFuZGFyZENhcChjYXApIHtcbiAgcmV0dXJuIFNUQU5EQVJEX0NBUFNfTE9XRVIuaGFzKGNhcC50b0xvd2VyQ2FzZSgpKTtcbn1cblxuLyoqXG4gKiBJZiB0aGUgJ2FwcGl1bTonIHByZWZpeCB3YXMgcHJvdmlkZWQgYW5kIGl0J3MgYSB2YWxpZCBjYXBhYmlsaXR5LCBzdHJpcCBvdXQgdGhlIHByZWZpeFxuICogQHRlbXBsYXRlIHtDb25zdHJhaW50c30gW0M9e31dXG4gKiBAcGFyYW0ge2ltcG9ydCgnQGFwcGl1bS90eXBlcycpLk5TQ2FwYWJpbGl0aWVzPEM+fSBjYXBzXG4gKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi93ZWJkcml2ZXIvI2Rmbi1leHRlbnNpb24tY2FwYWJpbGl0aWVzXG4gKiBAaW50ZXJuYWxcbiAqIEByZXR1cm5zIHtpbXBvcnQoJ0BhcHBpdW0vdHlwZXMnKS5DYXBhYmlsaXRpZXM8Qz59XG4gKi9cbmZ1bmN0aW9uIHN0cmlwQXBwaXVtUHJlZml4ZXMoY2Fwcykge1xuICAvLyBzcGxpdCBpbnRvIHByZWZpeGVkIGFuZCBub24tcHJlZml4ZWQuXG4gIC8vIG5vbi1wcmVmaXhlZCBzaG91bGQgYmUgc3RhbmRhcmQgY2FwcyBhdCB0aGlzIHBvaW50XG4gIGNvbnN0IFtwcmVmaXhlZENhcHMsIG5vblByZWZpeGVkQ2Fwc10gPSBfLnBhcnRpdGlvbihfLmtleXMoY2FwcyksIChjYXApID0+XG4gICAgU3RyaW5nKGNhcCkuc3RhcnRzV2l0aChBUFBJVU1fVkVORE9SX1BSRUZJWClcbiAgKTtcblxuICAvLyBpbml0aWFsaXplIHRoaXMgd2l0aCB0aGUgay92IHBhaXJzIG9mIHRoZSBub24tcHJlZml4ZWQgY2Fwc1xuICBsZXQgc3RyaXBwZWRDYXBzID0gLyoqIEB0eXBlIHtpbXBvcnQoJ0BhcHBpdW0vdHlwZXMnKS5DYXBhYmlsaXRpZXM8Qz59ICovIChcbiAgICBfLnBpY2soY2Fwcywgbm9uUHJlZml4ZWRDYXBzKVxuICApO1xuICBjb25zdCBiYWRQcmVmaXhlZENhcHMgPSBbXTtcblxuICAvLyBTdHJpcCBvdXQgdGhlICdhcHBpdW06JyBwcmVmaXhcbiAgZm9yIChsZXQgcHJlZml4ZWRDYXAgb2YgcHJlZml4ZWRDYXBzKSB7XG4gICAgY29uc3Qgc3RyaXBwZWRDYXBOYW1lID1cbiAgICAgIC8qKiBAdHlwZSB7aW1wb3J0KCd0eXBlLWZlc3QnKS5TdHJpbmdLZXlPZjxpbXBvcnQoJ0BhcHBpdW0vdHlwZXMnKS5DYXBhYmlsaXRpZXM8Qz4+fSAqLyAoXG4gICAgICAgIHByZWZpeGVkQ2FwLnN1YnN0cmluZyhBUFBJVU1fVkVORE9SX1BSRUZJWC5sZW5ndGgpXG4gICAgICApO1xuXG4gICAgLy8gSWYgaXQncyBzdGFuZGFyZCBjYXBhYmlsaXR5IHRoYXQgd2FzIHByZWZpeGVkLCBhZGQgaXQgdG8gYW4gYXJyYXkgb2YgaW5jb3JyZWN0bHkgcHJlZml4ZWQgY2FwYWJpbGl0aWVzXG4gICAgaWYgKGlzU3RhbmRhcmRDYXAoc3RyaXBwZWRDYXBOYW1lKSkge1xuICAgICAgYmFkUHJlZml4ZWRDYXBzLnB1c2goc3RyaXBwZWRDYXBOYW1lKTtcbiAgICAgIGlmIChfLmlzTmlsKHN0cmlwcGVkQ2Fwc1tzdHJpcHBlZENhcE5hbWVdKSkge1xuICAgICAgICBzdHJpcHBlZENhcHNbc3RyaXBwZWRDYXBOYW1lXSA9IGNhcHNbcHJlZml4ZWRDYXBdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nLndhcm4oXG4gICAgICAgICAgYElnbm9yaW5nIGNhcGFiaWxpdHkgJyR7cHJlZml4ZWRDYXB9PSR7Y2Fwc1twcmVmaXhlZENhcF19JyBhbmQgYCArXG4gICAgICAgICAgICBgdXNpbmcgY2FwYWJpbGl0eSAnJHtzdHJpcHBlZENhcE5hbWV9PSR7c3RyaXBwZWRDYXBzW3N0cmlwcGVkQ2FwTmFtZV19J2BcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgc3RyaXBwZWRDYXBzW3N0cmlwcGVkQ2FwTmFtZV0gPSBjYXBzW3ByZWZpeGVkQ2FwXTtcbiAgICB9XG4gIH1cblxuICAvLyBJZiB3ZSBmb3VuZCBzdGFuZGFyZCBjYXBzIHRoYXQgd2VyZSBpbmNvcnJlY3RseSBwcmVmaXhlZCwgdGhyb3cgYW4gZXhjZXB0aW9uIChlLmcuOiBkb24ndCBhY2NlcHQgJ2FwcGl1bTpwbGF0Zm9ybU5hbWUnLCBvbmx5IGFjY2VwdCBqdXN0ICdwbGF0Zm9ybU5hbWUnKVxuICBpZiAoYmFkUHJlZml4ZWRDYXBzLmxlbmd0aCA+IDApIHtcbiAgICBsb2cud2FybihcbiAgICAgIGBUaGUgY2FwYWJpbGl0aWVzICR7SlNPTi5zdHJpbmdpZnkoXG4gICAgICAgIGJhZFByZWZpeGVkQ2Fwc1xuICAgICAgKX0gYXJlIHN0YW5kYXJkIGNhcGFiaWxpdGllcyBhbmQgZG8gbm90IHJlcXVpcmUgXCJhcHBpdW06XCIgcHJlZml4YFxuICAgICk7XG4gIH1cbiAgcmV0dXJuIHN0cmlwcGVkQ2Fwcztcbn1cblxuLyoqXG4gKiBHZXQgYW4gYXJyYXkgb2YgYWxsIHRoZSB1bnByZWZpeGVkIGNhcHMgdGhhdCBhcmUgYmVpbmcgdXNlZCBpbiAnYWx3YXlzTWF0Y2gnIGFuZCBhbGwgb2YgdGhlICdmaXJzdE1hdGNoJyBvYmplY3RcbiAqIEB0ZW1wbGF0ZSB7Q29uc3RyYWludHN9IFtDPXt9XVxuICogQHBhcmFtIHtpbXBvcnQoJ0BhcHBpdW0vdHlwZXMnKS5XM0NDYXBhYmlsaXRpZXM8Qz59IGNhcHMgQSBjYXBhYmlsaXRpZXMgb2JqZWN0XG4gKi9cbmZ1bmN0aW9uIGZpbmROb25QcmVmaXhlZENhcHMoe2Fsd2F5c01hdGNoID0ge30sIGZpcnN0TWF0Y2ggPSBbXX0pIHtcbiAgcmV0dXJuIF8uY2hhaW4oW2Fsd2F5c01hdGNoLCAuLi5maXJzdE1hdGNoXSlcbiAgICAucmVkdWNlKFxuICAgICAgKHVucHJlZml4ZWRDYXBzLCBjYXBzKSA9PiBbXG4gICAgICAgIC4uLnVucHJlZml4ZWRDYXBzLFxuICAgICAgICAuLi5PYmplY3Qua2V5cyhjYXBzKS5maWx0ZXIoKGNhcCkgPT4gIWNhcC5pbmNsdWRlcygnOicpICYmICFpc1N0YW5kYXJkQ2FwKGNhcCkpLFxuICAgICAgXSxcbiAgICAgIFtdXG4gICAgKVxuICAgIC51bmlxKClcbiAgICAudmFsdWUoKTtcbn1cblxuLyoqXG4gKiBQYXJzZSBjYXBhYmlsaXRpZXNcbiAqIEB0ZW1wbGF0ZSB7Q29uc3RyYWludHN9IFtDPXt9XVxuICogQHBhcmFtIHtpbXBvcnQoJ0BhcHBpdW0vdHlwZXMnKS5XM0NDYXBhYmlsaXRpZXM8Qz59IGNhcHNcbiAqIEBwYXJhbSB7Q30gW2NvbnN0cmFpbnRzXVxuICogQHBhcmFtIHtib29sZWFufSBbc2hvdWxkVmFsaWRhdGVDYXBzXVxuICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvd2ViZHJpdmVyLyNwcm9jZXNzaW5nLWNhcGFiaWxpdGllc1xuICovXG5mdW5jdGlvbiBwYXJzZUNhcHMoY2FwcywgY29uc3RyYWludHMgPSAvKiogQHR5cGUge0N9ICovICh7fSksIHNob3VsZFZhbGlkYXRlQ2FwcyA9IHRydWUpIHtcbiAgLy8gSWYgY2FwYWJpbGl0aWVzIHJlcXVlc3QgaXMgbm90IGFuIG9iamVjdCwgcmV0dXJuIGVycm9yICgjMS4xKVxuICBpZiAoIV8uaXNQbGFpbk9iamVjdChjYXBzKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuSW52YWxpZEFyZ3VtZW50RXJyb3IoXG4gICAgICAnVGhlIGNhcGFiaWxpdGllcyBhcmd1bWVudCB3YXMgbm90IHZhbGlkIGZvciB0aGUgZm9sbG93aW5nIHJlYXNvbihzKTogXCJjYXBhYmlsaXRpZXNcIiBtdXN0IGJlIGEgSlNPTiBvYmplY3QuJ1xuICAgICk7XG4gIH1cblxuICAvLyBMZXQgJ3JlcXVpcmVkQ2FwcycgYmUgcHJvcGVydHkgbmFtZWQgJ2Fsd2F5c01hdGNoJyBmcm9tIGNhcGFiaWxpdGllcyByZXF1ZXN0ICgjMilcbiAgLy8gYW5kICdhbGxGaXJzdE1hdGNoQ2FwcycgYmUgcHJvcGVydHkgbmFtZWQgJ2ZpcnN0TWF0Y2gnIGZyb20gY2FwYWJpbGl0aWVzIHJlcXVlc3QgKCMzKVxuICBsZXQge1xuICAgIGFsd2F5c01hdGNoOiByZXF1aXJlZENhcHMgPSB7fSwgLy8gSWYgJ3JlcXVpcmVkQ2FwcycgaXMgdW5kZWZpbmVkLCBzZXQgaXQgdG8gYW4gZW1wdHkgSlNPTiBvYmplY3QgKCMyLjEpXG4gICAgZmlyc3RNYXRjaDogYWxsRmlyc3RNYXRjaENhcHMgPSBbe31dLCAvLyBJZiAnZmlyc3RNYXRjaCcgaXMgdW5kZWZpbmVkIHNldCBpdCB0byBhIHNpbmdsZXRvbiBsaXN0IHdpdGggb25lIGVtcHR5IG9iamVjdCAoIzMuMSlcbiAgfSA9IGNhcHM7XG5cbiAgLy8gUmVqZWN0ICdmaXJzdE1hdGNoJyBhcmd1bWVudCBpZiBpdCdzIG5vdCBhbiBhcnJheSAoIzMuMilcbiAgaWYgKCFfLmlzQXJyYXkoYWxsRmlyc3RNYXRjaENhcHMpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5JbnZhbGlkQXJndW1lbnRFcnJvcihcbiAgICAgICdUaGUgY2FwYWJpbGl0aWVzLmZpcnN0TWF0Y2ggYXJndW1lbnQgd2FzIG5vdCB2YWxpZCBmb3IgdGhlIGZvbGxvd2luZyByZWFzb24ocyk6IFwiY2FwYWJpbGl0aWVzLmZpcnN0TWF0Y2hcIiBtdXN0IGJlIGEgSlNPTiBhcnJheSBvciB1bmRlZmluZWQnXG4gICAgKTtcbiAgfVxuXG4gIC8vIElmIGFuIGVtcHR5IGFycmF5IGFzIHByb3ZpZGVkLCB3ZSdsbCBiZSBmb3JnaXZpbmcgYW5kIG1ha2UgaXQgYW4gYXJyYXkgb2Ygb25lIGVtcHR5IG9iamVjdFxuICAvLyBJbiB0aGUgZnV0dXJlLCByZWplY3QgJ2ZpcnN0TWF0Y2gnIGFyZ3VtZW50IGlmIGl0cyBhcnJheSBkaWQgbm90IGhhdmUgb25lIG9yIG1vcmUgZW50cmllcyAoIzMuMilcbiAgaWYgKGFsbEZpcnN0TWF0Y2hDYXBzLmxlbmd0aCA9PT0gMCkge1xuICAgIGxvZy53YXJuKFxuICAgICAgYFRoZSBmaXJzdE1hdGNoIGFycmF5IGluIHRoZSBnaXZlbiBjYXBhYmlsaXRpZXMgaGFzIG5vIGVudHJpZXMuIEFkZGluZyBhbiBlbXB0eSBlbnRyeSBmbyBybm93LCBgICtcbiAgICAgICAgYGJ1dCBpdCB3aWxsIHJlcXVpcmUgb25lIG9yIG1vcmUgZW50cmllcyBhcyBXM0Mgc3BlYy5gXG4gICAgKTtcbiAgICBhbGxGaXJzdE1hdGNoQ2Fwcy5wdXNoKHt9KTtcbiAgfVxuXG4gIC8vIENoZWNrIGZvciBub24tcHJlZml4ZWQsIG5vbi1zdGFuZGFyZCBjYXBhYmlsaXRpZXMgYW5kIGxvZyB3YXJuaW5ncyBpZiB0aGV5IGFyZSBmb3VuZFxuICBsZXQgbm9uUHJlZml4ZWRDYXBzID0gZmluZE5vblByZWZpeGVkQ2FwcyhjYXBzKTtcbiAgaWYgKCFfLmlzRW1wdHkobm9uUHJlZml4ZWRDYXBzKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuSW52YWxpZEFyZ3VtZW50RXJyb3IoXG4gICAgICBgQWxsIG5vbi1zdGFuZGFyZCBjYXBhYmlsaXRpZXMgc2hvdWxkIGhhdmUgYSB2ZW5kb3IgcHJlZml4LiBUaGUgZm9sbG93aW5nIGNhcGFiaWxpdGllcyBkaWQgbm90IGhhdmUgb25lOiAke25vblByZWZpeGVkQ2Fwc31gXG4gICAgKTtcbiAgfVxuXG4gIC8vIFN0cmlwIG91dCB0aGUgJ2FwcGl1bTonIHByZWZpeCBmcm9tIGFsbFxuICBsZXQgc3RyaXBwZWRSZXF1aXJlZENhcHMgPSBzdHJpcEFwcGl1bVByZWZpeGVzKHJlcXVpcmVkQ2Fwcyk7XG4gIGxldCBzdHJpcHBlZEFsbEZpcnN0TWF0Y2hDYXBzID0gYWxsRmlyc3RNYXRjaENhcHMubWFwKHN0cmlwQXBwaXVtUHJlZml4ZXMpO1xuXG4gIC8vIFZhbGlkYXRlIHRoZSByZXF1aXJlZENhcHMuIEJ1dCBkb24ndCB2YWxpZGF0ZSAncHJlc2VuY2UnIGJlY2F1c2UgaWYgdGhhdCBjb25zdHJhaW50IGZhaWxzIG9uICdhbHdheXNNYXRjaCcgaXQgY291bGQgc3RpbGwgcGFzcyBvbiBvbmUgb2YgdGhlICdmaXJzdE1hdGNoJyBrZXlzXG4gIGlmIChzaG91bGRWYWxpZGF0ZUNhcHMpIHtcbiAgICBzdHJpcHBlZFJlcXVpcmVkQ2FwcyA9IHZhbGlkYXRlQ2FwcyhzdHJpcHBlZFJlcXVpcmVkQ2FwcywgY29uc3RyYWludHMsIHtcbiAgICAgIHNraXBQcmVzZW5jZUNvbnN0cmFpbnQ6IHRydWUsXG4gICAgfSk7XG4gIH1cbiAgLy8gUmVtb3ZlIHRoZSAncHJlc2VuY2UnIGNvbnN0cmFpbnQgZm9yIGFueSBrZXlzIHRoYXQgYXJlIGFscmVhZHkgcHJlc2VudCBpbiAncmVxdWlyZWRDYXBzJ1xuICAvLyBzaW5jZSB3ZSBrbm93IHRoYXQgdGhpcyBjb25zdHJhaW50IGhhcyBhbHJlYWR5IHBhc3NlZFxuICBjb25zdCBmaWx0ZXJlZENvbnN0cmFpbnRzID0gLyoqIEB0eXBlIHtDfSAqLyAoXG4gICAgXy5vbWl0QnkoY29uc3RyYWludHMsIChfLCBrZXkpID0+IGtleSBpbiBzdHJpcHBlZFJlcXVpcmVkQ2FwcylcbiAgKTtcblxuICAvLyBWYWxpZGF0ZSBhbGwgb2YgdGhlIGZpcnN0IG1hdGNoIGNhcGFiaWxpdGllcyBhbmQgcmV0dXJuIGFuIGFycmF5IHdpdGggb25seSB0aGUgdmFsaWQgY2FwcyAoc2VlIHNwZWMgIzUpXG4gIC8qKiBAdHlwZSB7c3RyaW5nW119ICovXG4gIGxldCB2YWxpZGF0aW9uRXJyb3JzID0gW107XG4gIGxldCB2YWxpZGF0ZWRGaXJzdE1hdGNoQ2FwcyA9IF8uY29tcGFjdChcbiAgICBzdHJpcHBlZEFsbEZpcnN0TWF0Y2hDYXBzLm1hcChcbiAgICAgIC8qKlxuICAgICAgICogQHBhcmFtIHtpbXBvcnQoJ0BhcHBpdW0vdHlwZXMnKS5DYXBhYmlsaXRpZXM8Qz59IGZpcnN0TWF0Y2hDYXBzXG4gICAgICAgKi9cbiAgICAgIChmaXJzdE1hdGNoQ2FwcykgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIC8vIFZhbGlkYXRlIGZpcnN0TWF0Y2ggY2Fwc1xuICAgICAgICAgIHJldHVybiBzaG91bGRWYWxpZGF0ZUNhcHNcbiAgICAgICAgICAgID8gdmFsaWRhdGVDYXBzKGZpcnN0TWF0Y2hDYXBzLCBmaWx0ZXJlZENvbnN0cmFpbnRzKVxuICAgICAgICAgICAgOiBmaXJzdE1hdGNoQ2FwcztcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIHZhbGlkYXRpb25FcnJvcnMucHVzaChlLm1lc3NhZ2UpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgKVxuICApO1xuXG4gIC8vIFRyeSB0byBtZXJnZSByZXF1aXJlZENhcHMgd2l0aCBmaXJzdCBtYXRjaCBjYXBhYmlsaXRpZXMsIGJyZWFrIG9uY2UgaXQgZmluZHMgaXRzIGZpcnN0IG1hdGNoIChzZWUgc3BlYyAjNilcbiAgbGV0IG1hdGNoZWRDYXBzID0gbnVsbDtcbiAgZm9yIChsZXQgZmlyc3RNYXRjaENhcHMgb2YgdmFsaWRhdGVkRmlyc3RNYXRjaENhcHMpIHtcbiAgICB0cnkge1xuICAgICAgbWF0Y2hlZENhcHMgPSBtZXJnZUNhcHMoc3RyaXBwZWRSZXF1aXJlZENhcHMsIGZpcnN0TWF0Y2hDYXBzKTtcbiAgICAgIGlmIChtYXRjaGVkQ2Fwcykge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy53YXJuKGVyci5tZXNzYWdlKTtcbiAgICAgIHZhbGlkYXRpb25FcnJvcnMucHVzaChlcnIubWVzc2FnZSk7XG4gICAgfVxuICB9XG5cbiAgLy8gUmV0dXJucyB2YXJpYWJsZXMgZm9yIHRlc3RpbmcgcHVycG9zZXNcbiAgcmV0dXJuIHtcbiAgICByZXF1aXJlZENhcHMsXG4gICAgYWxsRmlyc3RNYXRjaENhcHMsXG4gICAgdmFsaWRhdGVkRmlyc3RNYXRjaENhcHMsXG4gICAgbWF0Y2hlZENhcHMsXG4gICAgdmFsaWRhdGlvbkVycm9ycyxcbiAgfTtcbn1cblxuLy8gQ2FsbHMgcGFyc2VDYXBzIGFuZCBqdXN0IHJldHVybnMgdGhlIG1hdGNoZWRDYXBzIHZhcmlhYmxlXG4vKipcbiAqIEB0ZW1wbGF0ZSB7Q29uc3RyYWludHN9IENcbiAqIEBwYXJhbSB7aW1wb3J0KCdAYXBwaXVtL3R5cGVzJykuVzNDQ2FwYWJpbGl0aWVzPEM+fSB3M2NDYXBzXG4gKiBAcGFyYW0ge0N9IFtjb25zdHJhaW50c11cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gW3Nob3VsZFZhbGlkYXRlQ2Fwc11cbiAqIEByZXR1cm5zIHtpbXBvcnQoJ0BhcHBpdW0vdHlwZXMnKS5DYXBhYmlsaXRpZXM8Qz59XG4gKi9cbmZ1bmN0aW9uIHByb2Nlc3NDYXBhYmlsaXRpZXMoXG4gIHczY0NhcHMsXG4gIGNvbnN0cmFpbnRzID0gLyoqIEB0eXBlIHtDfSAqLyAoe30pLFxuICBzaG91bGRWYWxpZGF0ZUNhcHMgPSB0cnVlXG4pIHtcbiAgY29uc3Qge21hdGNoZWRDYXBzLCB2YWxpZGF0aW9uRXJyb3JzfSA9IHBhcnNlQ2Fwcyh3M2NDYXBzLCBjb25zdHJhaW50cywgc2hvdWxkVmFsaWRhdGVDYXBzKTtcblxuICAvLyBJZiB3ZSBmb3VuZCBhbiBlcnJvciB0aHJvdyBhbiBleGNlcHRpb25cbiAgaWYgKCF1dGlsLmhhc1ZhbHVlKG1hdGNoZWRDYXBzKSkge1xuICAgIGlmIChfLmlzQXJyYXkodzNjQ2Fwcy5maXJzdE1hdGNoKSAmJiB3M2NDYXBzLmZpcnN0TWF0Y2gubGVuZ3RoID4gMSkge1xuICAgICAgLy8gSWYgdGhlcmUgd2FzIG1vcmUgdGhhbiBvbmUgJ2ZpcnN0TWF0Y2gnIGNhcCwgaW5kaWNhdGUgdGhhdCB3ZSBjb3VsZG4ndCBmaW5kIGEgbWF0Y2hpbmcgY2FwYWJpbGl0aWVzIHNldCBhbmQgc2hvdyBhbGwgdGhlIGVycm9yc1xuICAgICAgdGhyb3cgbmV3IGVycm9ycy5JbnZhbGlkQXJndW1lbnRFcnJvcihcbiAgICAgICAgYENvdWxkIG5vdCBmaW5kIG1hdGNoaW5nIGNhcGFiaWxpdGllcyBmcm9tICR7SlNPTi5zdHJpbmdpZnkoXG4gICAgICAgICAgdzNjQ2Fwc1xuICAgICAgICApfTpcXG4gJHt2YWxpZGF0aW9uRXJyb3JzLmpvaW4oJ1xcbicpfWBcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIE90aGVyd2lzZSwganVzdCBzaG93IHRoZSBzaW5ndWxhciBlcnJvciBtZXNzYWdlXG4gICAgICB0aHJvdyBuZXcgZXJyb3JzLkludmFsaWRBcmd1bWVudEVycm9yKHZhbGlkYXRpb25FcnJvcnNbMF0pO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiAvKiogQHR5cGUge0NhcGFiaWxpdGllczxDPn0gKi8gKG1hdGNoZWRDYXBzID8/IHt9KTtcbn1cblxuLyoqXG4gKiBSZXR1cm4gYSBjb3B5IG9mIGEgY2FwYWJpbGl0aWVzIG9iamVjdCB3aGljaCBoYXMgdGFrZW4gZXZlcnl0aGluZyB3aXRoaW4gdGhlICdvcHRpb25zJ1xuICogY2FwYWJpbGl0eSBhbmQgcHJvbW90ZWQgaXQgdG8gdGhlIHRvcCBsZXZlbC4gTm90ZSB0aGF0IHRoaXMgZnVuY3Rpb24gaXMgYXNzdW1lZCB0byBiZSBydW4gYWZ0ZXJcbiAqIGFsbCB2ZW5kb3IgcHJlZml4ZXMgaGF2ZSBhbHJlYWR5IGJlZW4gc3RyaXBwZWQgZnJvbSB0aGUgdG9wIGxldmVsLiBTbyB3ZSBhcmUgZGVhbGluZyB3aXRoIGUuZy5cbiAqICdvcHRpb25zJyBhbmQgbm90ICdhcHBpdW06b3B0aW9ucycgYXQgdGhpcyBwb2ludC4gQW55IHByZWZpeGVzIF9pbnNpZGVfIHRoZSAnb3B0aW9ucycgY2FwYWJpbGl0eVxuICogd2lsbCB0aGVtc2VsdmVzIGJlIHN0cmlwcGVkLiBUaGlzIGlzIGRlc2lnbmVkIGFzIGFuIGludGVybmFsIGZ1bmN0aW9uLCBub3Qgb25lIHRvIG9wZXJhdGUgb25cbiAqIHVzZXItY29uc3RydWN0ZWQgY2FwYWJpbGl0aWVzLlxuICpcbiAqIEBwYXJhbSB7b2JqZWN0fSBvcmlnaW5hbENhcHMgLSB0aGUgY2FwYWJpbGl0aWVzIHRvIGFuYWx5emUgYW5kIHByb21vdGUgZnJvbSAnb3B0aW9ucydcbiAqIEByZXR1cm4ge29iamVjdCF9IC0gdGhlIGNhcGFiaWxpdGllcyB3aXRoICdvcHRpb25zJyBwcm9tb3RlZCBpZiBuZWNlc3NhcnlcbiAqL1xuZnVuY3Rpb24gcHJvbW90ZUFwcGl1bU9wdGlvbnMob3JpZ2luYWxDYXBzKSB7XG4gIGNvbnN0IGFwcGl1bU9wdGlvbnMgPSBvcmlnaW5hbENhcHNbQVBQSVVNX09QVFNfQ0FQXTtcbiAgaWYgKCFhcHBpdW1PcHRpb25zKSB7XG4gICAgcmV0dXJuIG9yaWdpbmFsQ2FwcztcbiAgfVxuXG4gIGxldCBjYXBzID0gXy5jbG9uZURlZXAob3JpZ2luYWxDYXBzKTtcbiAgaWYgKCFfLmlzUGxhaW5PYmplY3QoYXBwaXVtT3B0aW9ucykpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlNlc3Npb25Ob3RDcmVhdGVkRXJyb3IoYFRoZSAke0FQUElVTV9PUFRTX0NBUH0gY2FwYWJpbGl0eSBtdXN0IGJlIGFuIG9iamVjdGApO1xuICB9XG5cbiAgLy8gZmlyc3QgZ2V0IHJpZCBvZiBhbnkgcHJlZml4ZXMgaW5zaWRlIGFwcGl1bTpvcHRpb25zXG4gIGNvbnN0IHN0cmlwcGVkQXBwaXVtT3B0aW9ucyA9IHN0cmlwQXBwaXVtUHJlZml4ZXMoYXBwaXVtT3B0aW9ucyk7XG4gIC8vIHdhcm4gaWYgd2UgYXJlIGdvaW5nIHRvIG92ZXJ3cml0ZSBhbnkga2V5cyBvbiB0aGUgYmFzZSBjYXBzIG9iamVjdFxuICBjb25zdCBvdmVyd3JpdHRlbktleXMgPSBfLmludGVyc2VjdGlvbihPYmplY3Qua2V5cyhjYXBzKSwgT2JqZWN0LmtleXMoc3RyaXBwZWRBcHBpdW1PcHRpb25zKSk7XG4gIGlmIChvdmVyd3JpdHRlbktleXMubGVuZ3RoID4gMCkge1xuICAgIGxvZy53YXJuKFxuICAgICAgYEZvdW5kIGNhcGFiaWxpdGllcyBpbnNpZGUgJHtQUkVGSVhFRF9BUFBJVU1fT1BUU19DQVB9IHRoYXQgd2lsbCBvdmVyd3JpdGUgYCArXG4gICAgICAgIGBjYXBhYmlsaXRpZXMgYXQgdGhlIHRvcCBsZXZlbDogJHtKU09OLnN0cmluZ2lmeShvdmVyd3JpdHRlbktleXMpfWBcbiAgICApO1xuICB9XG5cbiAgLy8gbm93IGp1c3QgYXBwbHkgdGhlbSB0byB0aGUgbWFpbiBjYXBzIG9iamVjdFxuICBjYXBzID0gey4uLmNhcHMsIC4uLnN0cmlwcGVkQXBwaXVtT3B0aW9uc307XG5cbiAgLy8gYW5kIHJlbW92ZSBhbGwgdHJhY2VzIG9mIHRoZSBvcHRpb25zIGNhcFxuICBkZWxldGUgY2Fwc1tBUFBJVU1fT1BUU19DQVBdO1xuICByZXR1cm4gY2Fwcztcbn1cblxuZXhwb3J0IHtcbiAgcGFyc2VDYXBzLFxuICBwcm9jZXNzQ2FwYWJpbGl0aWVzLFxuICB2YWxpZGF0ZUNhcHMsXG4gIG1lcmdlQ2FwcyxcbiAgQVBQSVVNX1ZFTkRPUl9QUkVGSVgsXG4gIEFQUElVTV9PUFRTX0NBUCxcbiAgZmluZE5vblByZWZpeGVkQ2FwcyxcbiAgaXNTdGFuZGFyZENhcCxcbiAgc3RyaXBBcHBpdW1QcmVmaXhlcyxcbiAgcHJvbW90ZUFwcGl1bU9wdGlvbnMsXG4gIFBSRUZJWEVEX0FQUElVTV9PUFRTX0NBUCxcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge2ltcG9ydCgnQGFwcGl1bS90eXBlcycpLkNvbnN0cmFpbnRzfSBDb25zdHJhaW50c1xuICogQHR5cGVkZWYge2ltcG9ydCgnQGFwcGl1bS90eXBlcycpLkNvbnN0cmFpbnR9IENvbnN0cmFpbnRcbiAqIEB0eXBlZGVmIHtpbXBvcnQoJ0BhcHBpdW0vdHlwZXMnKS5TdHJpbmdSZWNvcmR9IFN0cmluZ1JlY29yZFxuICogQHR5cGVkZWYge2ltcG9ydCgnQGFwcGl1bS90eXBlcycpLkJhc2VEcml2ZXJDYXBDb25zdHJhaW50c30gQmFzZURyaXZlckNhcENvbnN0cmFpbnRzXG4gKi9cblxuLyoqXG4gKiBAdHlwZWRlZiBWYWxpZGF0ZUNhcHNPcHRzXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IFtza2lwUHJlc2VuY2VDb25zdHJhaW50XSAtIGlmIHRydWUsIHNraXAgdGhlIHByZXNlbmNlIGNvbnN0cmFpbnRcbiAqL1xuXG4vKipcbiAqIEB0ZW1wbGF0ZSB7Q29uc3RyYWludHN9IFtDPUJhc2VEcml2ZXJDYXBDb25zdHJhaW50c11cbiAqIEB0ZW1wbGF0ZSB7U3RyaW5nUmVjb3JkfHZvaWR9IFtFeHRyYT12b2lkXVxuICogQHR5cGVkZWYge2ltcG9ydCgnQGFwcGl1bS90eXBlcycpLk5TQ2FwYWJpbGl0aWVzPEMsIEV4dHJhPn0gTlNDYXBhYmlsaXRpZXNcbiAqL1xuXG4vKipcbiAqIEB0ZW1wbGF0ZSB7Q29uc3RyYWludHN9IFtDPUJhc2VEcml2ZXJDYXBDb25zdHJhaW50c11cbiAqIEB0ZW1wbGF0ZSB7U3RyaW5nUmVjb3JkfHZvaWR9IFtFeHRyYT12b2lkXVxuICogQHR5cGVkZWYge2ltcG9ydCgnQGFwcGl1bS90eXBlcycpLkNhcGFiaWxpdGllczxDLCBFeHRyYT59IENhcGFiaWxpdGllc1xuICovXG5cbi8qKlxuICogQHRlbXBsYXRlIHtDb25zdHJhaW50c30gW0M9QmFzZURyaXZlckNhcENvbnN0cmFpbnRzXVxuICogQHRlbXBsYXRlIHtTdHJpbmdSZWNvcmR8dm9pZH0gW0V4dHJhPXZvaWRdXG4gKiBAdHlwZWRlZiB7aW1wb3J0KCdAYXBwaXVtL3R5cGVzJykuVzNDQ2FwYWJpbGl0aWVzPEMsIEV4dHJhPn0gVzNDQ2FwYWJpbGl0aWVzXG4gKi9cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUVBLE1BQU1BLG9CQUFvQixHQUFHLFNBQTdCOztBQUNBLE1BQU1DLGVBQWUsR0FBRyxTQUF4Qjs7QUFDQSxNQUFNQyx3QkFBd0IsR0FBSSxHQUFFRixvQkFBcUIsR0FBRUMsZUFBZ0IsRUFBM0U7OztBQVdBLFNBQVNFLFNBQVQsQ0FBbUJDLE9BQU8sR0FBRyxFQUE3QixFQUFpQ0MsU0FBUyxHQUFHLEVBQTdDLEVBQWlEO0VBQy9DLElBQUlDLE1BQU0sR0FBK0UsRUFDdkYsR0FBR0Y7RUFEb0YsQ0FBekY7O0VBSUEsS0FBSyxJQUFJLENBQUNHLElBQUQsRUFBT0MsS0FBUCxDQUFULElBQXdFQyxlQUFBLENBQUVDLE9BQUYsQ0FBVUwsU0FBVixDQUF4RSxFQUErRjtJQUU3RixJQUFJLENBQUNJLGVBQUEsQ0FBRUUsV0FBRixDQUFjUCxPQUFPLENBQUNHLElBQUQsQ0FBckIsQ0FBTCxFQUFtQztNQUNqQyxNQUFNLElBQUlLLGNBQUEsQ0FBT0Msb0JBQVgsQ0FDSCxhQUFZTixJQUFLLHVDQUFzQ08sSUFBSSxDQUFDQyxTQUFMLENBQ3REWCxPQURzRCxDQUV0RCxvQkFBbUJVLElBQUksQ0FBQ0MsU0FBTCxDQUFlVixTQUFmLENBQTBCLFVBSDNDLENBQU47SUFLRDs7SUFDREMsTUFBTSxDQUFxQ0MsSUFBckMsQ0FBTixHQUFvREMsS0FBcEQ7RUFD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