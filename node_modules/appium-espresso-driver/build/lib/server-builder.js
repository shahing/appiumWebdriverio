"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.VERSION_KEYS = exports.ServerBuilder = exports.GRADLE_URL_TEMPLATE = void 0;
exports.buildServerSigningConfig = buildServerSigningConfig;
exports.default = void 0;
require("source-map-support/register");
var _teen_process = require("teen_process");
var _support = require("appium/support");
var _lodash = _interopRequireDefault(require("lodash"));
var _path = _interopRequireDefault(require("path"));
var _os = require("os");
var _utils = require("./utils");
const GRADLE_VERSION_KEY = 'gradle';
const GRADLE_URL_PREFIX = 'distributionUrl=';
const GRADLE_URL_TEMPLATE = 'https\\://services.gradle.org/distributions/gradle-VERSION-all.zip';
exports.GRADLE_URL_TEMPLATE = GRADLE_URL_TEMPLATE;
const GRADLE_MAX_ERROR_LOG_LINES = 15;
const DEPENDENCY_PROP_NAMES = ['additionalAppDependencies', 'additionalAndroidTestDependencies'];
const VERSION_KEYS = [GRADLE_VERSION_KEY, 'androidGradlePlugin', 'compileSdk', 'buildTools', 'minSdk', 'targetSdk', 'kotlin', 'sourceCompatibility', 'targetCompatibility', 'jvmTarget', 'composeVersion', 'annotationVersion'];
exports.VERSION_KEYS = VERSION_KEYS;
function buildServerSigningConfig(args) {
  return {
    zipAlign: true,
    keystoreFile: args.keystoreFile,
    keystorePassword: args.keystorePassword,
    keyAlias: args.keyAlias,
    keyPassword: args.keyPassword
  };
}
class ServerBuilder {
  constructor(log, args = {}) {
    this.log = log;
    this.serverPath = args.serverPath;
    this.showGradleLog = args.showGradleLog;
    const buildConfiguration = args.buildConfiguration || {};
    const versionConfiguration = buildConfiguration.toolsVersions || {};
    this.serverVersions = _lodash.default.reduce(versionConfiguration, (acc, value, key) => {
      if (VERSION_KEYS.includes(key)) {
        acc[key] = value;
      } else {
        log.warn(`Got unexpected '${key}' in toolsVersion block of the build configuration`);
      }
      return acc;
    }, {});
    this.testAppPackage = args.testAppPackage;
    this.signingConfig = args.signingConfig;
    for (const propName of DEPENDENCY_PROP_NAMES) {
      this[propName] = buildConfiguration[propName] || [];
    }
  }
  async build() {
    if (this.serverVersions[GRADLE_VERSION_KEY]) {
      await this.setGradleWrapperVersion(this.serverVersions[GRADLE_VERSION_KEY]);
    }
    await this.insertAdditionalDependencies();
    await this.runBuildProcess();
  }
  getCommand() {
    const cmd = _support.system.isWindows() ? 'gradlew.bat' : _path.default.resolve(this.serverPath, 'gradlew');
    const buildProperty = (key, value) => value ? `-P${key}=${value}` : null;
    let args = VERSION_KEYS.filter(key => key !== GRADLE_VERSION_KEY).map(key => {
      const serverVersion = this.serverVersions[key];
      const gradleProperty = `appium${key.charAt(0).toUpperCase()}${key.slice(1)}`;
      return buildProperty(gradleProperty, serverVersion);
    }).filter(Boolean);
    if (this.signingConfig) {
      args.push(..._lodash.default.keys(this.signingConfig).map(key => [`appium${_lodash.default.upperFirst(key)}`, this.signingConfig[key]]).map(([k, v]) => buildProperty(k, v)).filter(Boolean));
    }
    if (this.testAppPackage) {
      args.push(buildProperty('appiumTargetPackage', this.testAppPackage));
    }
    args.push('app:assembleAndroidTest');
    return {
      cmd,
      args
    };
  }
  async setGradleWrapperVersion(version) {
    const propertiesPath = _path.default.resolve(this.serverPath, 'gradle', 'wrapper', 'gradle-wrapper.properties');
    const originalProperties = await _support.fs.readFile(propertiesPath, 'utf8');
    const newProperties = this.updateGradleDistUrl(originalProperties, version);
    await _support.fs.writeFile(propertiesPath, newProperties, 'utf8');
  }
  updateGradleDistUrl(propertiesContent, version) {
    return propertiesContent.replace(new RegExp(`^(${_lodash.default.escapeRegExp(GRADLE_URL_PREFIX)}).+$`, 'gm'), `$1${GRADLE_URL_TEMPLATE.replace('VERSION', version)}`);
  }
  async insertAdditionalDependencies() {
    let hasAdditionalDeps = false;
    for (const propName of DEPENDENCY_PROP_NAMES) {
      if (!_lodash.default.isArray(this[propName])) {
        throw new Error(`'${propName}' must be an array`);
      }
      if (_lodash.default.isEmpty(this[propName].filter(line => _lodash.default.trim(line)))) {
        continue;
      }
      for (const dep of this[propName]) {
        if (/[\s'\\$]/.test(dep)) {
          throw new Error('Single quotes, dollar characters and whitespace characters' + ` are disallowed in additional dependencies: ${dep}`);
        }
      }
      hasAdditionalDeps = true;
    }
    if (!hasAdditionalDeps) {
      return;
    }
    const buildPath = _path.default.resolve(this.serverPath, 'app', 'build.gradle.kts');
    let configuration = await _support.fs.readFile(buildPath, 'utf8');
    for (const propName of DEPENDENCY_PROP_NAMES) {
      const prefix = propName === DEPENDENCY_PROP_NAMES[0] ? 'implementation' : 'androidTestImplementation';
      const deps = this[propName].filter(line => _lodash.default.trim(line)).map(line => `${prefix}("${line}")`);
      if (_lodash.default.isEmpty(deps)) {
        continue;
      }
      this.log.info(`Adding the following ${propName} to build.gradle.kts: ${deps}`);
      configuration = (0, _utils.updateDependencyLines)(configuration, propName, deps);
    }
    await _support.fs.writeFile(buildPath, configuration, 'utf8');
  }
  async runBuildProcess() {
    const {
      cmd,
      args
    } = this.getCommand();
    this.log.debug(`Beginning build with command '${cmd} ${args.join(' ')}' ` + `in directory '${this.serverPath}'`);
    const gradlebuild = new _teen_process.SubProcess(cmd, args, {
      cwd: this.serverPath,
      stdio: ['ignore', 'pipe', 'pipe'],
      windowsVerbatimArguments: true
    });
    let buildLastLines = [];
    const logMsg = `Output from Gradle ${this.showGradleLog ? 'will' : 'will not'} be logged`;
    this.log.debug(`${logMsg}. To change this, use 'showGradleLog' desired capability`);
    gradlebuild.on('stream-line', line => {
      if (this.showGradleLog) {
        if (line.startsWith('[STDERR]')) {
          this.log.warn(`[Gradle] ${line}`);
        } else {
          this.log.info(`[Gradle] ${line}`);
        }
      }
      buildLastLines.push(`${_os.EOL}${line}`);
      if (buildLastLines.length > GRADLE_MAX_ERROR_LOG_LINES) {
        buildLastLines = buildLastLines.slice(-GRADLE_MAX_ERROR_LOG_LINES);
      }
    });
    try {
      await gradlebuild.start();
      await gradlebuild.join();
    } catch (err) {
      let msg = `Unable to build Espresso server - ${err.message}\n` + `Gradle error message:${_os.EOL}${buildLastLines}`;
      this.log.errorAndThrow(msg);
    }
  }
}
exports.ServerBuilder = ServerBuilder;
var _default = ServerBuilder;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJHUkFETEVfVkVSU0lPTl9LRVkiLCJHUkFETEVfVVJMX1BSRUZJWCIsIkdSQURMRV9VUkxfVEVNUExBVEUiLCJHUkFETEVfTUFYX0VSUk9SX0xPR19MSU5FUyIsIkRFUEVOREVOQ1lfUFJPUF9OQU1FUyIsIlZFUlNJT05fS0VZUyIsImJ1aWxkU2VydmVyU2lnbmluZ0NvbmZpZyIsImFyZ3MiLCJ6aXBBbGlnbiIsImtleXN0b3JlRmlsZSIsImtleXN0b3JlUGFzc3dvcmQiLCJrZXlBbGlhcyIsImtleVBhc3N3b3JkIiwiU2VydmVyQnVpbGRlciIsImNvbnN0cnVjdG9yIiwibG9nIiwic2VydmVyUGF0aCIsInNob3dHcmFkbGVMb2ciLCJidWlsZENvbmZpZ3VyYXRpb24iLCJ2ZXJzaW9uQ29uZmlndXJhdGlvbiIsInRvb2xzVmVyc2lvbnMiLCJzZXJ2ZXJWZXJzaW9ucyIsIl8iLCJyZWR1Y2UiLCJhY2MiLCJ2YWx1ZSIsImtleSIsImluY2x1ZGVzIiwid2FybiIsInRlc3RBcHBQYWNrYWdlIiwic2lnbmluZ0NvbmZpZyIsInByb3BOYW1lIiwiYnVpbGQiLCJzZXRHcmFkbGVXcmFwcGVyVmVyc2lvbiIsImluc2VydEFkZGl0aW9uYWxEZXBlbmRlbmNpZXMiLCJydW5CdWlsZFByb2Nlc3MiLCJnZXRDb21tYW5kIiwiY21kIiwic3lzdGVtIiwiaXNXaW5kb3dzIiwicGF0aCIsInJlc29sdmUiLCJidWlsZFByb3BlcnR5IiwiZmlsdGVyIiwibWFwIiwic2VydmVyVmVyc2lvbiIsImdyYWRsZVByb3BlcnR5IiwiY2hhckF0IiwidG9VcHBlckNhc2UiLCJzbGljZSIsIkJvb2xlYW4iLCJwdXNoIiwia2V5cyIsInVwcGVyRmlyc3QiLCJrIiwidiIsInZlcnNpb24iLCJwcm9wZXJ0aWVzUGF0aCIsIm9yaWdpbmFsUHJvcGVydGllcyIsImZzIiwicmVhZEZpbGUiLCJuZXdQcm9wZXJ0aWVzIiwidXBkYXRlR3JhZGxlRGlzdFVybCIsIndyaXRlRmlsZSIsInByb3BlcnRpZXNDb250ZW50IiwicmVwbGFjZSIsIlJlZ0V4cCIsImVzY2FwZVJlZ0V4cCIsImhhc0FkZGl0aW9uYWxEZXBzIiwiaXNBcnJheSIsIkVycm9yIiwiaXNFbXB0eSIsImxpbmUiLCJ0cmltIiwiZGVwIiwidGVzdCIsImJ1aWxkUGF0aCIsImNvbmZpZ3VyYXRpb24iLCJwcmVmaXgiLCJkZXBzIiwiaW5mbyIsInVwZGF0ZURlcGVuZGVuY3lMaW5lcyIsImRlYnVnIiwiam9pbiIsImdyYWRsZWJ1aWxkIiwiU3ViUHJvY2VzcyIsImN3ZCIsInN0ZGlvIiwid2luZG93c1ZlcmJhdGltQXJndW1lbnRzIiwiYnVpbGRMYXN0TGluZXMiLCJsb2dNc2ciLCJvbiIsInN0YXJ0c1dpdGgiLCJFT0wiLCJsZW5ndGgiLCJzdGFydCIsImVyciIsIm1zZyIsIm1lc3NhZ2UiLCJlcnJvckFuZFRocm93Il0sInNvdXJjZXMiOlsiLi4vLi4vbGliL3NlcnZlci1idWlsZGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFN1YlByb2Nlc3MgfSBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuaW1wb3J0IHsgZnMsIHN5c3RlbSB9IGZyb20gJ2FwcGl1bS9zdXBwb3J0JztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IEVPTCB9IGZyb20gJ29zJztcbmltcG9ydCB7IHVwZGF0ZURlcGVuZGVuY3lMaW5lcyB9IGZyb20gJy4vdXRpbHMnO1xuXG5jb25zdCBHUkFETEVfVkVSU0lPTl9LRVkgPSAnZ3JhZGxlJztcbmNvbnN0IEdSQURMRV9VUkxfUFJFRklYID0gJ2Rpc3RyaWJ1dGlvblVybD0nO1xuY29uc3QgR1JBRExFX1VSTF9URU1QTEFURSA9ICdodHRwc1xcXFw6Ly9zZXJ2aWNlcy5ncmFkbGUub3JnL2Rpc3RyaWJ1dGlvbnMvZ3JhZGxlLVZFUlNJT04tYWxsLnppcCc7XG5jb25zdCBHUkFETEVfTUFYX0VSUk9SX0xPR19MSU5FUyA9IDE1O1xuY29uc3QgREVQRU5ERU5DWV9QUk9QX05BTUVTID0gWydhZGRpdGlvbmFsQXBwRGVwZW5kZW5jaWVzJywgJ2FkZGl0aW9uYWxBbmRyb2lkVGVzdERlcGVuZGVuY2llcyddO1xuXG5jb25zdCBWRVJTSU9OX0tFWVMgPSBbXG4gIEdSQURMRV9WRVJTSU9OX0tFWSxcbiAgJ2FuZHJvaWRHcmFkbGVQbHVnaW4nLFxuICAnY29tcGlsZVNkaycsXG4gICdidWlsZFRvb2xzJyxcbiAgJ21pblNkaycsXG4gICd0YXJnZXRTZGsnLFxuICAna290bGluJyxcbiAgJ3NvdXJjZUNvbXBhdGliaWxpdHknLFxuICAndGFyZ2V0Q29tcGF0aWJpbGl0eScsXG4gICdqdm1UYXJnZXQnLFxuICAnY29tcG9zZVZlcnNpb24nLFxuICAnYW5ub3RhdGlvblZlcnNpb24nXG5dO1xuXG5mdW5jdGlvbiBidWlsZFNlcnZlclNpZ25pbmdDb25maWcgKGFyZ3MpIHtcbiAgcmV0dXJuIHtcbiAgICB6aXBBbGlnbjogdHJ1ZSxcbiAgICBrZXlzdG9yZUZpbGU6IGFyZ3Mua2V5c3RvcmVGaWxlLFxuICAgIGtleXN0b3JlUGFzc3dvcmQ6IGFyZ3Mua2V5c3RvcmVQYXNzd29yZCxcbiAgICBrZXlBbGlhczogYXJncy5rZXlBbGlhcyxcbiAgICBrZXlQYXNzd29yZDogYXJncy5rZXlQYXNzd29yZFxuICB9O1xufVxuXG5jbGFzcyBTZXJ2ZXJCdWlsZGVyIHtcbiAgY29uc3RydWN0b3IgKGxvZywgYXJncyA9IHt9KSB7XG4gICAgdGhpcy5sb2cgPSBsb2c7XG4gICAgdGhpcy5zZXJ2ZXJQYXRoID0gYXJncy5zZXJ2ZXJQYXRoO1xuICAgIHRoaXMuc2hvd0dyYWRsZUxvZyA9IGFyZ3Muc2hvd0dyYWRsZUxvZztcblxuICAgIGNvbnN0IGJ1aWxkQ29uZmlndXJhdGlvbiA9IGFyZ3MuYnVpbGRDb25maWd1cmF0aW9uIHx8IHt9O1xuXG4gICAgY29uc3QgdmVyc2lvbkNvbmZpZ3VyYXRpb24gPSBidWlsZENvbmZpZ3VyYXRpb24udG9vbHNWZXJzaW9ucyB8fCB7fTtcbiAgICB0aGlzLnNlcnZlclZlcnNpb25zID0gXy5yZWR1Y2UodmVyc2lvbkNvbmZpZ3VyYXRpb24sIChhY2MsIHZhbHVlLCBrZXkpID0+IHtcbiAgICAgIGlmIChWRVJTSU9OX0tFWVMuaW5jbHVkZXMoa2V5KSkge1xuICAgICAgICBhY2Nba2V5XSA9IHZhbHVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nLndhcm4oYEdvdCB1bmV4cGVjdGVkICcke2tleX0nIGluIHRvb2xzVmVyc2lvbiBibG9jayBvZiB0aGUgYnVpbGQgY29uZmlndXJhdGlvbmApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGFjYztcbiAgICB9LCB7fSk7XG5cbiAgICB0aGlzLnRlc3RBcHBQYWNrYWdlID0gYXJncy50ZXN0QXBwUGFja2FnZTtcbiAgICB0aGlzLnNpZ25pbmdDb25maWcgPSBhcmdzLnNpZ25pbmdDb25maWc7XG5cbiAgICBmb3IgKGNvbnN0IHByb3BOYW1lIG9mIERFUEVOREVOQ1lfUFJPUF9OQU1FUykge1xuICAgICAgdGhpc1twcm9wTmFtZV0gPSBidWlsZENvbmZpZ3VyYXRpb25bcHJvcE5hbWVdIHx8IFtdO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGJ1aWxkICgpIHtcbiAgICBpZiAodGhpcy5zZXJ2ZXJWZXJzaW9uc1tHUkFETEVfVkVSU0lPTl9LRVldKSB7XG4gICAgICBhd2FpdCB0aGlzLnNldEdyYWRsZVdyYXBwZXJWZXJzaW9uKHRoaXMuc2VydmVyVmVyc2lvbnNbR1JBRExFX1ZFUlNJT05fS0VZXSk7XG4gICAgfVxuXG4gICAgYXdhaXQgdGhpcy5pbnNlcnRBZGRpdGlvbmFsRGVwZW5kZW5jaWVzKCk7XG5cbiAgICBhd2FpdCB0aGlzLnJ1bkJ1aWxkUHJvY2VzcygpO1xuICB9XG5cbiAgZ2V0Q29tbWFuZCAoKSB7XG4gICAgY29uc3QgY21kID0gc3lzdGVtLmlzV2luZG93cygpID8gJ2dyYWRsZXcuYmF0JyA6IHBhdGgucmVzb2x2ZSh0aGlzLnNlcnZlclBhdGgsICdncmFkbGV3Jyk7XG4gICAgY29uc3QgYnVpbGRQcm9wZXJ0eSA9IChrZXksIHZhbHVlKSA9PiB2YWx1ZSA/IGAtUCR7a2V5fT0ke3ZhbHVlfWAgOiBudWxsO1xuICAgIGxldCBhcmdzID0gVkVSU0lPTl9LRVlTXG4gICAgICAuZmlsdGVyKChrZXkpID0+IGtleSAhPT0gR1JBRExFX1ZFUlNJT05fS0VZKVxuICAgICAgLm1hcCgoa2V5KSA9PiB7XG4gICAgICAgIGNvbnN0IHNlcnZlclZlcnNpb24gPSB0aGlzLnNlcnZlclZlcnNpb25zW2tleV07XG4gICAgICAgIGNvbnN0IGdyYWRsZVByb3BlcnR5ID0gYGFwcGl1bSR7a2V5LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpfSR7a2V5LnNsaWNlKDEpfWA7XG4gICAgICAgIHJldHVybiBidWlsZFByb3BlcnR5KGdyYWRsZVByb3BlcnR5LCBzZXJ2ZXJWZXJzaW9uKTtcbiAgICAgIH0pXG4gICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuXG4gICAgaWYgKHRoaXMuc2lnbmluZ0NvbmZpZykge1xuICAgICAgYXJncy5wdXNoKC4uLihcbiAgICAgICAgXy5rZXlzKHRoaXMuc2lnbmluZ0NvbmZpZylcbiAgICAgICAgLm1hcCgoa2V5KSA9PiBbYGFwcGl1bSR7Xy51cHBlckZpcnN0KGtleSl9YCwgdGhpcy5zaWduaW5nQ29uZmlnW2tleV1dKVxuICAgICAgICAubWFwKChbaywgdl0pID0+IGJ1aWxkUHJvcGVydHkoaywgdikpXG4gICAgICAgIC5maWx0ZXIoQm9vbGVhbilcbiAgICAgICkpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnRlc3RBcHBQYWNrYWdlKSB7XG4gICAgICBhcmdzLnB1c2goYnVpbGRQcm9wZXJ0eSgnYXBwaXVtVGFyZ2V0UGFja2FnZScsIHRoaXMudGVzdEFwcFBhY2thZ2UpKTtcbiAgICB9XG4gICAgYXJncy5wdXNoKCdhcHA6YXNzZW1ibGVBbmRyb2lkVGVzdCcpO1xuXG4gICAgcmV0dXJuIHtjbWQsIGFyZ3N9O1xuICB9XG5cbiAgYXN5bmMgc2V0R3JhZGxlV3JhcHBlclZlcnNpb24gKHZlcnNpb24pIHtcbiAgICBjb25zdCBwcm9wZXJ0aWVzUGF0aCA9IHBhdGgucmVzb2x2ZSh0aGlzLnNlcnZlclBhdGgsICdncmFkbGUnLCAnd3JhcHBlcicsICdncmFkbGUtd3JhcHBlci5wcm9wZXJ0aWVzJyk7XG4gICAgY29uc3Qgb3JpZ2luYWxQcm9wZXJ0aWVzID0gYXdhaXQgZnMucmVhZEZpbGUocHJvcGVydGllc1BhdGgsICd1dGY4Jyk7XG4gICAgY29uc3QgbmV3UHJvcGVydGllcyA9IHRoaXMudXBkYXRlR3JhZGxlRGlzdFVybChvcmlnaW5hbFByb3BlcnRpZXMsIHZlcnNpb24pO1xuICAgIGF3YWl0IGZzLndyaXRlRmlsZShwcm9wZXJ0aWVzUGF0aCwgbmV3UHJvcGVydGllcywgJ3V0ZjgnKTtcbiAgfVxuXG4gIHVwZGF0ZUdyYWRsZURpc3RVcmwgKHByb3BlcnRpZXNDb250ZW50LCB2ZXJzaW9uKSB7XG4gICAgcmV0dXJuIHByb3BlcnRpZXNDb250ZW50LnJlcGxhY2UoXG4gICAgICBuZXcgUmVnRXhwKGBeKCR7Xy5lc2NhcGVSZWdFeHAoR1JBRExFX1VSTF9QUkVGSVgpfSkuKyRgLCAnZ20nKSxcbiAgICAgIGAkMSR7R1JBRExFX1VSTF9URU1QTEFURS5yZXBsYWNlKCdWRVJTSU9OJywgdmVyc2lvbil9YFxuICAgICk7XG4gIH1cblxuICBhc3luYyBpbnNlcnRBZGRpdGlvbmFsRGVwZW5kZW5jaWVzICgpIHtcbiAgICBsZXQgaGFzQWRkaXRpb25hbERlcHMgPSBmYWxzZTtcbiAgICBmb3IgKGNvbnN0IHByb3BOYW1lIG9mIERFUEVOREVOQ1lfUFJPUF9OQU1FUykge1xuICAgICAgaWYgKCFfLmlzQXJyYXkodGhpc1twcm9wTmFtZV0pKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgJyR7cHJvcE5hbWV9JyBtdXN0IGJlIGFuIGFycmF5YCk7XG4gICAgICB9XG4gICAgICBpZiAoXy5pc0VtcHR5KHRoaXNbcHJvcE5hbWVdLmZpbHRlcigobGluZSkgPT4gXy50cmltKGxpbmUpKSkpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIGZvciAoY29uc3QgZGVwIG9mIHRoaXNbcHJvcE5hbWVdKSB7XG4gICAgICAgIGlmICgvW1xccydcXFxcJF0vLnRlc3QoZGVwKSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU2luZ2xlIHF1b3RlcywgZG9sbGFyIGNoYXJhY3RlcnMgYW5kIHdoaXRlc3BhY2UgY2hhcmFjdGVycycgK1xuICAgICAgICAgICAgYCBhcmUgZGlzYWxsb3dlZCBpbiBhZGRpdGlvbmFsIGRlcGVuZGVuY2llczogJHtkZXB9YCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGhhc0FkZGl0aW9uYWxEZXBzID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKCFoYXNBZGRpdGlvbmFsRGVwcykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGJ1aWxkUGF0aCA9IHBhdGgucmVzb2x2ZSh0aGlzLnNlcnZlclBhdGgsICdhcHAnLCAnYnVpbGQuZ3JhZGxlLmt0cycpO1xuICAgIGxldCBjb25maWd1cmF0aW9uID0gYXdhaXQgZnMucmVhZEZpbGUoYnVpbGRQYXRoLCAndXRmOCcpO1xuICAgIGZvciAoY29uc3QgcHJvcE5hbWUgb2YgREVQRU5ERU5DWV9QUk9QX05BTUVTKSB7XG4gICAgICBjb25zdCBwcmVmaXggPSBwcm9wTmFtZSA9PT0gREVQRU5ERU5DWV9QUk9QX05BTUVTWzBdXG4gICAgICAgID8gJ2ltcGxlbWVudGF0aW9uJ1xuICAgICAgICA6ICdhbmRyb2lkVGVzdEltcGxlbWVudGF0aW9uJztcbiAgICAgIGNvbnN0IGRlcHMgPSB0aGlzW3Byb3BOYW1lXVxuICAgICAgICAuZmlsdGVyKChsaW5lKSA9PiBfLnRyaW0obGluZSkpXG4gICAgICAgIC5tYXAoKGxpbmUpID0+IGAke3ByZWZpeH0oXCIke2xpbmV9XCIpYCk7XG4gICAgICBpZiAoXy5pc0VtcHR5KGRlcHMpKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZy5pbmZvKGBBZGRpbmcgdGhlIGZvbGxvd2luZyAke3Byb3BOYW1lfSB0byBidWlsZC5ncmFkbGUua3RzOiAke2RlcHN9YCk7XG4gICAgICBjb25maWd1cmF0aW9uID0gdXBkYXRlRGVwZW5kZW5jeUxpbmVzKGNvbmZpZ3VyYXRpb24sIHByb3BOYW1lLCBkZXBzKTtcbiAgICB9XG4gICAgYXdhaXQgZnMud3JpdGVGaWxlKGJ1aWxkUGF0aCwgY29uZmlndXJhdGlvbiwgJ3V0ZjgnKTtcbiAgfVxuXG4gIGFzeW5jIHJ1bkJ1aWxkUHJvY2VzcyAoKSB7XG4gICAgY29uc3Qge2NtZCwgYXJnc30gPSB0aGlzLmdldENvbW1hbmQoKTtcbiAgICB0aGlzLmxvZy5kZWJ1ZyhgQmVnaW5uaW5nIGJ1aWxkIHdpdGggY29tbWFuZCAnJHtjbWR9ICR7YXJncy5qb2luKCcgJyl9JyBgICtcbiAgICAgIGBpbiBkaXJlY3RvcnkgJyR7dGhpcy5zZXJ2ZXJQYXRofSdgKTtcbiAgICBjb25zdCBncmFkbGVidWlsZCA9IG5ldyBTdWJQcm9jZXNzKGNtZCwgYXJncywge1xuICAgICAgY3dkOiB0aGlzLnNlcnZlclBhdGgsXG4gICAgICBzdGRpbzogWydpZ25vcmUnLCAncGlwZScsICdwaXBlJ10sXG4gICAgICB3aW5kb3dzVmVyYmF0aW1Bcmd1bWVudHM6IHRydWVcbiAgICB9KTtcbiAgICBsZXQgYnVpbGRMYXN0TGluZXMgPSBbXTtcblxuICAgIGNvbnN0IGxvZ01zZyA9IGBPdXRwdXQgZnJvbSBHcmFkbGUgJHt0aGlzLnNob3dHcmFkbGVMb2cgPyAnd2lsbCcgOiAnd2lsbCBub3QnfSBiZSBsb2dnZWRgO1xuICAgIHRoaXMubG9nLmRlYnVnKGAke2xvZ01zZ30uIFRvIGNoYW5nZSB0aGlzLCB1c2UgJ3Nob3dHcmFkbGVMb2cnIGRlc2lyZWQgY2FwYWJpbGl0eWApO1xuICAgIGdyYWRsZWJ1aWxkLm9uKCdzdHJlYW0tbGluZScsIChsaW5lKSA9PiB7XG4gICAgICBpZiAodGhpcy5zaG93R3JhZGxlTG9nKSB7XG4gICAgICAgIGlmIChsaW5lLnN0YXJ0c1dpdGgoJ1tTVERFUlJdJykpIHtcbiAgICAgICAgICB0aGlzLmxvZy53YXJuKGBbR3JhZGxlXSAke2xpbmV9YCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5sb2cuaW5mbyhgW0dyYWRsZV0gJHtsaW5lfWApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBidWlsZExhc3RMaW5lcy5wdXNoKGAke0VPTH0ke2xpbmV9YCk7XG4gICAgICBpZiAoYnVpbGRMYXN0TGluZXMubGVuZ3RoID4gR1JBRExFX01BWF9FUlJPUl9MT0dfTElORVMpIHtcbiAgICAgICAgYnVpbGRMYXN0TGluZXMgPSBidWlsZExhc3RMaW5lcy5zbGljZSgtR1JBRExFX01BWF9FUlJPUl9MT0dfTElORVMpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGdyYWRsZWJ1aWxkLnN0YXJ0KCk7XG4gICAgICBhd2FpdCBncmFkbGVidWlsZC5qb2luKCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsZXQgbXNnID0gYFVuYWJsZSB0byBidWlsZCBFc3ByZXNzbyBzZXJ2ZXIgLSAke2Vyci5tZXNzYWdlfVxcbmAgK1xuICAgICAgICBgR3JhZGxlIGVycm9yIG1lc3NhZ2U6JHtFT0x9JHtidWlsZExhc3RMaW5lc31gO1xuICAgICAgdGhpcy5sb2cuZXJyb3JBbmRUaHJvdyhtc2cpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgeyBTZXJ2ZXJCdWlsZGVyLCBWRVJTSU9OX0tFWVMsIEdSQURMRV9VUkxfVEVNUExBVEUsIGJ1aWxkU2VydmVyU2lnbmluZ0NvbmZpZyB9O1xuZXhwb3J0IGRlZmF1bHQgU2VydmVyQnVpbGRlcjtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBLE1BQU1BLGtCQUFrQixHQUFHLFFBQVE7QUFDbkMsTUFBTUMsaUJBQWlC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