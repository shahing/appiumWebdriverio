"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
require("source-map-support/register");
var _bluebird = _interopRequireDefault(require("bluebird"));
var _support = require("@appium/support");
var _teen_process = require("teen_process");
var _lodash = _interopRequireDefault(require("lodash"));
var _asyncbox = require("asyncbox");
var _helpers = require("../helpers");
var _logger = _interopRequireDefault(require("../logger.js"));
const COMPANION_PGREP_PATTERN = udid => `${_helpers.IDB_COMPANION_EXECUTABLE}.*--udid[[:space:]]+${udid}`;
const COMPANION_STARTUP_REGEXP = /"grpc_port":(\d+)/;
const COMPANION_STARTUP_ERROR_REGEXP = /New Error Built ==> (.+)/;
const COMPANION_STARTUP_TIMEOUT_SEC = 30;
const systemCallMethods = {};
systemCallMethods.connect = async function connect(opts = {}) {
  const {
    onlineTimeout
  } = opts;
  _logger.default.debug(`Connecting ${_helpers.IDB_EXECUTABLE} service to '${this.udid}'`);
  const binaryPaths = {};
  for (const binary of [_helpers.IDB_EXECUTABLE, _helpers.IDB_COMPANION_EXECUTABLE]) {
    try {
      binaryPaths[binary] = await _support.fs.which(binary);
    } catch (e) {
      throw new Error(`'${binary}' has not been found in PATH. ` + `Is it installed? Read https://www.fbidb.io for more details`);
    }
  }
  let grpcPort = _helpers.DEFAULT_COMPANION_GRPC_PORT;
  _logger.default.debug(`Starting companion: '${binaryPaths[_helpers.IDB_COMPANION_EXECUTABLE]}'`);
  const companionProc = new _teen_process.SubProcess(binaryPaths[_helpers.IDB_COMPANION_EXECUTABLE], ['--udid', this.udid]);
  let listeners = {
    'lines-stdout': null,
    'lines-stderr': null,
    exit: null
  };
  const cleanupListeners = () => {
    _lodash.default.toPairs(listeners).filter(([, v]) => _lodash.default.isFunction(v)).map(([k, v]) => companionProc.removeListener(k, v));
    listeners = {};
  };
  try {
    await companionProc.start(0);
    await new _bluebird.default((resolve, reject) => {
      for (const outType of ['stderr', 'stdout']) {
        const eventName = `lines-${outType}`;
        listeners[eventName] = lines => {
          for (const line of lines) {
            if (_lodash.default.isEmpty(_lodash.default.trim(line))) {
              continue;
            }
            if (this.verbose) {
              _logger.default.debug(`[${_helpers.IDB_COMPANION_EXECUTABLE} ${outType}] ${line}`);
            }
            const readyMatch = COMPANION_STARTUP_REGEXP.exec(line);
            if (readyMatch) {
              grpcPort = readyMatch[1];
              resolve();
            } else {
              const errorMatch = COMPANION_STARTUP_ERROR_REGEXP.exec(line);
              if (errorMatch) {
                reject(new Error(errorMatch[1]));
              }
            }
          }
        };
        companionProc.on(eventName, listeners[eventName]);
      }
      listeners.exit = (code, signal) => {
        cleanupListeners();
        const message = `${_helpers.IDB_COMPANION_EXECUTABLE} exited with code '${code}' from signal '${signal}'`;
        _logger.default.debug(message);
        reject(new Error(message));
      };
      companionProc.once('exit', listeners.exit);
    }).timeout(COMPANION_STARTUP_TIMEOUT_SEC * 1000, `Was unable to acquire a GRPC port after ${COMPANION_STARTUP_TIMEOUT_SEC}s timeout`);
  } catch (err) {
    cleanupListeners();
    if (companionProc.isRunning) {
      try {
        await companionProc.stop();
      } catch (ign) {}
    }
    _logger.default.error(`Failed to start ${_helpers.IDB_COMPANION_EXECUTABLE}: ${err.message}`);
    throw err;
  }
  _logger.default.debug(`${_helpers.IDB_COMPANION_EXECUTABLE} is listening on GRPC port '${grpcPort}'`);
  try {
    try {
      await (0, _teen_process.exec)(_helpers.IDB_EXECUTABLE, ['connect', this.udid, grpcPort]);
    } catch (connectionError) {
      await (0, _asyncbox.retryInterval)(2, 100, async () => {
        await this.disconnect();
        try {
          await (0, _teen_process.exec)(_helpers.IDB_EXECUTABLE, ['kill']);
        } catch (ign) {}
        await (0, _teen_process.exec)(_helpers.IDB_EXECUTABLE, ['connect', this.udid, grpcPort]);
      });
    }
  } catch (e) {
    if (e.stderr || e.stdout) {
      _logger.default.debug(e.stderr || e.stdout);
    }
    throw new Error(`Cannot start ${_helpers.IDB_EXECUTABLE} service for the device '${this.udid}'. ` + `Check the server log for more details.`);
  }
  _logger.default.info(`Successfully established the connection to ${_helpers.IDB_EXECUTABLE} service for '${this.udid}'`);
  if (onlineTimeout) {
    await this.waitForDevice(onlineTimeout);
  }
  this.executable.path = binaryPaths[_helpers.IDB_EXECUTABLE];
  this.companion.path = binaryPaths[_helpers.IDB_COMPANION_EXECUTABLE];
};
systemCallMethods.waitForDevice = async function waitForDevice(timeoutMs = 10000) {
  if (!timeoutMs) {
    _logger.default.debug('No timeout is provided, so not waiting until the device is online');
    return;
  }
  _logger.default.debug(`Waiting up to ${timeoutMs}ms for the device to be online`);
  const timer = new _support.timing.Timer().start();
  let lastError = null;
  try {
    await (0, _asyncbox.waitForCondition)(async () => {
      try {
        await this.exec(['ui', 'describe-all']);
        return true;
      } catch (e) {
        lastError = e.stderr || e.message;
        return false;
      }
    }, {
      waitMs: timeoutMs,
      intervalMs: 300
    });
  } catch (e) {
    throw new Error(`The device '${this.udid}' is not responding to idb requests after ${timeoutMs}ms timeout. ` + `Original error: ${lastError || e.message}`);
  }
  _logger.default.debug(`The device '${this.udid}' is online and ready to accept idb commands in ` + `${timer.getDuration().asSeconds.toFixed(3)}s`);
};
systemCallMethods.disconnect = async function disconnect() {
  _logger.default.debug(`Disconnecting ${_helpers.IDB_EXECUTABLE} service from '${this.udid}'`);
  try {
    await (0, _teen_process.exec)(this.executable.path, ['disconnect', this.udid]);
  } catch (ign) {}
  const companionPids = await (0, _helpers.getPids)(COMPANION_PGREP_PATTERN(this.udid));
  if (_lodash.default.isEmpty(companionPids)) {
    return;
  }
  _logger.default.debug(`Cleaning up ${companionPids.length} obsolete ${_helpers.IDB_COMPANION_EXECUTABLE} ` + `process${companionPids.length === 1 ? '' : 'es'}`);
  await (0, _teen_process.exec)('kill', ['-2', ...companionPids]);
};
systemCallMethods.exec = async function exec(cmd, args = [], opts = {}) {
  if (!cmd) {
    throw new Error('You need to pass in a command to exec()');
  }
  cmd = _lodash.default.isArray(cmd) ? cmd : [cmd];
  opts = _lodash.default.cloneDeep(opts);
  opts.timeout = opts.timeout || this.execTimeout || _helpers.DEFAULT_IDB_EXEC_TIMEOUT;
  opts.timeoutCapName = opts.timeoutCapName || 'execTimeout';
  const fullArgs = [...cmd, ...this.executable.defaultArgs, ...args];
  _logger.default.debug(`Running '${this.executable.path} ${_support.util.quote(fullArgs)}'`);
  try {
    const {
      stdout
    } = await (0, _teen_process.exec)(this.executable.path, fullArgs, opts);
    return stdout;
  } catch (e) {
    if (_support.util.hasValue(e.code)) {
      e.message = `Error executing ${_helpers.IDB_EXECUTABLE}. Original error: '${e.message}'; ` + `Stdout: '${(e.stdout || '').trim()}'; ` + `Stderr: '${(e.stderr || '').trim()}'; ` + `Code: '${e.code}'`;
    } else {
      e.message = `Error executing ${_helpers.IDB_EXECUTABLE}. Original error: '${e.message}'. ` + `Try to increase the ${opts.timeout}ms ${_helpers.IDB_EXECUTABLE} execution timeout represented by '${opts.timeoutCapName}' capability`;
    }
    throw e;
  }
};
systemCallMethods.createSubProcess = function createSubProcess(command = [], args = [], opts = {}) {
  const idbArgs = [...command, ...this.executable.defaultArgs, ...args];
  _logger.default.debug(`Creating ${_helpers.IDB_EXECUTABLE} subprocess with args: ${_support.util.quote(args)}`);
  return new _teen_process.SubProcess(this.executable.path, idbArgs, opts);
};
var _default = systemCallMethods;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJDT01QQU5JT05fUEdSRVBfUEFUVEVSTiIsInVkaWQiLCJJREJfQ09NUEFOSU9OX0VYRUNVVEFCTEUiLCJDT01QQU5JT05fU1RBUlRVUF9SRUdFWFAiLCJDT01QQU5JT05fU1RBUlRVUF9FUlJPUl9SRUdFWFAiLCJDT01QQU5JT05fU1RBUlRVUF9USU1FT1VUX1NFQyIsInN5c3RlbUNhbGxNZXRob2RzIiwiY29ubmVjdCIsIm9wdHMiLCJvbmxpbmVUaW1lb3V0IiwibG9nIiwiZGVidWciLCJJREJfRVhFQ1VUQUJMRSIsImJpbmFyeVBhdGhzIiwiYmluYXJ5IiwiZnMiLCJ3aGljaCIsImUiLCJFcnJvciIsImdycGNQb3J0IiwiREVGQVVMVF9DT01QQU5JT05fR1JQQ19QT1JUIiwiY29tcGFuaW9uUHJvYyIsIlN1YlByb2Nlc3MiLCJsaXN0ZW5lcnMiLCJleGl0IiwiY2xlYW51cExpc3RlbmVycyIsIl8iLCJ0b1BhaXJzIiwiZmlsdGVyIiwidiIsImlzRnVuY3Rpb24iLCJtYXAiLCJrIiwicmVtb3ZlTGlzdGVuZXIiLCJzdGFydCIsIkIiLCJyZXNvbHZlIiwicmVqZWN0Iiwib3V0VHlwZSIsImV2ZW50TmFtZSIsImxpbmVzIiwibGluZSIsImlzRW1wdHkiLCJ0cmltIiwidmVyYm9zZSIsInJlYWR5TWF0Y2giLCJleGVjIiwiZXJyb3JNYXRjaCIsIm9uIiwiY29kZSIsInNpZ25hbCIsIm1lc3NhZ2UiLCJvbmNlIiwidGltZW91dCIsImVyciIsImlzUnVubmluZyIsInN0b3AiLCJpZ24iLCJlcnJvciIsInRwRXhlYyIsImNvbm5lY3Rpb25FcnJvciIsInJldHJ5SW50ZXJ2YWwiLCJkaXNjb25uZWN0Iiwic3RkZXJyIiwic3Rkb3V0IiwiaW5mbyIsIndhaXRGb3JEZXZpY2UiLCJleGVjdXRhYmxlIiwicGF0aCIsImNvbXBhbmlvbiIsInRpbWVvdXRNcyIsInRpbWVyIiwidGltaW5nIiwiVGltZXIiLCJsYXN0RXJyb3IiLCJ3YWl0Rm9yQ29uZGl0aW9uIiwid2FpdE1zIiwiaW50ZXJ2YWxNcyIsImdldER1cmF0aW9uIiwiYXNTZWNvbmRzIiwidG9GaXhlZCIsImNvbXBhbmlvblBpZHMiLCJnZXRQaWRzIiwibGVuZ3RoIiwiY21kIiwiYXJncyIsImlzQXJyYXkiLCJjbG9uZURlZXAiLCJleGVjVGltZW91dCIsIkRFRkFVTFRfSURCX0VYRUNfVElNRU9VVCIsInRpbWVvdXRDYXBOYW1lIiwiZnVsbEFyZ3MiLCJkZWZhdWx0QXJncyIsInV0aWwiLCJxdW90ZSIsImhhc1ZhbHVlIiwiY3JlYXRlU3ViUHJvY2VzcyIsImNvbW1hbmQiLCJpZGJBcmdzIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL3Rvb2xzL3N5c3RlbS1jb21tYW5kcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyBmcywgdXRpbCwgdGltaW5nIH0gZnJvbSAnQGFwcGl1bS9zdXBwb3J0JztcbmltcG9ydCB7IGV4ZWMgYXMgdHBFeGVjLCBTdWJQcm9jZXNzIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyByZXRyeUludGVydmFsLCB3YWl0Rm9yQ29uZGl0aW9uIH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IHtcbiAgZ2V0UGlkcywgREVGQVVMVF9JREJfRVhFQ19USU1FT1VULCBJREJfRVhFQ1VUQUJMRSxcbiAgSURCX0NPTVBBTklPTl9FWEVDVVRBQkxFLCBERUZBVUxUX0NPTVBBTklPTl9HUlBDX1BPUlQsXG59IGZyb20gJy4uL2hlbHBlcnMnO1xuaW1wb3J0IGxvZyBmcm9tICcuLi9sb2dnZXIuanMnO1xuXG5cbmNvbnN0IENPTVBBTklPTl9QR1JFUF9QQVRURVJOID0gKHVkaWQpID0+XG4gIGAke0lEQl9DT01QQU5JT05fRVhFQ1VUQUJMRX0uKi0tdWRpZFtbOnNwYWNlOl1dKyR7dWRpZH1gO1xuY29uc3QgQ09NUEFOSU9OX1NUQVJUVVBfUkVHRVhQID0gL1wiZ3JwY19wb3J0XCI6KFxcZCspLztcbmNvbnN0IENPTVBBTklPTl9TVEFSVFVQX0VSUk9SX1JFR0VYUCA9IC9OZXcgRXJyb3IgQnVpbHQgPT0+ICguKykvO1xuY29uc3QgQ09NUEFOSU9OX1NUQVJUVVBfVElNRU9VVF9TRUMgPSAzMDtcblxuY29uc3Qgc3lzdGVtQ2FsbE1ldGhvZHMgPSB7fTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBDb25uZWN0T3B0aW9uc1xuICpcbiAqIEBwcm9wZXJ0eSB7P251bWJlcn0gb25saW5lVGltZW91dCAtIFRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXRcbiAqIHVudGlsIHRoZSBkZXZpY2UgdW5kZXIgdGVzdHMgaXMgb25saW5lLiBObyB3YWl0IGlzIGdvaW5nIHRvIGJlIHBlcmZvcm1lZFxuICogaWYgdGhlIHRpbWVvdXQgaXMgbm90IHNldC4gSXQgaXMgcmVjb21tZW5kZWQgdG8gcHJvdmlkZSB0aGlzIHZhbHVlIGlmXG4gKiBgY29ubmVjdGAgaXMgY2FsbGVkIHJpZ2h0IGFmdGVyIGRldmljZSBpcyBib290ZWQsIHNvIG5vdCBhbGwgdGhlIHJlcXVpcmVkXG4gKiBkZXZpY2Ugc2VydmljZXMgaGF2ZSBiZWVuIHN0YXJ0ZWQgeWV0LlxuICovXG5cbi8qKlxuICogSW5pdGlhbGl6ZXMgaWRiIGFuZCBjb21wYW5pb24gcHJvY2Vzc2VzIGlmIG5lY2Vzc2FyeSBhbmRcbiAqIGFzc2lnbnMgcGF0aCBwcm9wZXJ0aWVzLiBJdCBpcyBtYW5kYXRvcnkgdG8gY2FsbCB0aGlzIG1ldGhvZCBiZWZvcmVcbiAqIG9uZSBjYW4gc3RhcnQgdXNpbmcgSURCIGluc3RhbmNlLFxuICpcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiBtYW5kYXRvcnkgaWRiIGV4ZWN1dGFibGVzIGFyZSBub3QgcHJlc2VudCBvbiB0aGVcbiAqIGxvY2FsaG9zdCBvciB0aGVyZSB3YXMgYSBmYWlsdXJlIHdoaWxlIHN0YXJ0aW5nL2RldGVjdGluZyB0aGVtXG4gKi9cbnN5c3RlbUNhbGxNZXRob2RzLmNvbm5lY3QgPSBhc3luYyBmdW5jdGlvbiBjb25uZWN0IChvcHRzID0ge30pIHtcbiAgY29uc3Qge1xuICAgIG9ubGluZVRpbWVvdXQsXG4gIH0gPSBvcHRzO1xuXG4gIGxvZy5kZWJ1ZyhgQ29ubmVjdGluZyAke0lEQl9FWEVDVVRBQkxFfSBzZXJ2aWNlIHRvICcke3RoaXMudWRpZH0nYCk7XG5cbiAgY29uc3QgYmluYXJ5UGF0aHMgPSB7fTtcbiAgZm9yIChjb25zdCBiaW5hcnkgb2YgW0lEQl9FWEVDVVRBQkxFLCBJREJfQ09NUEFOSU9OX0VYRUNVVEFCTEVdKSB7XG4gICAgdHJ5IHtcbiAgICAgIGJpbmFyeVBhdGhzW2JpbmFyeV0gPSBhd2FpdCBmcy53aGljaChiaW5hcnkpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgJyR7YmluYXJ5fScgaGFzIG5vdCBiZWVuIGZvdW5kIGluIFBBVEguIGAgK1xuICAgICAgICBgSXMgaXQgaW5zdGFsbGVkPyBSZWFkIGh0dHBzOi8vd3d3LmZiaWRiLmlvIGZvciBtb3JlIGRldGFpbHNgKTtcbiAgICB9XG4gIH1cblxuICBsZXQgZ3JwY1BvcnQgPSBERUZBVUxUX0NPTVBBTklPTl9HUlBDX1BPUlQ7XG4gIGxvZy5kZWJ1ZyhgU3RhcnRpbmcgY29tcGFuaW9uOiAnJHtiaW5hcnlQYXRoc1tJREJfQ09NUEFOSU9OX0VYRUNVVEFCTEVdfSdgKTtcbiAgY29uc3QgY29tcGFuaW9uUHJvYyA9IG5ldyBTdWJQcm9jZXNzKGJpbmFyeVBhdGhzW0lEQl9DT01QQU5JT05fRVhFQ1VUQUJMRV0sIFsnLS11ZGlkJywgdGhpcy51ZGlkXSk7XG4gIGxldCBsaXN0ZW5lcnMgPSB7XG4gICAgJ2xpbmVzLXN0ZG91dCc6IG51bGwsXG4gICAgJ2xpbmVzLXN0ZGVycic6IG51bGwsXG4gICAgZXhpdDogbnVsbCxcbiAgfTtcbiAgY29uc3QgY2xlYW51cExpc3RlbmVycyA9ICgpID0+IHtcbiAgICBfLnRvUGFpcnMobGlzdGVuZXJzKVxuICAgICAgLmZpbHRlcigoWywgdl0pID0+IF8uaXNGdW5jdGlvbih2KSlcbiAgICAgIC5tYXAoKFtrLCB2XSkgPT4gY29tcGFuaW9uUHJvYy5yZW1vdmVMaXN0ZW5lcihrLCB2KSk7XG4gICAgbGlzdGVuZXJzID0ge307XG4gIH07XG4gIHRyeSB7XG4gICAgYXdhaXQgY29tcGFuaW9uUHJvYy5zdGFydCgwKTtcblxuICAgIGF3YWl0IG5ldyBCKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGZvciAoY29uc3Qgb3V0VHlwZSBvZiBbJ3N0ZGVycicsICdzdGRvdXQnXSkge1xuICAgICAgICBjb25zdCBldmVudE5hbWUgPSBgbGluZXMtJHtvdXRUeXBlfWA7XG4gICAgICAgIGxpc3RlbmVyc1tldmVudE5hbWVdID0gKGxpbmVzKSA9PiB7XG4gICAgICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgICAgICBpZiAoXy5pc0VtcHR5KF8udHJpbShsaW5lKSkpIHtcbiAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnZlcmJvc2UpIHtcbiAgICAgICAgICAgICAgbG9nLmRlYnVnKGBbJHtJREJfQ09NUEFOSU9OX0VYRUNVVEFCTEV9ICR7b3V0VHlwZX1dICR7bGluZX1gKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gY2hlY2sgZm9yIG1hcmtlciB0aGF0IHRoaW5ncyBhcmUgcmVhZHkgdG8gZ29cbiAgICAgICAgICAgIGNvbnN0IHJlYWR5TWF0Y2ggPSBDT01QQU5JT05fU1RBUlRVUF9SRUdFWFAuZXhlYyhsaW5lKTtcbiAgICAgICAgICAgIGlmIChyZWFkeU1hdGNoKSB7XG4gICAgICAgICAgICAgIC8vIGZpbmQgdGhlIHBvcnQgYW5kIHNhdmUsIHNvIGlkYiBjYW4gY29ubmVjdFxuICAgICAgICAgICAgICBncnBjUG9ydCA9IHJlYWR5TWF0Y2hbMV07XG4gICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vIGNoZWNrIGlmIHRoZXJlIGhhcyBiZWVuIGFuIGVycm9yXG4gICAgICAgICAgICAgIGNvbnN0IGVycm9yTWF0Y2ggPSBDT01QQU5JT05fU1RBUlRVUF9FUlJPUl9SRUdFWFAuZXhlYyhsaW5lKTtcbiAgICAgICAgICAgICAgaWYgKGVycm9yTWF0Y2gpIHtcbiAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKGVycm9yTWF0Y2hbMV0pKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgY29tcGFuaW9uUHJvYy5vbihldmVudE5hbWUsIGxpc3RlbmVyc1tldmVudE5hbWVdKTtcbiAgICAgIH1cblxuICAgICAgbGlzdGVuZXJzLmV4aXQgPSAoY29kZSwgc2lnbmFsKSA9PiB7XG4gICAgICAgIGNsZWFudXBMaXN0ZW5lcnMoKTtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IGAke0lEQl9DT01QQU5JT05fRVhFQ1VUQUJMRX0gZXhpdGVkIHdpdGggY29kZSAnJHtjb2RlfScgZnJvbSBzaWduYWwgJyR7c2lnbmFsfSdgO1xuICAgICAgICBsb2cuZGVidWcobWVzc2FnZSk7XG4gICAgICAgIHJlamVjdChuZXcgRXJyb3IobWVzc2FnZSkpO1xuICAgICAgfTtcbiAgICAgIGNvbXBhbmlvblByb2Mub25jZSgnZXhpdCcsIGxpc3RlbmVycy5leGl0KTtcbiAgICB9KS50aW1lb3V0KFxuICAgICAgQ09NUEFOSU9OX1NUQVJUVVBfVElNRU9VVF9TRUMgKiAxMDAwLFxuICAgICAgYFdhcyB1bmFibGUgdG8gYWNxdWlyZSBhIEdSUEMgcG9ydCBhZnRlciAke0NPTVBBTklPTl9TVEFSVFVQX1RJTUVPVVRfU0VDfXMgdGltZW91dGBcbiAgICApO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjbGVhbnVwTGlzdGVuZXJzKCk7XG4gICAgaWYgKGNvbXBhbmlvblByb2MuaXNSdW5uaW5nKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBjb21wYW5pb25Qcm9jLnN0b3AoKTtcbiAgICAgIH0gY2F0Y2ggKGlnbikge31cbiAgICB9XG4gICAgbG9nLmVycm9yKGBGYWlsZWQgdG8gc3RhcnQgJHtJREJfQ09NUEFOSU9OX0VYRUNVVEFCTEV9OiAke2Vyci5tZXNzYWdlfWApO1xuICAgIHRocm93IGVycjtcbiAgfVxuXG4gIGxvZy5kZWJ1ZyhgJHtJREJfQ09NUEFOSU9OX0VYRUNVVEFCTEV9IGlzIGxpc3RlbmluZyBvbiBHUlBDIHBvcnQgJyR7Z3JwY1BvcnR9J2ApO1xuXG4gIHRyeSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRwRXhlYyhJREJfRVhFQ1VUQUJMRSwgWydjb25uZWN0JywgdGhpcy51ZGlkLCBncnBjUG9ydF0pO1xuICAgIH0gY2F0Y2ggKGNvbm5lY3Rpb25FcnJvcikge1xuICAgICAgYXdhaXQgcmV0cnlJbnRlcnZhbCgyLCAxMDAsIGFzeW5jICgpID0+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5kaXNjb25uZWN0KCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgdHBFeGVjKElEQl9FWEVDVVRBQkxFLCBbJ2tpbGwnXSk7XG4gICAgICAgIH0gY2F0Y2ggKGlnbikge31cbiAgICAgICAgYXdhaXQgdHBFeGVjKElEQl9FWEVDVVRBQkxFLCBbJ2Nvbm5lY3QnLCB0aGlzLnVkaWQsIGdycGNQb3J0XSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBpZiAoZS5zdGRlcnIgfHwgZS5zdGRvdXQpIHtcbiAgICAgIGxvZy5kZWJ1ZyhlLnN0ZGVyciB8fCBlLnN0ZG91dCk7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IHN0YXJ0ICR7SURCX0VYRUNVVEFCTEV9IHNlcnZpY2UgZm9yIHRoZSBkZXZpY2UgJyR7dGhpcy51ZGlkfScuIGAgK1xuICAgICAgYENoZWNrIHRoZSBzZXJ2ZXIgbG9nIGZvciBtb3JlIGRldGFpbHMuYCk7XG4gIH1cbiAgbG9nLmluZm8oYFN1Y2Nlc3NmdWxseSBlc3RhYmxpc2hlZCB0aGUgY29ubmVjdGlvbiB0byAke0lEQl9FWEVDVVRBQkxFfSBzZXJ2aWNlIGZvciAnJHt0aGlzLnVkaWR9J2ApO1xuXG4gIGlmIChvbmxpbmVUaW1lb3V0KSB7XG4gICAgYXdhaXQgdGhpcy53YWl0Rm9yRGV2aWNlKG9ubGluZVRpbWVvdXQpO1xuICB9XG5cbiAgdGhpcy5leGVjdXRhYmxlLnBhdGggPSBiaW5hcnlQYXRoc1tJREJfRVhFQ1VUQUJMRV07XG4gIHRoaXMuY29tcGFuaW9uLnBhdGggPSBiaW5hcnlQYXRoc1tJREJfQ09NUEFOSU9OX0VYRUNVVEFCTEVdO1xufTtcblxuLyoqXG4gKiBCbG9ja3MgdW50aWwgdGhlIGRldmljZSB1bmRlciB0ZXN0IHN0YXJ0cyByZXNwb25kaW5nIHRvIGlkYiBjb21tYW5kcy5cbiAqIFRoZSBkZXZpY2UgbXVzdCBiZSBib290ZWQvb25saW5lIGFuZCBpZGIgbXVzdCBiZSBhbHJlYWR5IGNvbm5lY3RlZCBmb3IgdGhhdCB0byBoYXBwZW5cbiAqXG4gKiBAcGFyYW0gez9udW1iZXJ9IHRpbWVvdXRNcyBbMTAwMDBdIC0gVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdFxuICogdW50aWwgdGhlIGRldmljZSB1bmRlciB0ZXN0cyBpcyBvbmxpbmUuIFRoZSBtZXRob2Qgd2lsbCByZXR1cm4gaW1tZWRpYXRlbHlcbiAqIGlmIHRoZSB0aW1lb3V0IGlzIGZhbHN5XG4gKiBAdGhyb3dzIHtFcnJvcn0gaWYgdGhlIGRldmljZSBpcyBub3QgcmVzcG9uZGluZyB3aXRoaW4gdGhlIGdpdmVuIHRpbWVvdXRcbiAqL1xuc3lzdGVtQ2FsbE1ldGhvZHMud2FpdEZvckRldmljZSA9IGFzeW5jIGZ1bmN0aW9uIHdhaXRGb3JEZXZpY2UgKHRpbWVvdXRNcyA9IDEwMDAwKSB7XG4gIGlmICghdGltZW91dE1zKSB7XG4gICAgbG9nLmRlYnVnKCdObyB0aW1lb3V0IGlzIHByb3ZpZGVkLCBzbyBub3Qgd2FpdGluZyB1bnRpbCB0aGUgZGV2aWNlIGlzIG9ubGluZScpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxvZy5kZWJ1ZyhgV2FpdGluZyB1cCB0byAke3RpbWVvdXRNc31tcyBmb3IgdGhlIGRldmljZSB0byBiZSBvbmxpbmVgKTtcbiAgY29uc3QgdGltZXIgPSBuZXcgdGltaW5nLlRpbWVyKCkuc3RhcnQoKTtcbiAgbGV0IGxhc3RFcnJvciA9IG51bGw7XG4gIHRyeSB7XG4gICAgYXdhaXQgd2FpdEZvckNvbmRpdGlvbihhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLmV4ZWMoWyd1aScsICdkZXNjcmliZS1hbGwnXSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBsYXN0RXJyb3IgPSBlLnN0ZGVyciB8fCBlLm1lc3NhZ2U7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9LCB7XG4gICAgICB3YWl0TXM6IHRpbWVvdXRNcyxcbiAgICAgIGludGVydmFsTXM6IDMwMCxcbiAgICB9KTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGRldmljZSAnJHt0aGlzLnVkaWR9JyBpcyBub3QgcmVzcG9uZGluZyB0byBpZGIgcmVxdWVzdHMgYWZ0ZXIgJHt0aW1lb3V0TXN9bXMgdGltZW91dC4gYCArXG4gICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7bGFzdEVycm9yIHx8IGUubWVzc2FnZX1gKTtcbiAgfVxuICBsb2cuZGVidWcoYFRoZSBkZXZpY2UgJyR7dGhpcy51ZGlkfScgaXMgb25saW5lIGFuZCByZWFkeSB0byBhY2NlcHQgaWRiIGNvbW1hbmRzIGluIGAgK1xuICAgIGAke3RpbWVyLmdldER1cmF0aW9uKCkuYXNTZWNvbmRzLnRvRml4ZWQoMyl9c2ApO1xufTtcblxuLyoqXG4gKiBQZXJmb3JtcyBjbGVhbnVwIG9mIG9ic29sZXRlIGNvbXBhbmlvbiBwcm9jZXNzZXNcbiAqIFRoZSBkYWVtb24gcHJvY2VzcyBpcyBsZWZ0IHVudG91Y2hlZCwgYmVjYXVzZSBraWxsaW5nIGl0IG1pZ2h0XG4gKiBwb3RlbnRpYWxseSBhZmZlY3Qgb3RoZXIgcGFyYWxsZWwgc2Vzc2lvbnMuIE5vdGhpbmdcbiAqIGlzIGRvbmUgaWYgbm8gb2Jzb2xldGUgcHJvY2Vzc2VzIGFyZSBmb3VuZC5cbiAqL1xuc3lzdGVtQ2FsbE1ldGhvZHMuZGlzY29ubmVjdCA9IGFzeW5jIGZ1bmN0aW9uIGRpc2Nvbm5lY3QgKCkge1xuICBsb2cuZGVidWcoYERpc2Nvbm5lY3RpbmcgJHtJREJfRVhFQ1VUQUJMRX0gc2VydmljZSBmcm9tICcke3RoaXMudWRpZH0nYCk7XG5cbiAgdHJ5IHtcbiAgICBhd2FpdCB0cEV4ZWModGhpcy5leGVjdXRhYmxlLnBhdGgsIFsnZGlzY29ubmVjdCcsIHRoaXMudWRpZF0pO1xuICB9IGNhdGNoIChpZ24pIHt9XG5cbiAgY29uc3QgY29tcGFuaW9uUGlkcyA9IGF3YWl0IGdldFBpZHMoQ09NUEFOSU9OX1BHUkVQX1BBVFRFUk4odGhpcy51ZGlkKSk7XG4gIGlmIChfLmlzRW1wdHkoY29tcGFuaW9uUGlkcykpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBsb2cuZGVidWcoYENsZWFuaW5nIHVwICR7Y29tcGFuaW9uUGlkcy5sZW5ndGh9IG9ic29sZXRlICR7SURCX0NPTVBBTklPTl9FWEVDVVRBQkxFfSBgICtcbiAgICBgcHJvY2VzcyR7Y29tcGFuaW9uUGlkcy5sZW5ndGggPT09IDEgPyAnJyA6ICdlcyd9YCk7XG4gIGF3YWl0IHRwRXhlYygna2lsbCcsIFsnLTInLCAuLi5jb21wYW5pb25QaWRzXSk7XG59O1xuXG4vKipcbiAqIEV4ZWN1dGUgdGhlIGdpdmVuIGlkYiBjb21tYW5kLlxuICpcbiAqIEBwYXJhbSB7QXJyYXkuPHN0cmluZz59IGNtZCAtIFRoZSBhY3R1YWwgaWRiIGNvbW1hbmQgd2l0aG91dCBhcmd1bWVudHMvcGFyYW1zLlxuICogQHBhcmFtIHtBcnJheTxzdHJpbmc+fSBhcmdzIC0gT3B0aW9uYWwgY29tbWFuZCBhcmd1bWVudHMuXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0cyAtIEFkZGl0aW9uYWwgb3B0aW9ucyBtYXBwaW5nLiBTZWVcbiAqICAgICAgICAgICAgICAgICAgICAgICAge0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS9hcHBpdW0vbm9kZS10ZWVuX3Byb2Nlc3N9XG4gKiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBtb3JlIGRldGFpbHMuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IC0gQ29tbWFuZCdzIHN0ZG91dC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29tbWFuZCByZXR1cm5lZCBub24temVybyBleGl0IGNvZGUuXG4gKi9cbnN5c3RlbUNhbGxNZXRob2RzLmV4ZWMgPSBhc3luYyBmdW5jdGlvbiBleGVjIChjbWQsIGFyZ3MgPSBbXSwgb3B0cyA9IHt9KSB7XG4gIGlmICghY21kKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdZb3UgbmVlZCB0byBwYXNzIGluIGEgY29tbWFuZCB0byBleGVjKCknKTtcbiAgfVxuICBjbWQgPSBfLmlzQXJyYXkoY21kKSA/IGNtZCA6IFtjbWRdO1xuXG4gIG9wdHMgPSBfLmNsb25lRGVlcChvcHRzKTtcbiAgLy8gc2V0dGluZyBkZWZhdWx0IHRpbWVvdXQgZm9yIGVhY2ggY29tbWFuZCB0byBwcmV2ZW50IGluZmluaXRlIHdhaXQuXG4gIG9wdHMudGltZW91dCA9IG9wdHMudGltZW91dCB8fCB0aGlzLmV4ZWNUaW1lb3V0IHx8IERFRkFVTFRfSURCX0VYRUNfVElNRU9VVDtcbiAgb3B0cy50aW1lb3V0Q2FwTmFtZSA9IG9wdHMudGltZW91dENhcE5hbWUgfHwgJ2V4ZWNUaW1lb3V0JzsgLy8gRm9yIGVycm9yIG1lc3NhZ2VcblxuICBjb25zdCBmdWxsQXJncyA9IFsuLi5jbWQsIC4uLnRoaXMuZXhlY3V0YWJsZS5kZWZhdWx0QXJncywgLi4uYXJnc107XG4gIGxvZy5kZWJ1ZyhgUnVubmluZyAnJHt0aGlzLmV4ZWN1dGFibGUucGF0aH0gJHt1dGlsLnF1b3RlKGZ1bGxBcmdzKX0nYCk7XG4gIHRyeSB7XG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCB0cEV4ZWModGhpcy5leGVjdXRhYmxlLnBhdGgsIGZ1bGxBcmdzLCBvcHRzKTtcbiAgICByZXR1cm4gc3Rkb3V0O1xuICB9IGNhdGNoIChlKSB7XG4gICAgaWYgKHV0aWwuaGFzVmFsdWUoZS5jb2RlKSkge1xuICAgICAgZS5tZXNzYWdlID0gYEVycm9yIGV4ZWN1dGluZyAke0lEQl9FWEVDVVRBQkxFfS4gT3JpZ2luYWwgZXJyb3I6ICcke2UubWVzc2FnZX0nOyBgICtcbiAgICAgICAgYFN0ZG91dDogJyR7KGUuc3Rkb3V0IHx8ICcnKS50cmltKCl9JzsgYCArXG4gICAgICAgIGBTdGRlcnI6ICckeyhlLnN0ZGVyciB8fCAnJykudHJpbSgpfSc7IGAgK1xuICAgICAgICBgQ29kZTogJyR7ZS5jb2RlfSdgO1xuICAgIH0gZWxzZSB7XG4gICAgICBlLm1lc3NhZ2UgPSBgRXJyb3IgZXhlY3V0aW5nICR7SURCX0VYRUNVVEFCTEV9LiBPcmlnaW5hbCBlcnJvcjogJyR7ZS5tZXNzYWdlfScuIGAgK1xuICAgICAgICBgVHJ5IHRvIGluY3JlYXNlIHRoZSAke29wdHMudGltZW91dH1tcyAke0lEQl9FWEVDVVRBQkxFfSBleGVjdXRpb24gdGltZW91dCByZXByZXNlbnRlZCBieSAnJHtvcHRzLnRpbWVvdXRDYXBOYW1lfScgY2FwYWJpbGl0eWA7XG4gICAgfVxuICAgIHRocm93IGU7XG4gIH1cbn07XG5cbi8qKlxuICogQ3JlYXRlcyBTdWJQcm9jZXNzIGluc3RhbmNlIG9mIGlkYiBmb3IgYmFja2dyb3VuZFxuICogZXhlY3V0aW9uLlxuICpcbiAqIEBwYXJhbSB7QXJyYXk8U3RyaW5nPn0gY29tbWFuZCBkZXNpcmVkIGlkYiBjb21tYW5kIChlLmcuOiBbXCJsYXVuY2hcIl0sIFtcInhjdGVzdFwiLCBcInJ1blwiLCBcInVpXCJdKVxuICogQHBhcmFtIHtBcnJheTxTdHJpbmc+fSBhcmdzIGFkZGl0aW9uYWwgaWRiIGFyZ3VtZW50c1xuICogQHJldHVybnMge1N1YlByb2Nlc3N9XG4gKi9cbnN5c3RlbUNhbGxNZXRob2RzLmNyZWF0ZVN1YlByb2Nlc3MgPSBmdW5jdGlvbiBjcmVhdGVTdWJQcm9jZXNzIChjb21tYW5kID0gW10sIGFyZ3MgPSBbXSwgb3B0cyA9IHt9KSB7XG4gIGNvbnN0IGlkYkFyZ3MgPSBbLi4uY29tbWFuZCwgLi4udGhpcy5leGVjdXRhYmxlLmRlZmF1bHRBcmdzLCAuLi5hcmdzXTtcbiAgbG9nLmRlYnVnKGBDcmVhdGluZyAke0lEQl9FWEVDVVRBQkxFfSBzdWJwcm9jZXNzIHdpdGggYXJnczogJHt1dGlsLnF1b3RlKGFyZ3MpfWApO1xuICByZXR1cm4gbmV3IFN1YlByb2Nlc3ModGhpcy5leGVjdXRhYmxlLnBhdGgsIGlkYkFyZ3MsIG9wdHMpO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgc3lzdGVtQ2FsbE1ldGhvZHM7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFHQSxNQUFNQSx1QkFBdUIsR0FBSUMsSUFBSSxJQUNsQyxHQUFFQyxpQ0FBeUIsdUJBQXNCRCxJQUFLLEVBQUM7QUFDMUQsTUFBTUUsd0JBQXdCLEdBQUcsbUJBQW1CO0FBQ3BELE1BQU1DLDhCQUE4QixHQUFHLDBCQUEwQjtBQUNqRSxNQUFNQyw2QkFBNkIsR0FBRyxFQUFFO0FBRXhDLE1BQU1DLGlCQUFpQixHQUFHLENBQUMsQ0FBQztBQW9CNUJBLGlCQUFpQixDQUFDQyxPQUFPLEdBQUcsZUFBZUEsT0FBTyxDQUFFQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLEVBQUU7RUFDN0QsTUFBTTtJQUNKQztFQUNGLENBQUMsR0FBR0QsSUFBSTtFQUVSRSxlQUFHLENBQUNDLEtBQUssQ0FBRSxjQUFhQyx1QkFBZSxnQkFBZSxJQUFJLENBQUNYLElBQUssR0FBRSxDQUFDO0VBRW5FLE1BQU1ZLFdBQVcsR0FBRyxDQUFDLENBQUM7RUFDdEIsS0FBSyxNQUFNQyxNQUFNLElBQUksQ0FBQ0YsdUJBQWMsRUFBRVYsaUNBQXdCLENBQUMsRUFBRTtJQUMvRCxJQUFJO01BQ0ZXLFdBQVcsQ0FBQ0MsTUFBTSxDQUFDLEdBQUcsTUFBTUMsV0FBRSxDQUFDQyxLQUFLLENBQUNGLE1BQU0sQ0FBQztJQUM5QyxDQUFDLENBQUMsT0FBT0csQ0FBQyxFQUFFO01BQ1YsTUFBTSxJQUFJQyxLQUFLLENBQUUsSUFBR0osTUFBTyxnQ0FBK0IsR0FDdkQsNkRBQTRELENBQUM7SUFDbEU7RUFDRjtFQUVBLElBQUlLLFFBQVEsR0FBR0Msb0NBQTJCO0VBQzFDVixlQUFHLENBQUNDLEtBQUssQ0FBRSx3QkFBdUJFLFdBQVcsQ0FBQ1gsaUNBQXdCLENBQUUsR0FBRSxDQUFDO0VBQzNFLE1BQU1tQixhQUFhLEdBQUcsSUFBSUMsd0JBQVUsQ0FBQ1QsV0FBVyxDQUFDWCxpQ0FBd0IsQ0FBQyxFQUFFLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQ0QsSUFBSSxDQUFDLENBQUM7RUFDbEcsSUFBSXNCLFNBQVMsR0FBRztJQUNkLGNBQWMsRUFBRSxJQUFJO0lBQ3BCLGNBQWMsRUFBRSxJQUFJO0lBQ3BCQyxJQUFJLEVBQUU7RUFDUixDQUFDO0VBQ0QsTUFBTUMsZ0JBQWdCLEdBQUcsTUFBTTtJQUM3QkMsZUFBQyxDQUFDQyxPQUFPLENBQUNKLFNBQVMsQ0FBQyxDQUNqQkssTUFBTSxDQUFDLENBQUMsR0FBR0MsQ0FBQyxDQUFDLEtBQUtILGVBQUMsQ0FBQ0ksVUFBVSxDQUFDRCxDQUFDLENBQUMsQ0FBQyxDQUNsQ0UsR0FBRyxDQUFDLENBQUMsQ0FBQ0MsQ0FBQyxFQUFFSCxDQUFDLENBQUMsS0FBS1IsYUFBYSxDQUFDWSxjQUFjLENBQUNELENBQUMsRUFBRUgsQ0FBQyxDQUFDLENBQUM7SUFDdEROLFNBQVMsR0FBRyxDQUFDLENBQUM7RUFDaEIsQ0FBQztFQUNELElBQUk7SUFDRixNQUFNRixhQUFhLENBQUNhLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFFNUIsTUFBTSxJQUFJQyxpQkFBQyxDQUFDLENBQUNDLE9BQU8sRUFBRUMsTUFBTSxLQUFLO01BQy9CLEtBQUssTUFBTUMsT0FBTyxJQUFJLENBQUMsUUFBUSxFQUFFLFFBQVEsQ0FBQyxFQUFFO1FBQzFDLE1BQU1DLFNBQVMsR0FBSSxTQUFRRCxPQUFRLEVBQUM7UUFDcENmLFNBQVMsQ0FBQ2dCLFNBQVMsQ0FBQyxHQUFJQyxLQUFLLElBQUs7VUFDaEMsS0FBSyxNQUFNQyxJQUFJLElBQUlELEtBQUssRUFBRTtZQUN4QixJQUFJZCxlQUFDLENBQUNnQixPQUFPLENBQUNoQixlQUFDLENBQUNpQixJQUFJLENBQUNGLElBQUksQ0FBQyxDQUFDLEVBQUU7Y0FDM0I7WUFDRjtZQUVBLElBQUksSUFBSSxDQUFDRyxPQUFPLEVBQUU7Y0FDaEJsQyxlQUFHLENBQUNDLEtBQUssQ0FBRSxJQUFHVCxpQ0FBeUIsSUFBR29DLE9BQVEsS0FBSUcsSUFBSyxFQUFDLENBQUM7WUFDL0Q7WUFHQSxNQUFNSSxVQUFVLEdBQUcxQyx3QkFBd0IsQ0FBQzJDLElBQUksQ0FBQ0wsSUFBSSxDQUFDO1lBQ3RELElBQUlJLFVBQVUsRUFBRTtjQUVkMUIsUUFBUSxHQUFHMEIsVUFBVSxDQUFDLENBQUMsQ0FBQztjQUN4QlQsT0FBTyxFQUFFO1lBQ1gsQ0FBQyxNQUFNO2NBRUwsTUFBTVcsVUFBVSxHQUFHM0MsOEJBQThCLENBQUMwQyxJQUFJLENBQUNMLElBQUksQ0FBQztjQUM1RCxJQUFJTSxVQUFVLEVBQUU7Z0JBQ2RWLE1BQU0sQ0FBQyxJQUFJbkIsS0FBSyxDQUFDNkIsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7Y0FDbEM7WUFDRjtVQUNGO1FBQ0YsQ0FBQztRQUNEMUIsYUFBYSxDQUFDMkIsRUFBRSxDQUFDVCxTQUFTLEVBQUVoQixTQUFTLENBQUNnQixTQUFTLENBQUMsQ0FBQztNQUNuRDtNQUVBaEIsU0FBUyxDQUFDQyxJQUFJLEdBQUcsQ0FBQ3lCLElBQUksRUFBRUMsTUFBTSxLQUFLO1FBQ2pDekIsZ0JBQWdCLEVBQUU7UUFDbEIsTUFBTTBCLE9BQU8sR0FBSSxHQUFFakQsaUNBQXlCLHNCQUFxQitDLElBQUssa0JBQWlCQyxNQUFPLEdBQUU7UUFDaEd4QyxlQUFHLENBQUNDLEtBQUssQ0FBQ3dDLE9BQU8sQ0FBQztRQUNsQmQsTUFBTSxDQUFDLElBQUluQixLQUFLLENBQUNpQyxPQUFPLENBQUMsQ0FBQztNQUM1QixDQUFDO01BQ0Q5QixhQUFhLENBQUMrQixJQUFJLENBQUMsTUFBTSxFQUFFN0IsU0FBUyxDQUFDQyxJQUFJLENBQUM7SUFDNUMsQ0FBQyxDQUFDLENBQUM2QixPQUFPLENBQ1JoRCw2QkFBNkIsR0FBRyxJQUFJLEVBQ25DLDJDQUEwQ0EsNkJBQThCLFdBQVUsQ0FDcEY7RUFDSCxDQUFDLENBQUMsT0FBT2lELEdBQUcsRUFBRTtJQUNaN0IsZ0JBQWdCLEVBQUU7SUFDbEIsSUFBSUosYUFBYSxDQUFDa0MsU0FBUyxFQUFFO01BQzNCLElBQUk7UUFDRixNQUFNbEMsYUFBYSxDQUFDbUMsSUFBSSxFQUFFO01BQzVCLENBQUMsQ0FBQyxPQUFPQyxHQUFHLEVBQUUsQ0FBQztJQUNqQjtJQUNBL0MsZUFBRyxDQUFDZ0QsS0FBSyxDQUFFLG1CQUFrQnhELGlDQUF5QixLQUFJb0QsR0FBRyxDQUFDSCxPQUFRLEVBQUMsQ0FBQztJQUN4RSxNQUFNRyxHQUFHO0VBQ1g7RUFFQTVDLGVBQUcsQ0FBQ0MsS0FBSyxDQUFFLEdBQUVULGlDQUF5QiwrQkFBOEJpQixRQUFTLEdBQUUsQ0FBQztFQUVoRixJQUFJO0lBQ0YsSUFBSTtNQUNGLE1BQU0sSUFBQXdDLGtCQUFNLEVBQUMvQyx1QkFBYyxFQUFFLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQ1gsSUFBSSxFQUFFa0IsUUFBUSxDQUFDLENBQUM7SUFDaEUsQ0FBQyxDQUFDLE9BQU95QyxlQUFlLEVBQUU7TUFDeEIsTUFBTSxJQUFBQyx1QkFBYSxFQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsWUFBWTtRQUN0QyxNQUFNLElBQUksQ0FBQ0MsVUFBVSxFQUFFO1FBQ3ZCLElBQUk7VUFDRixNQUFNLElBQUFILGtCQUFNLEVBQUMvQyx1QkFBYyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDeEMsQ0FBQyxDQUFDLE9BQU82QyxHQUFHLEVBQUUsQ0FBQztRQUNmLE1BQU0sSUFBQUUsa0JBQU0sRUFBQy9DLHVCQUFjLEVBQUUsQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDWCxJQUFJLEVBQUVrQixRQUFRLENBQUMsQ0FBQztNQUNoRSxDQUFDLENBQUM7SUFDSjtFQUNGLENBQUMsQ0FBQyxPQUFPRixDQUFDLEVBQUU7SUFDVixJQUFJQSxDQUFDLENBQUM4QyxNQUFNLElBQUk5QyxDQUFDLENBQUMrQyxNQUFNLEVBQUU7TUFDeEJ0RCxlQUFHLENBQUNDLEtBQUssQ0FBQ00sQ0FBQyxDQUFDOEMsTUFBTSxJQUFJOUMsQ0FBQyxDQUFDK0MsTUFBTSxDQUFDO0lBQ2pDO0lBQ0EsTUFBTSxJQUFJOUMsS0FBSyxDQUFFLGdCQUFlTix1QkFBZSw0QkFBMkIsSUFBSSxDQUFDWCxJQUFLLEtBQUksR0FDckYsd0NBQXVDLENBQUM7RUFDN0M7RUFDQVMsZUFBRyxDQUFDdUQsSUFBSSxDQUFFLDhDQUE2Q3JELHVCQUFlLGlCQUFnQixJQUFJLENBQUNYLElBQUssR0FBRSxDQUFDO0VBRW5HLElBQUlRLGFBQWEsRUFBRTtJQUNqQixNQUFNLElBQUksQ0FBQ3lELGFBQWEsQ0FBQ3pELGFBQWEsQ0FBQztFQUN6QztFQUVBLElBQUksQ0FBQzBELFVBQVUsQ0FBQ0MsSUFBSSxHQUFHdkQsV0FBVyxDQUFDRCx1QkFBYyxDQUFDO0VBQ2xELElBQUksQ0FBQ3lELFNBQVMsQ0FBQ0QsSUFBSSxHQUFHdkQsV0FBVyxDQUFDWCxpQ0FBd0IsQ0FBQztBQUM3RCxDQUFDO0FBV0RJLGlCQUFpQixDQUFDNEQsYUFBYSxHQUFHLGVBQWVBLGFBQWEsQ0FBRUksU0FBUyxHQUFHLEtBQUssRUFBRTtFQUNqRixJQUFJLENBQUNBLFNBQVMsRUFBRTtJQUNkNUQsZUFBRyxDQUFDQyxLQUFLLENBQUMsbUVBQW1FLENBQUM7SUFDOUU7RUFDRjtFQUVBRCxlQUFHLENBQUNDLEtBQUssQ0FBRSxpQkFBZ0IyRCxTQUFVLGdDQUErQixDQUFDO0VBQ3JFLE1BQU1DLEtBQUssR0FBRyxJQUFJQyxlQUFNLENBQUNDLEtBQUssRUFBRSxDQUFDdkMsS0FBSyxFQUFFO0VBQ3hDLElBQUl3QyxTQUFTLEdBQUcsSUFBSTtFQUNwQixJQUFJO0lBQ0YsTUFBTSxJQUFBQywwQkFBZ0IsRUFBQyxZQUFZO01BQ2pDLElBQUk7UUFDRixNQUFNLElBQUksQ0FBQzdCLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxjQUFjLENBQUMsQ0FBQztRQUN2QyxPQUFPLElBQUk7TUFDYixDQUFDLENBQUMsT0FBTzdCLENBQUMsRUFBRTtRQUNWeUQsU0FBUyxHQUFHekQsQ0FBQyxDQUFDOEMsTUFBTSxJQUFJOUMsQ0FBQyxDQUFDa0MsT0FBTztRQUNqQyxPQUFPLEtBQUs7TUFDZDtJQUNGLENBQUMsRUFBRTtNQUNEeUIsTUFBTSxFQUFFTixTQUFTO01BQ2pCTyxVQUFVLEVBQUU7SUFDZCxDQUFDLENBQUM7RUFDSixDQUFDLENBQUMsT0FBTzVELENBQUMsRUFBRTtJQUNWLE1BQU0sSUFBSUMsS0FBSyxDQUFFLGVBQWMsSUFBSSxDQUFDakIsSUFBSyw2Q0FBNENxRSxTQUFVLGNBQWEsR0FDekcsbUJBQWtCSSxTQUFTLElBQUl6RCxDQUFDLENBQUNrQyxPQUFRLEVBQUMsQ0FBQztFQUNoRDtFQUNBekMsZUFBRyxDQUFDQyxLQUFLLENBQUUsZUFBYyxJQUFJLENBQUNWLElBQUssa0RBQWlELEdBQ2pGLEdBQUVzRSxLQUFLLENBQUNPLFdBQVcsRUFBRSxDQUFDQyxTQUFTLENBQUNDLE9BQU8sQ0FBQyxDQUFDLENBQUUsR0FBRSxDQUFDO0FBQ25ELENBQUM7QUFRRDFFLGlCQUFpQixDQUFDd0QsVUFBVSxHQUFHLGVBQWVBLFVBQVUsR0FBSTtFQUMxRHBELGVBQUcsQ0FBQ0MsS0FBSyxDQUFFLGlCQUFnQkMsdUJBQWUsa0JBQWlCLElBQUksQ0FBQ1gsSUFBSyxHQUFFLENBQUM7RUFFeEUsSUFBSTtJQUNGLE1BQU0sSUFBQTBELGtCQUFNLEVBQUMsSUFBSSxDQUFDUSxVQUFVLENBQUNDLElBQUksRUFBRSxDQUFDLFlBQVksRUFBRSxJQUFJLENBQUNuRSxJQUFJLENBQUMsQ0FBQztFQUMvRCxDQUFDLENBQUMsT0FBT3dELEdBQUcsRUFBRSxDQUFDO0VBRWYsTUFBTXdCLGFBQWEsR0FBRyxNQUFNLElBQUFDLGdCQUFPLEVBQUNsRix1QkFBdUIsQ0FBQyxJQUFJLENBQUNDLElBQUksQ0FBQyxDQUFDO0VBQ3ZFLElBQUl5QixlQUFDLENBQUNnQixPQUFPLENBQUN1QyxhQUFhLENBQUMsRUFBRTtJQUM1QjtFQUNGO0VBRUF2RSxlQUFHLENBQUNDLEtBQUssQ0FBRSxlQUFjc0UsYUFBYSxDQUFDRSxNQUFPLGFBQVlqRixpQ0FBeUIsR0FBRSxHQUNsRixVQUFTK0UsYUFBYSxDQUFDRSxNQUFNLEtBQUssQ0FBQyxHQUFHLEVBQUUsR0FBRyxJQUFLLEVBQUMsQ0FBQztFQUNyRCxNQUFNLElBQUF4QixrQkFBTSxFQUFDLE1BQU0sRUFBRSxDQUFDLElBQUksRUFBRSxHQUFHc0IsYUFBYSxDQUFDLENBQUM7QUFDaEQsQ0FBQztBQWFEM0UsaUJBQWlCLENBQUN3QyxJQUFJLEdBQUcsZUFBZUEsSUFBSSxDQUFFc0MsR0FBRyxFQUFFQyxJQUFJLEdBQUcsRUFBRSxFQUFFN0UsSUFBSSxHQUFHLENBQUMsQ0FBQyxFQUFFO0VBQ3ZFLElBQUksQ0FBQzRFLEdBQUcsRUFBRTtJQUNSLE1BQU0sSUFBSWxFLEtBQUssQ0FBQyx5Q0FBeUMsQ0FBQztFQUM1RDtFQUNBa0UsR0FBRyxHQUFHMUQsZUFBQyxDQUFDNEQsT0FBTyxDQUFDRixHQUFHLENBQUMsR0FBR0EsR0FBRyxHQUFHLENBQUNBLEdBQUcsQ0FBQztFQUVsQzVFLElBQUksR0FBR2tCLGVBQUMsQ0FBQzZELFNBQVMsQ0FBQy9FLElBQUksQ0FBQztFQUV4QkEsSUFBSSxDQUFDNkMsT0FBTyxHQUFHN0MsSUFBSSxDQUFDNkMsT0FBTyxJQUFJLElBQUksQ0FBQ21DLFdBQVcsSUFBSUMsaUNBQXdCO0VBQzNFakYsSUFBSSxDQUFDa0YsY0FBYyxHQUFHbEYsSUFBSSxDQUFDa0YsY0FBYyxJQUFJLGFBQWE7RUFFMUQsTUFBTUMsUUFBUSxHQUFHLENBQUMsR0FBR1AsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDakIsVUFBVSxDQUFDeUIsV0FBVyxFQUFFLEdBQUdQLElBQUksQ0FBQztFQUNsRTNFLGVBQUcsQ0FBQ0MsS0FBSyxDQUFFLFlBQVcsSUFBSSxDQUFDd0QsVUFBVSxDQUFDQyxJQUFLLElBQUd5QixhQUFJLENBQUNDLEtBQUssQ0FBQ0gsUUFBUSxDQUFFLEdBQUUsQ0FBQztFQUN0RSxJQUFJO0lBQ0YsTUFBTTtNQUFDM0I7SUFBTSxDQUFDLEdBQUcsTUFBTSxJQUFBTCxrQkFBTSxFQUFDLElBQUksQ0FBQ1EsVUFBVSxDQUFDQyxJQUFJLEVBQUV1QixRQUFRLEVBQUVuRixJQUFJLENBQUM7SUFDbkUsT0FBT3dELE1BQU07RUFDZixDQUFDLENBQUMsT0FBTy9DLENBQUMsRUFBRTtJQUNWLElBQUk0RSxhQUFJLENBQUNFLFFBQVEsQ0FBQzlFLENBQUMsQ0FBQ2dDLElBQUksQ0FBQyxFQUFFO01BQ3pCaEMsQ0FBQyxDQUFDa0MsT0FBTyxHQUFJLG1CQUFrQnZDLHVCQUFlLHNCQUFxQkssQ0FBQyxDQUFDa0MsT0FBUSxLQUFJLEdBQzlFLFlBQVcsQ0FBQ2xDLENBQUMsQ0FBQytDLE1BQU0sSUFBSSxFQUFFLEVBQUVyQixJQUFJLEVBQUcsS0FBSSxHQUN2QyxZQUFXLENBQUMxQixDQUFDLENBQUM4QyxNQUFNLElBQUksRUFBRSxFQUFFcEIsSUFBSSxFQUFHLEtBQUksR0FDdkMsVUFBUzFCLENBQUMsQ0FBQ2dDLElBQUssR0FBRTtJQUN2QixDQUFDLE1BQU07TUFDTGhDLENBQUMsQ0FBQ2tDLE9BQU8sR0FBSSxtQkFBa0J2Qyx1QkFBZSxzQkFBcUJLLENBQUMsQ0FBQ2tDLE9BQVEsS0FBSSxHQUM5RSx1QkFBc0IzQyxJQUFJLENBQUM2QyxPQUFRLE1BQUt6Qyx1QkFBZSxzQ0FBcUNKLElBQUksQ0FBQ2tGLGNBQWUsY0FBYTtJQUNsSTtJQUNBLE1BQU16RSxDQUFDO0VBQ1Q7QUFDRixDQUFDO0FBVURYLGlCQUFpQixDQUFDMEYsZ0JBQWdCLEdBQUcsU0FBU0EsZ0JBQWdCLENBQUVDLE9BQU8sR0FBRyxFQUFFLEVBQUVaLElBQUksR0FBRyxFQUFFLEVBQUU3RSxJQUFJLEdBQUcsQ0FBQyxDQUFDLEVBQUU7RUFDbEcsTUFBTTBGLE9BQU8sR0FBRyxDQUFDLEdBQUdELE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQzlCLFVBQVUsQ0FBQ3lCLFdBQVcsRUFBRSxHQUFHUCxJQUFJLENBQUM7RUFDckUzRSxlQUFHLENBQUNDLEtBQUssQ0FBRSxZQUFXQyx1QkFBZSwwQkFBeUJpRixhQUFJLENBQUNDLEtBQUssQ0FBQ1QsSUFBSSxDQUFFLEVBQUMsQ0FBQztFQUNqRixPQUFPLElBQUkvRCx3QkFBVSxDQUFDLElBQUksQ0FBQzZDLFVBQVUsQ0FBQ0MsSUFBSSxFQUFFOEIsT0FBTyxFQUFFMUYsSUFBSSxDQUFDO0FBQzVELENBQUM7QUFBQyxlQUVhRixpQkFBaUI7QUFBQSJ9