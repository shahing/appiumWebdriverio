"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SAFARI_STARTUP_TIMEOUT = exports.MOBILE_SAFARI_BUNDLE_ID = void 0;
exports.activateApp = activateApp;
exports.endAllSimulatorDaemons = endAllSimulatorDaemons;
exports.execSQLiteQuery = execSQLiteQuery;
exports.getDeveloperRoot = getDeveloperRoot;
exports.getSimulatorInfo = getSimulatorInfo;
exports.hasSSLCert = hasSSLCert;
exports.installSSLCert = installSSLCert;
exports.killAllSimulators = killAllSimulators;
exports.launchApp = launchApp;
exports.safeRimRaf = safeRimRaf;
exports.simExists = simExists;
exports.toBiometricDomainComponent = toBiometricDomainComponent;
exports.uninstallSSLCert = uninstallSSLCert;
require("source-map-support/register");
var _logger = _interopRequireDefault(require("./logger"));
var _lodash = _interopRequireDefault(require("lodash"));
var _teen_process = require("teen_process");
var _asyncbox = require("asyncbox");
var _appiumXcode = require("appium-xcode");
var _nodeSimctl = _interopRequireDefault(require("node-simctl"));
var _support = require("@appium/support");
var _certificate = require("./certificate");
var _path = _interopRequireDefault(require("path"));
var _simulatorXcode = _interopRequireDefault(require("./simulator-xcode-6"));
const DEFAULT_SIM_SHUTDOWN_TIMEOUT = 30000;
const SAFARI_STARTUP_TIMEOUT = 25 * 1000;
exports.SAFARI_STARTUP_TIMEOUT = SAFARI_STARTUP_TIMEOUT;
const MOBILE_SAFARI_BUNDLE_ID = 'com.apple.mobilesafari';
exports.MOBILE_SAFARI_BUNDLE_ID = MOBILE_SAFARI_BUNDLE_ID;
const PROCESS_LAUNCH_OK_PATTERN = bundleId => new RegExp(`${bundleId.replace('.', '\\.')}:\\s+\\d+`);
const APP_ACTIVATION_SCRIPT = pid => `
use framework "Foundation"
use framework "AppKit"
use scripting additions

set theApp to current application's NSRunningApplication's runningApplicationWithProcessIdentifier:${pid}
if theApp = null then
	log "Cannot find Simulator window under PID ${pid}. Is it running?"
	error number 1
end if
set result to theApp's activateWithOptions:3
if not result then
	log "Cannot activate Simulator window under PID ${pid}. Is it running?"
	error number 1
end if
`;
const BIOMETRICS = {
  touchId: 'fingerTouch',
  faceId: 'pearl'
};
function toBiometricDomainComponent(name) {
  if (!BIOMETRICS[name]) {
    throw new Error(`'${name}' is not a valid biometric. Use one of: ${JSON.stringify(_lodash.default.keys(BIOMETRICS))}`);
  }
  return BIOMETRICS[name];
}
async function pkill(appName, forceKill = false) {
  let args = forceKill ? ['-9'] : [];
  args.push('-x', appName);
  try {
    await (0, _teen_process.exec)('pkill', args);
    return 0;
  } catch (err) {
    if (!_lodash.default.isUndefined(err.code)) {
      throw new Error(`Cannot forcefully terminate ${appName}. pkill error code: ${err.code}`);
    }
    _logger.default.error(`Received unexpected error while trying to kill ${appName}: ${err.message}`);
    throw err;
  }
}
async function killAllSimulators(timeout = DEFAULT_SIM_SHUTDOWN_TIMEOUT) {
  _logger.default.debug('Killing all iOS Simulators');
  const xcodeVersion = await (0, _appiumXcode.getVersion)(true);
  const appName = xcodeVersion.major >= 7 ? 'Simulator' : 'iOS Simulator';
  timeout = timeout * (xcodeVersion.major >= 8 ? 2 : 1);
  try {
    await (0, _teen_process.exec)('xcrun', ['simctl', 'shutdown', xcodeVersion.major > 8 ? 'all' : 'booted'], {
      timeout
    });
  } catch (ign) {}
  const pids = [];
  try {
    const {
      stdout
    } = await (0, _teen_process.exec)('pgrep', ['-f', `${appName}.app/Contents/MacOS/`]);
    if (stdout.trim()) {
      pids.push(...stdout.trim().split(/\s+/));
    }
  } catch (e) {
    if (e.code === 1) {
      _logger.default.debug(`${appName} is not running. Continuing...`);
      return;
    }
    if (_lodash.default.isEmpty(pids)) {
      _logger.default.warn(`pgrep error ${e.code} while detecting whether ${appName} is running. Trying to kill anyway.`);
    }
  }
  if (!_lodash.default.isEmpty(pids)) {
    _logger.default.debug(`Killing processes: ${pids.join(', ')}`);
    try {
      await (0, _teen_process.exec)('kill', ['-9', ...pids.map(pid => `${pid}`)]);
    } catch (ign) {}
  }
  _logger.default.debug(`Using pkill to kill application: ${appName}`);
  try {
    await pkill(appName, true);
  } catch (ign) {}
  let remainingDevices = [];
  async function allSimsAreDown() {
    remainingDevices = [];
    let devices = await new _nodeSimctl.default().getDevices();
    devices = _lodash.default.flatten(_lodash.default.values(devices));
    return _lodash.default.every(devices, sim => {
      let state = sim.state.toLowerCase();
      let done = state === 'shutdown' || state === 'unavailable' || state === 'disconnected';
      if (!done) {
        remainingDevices.push(`${sim.name} (${sim.sdk}, udid: ${sim.udid}) is still in state '${state}'`);
      }
      return done;
    });
  }
  try {
    await (0, _asyncbox.waitForCondition)(allSimsAreDown, {
      waitMs: timeout,
      intervalMs: 200
    });
  } catch (err) {
    if (remainingDevices.length > 0) {
      _logger.default.warn(`The following devices are still not in the correct state after ${timeout} ms:`);
      for (let device of remainingDevices) {
        _logger.default.warn(`    ${device}`);
      }
    }
    throw err;
  }
}
async function endAllSimulatorDaemons() {
  _logger.default.debug('Ending all simulator daemons');
  for (let servicePattern of ['com.apple.iphonesimulator', 'com.apple.CoreSimulator']) {
    _logger.default.debug(`Killing any other ${servicePattern} daemons`);
    let launchCtlCommand = `launchctl list | grep ${servicePattern} | cut -f 3 | xargs -n 1 launchctl`;
    try {
      let stopCmd = `${launchCtlCommand} stop`;
      await (0, _teen_process.exec)('bash', ['-c', stopCmd]);
    } catch (err) {
      _logger.default.warn(`Could not stop ${servicePattern} daemons, carrying on anyway!`);
    }
    try {
      let removeCmd = `${launchCtlCommand} remove`;
      await (0, _teen_process.exec)('bash', ['-c', removeCmd]);
    } catch (err) {
      _logger.default.warn(`Could not remove ${servicePattern} daemons, carrying on anyway!`);
    }
  }
  try {
    await (0, _asyncbox.waitForCondition)(async () => {
      let {
        stdout
      } = await (0, _teen_process.exec)('bash', ['-c', `ps -e  | grep launchd_sim | grep -v bash | grep -v grep | awk {'print$1'}`]);
      return stdout.trim().length === 0;
    }, {
      waitMs: 5000,
      intervalMs: 500
    });
  } catch (err) {
    _logger.default.warn(`Could not end all simulator daemons, carrying on!`);
  }
  _logger.default.debug('Finishing ending all simulator daemons');
}
async function getSimulatorInfo(udid, opts = {}) {
  const {
    devicesSetPath
  } = opts;
  let devices = await new _nodeSimctl.default({
    devicesSetPath
  }).getDevices();
  devices = _lodash.default.toPairs(devices).map(pair => pair[1]).reduce((a, b) => a.concat(b), []);
  return _lodash.default.find(devices, sim => sim.udid === udid);
}
async function simExists(udid) {
  return !!(await getSimulatorInfo(udid));
}
async function safeRimRaf(delPath, tryNum = 0) {
  try {
    await _support.fs.rimraf(delPath);
  } catch (err) {
    if (tryNum < 20) {
      if (err.message.indexOf('ENOTEMPTY') !== -1) {
        _logger.default.debug(`Path '${delPath}' was not empty during delete; retrying`);
        return await safeRimRaf(delPath, tryNum + 1);
      } else if (err.message.indexOf('ENOENT') !== -1) {
        _logger.default.debug(`Path '${delPath}' did not exist when we tried to delete, ignoring`);
        return await safeRimRaf(delPath, tryNum + 1);
      }
    }
  }
}
async function installSSLCert(pemText, udid) {
  try {
    await _support.fs.which('openssl');
  } catch (e) {
    _logger.default.debug(`customSSLCert requires openssl to be available on path`);
    _logger.default.errorAndThrow(`Command 'openssl' not found`);
  }
  try {
    await _support.fs.which('sqlite3');
  } catch (e) {
    _logger.default.debug(`customSSLCert requires sqlite3 to be available on path`);
    _logger.default.errorAndThrow(`Command 'sqlite3' not found`);
  }
  let tempFileName = _path.default.resolve(await _support.tempDir.openDir(), 'temp-ssl-cert.pem');
  let pathToKeychain = new _simulatorXcode.default(udid).getDir();
  await _support.fs.writeFile(tempFileName, pemText);
  try {
    await _support.fs.stat(pathToKeychain);
  } catch (e) {
    _logger.default.debug(`Could not install SSL certificate. No simulator with udid '${udid}'`);
    _logger.default.errorAndThrow(e);
  }
  let certificate = new _certificate.Certificate(tempFileName);
  _logger.default.debug(`Installing certificate to ${pathToKeychain}`);
  await certificate.add(pathToKeychain);
  await _support.fs.unlink(tempFileName);
  return certificate;
}
async function uninstallSSLCert(pemText, udid) {
  try {
    let tempFileName = _path.default.resolve(__dirname, 'temp-ssl-cert.pem');
    let pathToKeychain = _path.default.resolve(new _simulatorXcode.default(udid).getDir());
    await _support.fs.writeFile(tempFileName, pemText);
    let certificate = new _certificate.Certificate(tempFileName);
    await certificate.remove(pathToKeychain);
    await _support.fs.unlink(tempFileName);
    return certificate;
  } catch (e) {
    _logger.default.debug(`Could not uninstall SSL certificate. No simulator with udid '${udid}'`);
    _logger.default.errorAndThrow(e);
  }
}
async function hasSSLCert(pemText, udid) {
  const tempFileName = _path.default.resolve(await _support.tempDir.openDir(), 'temp-ssl-cert.pem');
  const pathToKeychain = new _simulatorXcode.default(udid).getDir();
  await _support.fs.writeFile(tempFileName, pemText);
  const certificate = new _certificate.Certificate(tempFileName);
  return certificate.has(pathToKeychain);
}
async function execSQLiteQuery(db, query, ...queryParams) {
  query = query.replace(/\n+/g, ' ');
  let queryTokens = query.split('?');
  let formattedQuery = [];
  queryParams.map(param => `${param}`).forEach((param, i) => {
    formattedQuery.push(queryTokens[i]);
    formattedQuery.push(param.replace(/'/g, "''"));
  });
  formattedQuery.push(queryTokens[queryTokens.length - 1]);
  _logger.default.debug(`Executing SQL query "${formattedQuery.join('')}" on '${db}'`);
  try {
    return (await (0, _teen_process.exec)('sqlite3', ['-line', db, formattedQuery.join('')])).stdout;
  } catch (err) {
    throw new Error(`Cannot execute SQLite query "${formattedQuery.join('')}" to '${db}'. ` + `Original error: ${err.stderr}`);
  }
}
async function getDeveloperRoot() {
  const {
    stdout
  } = await (0, _teen_process.exec)('xcode-select', ['-p']);
  return stdout.trim();
}
async function activateApp(pid) {
  try {
    await (0, _teen_process.exec)('osascript', ['-e', APP_ACTIVATION_SCRIPT(pid)]);
  } catch (e) {
    throw new Error(`Simulator window cannot be activated. Original error: ${e.stderr || e.message}`);
  }
}
async function launchApp(simctl, bundleId, timeoutMs = 25000) {
  let lastError;
  try {
    await (0, _asyncbox.waitForCondition)(async () => {
      try {
        const stdout = await simctl.launchApp(MOBILE_SAFARI_BUNDLE_ID, 1);
        return PROCESS_LAUNCH_OK_PATTERN(MOBILE_SAFARI_BUNDLE_ID).test(stdout);
      } catch (err) {
        lastError = err.stderr || err.message;
      }
      return false;
    }, {
      waitMs: timeoutMs,
      intervalMs: 500
    });
  } catch (e) {
    let msg = `'${bundleId}' did not run after ${timeoutMs}ms timeout.`;
    if (lastError) {
      msg += ` Original error: ${lastError}`;
    }
    throw new Error(msg);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJERUZBVUxUX1NJTV9TSFVURE9XTl9USU1FT1VUIiwiU0FGQVJJX1NUQVJUVVBfVElNRU9VVCIsIk1PQklMRV9TQUZBUklfQlVORExFX0lEIiwiUFJPQ0VTU19MQVVOQ0hfT0tfUEFUVEVSTiIsImJ1bmRsZUlkIiwiUmVnRXhwIiwicmVwbGFjZSIsIkFQUF9BQ1RJVkFUSU9OX1NDUklQVCIsInBpZCIsIkJJT01FVFJJQ1MiLCJ0b3VjaElkIiwiZmFjZUlkIiwidG9CaW9tZXRyaWNEb21haW5Db21wb25lbnQiLCJuYW1lIiwiRXJyb3IiLCJKU09OIiwic3RyaW5naWZ5IiwiXyIsImtleXMiLCJwa2lsbCIsImFwcE5hbWUiLCJmb3JjZUtpbGwiLCJhcmdzIiwicHVzaCIsImV4ZWMiLCJlcnIiLCJpc1VuZGVmaW5lZCIsImNvZGUiLCJsb2ciLCJlcnJvciIsIm1lc3NhZ2UiLCJraWxsQWxsU2ltdWxhdG9ycyIsInRpbWVvdXQiLCJkZWJ1ZyIsInhjb2RlVmVyc2lvbiIsImdldFZlcnNpb24iLCJtYWpvciIsImlnbiIsInBpZHMiLCJzdGRvdXQiLCJ0cmltIiwic3BsaXQiLCJlIiwiaXNFbXB0eSIsIndhcm4iLCJqb2luIiwibWFwIiwicmVtYWluaW5nRGV2aWNlcyIsImFsbFNpbXNBcmVEb3duIiwiZGV2aWNlcyIsIlNpbWN0bCIsImdldERldmljZXMiLCJmbGF0dGVuIiwidmFsdWVzIiwiZXZlcnkiLCJzaW0iLCJzdGF0ZSIsInRvTG93ZXJDYXNlIiwiZG9uZSIsInNkayIsInVkaWQiLCJ3YWl0Rm9yQ29uZGl0aW9uIiwid2FpdE1zIiwiaW50ZXJ2YWxNcyIsImxlbmd0aCIsImRldmljZSIsImVuZEFsbFNpbXVsYXRvckRhZW1vbnMiLCJzZXJ2aWNlUGF0dGVybiIsImxhdW5jaEN0bENvbW1hbmQiLCJzdG9wQ21kIiwicmVtb3ZlQ21kIiwiZ2V0U2ltdWxhdG9ySW5mbyIsIm9wdHMiLCJkZXZpY2VzU2V0UGF0aCIsInRvUGFpcnMiLCJwYWlyIiwicmVkdWNlIiwiYSIsImIiLCJjb25jYXQiLCJmaW5kIiwic2ltRXhpc3RzIiwic2FmZVJpbVJhZiIsImRlbFBhdGgiLCJ0cnlOdW0iLCJmcyIsInJpbXJhZiIsImluZGV4T2YiLCJpbnN0YWxsU1NMQ2VydCIsInBlbVRleHQiLCJ3aGljaCIsImVycm9yQW5kVGhyb3ciLCJ0ZW1wRmlsZU5hbWUiLCJwYXRoIiwicmVzb2x2ZSIsInRlbXBEaXIiLCJvcGVuRGlyIiwicGF0aFRvS2V5Y2hhaW4iLCJTaW11bGF0b3IiLCJnZXREaXIiLCJ3cml0ZUZpbGUiLCJzdGF0IiwiY2VydGlmaWNhdGUiLCJDZXJ0aWZpY2F0ZSIsImFkZCIsInVubGluayIsInVuaW5zdGFsbFNTTENlcnQiLCJfX2Rpcm5hbWUiLCJyZW1vdmUiLCJoYXNTU0xDZXJ0IiwiaGFzIiwiZXhlY1NRTGl0ZVF1ZXJ5IiwiZGIiLCJxdWVyeSIsInF1ZXJ5UGFyYW1zIiwicXVlcnlUb2tlbnMiLCJmb3JtYXR0ZWRRdWVyeSIsInBhcmFtIiwiZm9yRWFjaCIsImkiLCJzdGRlcnIiLCJnZXREZXZlbG9wZXJSb290IiwiYWN0aXZhdGVBcHAiLCJsYXVuY2hBcHAiLCJzaW1jdGwiLCJ0aW1lb3V0TXMiLCJsYXN0RXJyb3IiLCJ0ZXN0IiwibXNnIl0sInNvdXJjZXMiOlsiLi4vLi4vbGliL3V0aWxzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IGV4ZWMgfSBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuaW1wb3J0IHsgd2FpdEZvckNvbmRpdGlvbiB9IGZyb20gJ2FzeW5jYm94JztcbmltcG9ydCB7IGdldFZlcnNpb24gfSBmcm9tICdhcHBpdW0teGNvZGUnO1xuaW1wb3J0IFNpbWN0bCBmcm9tICdub2RlLXNpbWN0bCc7XG5pbXBvcnQgeyBmcywgdGVtcERpciB9IGZyb20gJ0BhcHBpdW0vc3VwcG9ydCc7XG5pbXBvcnQgeyBDZXJ0aWZpY2F0ZSB9IGZyb20gJy4vY2VydGlmaWNhdGUnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgU2ltdWxhdG9yIGZyb20gJy4vc2ltdWxhdG9yLXhjb2RlLTYnO1xuXG5cbmNvbnN0IERFRkFVTFRfU0lNX1NIVVRET1dOX1RJTUVPVVQgPSAzMDAwMDtcbmNvbnN0IFNBRkFSSV9TVEFSVFVQX1RJTUVPVVQgPSAyNSAqIDEwMDA7XG5jb25zdCBNT0JJTEVfU0FGQVJJX0JVTkRMRV9JRCA9ICdjb20uYXBwbGUubW9iaWxlc2FmYXJpJztcbmNvbnN0IFBST0NFU1NfTEFVTkNIX09LX1BBVFRFUk4gPSAoYnVuZGxlSWQpID0+IG5ldyBSZWdFeHAoYCR7YnVuZGxlSWQucmVwbGFjZSgnLicsICdcXFxcLicpfTpcXFxccytcXFxcZCtgKTtcbmNvbnN0IEFQUF9BQ1RJVkFUSU9OX1NDUklQVCA9IChwaWQpID0+IGBcbnVzZSBmcmFtZXdvcmsgXCJGb3VuZGF0aW9uXCJcbnVzZSBmcmFtZXdvcmsgXCJBcHBLaXRcIlxudXNlIHNjcmlwdGluZyBhZGRpdGlvbnNcblxuc2V0IHRoZUFwcCB0byBjdXJyZW50IGFwcGxpY2F0aW9uJ3MgTlNSdW5uaW5nQXBwbGljYXRpb24ncyBydW5uaW5nQXBwbGljYXRpb25XaXRoUHJvY2Vzc0lkZW50aWZpZXI6JHtwaWR9XG5pZiB0aGVBcHAgPSBudWxsIHRoZW5cblx0bG9nIFwiQ2Fubm90IGZpbmQgU2ltdWxhdG9yIHdpbmRvdyB1bmRlciBQSUQgJHtwaWR9LiBJcyBpdCBydW5uaW5nP1wiXG5cdGVycm9yIG51bWJlciAxXG5lbmQgaWZcbnNldCByZXN1bHQgdG8gdGhlQXBwJ3MgYWN0aXZhdGVXaXRoT3B0aW9uczozXG5pZiBub3QgcmVzdWx0IHRoZW5cblx0bG9nIFwiQ2Fubm90IGFjdGl2YXRlIFNpbXVsYXRvciB3aW5kb3cgdW5kZXIgUElEICR7cGlkfS4gSXMgaXQgcnVubmluZz9cIlxuXHRlcnJvciBudW1iZXIgMVxuZW5kIGlmXG5gO1xuXG5cbmNvbnN0IEJJT01FVFJJQ1MgPSB7XG4gIHRvdWNoSWQ6ICdmaW5nZXJUb3VjaCcsXG4gIGZhY2VJZDogJ3BlYXJsJyxcbn07XG5cbmZ1bmN0aW9uIHRvQmlvbWV0cmljRG9tYWluQ29tcG9uZW50IChuYW1lKSB7XG4gIGlmICghQklPTUVUUklDU1tuYW1lXSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgJyR7bmFtZX0nIGlzIG5vdCBhIHZhbGlkIGJpb21ldHJpYy4gVXNlIG9uZSBvZjogJHtKU09OLnN0cmluZ2lmeShfLmtleXMoQklPTUVUUklDUykpfWApO1xuICB9XG4gIHJldHVybiBCSU9NRVRSSUNTW25hbWVdO1xufVxuXG4vLyBwZ3JlcC9wa2lsbCBleGl0IGNvZGVzOlxuLy8gMCAgICAgICBPbmUgb3IgbW9yZSBwcm9jZXNzZXMgd2VyZSBtYXRjaGVkLlxuLy8gMSAgICAgICBObyBwcm9jZXNzZXMgd2VyZSBtYXRjaGVkLlxuLy8gMiAgICAgICBJbnZhbGlkIG9wdGlvbnMgd2VyZSBzcGVjaWZpZWQgb24gdGhlIGNvbW1hbmQgbGluZS5cbi8vIDMgICAgICAgQW4gaW50ZXJuYWwgZXJyb3Igb2NjdXJyZWQuXG5cbmFzeW5jIGZ1bmN0aW9uIHBraWxsIChhcHBOYW1lLCBmb3JjZUtpbGwgPSBmYWxzZSkge1xuICBsZXQgYXJncyA9IGZvcmNlS2lsbCA/IFsnLTknXSA6IFtdO1xuICBhcmdzLnB1c2goJy14JywgYXBwTmFtZSk7XG4gIHRyeSB7XG4gICAgYXdhaXQgZXhlYygncGtpbGwnLCBhcmdzKTtcbiAgICByZXR1cm4gMDtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgaWYgKCFfLmlzVW5kZWZpbmVkKGVyci5jb2RlKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgZm9yY2VmdWxseSB0ZXJtaW5hdGUgJHthcHBOYW1lfS4gcGtpbGwgZXJyb3IgY29kZTogJHtlcnIuY29kZX1gKTtcbiAgICB9XG4gICAgbG9nLmVycm9yKGBSZWNlaXZlZCB1bmV4cGVjdGVkIGVycm9yIHdoaWxlIHRyeWluZyB0byBraWxsICR7YXBwTmFtZX06ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgdGhyb3cgZXJyO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGtpbGxBbGxTaW11bGF0b3JzICh0aW1lb3V0ID0gREVGQVVMVF9TSU1fU0hVVERPV05fVElNRU9VVCkge1xuICBsb2cuZGVidWcoJ0tpbGxpbmcgYWxsIGlPUyBTaW11bGF0b3JzJyk7XG4gIGNvbnN0IHhjb2RlVmVyc2lvbiA9IGF3YWl0IGdldFZlcnNpb24odHJ1ZSk7XG4gIGNvbnN0IGFwcE5hbWUgPSB4Y29kZVZlcnNpb24ubWFqb3IgPj0gNyA/ICdTaW11bGF0b3InIDogJ2lPUyBTaW11bGF0b3InO1xuXG4gIC8vIGxhdGVyIHZlcnNpb25zIGFyZSBzbG93ZXIgdG8gY2xvc2VcbiAgdGltZW91dCA9IHRpbWVvdXQgKiAoeGNvZGVWZXJzaW9uLm1ham9yID49IDggPyAyIDogMSk7XG5cbiAgdHJ5IHtcbiAgICBhd2FpdCBleGVjKCd4Y3J1bicsIFsnc2ltY3RsJywgJ3NodXRkb3duJywgeGNvZGVWZXJzaW9uLm1ham9yID4gOCA/ICdhbGwnIDogJ2Jvb3RlZCddLCB7dGltZW91dH0pO1xuICB9IGNhdGNoIChpZ24pIHt9XG5cbiAgY29uc3QgcGlkcyA9IFtdO1xuICB0cnkge1xuICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYygncGdyZXAnLCBbJy1mJywgYCR7YXBwTmFtZX0uYXBwL0NvbnRlbnRzL01hY09TL2BdKTtcbiAgICBpZiAoc3Rkb3V0LnRyaW0oKSkge1xuICAgICAgcGlkcy5wdXNoKC4uLihzdGRvdXQudHJpbSgpLnNwbGl0KC9cXHMrLykpKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBpZiAoZS5jb2RlID09PSAxKSB7XG4gICAgICBsb2cuZGVidWcoYCR7YXBwTmFtZX0gaXMgbm90IHJ1bm5pbmcuIENvbnRpbnVpbmcuLi5gKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKF8uaXNFbXB0eShwaWRzKSkge1xuICAgICAgbG9nLndhcm4oYHBncmVwIGVycm9yICR7ZS5jb2RlfSB3aGlsZSBkZXRlY3Rpbmcgd2hldGhlciAke2FwcE5hbWV9IGlzIHJ1bm5pbmcuIFRyeWluZyB0byBraWxsIGFueXdheS5gKTtcbiAgICB9XG4gIH1cbiAgaWYgKCFfLmlzRW1wdHkocGlkcykpIHtcbiAgICBsb2cuZGVidWcoYEtpbGxpbmcgcHJvY2Vzc2VzOiAke3BpZHMuam9pbignLCAnKX1gKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZXhlYygna2lsbCcsIFsnLTknLCAuLi4ocGlkcy5tYXAoKHBpZCkgPT4gYCR7cGlkfWApKV0pO1xuICAgIH0gY2F0Y2ggKGlnbikge31cbiAgfVxuXG4gIGxvZy5kZWJ1ZyhgVXNpbmcgcGtpbGwgdG8ga2lsbCBhcHBsaWNhdGlvbjogJHthcHBOYW1lfWApO1xuICB0cnkge1xuICAgIGF3YWl0IHBraWxsKGFwcE5hbWUsIHRydWUpO1xuICB9IGNhdGNoIChpZ24pIHt9XG5cbiAgLy8gd2FpdCBmb3IgYWxsIHRoZSBkZXZpY2VzIHRvIGJlIHNodXRkb3duIGJlZm9yZSBDb250aW51aW5nXG4gIC8vIGJ1dCBvbmx5IHByaW50IG91dCB0aGUgZmFpbGVkIG9uZXMgd2hlbiB0aGV5IGFyZSBhY3R1YWxseSBmdWxseSBmYWlsZWRcbiAgbGV0IHJlbWFpbmluZ0RldmljZXMgPSBbXTtcbiAgYXN5bmMgZnVuY3Rpb24gYWxsU2ltc0FyZURvd24gKCkge1xuICAgIHJlbWFpbmluZ0RldmljZXMgPSBbXTtcbiAgICBsZXQgZGV2aWNlcyA9IGF3YWl0IG5ldyBTaW1jdGwoKS5nZXREZXZpY2VzKCk7XG4gICAgZGV2aWNlcyA9IF8uZmxhdHRlbihfLnZhbHVlcyhkZXZpY2VzKSk7XG4gICAgcmV0dXJuIF8uZXZlcnkoZGV2aWNlcywgKHNpbSkgPT4ge1xuICAgICAgbGV0IHN0YXRlID0gc2ltLnN0YXRlLnRvTG93ZXJDYXNlKCk7XG4gICAgICBsZXQgZG9uZSA9IHN0YXRlID09PSAnc2h1dGRvd24nIHx8XG4gICAgICAgICAgICAgICAgIHN0YXRlID09PSAndW5hdmFpbGFibGUnIHx8XG4gICAgICAgICAgICAgICAgIHN0YXRlID09PSAnZGlzY29ubmVjdGVkJztcbiAgICAgIGlmICghZG9uZSkge1xuICAgICAgICByZW1haW5pbmdEZXZpY2VzLnB1c2goYCR7c2ltLm5hbWV9ICgke3NpbS5zZGt9LCB1ZGlkOiAke3NpbS51ZGlkfSkgaXMgc3RpbGwgaW4gc3RhdGUgJyR7c3RhdGV9J2ApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGRvbmU7XG4gICAgfSk7XG4gIH1cbiAgdHJ5IHtcbiAgICBhd2FpdCB3YWl0Rm9yQ29uZGl0aW9uKGFsbFNpbXNBcmVEb3duLCB7XG4gICAgICB3YWl0TXM6IHRpbWVvdXQsXG4gICAgICBpbnRlcnZhbE1zOiAyMDBcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgaWYgKHJlbWFpbmluZ0RldmljZXMubGVuZ3RoID4gMCkge1xuICAgICAgbG9nLndhcm4oYFRoZSBmb2xsb3dpbmcgZGV2aWNlcyBhcmUgc3RpbGwgbm90IGluIHRoZSBjb3JyZWN0IHN0YXRlIGFmdGVyICR7dGltZW91dH0gbXM6YCk7XG4gICAgICBmb3IgKGxldCBkZXZpY2Ugb2YgcmVtYWluaW5nRGV2aWNlcykge1xuICAgICAgICBsb2cud2FybihgICAgICR7ZGV2aWNlfWApO1xuICAgICAgfVxuICAgIH1cbiAgICB0aHJvdyBlcnI7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gZW5kQWxsU2ltdWxhdG9yRGFlbW9ucyAoKSB7XG4gIGxvZy5kZWJ1ZygnRW5kaW5nIGFsbCBzaW11bGF0b3IgZGFlbW9ucycpO1xuICBmb3IgKGxldCBzZXJ2aWNlUGF0dGVybiBvZiBbJ2NvbS5hcHBsZS5pcGhvbmVzaW11bGF0b3InLCAnY29tLmFwcGxlLkNvcmVTaW11bGF0b3InXSkge1xuICAgIGxvZy5kZWJ1ZyhgS2lsbGluZyBhbnkgb3RoZXIgJHtzZXJ2aWNlUGF0dGVybn0gZGFlbW9uc2ApO1xuICAgIGxldCBsYXVuY2hDdGxDb21tYW5kID0gYGxhdW5jaGN0bCBsaXN0IHwgZ3JlcCAke3NlcnZpY2VQYXR0ZXJufSB8IGN1dCAtZiAzIHwgeGFyZ3MgLW4gMSBsYXVuY2hjdGxgO1xuICAgIHRyeSB7XG4gICAgICBsZXQgc3RvcENtZCA9IGAke2xhdW5jaEN0bENvbW1hbmR9IHN0b3BgO1xuICAgICAgYXdhaXQgZXhlYygnYmFzaCcsIFsnLWMnLCBzdG9wQ21kXSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2cud2FybihgQ291bGQgbm90IHN0b3AgJHtzZXJ2aWNlUGF0dGVybn0gZGFlbW9ucywgY2Fycnlpbmcgb24gYW55d2F5IWApO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgbGV0IHJlbW92ZUNtZCA9IGAke2xhdW5jaEN0bENvbW1hbmR9IHJlbW92ZWA7XG4gICAgICBhd2FpdCBleGVjKCdiYXNoJywgWyctYycsIHJlbW92ZUNtZF0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLndhcm4oYENvdWxkIG5vdCByZW1vdmUgJHtzZXJ2aWNlUGF0dGVybn0gZGFlbW9ucywgY2Fycnlpbmcgb24gYW55d2F5IWApO1xuICAgIH1cbiAgfVxuICAvLyB3YWl0aW5nIHVudGlsIHRoZSBzaW11bGF0b3Igc2VydmljZSBoYXMgZGllZC5cbiAgdHJ5IHtcbiAgICBhd2FpdCB3YWl0Rm9yQ29uZGl0aW9uKGFzeW5jICgpID0+IHtcbiAgICAgIGxldCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ2Jhc2gnLCBbJy1jJyxcbiAgICAgICAgYHBzIC1lICB8IGdyZXAgbGF1bmNoZF9zaW0gfCBncmVwIC12IGJhc2ggfCBncmVwIC12IGdyZXAgfCBhd2sgeydwcmludCQxJ31gXSk7XG4gICAgICByZXR1cm4gc3Rkb3V0LnRyaW0oKS5sZW5ndGggPT09IDA7XG4gICAgfSwge3dhaXRNczogNTAwMCwgaW50ZXJ2YWxNczogNTAwfSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZy53YXJuKGBDb3VsZCBub3QgZW5kIGFsbCBzaW11bGF0b3IgZGFlbW9ucywgY2Fycnlpbmcgb24hYCk7XG4gIH1cbiAgbG9nLmRlYnVnKCdGaW5pc2hpbmcgZW5kaW5nIGFsbCBzaW11bGF0b3IgZGFlbW9ucycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRTaW11bGF0b3JJbmZvICh1ZGlkLCBvcHRzID0ge30pIHtcbiAgY29uc3Qge1xuICAgIGRldmljZXNTZXRQYXRoXG4gIH0gPSBvcHRzO1xuICAvLyBzZWUgdGhlIFJFQURNRSBmb3IgZ2l0aHViLmNvbS9hcHBpdW0vbm9kZS1zaW1jdGwgZm9yIGV4YW1wbGUgb3V0cHV0IG9mIGdldERldmljZXMoKVxuICBsZXQgZGV2aWNlcyA9IGF3YWl0IG5ldyBTaW1jdGwoe1xuICAgIGRldmljZXNTZXRQYXRoXG4gIH0pLmdldERldmljZXMoKTtcblxuICBkZXZpY2VzID0gXy50b1BhaXJzKGRldmljZXMpXG4gICAgLm1hcCgocGFpcikgPT4gcGFpclsxXSlcbiAgICAucmVkdWNlKChhLCBiKSA9PiBhLmNvbmNhdChiKSwgW10pO1xuICByZXR1cm4gXy5maW5kKGRldmljZXMsIChzaW0pID0+IHNpbS51ZGlkID09PSB1ZGlkKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2ltRXhpc3RzICh1ZGlkKSB7XG4gIHJldHVybiAhIShhd2FpdCBnZXRTaW11bGF0b3JJbmZvKHVkaWQpKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2FmZVJpbVJhZiAoZGVsUGF0aCwgdHJ5TnVtID0gMCkge1xuICB0cnkge1xuICAgIGF3YWl0IGZzLnJpbXJhZihkZWxQYXRoKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgaWYgKHRyeU51bSA8IDIwKSB7XG4gICAgICBpZiAoZXJyLm1lc3NhZ2UuaW5kZXhPZignRU5PVEVNUFRZJykgIT09IC0xKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgUGF0aCAnJHtkZWxQYXRofScgd2FzIG5vdCBlbXB0eSBkdXJpbmcgZGVsZXRlOyByZXRyeWluZ2ApO1xuICAgICAgICByZXR1cm4gYXdhaXQgc2FmZVJpbVJhZihkZWxQYXRoLCB0cnlOdW0gKyAxKTtcbiAgICAgIH0gZWxzZSBpZiAoZXJyLm1lc3NhZ2UuaW5kZXhPZignRU5PRU5UJykgIT09IC0xKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgUGF0aCAnJHtkZWxQYXRofScgZGlkIG5vdCBleGlzdCB3aGVuIHdlIHRyaWVkIHRvIGRlbGV0ZSwgaWdub3JpbmdgKTtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHNhZmVSaW1SYWYoZGVsUGF0aCwgdHJ5TnVtICsgMSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogSW5zdGFsbCBhbiBTU0wgY2VydGlmaWNhdGUgdG8gYSBkZXZpY2Ugd2l0aCBnaXZlbiB1ZGlkXG4gKiBAcGFyYW0ge3N0cmluZ30gcGVtVGV4dCBTU0wgcGVtIHRleHRcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIElkZW50aWZpZXIgb2YgdGhlIFNpbXVsYXRvclxuICovXG5hc3luYyBmdW5jdGlvbiBpbnN0YWxsU1NMQ2VydCAocGVtVGV4dCwgdWRpZCkge1xuICAvLyBDaGVjayB0aGF0IG9wZW5zc2wgaXMgaW5zdGFsbGVkIG9uIHRoZSBwYXRoXG4gIHRyeSB7XG4gICAgYXdhaXQgZnMud2hpY2goJ29wZW5zc2wnKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGxvZy5kZWJ1ZyhgY3VzdG9tU1NMQ2VydCByZXF1aXJlcyBvcGVuc3NsIHRvIGJlIGF2YWlsYWJsZSBvbiBwYXRoYCk7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coYENvbW1hbmQgJ29wZW5zc2wnIG5vdCBmb3VuZGApO1xuICB9XG5cbiAgLy8gQ2hlY2sgdGhhdCBzcWxpdGUzIGlzIGluc3RhbGxlZCBvbiB0aGUgcGF0aFxuICB0cnkge1xuICAgIGF3YWl0IGZzLndoaWNoKCdzcWxpdGUzJyk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBsb2cuZGVidWcoYGN1c3RvbVNTTENlcnQgcmVxdWlyZXMgc3FsaXRlMyB0byBiZSBhdmFpbGFibGUgb24gcGF0aGApO1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBDb21tYW5kICdzcWxpdGUzJyBub3QgZm91bmRgKTtcbiAgfVxuXG4gIC8vIENyZWF0ZSBhIHRlbXBvcmFyeSBmaWxlIHRvIHN0b3JlIFBFTSB0ZXh0XG4gIC8vIChhIHRlbXAgZmlsZSBpcyBuZWNlc3NhcnkgdG8gcnVuIGBvcGVuc3NsYCBzaGVsbCBjb21tYW5kcywgY2FuJ3QgYmUgZG9uZSBpbiBtZW1vcnkpXG4gIGxldCB0ZW1wRmlsZU5hbWUgPSBwYXRoLnJlc29sdmUoYXdhaXQgdGVtcERpci5vcGVuRGlyKCksICd0ZW1wLXNzbC1jZXJ0LnBlbScpO1xuICBsZXQgcGF0aFRvS2V5Y2hhaW4gPSBuZXcgU2ltdWxhdG9yKHVkaWQpLmdldERpcigpO1xuICBhd2FpdCBmcy53cml0ZUZpbGUodGVtcEZpbGVOYW1lLCBwZW1UZXh0KTtcbiAgdHJ5IHtcbiAgICBhd2FpdCBmcy5zdGF0KHBhdGhUb0tleWNoYWluKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGxvZy5kZWJ1ZyhgQ291bGQgbm90IGluc3RhbGwgU1NMIGNlcnRpZmljYXRlLiBObyBzaW11bGF0b3Igd2l0aCB1ZGlkICcke3VkaWR9J2ApO1xuICAgIGxvZy5lcnJvckFuZFRocm93KGUpO1xuICB9XG5cbiAgLy8gRG8gdGhlIGNlcnRpZmljYXRlIGluc3RhbGxhdGlvblxuICBsZXQgY2VydGlmaWNhdGUgPSBuZXcgQ2VydGlmaWNhdGUodGVtcEZpbGVOYW1lKTtcbiAgbG9nLmRlYnVnKGBJbnN0YWxsaW5nIGNlcnRpZmljYXRlIHRvICR7cGF0aFRvS2V5Y2hhaW59YCk7XG4gIGF3YWl0IGNlcnRpZmljYXRlLmFkZChwYXRoVG9LZXljaGFpbik7XG5cbiAgLy8gUmVtb3ZlIHRoZSB0ZW1wb3JhcnkgZmlsZVxuICBhd2FpdCBmcy51bmxpbmsodGVtcEZpbGVOYW1lKTtcblxuICByZXR1cm4gY2VydGlmaWNhdGU7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHVuaW5zdGFsbFNTTENlcnQgKHBlbVRleHQsIHVkaWQpIHtcbiAgdHJ5IHtcbiAgICBsZXQgdGVtcEZpbGVOYW1lID0gcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJ3RlbXAtc3NsLWNlcnQucGVtJyk7XG4gICAgbGV0IHBhdGhUb0tleWNoYWluID0gcGF0aC5yZXNvbHZlKG5ldyBTaW11bGF0b3IodWRpZCkuZ2V0RGlyKCkpO1xuICAgIGF3YWl0IGZzLndyaXRlRmlsZSh0ZW1wRmlsZU5hbWUsIHBlbVRleHQpO1xuICAgIGxldCBjZXJ0aWZpY2F0ZSA9IG5ldyBDZXJ0aWZpY2F0ZSh0ZW1wRmlsZU5hbWUpO1xuICAgIGF3YWl0IGNlcnRpZmljYXRlLnJlbW92ZShwYXRoVG9LZXljaGFpbik7XG4gICAgYXdhaXQgZnMudW5saW5rKHRlbXBGaWxlTmFtZSk7XG4gICAgcmV0dXJuIGNlcnRpZmljYXRlO1xuICB9IGNhdGNoIChlKSB7XG4gICAgbG9nLmRlYnVnKGBDb3VsZCBub3QgdW5pbnN0YWxsIFNTTCBjZXJ0aWZpY2F0ZS4gTm8gc2ltdWxhdG9yIHdpdGggdWRpZCAnJHt1ZGlkfSdgKTtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhlKTtcbiAgfVxufVxuXG4vKipcbiAqIENoZWNrIGlmIHRoZSBTaW11bGF0b3IgYWxyZWFkeSBoYXMgdGhpcyBTU0wgY2VydGlmaWNhdGVcbiAqIEBwYXJhbSB7c3RyaW5nfSBwZW1UZXh0IFBFTSB0ZXh0IG9mIFNTTCBjZXJ0XG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCBJZGVudGlmaWVyIG9mIHRoZSBTaW11bGF0b3JcbiAqL1xuYXN5bmMgZnVuY3Rpb24gaGFzU1NMQ2VydCAocGVtVGV4dCwgdWRpZCkge1xuICBjb25zdCB0ZW1wRmlsZU5hbWUgPSBwYXRoLnJlc29sdmUoYXdhaXQgdGVtcERpci5vcGVuRGlyKCksICd0ZW1wLXNzbC1jZXJ0LnBlbScpO1xuICBjb25zdCBwYXRoVG9LZXljaGFpbiA9IG5ldyBTaW11bGF0b3IodWRpZCkuZ2V0RGlyKCk7XG4gIGF3YWl0IGZzLndyaXRlRmlsZSh0ZW1wRmlsZU5hbWUsIHBlbVRleHQpO1xuICBjb25zdCBjZXJ0aWZpY2F0ZSA9IG5ldyBDZXJ0aWZpY2F0ZSh0ZW1wRmlsZU5hbWUpO1xuICByZXR1cm4gY2VydGlmaWNhdGUuaGFzKHBhdGhUb0tleWNoYWluKTtcbn1cblxuLyoqXG4gKiBSdW5zIGEgY29tbWFuZCBsaW5lIHNxbGl0ZTMgcXVlcnlcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gZGIgLSBGdWxsIHBhdGggdG8gc3FsaXRlIGRhdGFiYXNlXG4gKiBAcGFyYW0ge3N0cmluZ30gcXVlcnkgLSBUaGUgYWN0dWFsIHF1ZXJ5IHN0cmluZ1xuICogQHBhcmFtIHsuLi5zdHJpbmd9IHF1ZXJ5UGFyYW1zIC0gVGhlIGxpc3Qgb2YgcXVlcnkgcGFyYW1ldGVyc1xuICogQHJldHVybnMge3N0cmluZ30gc3FsaXRlIGNvbW1hbmQgc3Rkb3V0XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGV4ZWNTUUxpdGVRdWVyeSAoZGIsIHF1ZXJ5LCAuLi5xdWVyeVBhcmFtcykge1xuICBxdWVyeSA9IHF1ZXJ5LnJlcGxhY2UoL1xcbisvZywgJyAnKTtcbiAgbGV0IHF1ZXJ5VG9rZW5zID0gcXVlcnkuc3BsaXQoJz8nKTtcbiAgbGV0IGZvcm1hdHRlZFF1ZXJ5ID0gW107XG4gIHF1ZXJ5UGFyYW1zXG4gICAgLm1hcCgocGFyYW0pID0+IGAke3BhcmFtfWApXG4gICAgLmZvckVhY2goKHBhcmFtLCBpKSA9PiB7XG4gICAgICBmb3JtYXR0ZWRRdWVyeS5wdXNoKHF1ZXJ5VG9rZW5zW2ldKTtcbiAgICAgIGZvcm1hdHRlZFF1ZXJ5LnB1c2gocGFyYW0ucmVwbGFjZSgvJy9nLCBcIicnXCIpKTtcbiAgICB9KTtcbiAgZm9ybWF0dGVkUXVlcnkucHVzaChxdWVyeVRva2Vuc1txdWVyeVRva2Vucy5sZW5ndGggLSAxXSk7XG5cbiAgbG9nLmRlYnVnKGBFeGVjdXRpbmcgU1FMIHF1ZXJ5IFwiJHtmb3JtYXR0ZWRRdWVyeS5qb2luKCcnKX1cIiBvbiAnJHtkYn0nYCk7XG4gIHRyeSB7XG4gICAgcmV0dXJuIChhd2FpdCBleGVjKCdzcWxpdGUzJywgWyctbGluZScsIGRiLCBmb3JtYXR0ZWRRdWVyeS5qb2luKCcnKV0pKS5zdGRvdXQ7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGV4ZWN1dGUgU1FMaXRlIHF1ZXJ5IFwiJHtmb3JtYXR0ZWRRdWVyeS5qb2luKCcnKX1cIiB0byAnJHtkYn0nLiBgICtcbiAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlcnIuc3RkZXJyfWApO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldERldmVsb3BlclJvb3QgKCkge1xuICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ3hjb2RlLXNlbGVjdCcsIFsnLXAnXSk7XG4gIHJldHVybiBzdGRvdXQudHJpbSgpO1xufVxuXG4vKipcbiAqIEFjdGl2YXRlcyB0aGUgYXBwIGhhdmluZyB0aGUgZ2l2ZW4gcHJvY2VzcyBpZGVudGlmaWVyLlxuICogU2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmFwcGxlLmNvbS9kb2N1bWVudGF0aW9uL2FwcGtpdC9uc3J1bm5pbmdhcHBsaWNhdGlvbi8xNTI4NzI1LWFjdGl2YXRld2l0aG9wdGlvbnM/bGFuZ3VhZ2U9b2JqY1xuICogZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IHBpZCBBcHAgcHJvY2VzcyBpZGVudGlmaWVyXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGdpdmVuIFBJRCBpcyBub3QgcnVubmluZyBvciB0aGVyZSB3YXMgYSBmYWlsdXJlXG4gKiB3aGlsZSBhY3RpdmF0aW5nIHRoZSBhcHBcbiAqL1xuYXN5bmMgZnVuY3Rpb24gYWN0aXZhdGVBcHAgKHBpZCkge1xuICB0cnkge1xuICAgIGF3YWl0IGV4ZWMoJ29zYXNjcmlwdCcsIFsnLWUnLCBBUFBfQUNUSVZBVElPTl9TQ1JJUFQocGlkKV0pO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBTaW11bGF0b3Igd2luZG93IGNhbm5vdCBiZSBhY3RpdmF0ZWQuIE9yaWdpbmFsIGVycm9yOiAke2Uuc3RkZXJyIHx8IGUubWVzc2FnZX1gKTtcbiAgfVxufVxuXG4vKipcbiAqIEV4ZWN1dGVzIGFuIGFwcCBhbmQgdmVyaWZpZXMgaWYgaXQgd2FzIGxhdW5jaGVkIHByb3Blcmx5XG4gKlxuICogQHBhcmFtIHtTaW1jdGx9IHNpbWN0bCBTaW1jdGwgaW5zdGFuY2VcbiAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCBidW5kbGUgaWRlbnRpZmllciBvZiB0aGUgZGVzdGluYXRpb24gYXBwXG4gKiBAcGFyYW0ge251bWJlcn0gdGltZW91dE1zIFsyNTAwMF0gVGhlIG1heGltdW0gdGltZSB0byB3YWl0IHVudGlsXG4gKiB0aGUgYXBwIGlzIHJ1bm5pbmdcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgYXBwIGlzIHN0aWxsIG5vdCBydW5uaW5nIGFmdGVyIHRoZSBnaXZlbiB0aW1lb3V0XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGxhdW5jaEFwcCAoc2ltY3RsLCBidW5kbGVJZCwgdGltZW91dE1zID0gMjUwMDApIHtcbiAgbGV0IGxhc3RFcnJvcjtcbiAgdHJ5IHtcbiAgICBhd2FpdCB3YWl0Rm9yQ29uZGl0aW9uKGFzeW5jICgpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHN0ZG91dCA9IGF3YWl0IHNpbWN0bC5sYXVuY2hBcHAoTU9CSUxFX1NBRkFSSV9CVU5ETEVfSUQsIDEpO1xuICAgICAgICByZXR1cm4gUFJPQ0VTU19MQVVOQ0hfT0tfUEFUVEVSTihNT0JJTEVfU0FGQVJJX0JVTkRMRV9JRCkudGVzdChzdGRvdXQpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGxhc3RFcnJvciA9IGVyci5zdGRlcnIgfHwgZXJyLm1lc3NhZ2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSwge3dhaXRNczogdGltZW91dE1zLCBpbnRlcnZhbE1zOiA1MDB9KTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGxldCBtc2cgPSBgJyR7YnVuZGxlSWR9JyBkaWQgbm90IHJ1biBhZnRlciAke3RpbWVvdXRNc31tcyB0aW1lb3V0LmA7XG4gICAgaWYgKGxhc3RFcnJvcikge1xuICAgICAgbXNnICs9IGAgT3JpZ2luYWwgZXJyb3I6ICR7bGFzdEVycm9yfWA7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihtc2cpO1xuICB9XG59XG5cbmV4cG9ydCB7XG4gIGtpbGxBbGxTaW11bGF0b3JzLFxuICBlbmRBbGxTaW11bGF0b3JEYWVtb25zLFxuICBzYWZlUmltUmFmLFxuICBzaW1FeGlzdHMsXG4gIGdldFNpbXVsYXRvckluZm8sXG4gIGluc3RhbGxTU0xDZXJ0LFxuICB1bmluc3RhbGxTU0xDZXJ0LFxuICBoYXNTU0xDZXJ0LFxuICBleGVjU1FMaXRlUXVlcnksXG4gIHRvQmlvbWV0cmljRG9tYWluQ29tcG9uZW50LFxuICBnZXREZXZlbG9wZXJSb290LFxuICBhY3RpdmF0ZUFwcCxcbiAgU0FGQVJJX1NUQVJUVVBfVElNRU9VVCxcbiAgTU9CSUxFX1NBRkFSSV9CVU5ETEVfSUQsXG4gIGxhdW5jaEFwcCxcbn07XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0EsTUFBTUEsNEJBQTRCLEdBQUcsS0FBSztBQUMxQyxNQUFNQyxzQkFBc0IsR0FBRyxFQUFFLEdBQUcsSUFBSTtBQUFDO0FBQ3pDLE1BQU1DLHVCQUF1QixHQUFHLHdCQUF3QjtBQUFDO0FBQ3pELE1BQU1DLHlCQUF5QixHQUFJQyxRQUFRLElBQUssSUFBSUMsTUFBTSxDQUFFLEdBQUVELFFBQVEsQ0FBQ0UsT0FBTyxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUUsV0FBVSxDQUFDO0FBQ3RHLE1BQU1DLHFCQUFxQixHQUFJQyxHQUFHLElBQU07QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxR0FBcUdBLEdBQUk7QUFDekc7QUFDQSwrQ0FBK0NBLEdBQUk7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtREFBbURBLEdBQUk7QUFDdkQ7QUFDQTtBQUNBLENBQUM7QUFHRCxNQUFNQyxVQUFVLEdBQUc7RUFDakJDLE9BQU8sRUFBRSxhQUFhO0VBQ3RCQyxNQUFNLEVBQUU7QUFDVixDQUFDO0FBRUQsU0FBU0MsMEJBQTBCLENBQUVDLElBQUksRUFBRTtFQUN6QyxJQUFJLENBQUNKLFVBQVUsQ0FBQ0ksSUFBSSxDQUFDLEVBQUU7SUFDckIsTUFBTSxJQUFJQyxLQUFLLENBQUUsSUFBR0QsSUFBSywyQ0FBMENFLElBQUksQ0FBQ0MsU0FBUyxDQUFDQyxlQUFDLENBQUNDLElBQUksQ0FBQ1QsVUFBVSxDQUFDLENBQUUsRUFBQyxDQUFDO0VBQzFHO0VBQ0EsT0FBT0EsVUFBVSxDQUFDSSxJQUFJLENBQUM7QUFDekI7QUFRQSxlQUFlTSxLQUFLLENBQUVDLE9BQU8sRUFBRUMsU0FBUyxHQUFHLEtBQUssRUFBRTtFQUNoRCxJQUFJQyxJQUFJLEdBQUdELFNBQVMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUU7RUFDbENDLElBQUksQ0FBQ0MsSUFBSSxDQUFDLElBQUksRUFBRUgsT0FBTyxDQUFDO0VBQ3hCLElBQUk7SUFDRixNQUFNLElBQUFJLGtCQUFJLEVBQUMsT0FBTyxFQUFFRixJQUFJLENBQUM7SUFDekIsT0FBTyxDQUFDO0VBQ1YsQ0FBQyxDQUFDLE9BQU9HLEdBQUcsRUFBRTtJQUNaLElBQUksQ0FBQ1IsZUFBQyxDQUFDUyxXQUFXLENBQUNELEdBQUcsQ0FBQ0UsSUFBSSxDQUFDLEVBQUU7TUFDNUIsTUFBTSxJQUFJYixLQUFLLENBQUUsK0JBQThCTSxPQUFRLHVCQUFzQkssR0FBRyxDQUFDRSxJQUFLLEVBQUMsQ0FBQztJQUMxRjtJQUNBQyxlQUFHLENBQUNDLEtBQUssQ0FBRSxrREFBaURULE9BQVEsS0FBSUssR0FBRyxDQUFDSyxPQUFRLEVBQUMsQ0FBQztJQUN0RixNQUFNTCxHQUFHO0VBQ1g7QUFDRjtBQUVBLGVBQWVNLGlCQUFpQixDQUFFQyxPQUFPLEdBQUdoQyw0QkFBNEIsRUFBRTtFQUN4RTRCLGVBQUcsQ0FBQ0ssS0FBSyxDQUFDLDRCQUE0QixDQUFDO0VBQ3ZDLE1BQU1DLFlBQVksR0FBRyxNQUFNLElBQUFDLHVCQUFVLEVBQUMsSUFBSSxDQUFDO0VBQzNDLE1BQU1mLE9BQU8sR0FBR2MsWUFBWSxDQUFDRSxLQUFLLElBQUksQ0FBQyxHQUFHLFdBQVcsR0FBRyxlQUFlO0VBR3ZFSixPQUFPLEdBQUdBLE9BQU8sSUFBSUUsWUFBWSxDQUFDRSxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7RUFFckQsSUFBSTtJQUNGLE1BQU0sSUFBQVosa0JBQUksRUFBQyxPQUFPLEVBQUUsQ0FBQyxRQUFRLEVBQUUsVUFBVSxFQUFFVSxZQUFZLENBQUNFLEtBQUssR0FBRyxDQUFDLEdBQUcsS0FBSyxHQUFHLFFBQVEsQ0FBQyxFQUFFO01BQUNKO0lBQU8sQ0FBQyxDQUFDO0VBQ25HLENBQUMsQ0FBQyxPQUFPSyxHQUFHLEVBQUUsQ0FBQztFQUVmLE1BQU1DLElBQUksR0FBRyxFQUFFO0VBQ2YsSUFBSTtJQUNGLE1BQU07TUFBQ0M7SUFBTSxDQUFDLEdBQUcsTUFBTSxJQUFBZixrQkFBSSxFQUFDLE9BQU8sRUFBRSxDQUFDLElBQUksRUFBRyxHQUFFSixPQUFRLHNCQUFxQixDQUFDLENBQUM7SUFDOUUsSUFBSW1CLE1BQU0sQ0FBQ0MsSUFBSSxFQUFFLEVBQUU7TUFDakJGLElBQUksQ0FBQ2YsSUFBSSxDQUFDLEdBQUlnQixNQUFNLENBQUNDLElBQUksRUFBRSxDQUFDQyxLQUFLLENBQUMsS0FBSyxDQUFFLENBQUM7SUFDNUM7RUFDRixDQUFDLENBQUMsT0FBT0MsQ0FBQyxFQUFFO0lBQ1YsSUFBSUEsQ0FBQyxDQUFDZixJQUFJLEtBQUssQ0FBQyxFQUFFO01BQ2hCQyxlQUFHLENBQUNLLEtBQUssQ0FBRSxHQUFFYixPQUFRLGdDQUErQixDQUFDO01BQ3JEO0lBQ0Y7SUFDQSxJQUFJSCxlQUFDLENBQUMwQixPQUFPLENBQUNMLElBQUksQ0FBQyxFQUFFO01BQ25CVixlQUFHLENBQUNnQixJQUFJLENBQUUsZUFBY0YsQ0FBQyxDQUFDZixJQUFLLDRCQUEyQlAsT0FBUSxxQ0FBb0MsQ0FBQztJQUN6RztFQUNGO0VBQ0EsSUFBSSxDQUFDSCxlQUFDLENBQUMwQixPQUFPLENBQUNMLElBQUksQ0FBQyxFQUFFO0lBQ3BCVixlQUFHLENBQUNLLEtBQUssQ0FBRSxzQkFBcUJLLElBQUksQ0FBQ08sSUFBSSxDQUFDLElBQUksQ0FBRSxFQUFDLENBQUM7SUFDbEQsSUFBSTtNQUNGLE1BQU0sSUFBQXJCLGtCQUFJLEVBQUMsTUFBTSxFQUFFLENBQUMsSUFBSSxFQUFFLEdBQUljLElBQUksQ0FBQ1EsR0FBRyxDQUFFdEMsR0FBRyxJQUFNLEdBQUVBLEdBQUksRUFBQyxDQUFFLENBQUMsQ0FBQztJQUM5RCxDQUFDLENBQUMsT0FBTzZCLEdBQUcsRUFBRSxDQUFDO0VBQ2pCO0VBRUFULGVBQUcsQ0FBQ0ssS0FBSyxDQUFFLG9DQUFtQ2IsT0FBUSxFQUFDLENBQUM7RUFDeEQsSUFBSTtJQUNGLE1BQU1ELEtBQUssQ0FBQ0MsT0FBTyxFQUFFLElBQUksQ0FBQztFQUM1QixDQUFDLENBQUMsT0FBT2lCLEdBQUcsRUFBRSxDQUFDO0VBSWYsSUFBSVUsZ0JBQWdCLEdBQUcsRUFBRTtFQUN6QixlQUFlQyxjQUFjLEdBQUk7SUFDL0JELGdCQUFnQixHQUFHLEVBQUU7SUFDckIsSUFBSUUsT0FBTyxHQUFHLE1BQU0sSUFBSUMsbUJBQU0sRUFBRSxDQUFDQyxVQUFVLEVBQUU7SUFDN0NGLE9BQU8sR0FBR2hDLGVBQUMsQ0FBQ21DLE9BQU8sQ0FBQ25DLGVBQUMsQ0FBQ29DLE1BQU0sQ0FBQ0osT0FBTyxDQUFDLENBQUM7SUFDdEMsT0FBT2hDLGVBQUMsQ0FBQ3FDLEtBQUssQ0FBQ0wsT0FBTyxFQUFHTSxHQUFHLElBQUs7TUFDL0IsSUFBSUMsS0FBSyxHQUFHRCxHQUFHLENBQUNDLEtBQUssQ0FBQ0MsV0FBVyxFQUFFO01BQ25DLElBQUlDLElBQUksR0FBR0YsS0FBSyxLQUFLLFVBQVUsSUFDcEJBLEtBQUssS0FBSyxhQUFhLElBQ3ZCQSxLQUFLLEtBQUssY0FBYztNQUNuQyxJQUFJLENBQUNFLElBQUksRUFBRTtRQUNUWCxnQkFBZ0IsQ0FBQ3hCLElBQUksQ0FBRSxHQUFFZ0MsR0FBRyxDQUFDMUMsSUFBSyxLQUFJMEMsR0FBRyxDQUFDSSxHQUFJLFdBQVVKLEdBQUcsQ0FBQ0ssSUFBSyx3QkFBdUJKLEtBQU0sR0FBRSxDQUFDO01BQ25HO01BQ0EsT0FBT0UsSUFBSTtJQUNiLENBQUMsQ0FBQztFQUNKO0VBQ0EsSUFBSTtJQUNGLE1BQU0sSUFBQUcsMEJBQWdCLEVBQUNiLGNBQWMsRUFBRTtNQUNyQ2MsTUFBTSxFQUFFOUIsT0FBTztNQUNmK0IsVUFBVSxFQUFFO0lBQ2QsQ0FBQyxDQUFDO0VBQ0osQ0FBQyxDQUFDLE9BQU90QyxHQUFHLEVBQUU7SUFDWixJQUFJc0IsZ0JBQWdCLENBQUNpQixNQUFNLEdBQUcsQ0FBQyxFQUFFO01BQy9CcEMsZUFBRyxDQUFDZ0IsSUFBSSxDQUFFLGtFQUFpRVosT0FBUSxNQUFLLENBQUM7TUFDekYsS0FBSyxJQUFJaUMsTUFBTSxJQUFJbEIsZ0JBQWdCLEVBQUU7UUFDbkNuQixlQUFHLENBQUNnQixJQUFJLENBQUUsT0FBTXFCLE1BQU8sRUFBQyxDQUFDO01BQzNCO0lBQ0Y7SUFDQSxNQUFNeEMsR0FBRztFQUNYO0FBQ0Y7QUFFQSxlQUFleUMsc0JBQXNCLEdBQUk7RUFDdkN0QyxlQUFHLENBQUNLLEtBQUssQ0FBQyw4QkFBOEIsQ0FBQztFQUN6QyxLQUFLLElBQUlrQyxjQUFjLElBQUksQ0FBQywyQkFBMkIsRUFBRSx5QkFBeUIsQ0FBQyxFQUFFO0lBQ25GdkMsZUFBRyxDQUFDSyxLQUFLLENBQUUscUJBQW9Ca0MsY0FBZSxVQUFTLENBQUM7SUFDeEQsSUFBSUMsZ0JBQWdCLEdBQUkseUJBQXdCRCxjQUFlLG9DQUFtQztJQUNsRyxJQUFJO01BQ0YsSUFBSUUsT0FBTyxHQUFJLEdBQUVELGdCQUFpQixPQUFNO01BQ3hDLE1BQU0sSUFBQTVDLGtCQUFJLEVBQUMsTUFBTSxFQUFFLENBQUMsSUFBSSxFQUFFNkMsT0FBTyxDQUFDLENBQUM7SUFDckMsQ0FBQyxDQUFDLE9BQU81QyxHQUFHLEVBQUU7TUFDWkcsZUFBRyxDQUFDZ0IsSUFBSSxDQUFFLGtCQUFpQnVCLGNBQWUsK0JBQThCLENBQUM7SUFDM0U7SUFDQSxJQUFJO01BQ0YsSUFBSUcsU0FBUyxHQUFJLEdBQUVGLGdCQUFpQixTQUFRO01BQzVDLE1BQU0sSUFBQTVDLGtCQUFJLEVBQUMsTUFBTSxFQUFFLENBQUMsSUFBSSxFQUFFOEMsU0FBUyxDQUFDLENBQUM7SUFDdkMsQ0FBQyxDQUFDLE9BQU83QyxHQUFHLEVBQUU7TUFDWkcsZUFBRyxDQUFDZ0IsSUFBSSxDQUFFLG9CQUFtQnVCLGNBQWUsK0JBQThCLENBQUM7SUFDN0U7RUFDRjtFQUVBLElBQUk7SUFDRixNQUFNLElBQUFOLDBCQUFnQixFQUFDLFlBQVk7TUFDakMsSUFBSTtRQUFDdEI7TUFBTSxDQUFDLEdBQUcsTUFBTSxJQUFBZixrQkFBSSxFQUFDLE1BQU0sRUFBRSxDQUFDLElBQUksRUFDcEMsMkVBQTBFLENBQUMsQ0FBQztNQUMvRSxPQUFPZSxNQUFNLENBQUNDLElBQUksRUFBRSxDQUFDd0IsTUFBTSxLQUFLLENBQUM7SUFDbkMsQ0FBQyxFQUFFO01BQUNGLE1BQU0sRUFBRSxJQUFJO01BQUVDLFVBQVUsRUFBRTtJQUFHLENBQUMsQ0FBQztFQUNyQyxDQUFDLENBQUMsT0FBT3RDLEdBQUcsRUFBRTtJQUNaRyxlQUFHLENBQUNnQixJQUFJLENBQUUsbURBQWtELENBQUM7RUFDL0Q7RUFDQWhCLGVBQUcsQ0FBQ0ssS0FBSyxDQUFDLHdDQUF3QyxDQUFDO0FBQ3JEO0FBRUEsZUFBZXNDLGdCQUFnQixDQUFFWCxJQUFJLEVBQUVZLElBQUksR0FBRyxDQUFDLENBQUMsRUFBRTtFQUNoRCxNQUFNO0lBQ0pDO0VBQ0YsQ0FBQyxHQUFHRCxJQUFJO0VBRVIsSUFBSXZCLE9BQU8sR0FBRyxNQUFNLElBQUlDLG1CQUFNLENBQUM7SUFDN0J1QjtFQUNGLENBQUMsQ0FBQyxDQUFDdEIsVUFBVSxFQUFFO0VBRWZGLE9BQU8sR0FBR2hDLGVBQUMsQ0FBQ3lELE9BQU8sQ0FBQ3pCLE9BQU8sQ0FBQyxDQUN6QkgsR0FBRyxDQUFFNkIsSUFBSSxJQUFLQSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FDdEJDLE1BQU0sQ0FBQyxDQUFDQyxDQUFDLEVBQUVDLENBQUMsS0FBS0QsQ0FBQyxDQUFDRSxNQUFNLENBQUNELENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQztFQUNwQyxPQUFPN0QsZUFBQyxDQUFDK0QsSUFBSSxDQUFDL0IsT0FBTyxFQUFHTSxHQUFHLElBQUtBLEdBQUcsQ0FBQ0ssSUFBSSxLQUFLQSxJQUFJLENBQUM7QUFDcEQ7QUFFQSxlQUFlcUIsU0FBUyxDQUFFckIsSUFBSSxFQUFFO0VBQzlCLE9BQU8sQ0FBQyxFQUFFLE1BQU1XLGdCQUFnQixDQUFDWCxJQUFJLENBQUMsQ0FBQztBQUN6QztBQUVBLGVBQWVzQixVQUFVLENBQUVDLE9BQU8sRUFBRUMsTUFBTSxHQUFHLENBQUMsRUFBRTtFQUM5QyxJQUFJO0lBQ0YsTUFBTUMsV0FBRSxDQUFDQyxNQUFNLENBQUNILE9BQU8sQ0FBQztFQUMxQixDQUFDLENBQUMsT0FBTzFELEdBQUcsRUFBRTtJQUNaLElBQUkyRCxNQUFNLEdBQUcsRUFBRSxFQUFFO01BQ2YsSUFBSTNELEdBQUcsQ0FBQ0ssT0FBTyxDQUFDeUQsT0FBTyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFO1FBQzNDM0QsZUFBRyxDQUFDSyxLQUFLLENBQUUsU0FBUWtELE9BQVEseUNBQXdDLENBQUM7UUFDcEUsT0FBTyxNQUFNRCxVQUFVLENBQUNDLE9BQU8sRUFBRUMsTUFBTSxHQUFHLENBQUMsQ0FBQztNQUM5QyxDQUFDLE1BQU0sSUFBSTNELEdBQUcsQ0FBQ0ssT0FBTyxDQUFDeUQsT0FBTyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFO1FBQy9DM0QsZUFBRyxDQUFDSyxLQUFLLENBQUUsU0FBUWtELE9BQVEsbURBQWtELENBQUM7UUFDOUUsT0FBTyxNQUFNRCxVQUFVLENBQUNDLE9BQU8sRUFBRUMsTUFBTSxHQUFHLENBQUMsQ0FBQztNQUM5QztJQUNGO0VBQ0Y7QUFDRjtBQU9BLGVBQWVJLGNBQWMsQ0FBRUMsT0FBTyxFQUFFN0IsSUFBSSxFQUFFO0VBRTVDLElBQUk7SUFDRixNQUFNeUIsV0FBRSxDQUFDSyxLQUFLLENBQUMsU0FBUyxDQUFDO0VBQzNCLENBQUMsQ0FBQyxPQUFPaEQsQ0FBQyxFQUFFO0lBQ1ZkLGVBQUcsQ0FBQ0ssS0FBSyxDQUFFLHdEQUF1RCxDQUFDO0lBQ25FTCxlQUFHLENBQUMrRCxhQUFhLENBQUUsNkJBQTRCLENBQUM7RUFDbEQ7RUFHQSxJQUFJO0lBQ0YsTUFBTU4sV0FBRSxDQUFDSyxLQUFLLENBQUMsU0FBUyxDQUFDO0VBQzNCLENBQUMsQ0FBQyxPQUFPaEQsQ0FBQyxFQUFFO0lBQ1ZkLGVBQUcsQ0FBQ0ssS0FBSyxDQUFFLHdEQUF1RCxDQUFDO0lBQ25FTCxlQUFHLENBQUMrRCxhQUFhLENBQUUsNkJBQTRCLENBQUM7RUFDbEQ7RUFJQSxJQUFJQyxZQUFZLEdBQUdDLGFBQUksQ0FBQ0MsT0FBTyxDQUFDLE1BQU1DLGdCQUFPLENBQUNDLE9BQU8sRUFBRSxFQUFFLG1CQUFtQixDQUFDO0VBQzdFLElBQUlDLGNBQWMsR0FBRyxJQUFJQyx1QkFBUyxDQUFDdEMsSUFBSSxDQUFDLENBQUN1QyxNQUFNLEVBQUU7RUFDakQsTUFBTWQsV0FBRSxDQUFDZSxTQUFTLENBQUNSLFlBQVksRUFBRUgsT0FBTyxDQUFDO0VBQ3pDLElBQUk7SUFDRixNQUFNSixXQUFFLENBQUNnQixJQUFJLENBQUNKLGNBQWMsQ0FBQztFQUMvQixDQUFDLENBQUMsT0FBT3ZELENBQUMsRUFBRTtJQUNWZCxlQUFHLENBQUNLLEtBQUssQ0FBRSw4REFBNkQyQixJQUFLLEdBQUUsQ0FBQztJQUNoRmhDLGVBQUcsQ0FBQytELGFBQWEsQ0FBQ2pELENBQUMsQ0FBQztFQUN0QjtFQUdBLElBQUk0RCxXQUFXLEdBQUcsSUFBSUMsd0JBQVcsQ0FBQ1gsWUFBWSxDQUFDO0VBQy9DaEUsZUFBRyxDQUFDSyxLQUFLLENBQUUsNkJBQTRCZ0UsY0FBZSxFQUFDLENBQUM7RUFDeEQsTUFBTUssV0FBVyxDQUFDRSxHQUFHLENBQUNQLGNBQWMsQ0FBQztFQUdyQyxNQUFNWixXQUFFLENBQUNvQixNQUFNLENBQUNiLFlBQVksQ0FBQztFQUU3QixPQUFPVSxXQUFXO0FBQ3BCO0FBRUEsZUFBZUksZ0JBQWdCLENBQUVqQixPQUFPLEVBQUU3QixJQUFJLEVBQUU7RUFDOUMsSUFBSTtJQUNGLElBQUlnQyxZQUFZLEdBQUdDLGFBQUksQ0FBQ0MsT0FBTyxDQUFDYSxTQUFTLEVBQUUsbUJBQW1CLENBQUM7SUFDL0QsSUFBSVYsY0FBYyxHQUFHSixhQUFJLENBQUNDLE9BQU8sQ0FBQyxJQUFJSSx1QkFBUyxDQUFDdEMsSUFBSSxDQUFDLENBQUN1QyxNQUFNLEVBQUUsQ0FBQztJQUMvRCxNQUFNZCxXQUFFLENBQUNlLFNBQVMsQ0FBQ1IsWUFBWSxFQUFFSCxPQUFPLENBQUM7SUFDekMsSUFBSWEsV0FBVyxHQUFHLElBQUlDLHdCQUFXLENBQUNYLFlBQVksQ0FBQztJQUMvQyxNQUFNVSxXQUFXLENBQUNNLE1BQU0sQ0FBQ1gsY0FBYyxDQUFDO0lBQ3hDLE1BQU1aLFdBQUUsQ0FBQ29CLE1BQU0sQ0FBQ2IsWUFBWSxDQUFDO0lBQzdCLE9BQU9VLFdBQVc7RUFDcEIsQ0FBQyxDQUFDLE9BQU81RCxDQUFDLEVBQUU7SUFDVmQsZUFBRyxDQUFDSyxLQUFLLENBQUUsZ0VBQStEMkIsSUFBSyxHQUFFLENBQUM7SUFDbEZoQyxlQUFHLENBQUMrRCxhQUFhLENBQUNqRCxDQUFDLENBQUM7RUFDdEI7QUFDRjtBQU9BLGVBQWVtRSxVQUFVLENBQUVwQixPQUFPLEVBQUU3QixJQUFJLEVBQUU7RUFDeEMsTUFBTWdDLFlBQVksR0FBR0MsYUFBSSxDQUFDQyxPQUFPLENBQUMsTUFBTUMsZ0JBQU8sQ0FBQ0MsT0FBTyxFQUFFLEVBQUUsbUJBQW1CLENBQUM7RUFDL0UsTUFBTUMsY0FBYyxHQUFHLElBQUlDLHVCQUFTLENBQUN0QyxJQUFJLENBQUMsQ0FBQ3VDLE1BQU0sRUFBRTtFQUNuRCxNQUFNZCxXQUFFLENBQUNlLFNBQVMsQ0FBQ1IsWUFBWSxFQUFFSCxPQUFPLENBQUM7RUFDekMsTUFBTWEsV0FBVyxHQUFHLElBQUlDLHdCQUFXLENBQUNYLFlBQVksQ0FBQztFQUNqRCxPQUFPVSxXQUFXLENBQUNRLEdBQUcsQ0FBQ2IsY0FBYyxDQUFDO0FBQ3hDO0FBVUEsZUFBZWMsZUFBZSxDQUFFQyxFQUFFLEVBQUVDLEtBQUssRUFBRSxHQUFHQyxXQUFXLEVBQUU7RUFDekRELEtBQUssR0FBR0EsS0FBSyxDQUFDM0csT0FBTyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUM7RUFDbEMsSUFBSTZHLFdBQVcsR0FBR0YsS0FBSyxDQUFDeEUsS0FBSyxDQUFDLEdBQUcsQ0FBQztFQUNsQyxJQUFJMkUsY0FBYyxHQUFHLEVBQUU7RUFDdkJGLFdBQVcsQ0FDUnBFLEdBQUcsQ0FBRXVFLEtBQUssSUFBTSxHQUFFQSxLQUFNLEVBQUMsQ0FBQyxDQUMxQkMsT0FBTyxDQUFDLENBQUNELEtBQUssRUFBRUUsQ0FBQyxLQUFLO0lBQ3JCSCxjQUFjLENBQUM3RixJQUFJLENBQUM0RixXQUFXLENBQUNJLENBQUMsQ0FBQyxDQUFDO0lBQ25DSCxjQUFjLENBQUM3RixJQUFJLENBQUM4RixLQUFLLENBQUMvRyxPQUFPLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO0VBQ2hELENBQUMsQ0FBQztFQUNKOEcsY0FBYyxDQUFDN0YsSUFBSSxDQUFDNEYsV0FBVyxDQUFDQSxXQUFXLENBQUNuRCxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7RUFFeERwQyxlQUFHLENBQUNLLEtBQUssQ0FBRSx3QkFBdUJtRixjQUFjLENBQUN2RSxJQUFJLENBQUMsRUFBRSxDQUFFLFNBQVFtRSxFQUFHLEdBQUUsQ0FBQztFQUN4RSxJQUFJO0lBQ0YsT0FBTyxDQUFDLE1BQU0sSUFBQXhGLGtCQUFJLEVBQUMsU0FBUyxFQUFFLENBQUMsT0FBTyxFQUFFd0YsRUFBRSxFQUFFSSxjQUFjLENBQUN2RSxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFTixNQUFNO0VBQy9FLENBQUMsQ0FBQyxPQUFPZCxHQUFHLEVBQUU7SUFDWixNQUFNLElBQUlYLEtBQUssQ0FBRSxnQ0FBK0JzRyxjQUFjLENBQUN2RSxJQUFJLENBQUMsRUFBRSxDQUFFLFNBQVFtRSxFQUFHLEtBQUksR0FDcEYsbUJBQWtCdkYsR0FBRyxDQUFDK0YsTUFBTyxFQUFDLENBQUM7RUFDcEM7QUFDRjtBQUVBLGVBQWVDLGdCQUFnQixHQUFJO0VBQ2pDLE1BQU07SUFBQ2xGO0VBQU0sQ0FBQyxHQUFHLE1BQU0sSUFBQWYsa0JBQUksRUFBQyxjQUFjLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztFQUNuRCxPQUFPZSxNQUFNLENBQUNDLElBQUksRUFBRTtBQUN0QjtBQVdBLGVBQWVrRixXQUFXLENBQUVsSCxHQUFHLEVBQUU7RUFDL0IsSUFBSTtJQUNGLE1BQU0sSUFBQWdCLGtCQUFJLEVBQUMsV0FBVyxFQUFFLENBQUMsSUFBSSxFQUFFakIscUJBQXFCLENBQUNDLEdBQUcsQ0FBQyxDQUFDLENBQUM7RUFDN0QsQ0FBQyxDQUFDLE9BQU9rQyxDQUFDLEVBQUU7SUFDVixNQUFNLElBQUk1QixLQUFLLENBQUUseURBQXdENEIsQ0FBQyxDQUFDOEUsTUFBTSxJQUFJOUUsQ0FBQyxDQUFDWixPQUFRLEVBQUMsQ0FBQztFQUNuRztBQUNGO0FBV0EsZUFBZTZGLFNBQVMsQ0FBRUMsTUFBTSxFQUFFeEgsUUFBUSxFQUFFeUgsU0FBUyxHQUFHLEtBQUssRUFBRTtFQUM3RCxJQUFJQyxTQUFTO0VBQ2IsSUFBSTtJQUNGLE1BQU0sSUFBQWpFLDBCQUFnQixFQUFDLFlBQVk7TUFDakMsSUFBSTtRQUNGLE1BQU10QixNQUFNLEdBQUcsTUFBTXFGLE1BQU0sQ0FBQ0QsU0FBUyxDQUFDekgsdUJBQXVCLEVBQUUsQ0FBQyxDQUFDO1FBQ2pFLE9BQU9DLHlCQUF5QixDQUFDRCx1QkFBdUIsQ0FBQyxDQUFDNkgsSUFBSSxDQUFDeEYsTUFBTSxDQUFDO01BQ3hFLENBQUMsQ0FBQyxPQUFPZCxHQUFHLEVBQUU7UUFDWnFHLFNBQVMsR0FBR3JHLEdBQUcsQ0FBQytGLE1BQU0sSUFBSS9GLEdBQUcsQ0FBQ0ssT0FBTztNQUN2QztNQUNBLE9BQU8sS0FBSztJQUNkLENBQUMsRUFBRTtNQUFDZ0MsTUFBTSxFQUFFK0QsU0FBUztNQUFFOUQsVUFBVSxFQUFFO0lBQUcsQ0FBQyxDQUFDO0VBQzFDLENBQUMsQ0FBQyxPQUFPckIsQ0FBQyxFQUFFO0lBQ1YsSUFBSXNGLEdBQUcsR0FBSSxJQUFHNUgsUUFBUyx1QkFBc0J5SCxTQUFVLGFBQVk7SUFDbkUsSUFBSUMsU0FBUyxFQUFFO01BQ2JFLEdBQUcsSUFBSyxvQkFBbUJGLFNBQVUsRUFBQztJQUN4QztJQUNBLE1BQU0sSUFBSWhILEtBQUssQ0FBQ2tILEdBQUcsQ0FBQztFQUN0QjtBQUNGIn0=