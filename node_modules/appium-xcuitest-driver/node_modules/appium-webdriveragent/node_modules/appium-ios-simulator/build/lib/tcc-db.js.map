{"version":3,"file":"tcc-db.js","names":["TCCDB","constructor","xcodeVersion","sharedResourcesDir","getDB","db","tccPath","path","resolve","fs","exists","mkdirp","execSQLiteQuery","execQuery","query","params"],"sources":["../../lib/tcc-db.js"],"sourcesContent":["import path from 'path';\nimport { fs, mkdirp } from '@appium/support';\nimport { execSQLiteQuery } from './utils';\n\nclass TCCDB {\n  constructor (xcodeVersion, sharedResourcesDir) {\n    this.xcodeVersion = xcodeVersion;\n    this.sharedResourcesDir = sharedResourcesDir;\n  }\n\n  async getDB () {\n    if (this.db) {\n      return this.db;\n    }\n\n    const tccPath = path.resolve(this.sharedResourcesDir, 'Library', 'TCC');\n    if (!(await fs.exists(tccPath))) {\n      await mkdirp(tccPath);\n    }\n\n    this.db = path.resolve(tccPath, 'TCC.db');\n    await execSQLiteQuery(this.db, `CREATE TABLE IF NOT EXISTS access (\n      service TEXT NOT NULL DEFAULT '',\n      client TEXT NOT NULL DEFAULT '',\n      client_type INTEGER,\n      allowed INTEGER,\n      prompt_count INTEGER,\n      csreq BLOB NOT NULL DEFAULT '',\n      policy_ID INTEGER,\n      PRIMARY KEY(service, client, client_type)\n    );`);\n\n    return this.db;\n  }\n\n  async execQuery (query, ...params) {\n    return await execSQLiteQuery(await this.getDB(), query, ...params);\n  }\n}\n\nexport default TCCDB;\n"],"mappings":";;;;;;;;AAAA;AACA;AACA;AAEA,MAAMA,KAAK,CAAC;EACVC,WAAW,CAAEC,YAAY,EAAEC,kBAAkB,EAAE;IAC7C,IAAI,CAACD,YAAY,GAAGA,YAAY;IAChC,IAAI,CAACC,kBAAkB,GAAGA,kBAAkB;EAC9C;EAEA,MAAMC,KAAK,GAAI;IACb,IAAI,IAAI,CAACC,EAAE,EAAE;MACX,OAAO,IAAI,CAACA,EAAE;IAChB;IAEA,MAAMC,OAAO,GAAGC,aAAI,CAACC,OAAO,CAAC,IAAI,CAACL,kBAAkB,EAAE,SAAS,EAAE,KAAK,CAAC;IACvE,IAAI,EAAE,MAAMM,WAAE,CAACC,MAAM,CAACJ,OAAO,CAAC,CAAC,EAAE;MAC/B,MAAM,IAAAK,eAAM,EAACL,OAAO,CAAC;IACvB;IAEA,IAAI,CAACD,EAAE,GAAGE,aAAI,CAACC,OAAO,CAACF,OAAO,EAAE,QAAQ,CAAC;IACzC,MAAM,IAAAM,sBAAe,EAAC,IAAI,CAACP,EAAE,EAAG;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,CAAC;IAEJ,OAAO,IAAI,CAACA,EAAE;EAChB;EAEA,MAAMQ,SAAS,CAAEC,KAAK,EAAE,GAAGC,MAAM,EAAE;IACjC,OAAO,MAAM,IAAAH,sBAAe,EAAC,MAAM,IAAI,CAACR,KAAK,EAAE,EAAEU,KAAK,EAAE,GAAGC,MAAM,CAAC;EACpE;AACF;AAAC,eAEcf,KAAK;AAAA"}