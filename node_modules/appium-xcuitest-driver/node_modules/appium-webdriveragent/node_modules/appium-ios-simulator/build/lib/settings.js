"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.PLIST_IDENTIFIER = void 0;
exports.read = read;
exports.readSettings = readSettings;
exports.setReduceMotion = setReduceMotion;
exports.setReduceTransparency = setReduceTransparency;
exports.update = update;
exports.updateLocale = updateLocale;
exports.updateLocationSettings = updateLocationSettings;
exports.updateSafariGlobalSettings = updateSafariGlobalSettings;
exports.updateSafariUserSettings = updateSafariUserSettings;
exports.updateSettings = updateSettings;
require("source-map-support/register");
var _lodash = _interopRequireDefault(require("lodash"));
var _support = require("@appium/support");
var _path = _interopRequireDefault(require("path"));
var _logger = _interopRequireDefault(require("./logger"));
var _semver = _interopRequireDefault(require("semver"));
var _bluebird = _interopRequireDefault(require("bluebird"));
const PLIST_IDENTIFIER = Object.freeze({
  WEB_INSPECTOR: 'webInspector',
  MOBILE_SAFARI: 'mobileSafari',
  GLOBAL_MOBILE_SAFARI: 'globalMobileSafari',
  WEB_UI: 'webUI',
  WEB_FOUNDATION: 'webFoundation',
  PREFERENCES: 'preferences',
  GLOBAL_PREFERENCES: 'globalPreferences',
  LOCATION_SERVICES: 'locationServices',
  LOCATION_CLIENTS: 'locationClients',
  LOCATION_CACHE: 'locationCache',
  USER_SETTINGS: 'userSettings',
  EFFECTIVE_USER_SETTINGS: 'effectiveUserSettings',
  ACCESSIBLITY_SETTINGS: 'accessibilitySettings',
  UI_STYLE_SETTINGS: 'uiStyleSettings'
});
exports.PLIST_IDENTIFIER = PLIST_IDENTIFIER;
async function plistPaths(sim, identifier) {
  const simDirectory = sim.getDir();
  switch (identifier) {
    case PLIST_IDENTIFIER.WEB_INSPECTOR:
      return [_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.webInspector.plist')];
    case PLIST_IDENTIFIER.MOBILE_SAFARI:
      return [_path.default.resolve(await sim.getAppDir('com.apple.mobilesafari'), 'Library', 'Preferences', 'com.apple.mobilesafari.plist')];
    case PLIST_IDENTIFIER.GLOBAL_MOBILE_SAFARI:
      return [_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.mobilesafari.plist')];
    case PLIST_IDENTIFIER.WEB_UI:
      return [_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.WebUI.plist')];
    case PLIST_IDENTIFIER.WEB_FOUNDATION:
      return [_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.WebFoundation.plist')];
    case PLIST_IDENTIFIER.PREFERENCES:
      return [_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.Preferences.plist')];
    case PLIST_IDENTIFIER.GLOBAL_PREFERENCES:
      return [_path.default.resolve(simDirectory, 'Library', 'Preferences', '.GlobalPreferences.plist')];
    case PLIST_IDENTIFIER.LOCATION_SERVICES:
      return [_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.locationd.plist')];
    case PLIST_IDENTIFIER.LOCATION_CLIENTS:
      return [_path.default.resolve(simDirectory, 'Library', 'Caches', 'locationd', 'clients.plist')];
    case PLIST_IDENTIFIER.LOCATION_CACHE:
      return [['Caches', 'locationd', 'cache.plist'], ['Preferences', 'com.apple.locationd.plist']].map(x => _path.default.resolve(simDirectory, 'Library', ...x));
    case PLIST_IDENTIFIER.USER_SETTINGS:
      {
        const profilesDirName = _semver.default.lt(_semver.default.coerce(sim.xcodeVersion.versionString), _semver.default.coerce('7.3')) ? 'ConfigurationProfiles' : 'UserConfigurationProfiles';
        return [['UserSettings.plist'], ['EffectiveUserSettings.plist'], ['PublicInfo', 'PublicEffectiveUserSettings.plist']].map(x => _path.default.resolve(simDirectory, 'Library', profilesDirName, ...x));
      }
    case PLIST_IDENTIFIER.EFFECTIVE_USER_SETTINGS:
      return [['EffectiveUserSettings.plist'], ['PublicInfo', 'PublicEffectiveUserSettings.plist']].map(x => _path.default.resolve(simDirectory, 'Library', 'ConfigurationProfiles', ...x));
    case PLIST_IDENTIFIER.ACCESSIBLITY_SETTINGS:
      return [_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.Accessibility.plist')];
    case PLIST_IDENTIFIER.UI_STYLE_SETTINGS:
      return [_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.uikitservices.userInterfaceStyleMode.plist')];
    default:
      return [];
  }
}
async function updateSettings(sim, plist, updates) {
  const paths = await plistPaths(sim, plist);
  if (_lodash.default.isEmpty(paths)) {
    return false;
  }
  const results = await _bluebird.default.all(paths.map(p => update(p, updates)));
  return _lodash.default.some(results, Boolean);
}
async function update(pathToPlist, updates) {
  const currentSettings = await read(pathToPlist);
  const newSettings = Object.assign({}, currentSettings, updates);
  if (_lodash.default.isEqual(currentSettings, newSettings)) {
    return false;
  }
  await _support.plist.updatePlistFile(pathToPlist, newSettings, true, false);
  return true;
}
async function readSettings(sim, plist) {
  const paths = await plistPaths(sim, plist);
  if (_lodash.default.isEmpty(paths)) {
    return {};
  }
  const settings = await _bluebird.default.all(paths.map(read));
  return _lodash.default.fromPairs(_lodash.default.zip(paths, settings));
}
async function read(pathToPlist) {
  return await _support.plist.parsePlistFile(pathToPlist, false);
}
async function updateLocationSettings(sim, bundleId, authorized) {
  const newCachePrefs = {
    LastFenceActivityTimestamp: 412122103.232983,
    CleanShutdown: true
  };
  const updated = await updateSettings(sim, PLIST_IDENTIFIER.LOCATION_CACHE, {
    [bundleId]: newCachePrefs
  });
  const newClientPrefs = {
    BundleId: bundleId,
    Authorized: !!authorized,
    Whitelisted: false
  };
  const paths = await plistPaths(sim, PLIST_IDENTIFIER.LOCATION_CLIENTS);
  if (_lodash.default.isEmpty(paths)) {
    return false;
  }
  const contents = await _bluebird.default.all(paths.map(read));
  const promises = [];
  for (const [file, content] of _lodash.default.zip(paths, contents)) {
    _logger.default.debug(`Updating location client file: ${file}`);
    const updates = {};
    const weirdLocKey = 'com.apple.locationd.bundle-/System/Library/' + 'PrivateFrameworks/AOSNotification.framework';
    if (!_lodash.default.has(content, weirdLocKey)) {
      updates[weirdLocKey] = {
        BundlePath: '/System/Library/PrivateFrameworks/AOSNotification.framework',
        Whitelisted: false,
        Executable: '',
        Registered: ''
      };
    }
    const baseSetting = _lodash.default.has(content, bundleId) ? content[bundleId] : {};
    updates[bundleId] = _lodash.default.defaults(newClientPrefs, baseSetting);
    updates[bundleId].Executable = updates[bundleId].Executable || '';
    updates[bundleId].Registered = updates[bundleId].Registered || '';
    promises.push(update(file, updates));
  }
  return (_lodash.default.isEmpty(promises) ? false : _lodash.default.some(await _bluebird.default.all(promises), Boolean)) || updated;
}
async function setReduceMotion(sim, reduceMotion = true) {
  _logger.default.debug(`Updating reduce motion. Setting to ${reduceMotion}.`);
  await updateSettings(sim, PLIST_IDENTIFIER.ACCESSIBLITY_SETTINGS, {
    ReduceMotionEnabled: reduceMotion ? 1 : 0
  });
}
async function setReduceTransparency(sim, reduceTransparency) {
  _logger.default.debug(`Updating reduce tranceparency. Setting to ${reduceTransparency}.`);
  await updateSettings(sim, PLIST_IDENTIFIER.ACCESSIBLITY_SETTINGS, {
    EnhancedBackgroundContrastEnabled: reduceTransparency ? 1 : 0
  });
}
async function updateSafariGlobalSettings(sim, settingSet) {
  _logger.default.debug('Updating Safari global settings');
  const promises = [];
  for (const [file, safariSettingSet] of _lodash.default.toPairs(await readSettings(sim, PLIST_IDENTIFIER.GLOBAL_MOBILE_SAFARI))) {
    const newSettings = {};
    for (const [key, value] of _lodash.default.toPairs(settingSet)) {
      if (safariSettingSet[key] !== value) {
        newSettings[key] = value;
      }
    }
    if (_lodash.default.isEmpty(newSettings)) {
      continue;
    }
    promises.push(update(file, newSettings));
  }
  return _lodash.default.isEmpty(promises) ? false : _lodash.default.some(await _bluebird.default.all(promises), Boolean);
}
async function updateSafariUserSettings(sim, settingSet) {
  _logger.default.debug('Updating Safari user settings');
  const newUserSettings = {};
  if (_lodash.default.has(settingSet, 'WebKitJavaScriptEnabled')) {
    newUserSettings.safariAllowJavaScript = settingSet.WebKitJavaScriptEnabled;
  }
  if (_lodash.default.has(settingSet, 'WebKitJavaScriptCanOpenWindowsAutomatically')) {
    newUserSettings.safariAllowPopups = settingSet.WebKitJavaScriptCanOpenWindowsAutomatically;
  }
  if (_lodash.default.has(settingSet, 'WarnAboutFraudulentWebsites')) {
    newUserSettings.safariForceFraudWarning = !settingSet.WarnAboutFraudulentWebsites;
  }
  if (_lodash.default.isEmpty(newUserSettings)) {
    return false;
  }
  const promises = [];
  for (const [file, userSettingSet] of _lodash.default.toPairs(await readSettings(sim, PLIST_IDENTIFIER.USER_SETTINGS))) {
    if (!_lodash.default.has(userSettingSet, 'restrictedBool')) {
      userSettingSet.restrictedBool = {};
    }
    for (const [key, value] of _lodash.default.toPairs(newUserSettings)) {
      userSettingSet.restrictedBool[key] = {
        value
      };
    }
    promises.push(update(file, userSettingSet));
  }
  return _lodash.default.isEmpty(promises) ? false : _lodash.default.some(await _bluebird.default.all(promises), Boolean);
}
async function updateLocale(sim, language, locale, calendarFormat) {
  const globalPrefs = (await plistPaths(sim, PLIST_IDENTIFIER.GLOBAL_PREFERENCES))[0];
  if (!globalPrefs) {
    throw new Error('Global preferences folder path cannot be retrieved');
  }
  let data = await read(globalPrefs);
  let updates = {};
  if (language) {
    _logger.default.debug(`New language: ${language}`);
    let supportedLangs = data.AppleLanguages || [];
    if (supportedLangs.indexOf(language) !== 0) {
      updates.AppleLanguages = [language].concat(_lodash.default.without(supportedLangs, language));
    }
  }
  if (locale || calendarFormat) {
    let calSplit = '@calendar=';
    let curLocaleAndCal = data.AppleLocale || language || 'en';
    let split = curLocaleAndCal.split(calSplit);
    let curLoc = split[0];
    if (calendarFormat || split[1]) {
      calendarFormat = `${calSplit}${calendarFormat || split[1] || ''}`;
    }
    calendarFormat = calendarFormat || '';
    let newLocaleAndCal = locale ? locale : curLoc;
    if (calendarFormat) {
      newLocaleAndCal = `${newLocaleAndCal}${calendarFormat}`;
    }
    if (newLocaleAndCal !== curLocaleAndCal) {
      _logger.default.debug(`New locale: ${newLocaleAndCal}`);
      updates.AppleLocale = newLocaleAndCal;
    }
  }
  if (_lodash.default.size(updates) === 0) {
    _logger.default.debug('No locale updates necessary.');
    return false;
  }
  _logger.default.debug('Writing new locale plist data');
  await update(globalPrefs, updates);
  return true;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQTElTVF9JREVOVElGSUVSIiwiT2JqZWN0IiwiZnJlZXplIiwiV0VCX0lOU1BFQ1RPUiIsIk1PQklMRV9TQUZBUkkiLCJHTE9CQUxfTU9CSUxFX1NBRkFSSSIsIldFQl9VSSIsIldFQl9GT1VOREFUSU9OIiwiUFJFRkVSRU5DRVMiLCJHTE9CQUxfUFJFRkVSRU5DRVMiLCJMT0NBVElPTl9TRVJWSUNFUyIsIkxPQ0FUSU9OX0NMSUVOVFMiLCJMT0NBVElPTl9DQUNIRSIsIlVTRVJfU0VUVElOR1MiLCJFRkZFQ1RJVkVfVVNFUl9TRVRUSU5HUyIsIkFDQ0VTU0lCTElUWV9TRVRUSU5HUyIsIlVJX1NUWUxFX1NFVFRJTkdTIiwicGxpc3RQYXRocyIsInNpbSIsImlkZW50aWZpZXIiLCJzaW1EaXJlY3RvcnkiLCJnZXREaXIiLCJwYXRoIiwicmVzb2x2ZSIsImdldEFwcERpciIsIm1hcCIsIngiLCJwcm9maWxlc0Rpck5hbWUiLCJzZW12ZXIiLCJsdCIsImNvZXJjZSIsInhjb2RlVmVyc2lvbiIsInZlcnNpb25TdHJpbmciLCJ1cGRhdGVTZXR0aW5ncyIsInBsaXN0IiwidXBkYXRlcyIsInBhdGhzIiwiXyIsImlzRW1wdHkiLCJyZXN1bHRzIiwiQiIsImFsbCIsInAiLCJ1cGRhdGUiLCJzb21lIiwiQm9vbGVhbiIsInBhdGhUb1BsaXN0IiwiY3VycmVudFNldHRpbmdzIiwicmVhZCIsIm5ld1NldHRpbmdzIiwiYXNzaWduIiwiaXNFcXVhbCIsInVwZGF0ZVBsaXN0RmlsZSIsInJlYWRTZXR0aW5ncyIsInNldHRpbmdzIiwiZnJvbVBhaXJzIiwiemlwIiwicGFyc2VQbGlzdEZpbGUiLCJ1cGRhdGVMb2NhdGlvblNldHRpbmdzIiwiYnVuZGxlSWQiLCJhdXRob3JpemVkIiwibmV3Q2FjaGVQcmVmcyIsIkxhc3RGZW5jZUFjdGl2aXR5VGltZXN0YW1wIiwiQ2xlYW5TaHV0ZG93biIsInVwZGF0ZWQiLCJuZXdDbGllbnRQcmVmcyIsIkJ1bmRsZUlkIiwiQXV0aG9yaXplZCIsIldoaXRlbGlzdGVkIiwiY29udGVudHMiLCJwcm9taXNlcyIsImZpbGUiLCJjb250ZW50IiwibG9nIiwiZGVidWciLCJ3ZWlyZExvY0tleSIsImhhcyIsIkJ1bmRsZVBhdGgiLCJFeGVjdXRhYmxlIiwiUmVnaXN0ZXJlZCIsImJhc2VTZXR0aW5nIiwiZGVmYXVsdHMiLCJwdXNoIiwic2V0UmVkdWNlTW90aW9uIiwicmVkdWNlTW90aW9uIiwiUmVkdWNlTW90aW9uRW5hYmxlZCIsInNldFJlZHVjZVRyYW5zcGFyZW5jeSIsInJlZHVjZVRyYW5zcGFyZW5jeSIsIkVuaGFuY2VkQmFja2dyb3VuZENvbnRyYXN0RW5hYmxlZCIsInVwZGF0ZVNhZmFyaUdsb2JhbFNldHRpbmdzIiwic2V0dGluZ1NldCIsInNhZmFyaVNldHRpbmdTZXQiLCJ0b1BhaXJzIiwia2V5IiwidmFsdWUiLCJ1cGRhdGVTYWZhcmlVc2VyU2V0dGluZ3MiLCJuZXdVc2VyU2V0dGluZ3MiLCJzYWZhcmlBbGxvd0phdmFTY3JpcHQiLCJXZWJLaXRKYXZhU2NyaXB0RW5hYmxlZCIsInNhZmFyaUFsbG93UG9wdXBzIiwiV2ViS2l0SmF2YVNjcmlwdENhbk9wZW5XaW5kb3dzQXV0b21hdGljYWxseSIsInNhZmFyaUZvcmNlRnJhdWRXYXJuaW5nIiwiV2FybkFib3V0RnJhdWR1bGVudFdlYnNpdGVzIiwidXNlclNldHRpbmdTZXQiLCJyZXN0cmljdGVkQm9vbCIsInVwZGF0ZUxvY2FsZSIsImxhbmd1YWdlIiwibG9jYWxlIiwiY2FsZW5kYXJGb3JtYXQiLCJnbG9iYWxQcmVmcyIsIkVycm9yIiwiZGF0YSIsInN1cHBvcnRlZExhbmdzIiwiQXBwbGVMYW5ndWFnZXMiLCJpbmRleE9mIiwiY29uY2F0Iiwid2l0aG91dCIsImNhbFNwbGl0IiwiY3VyTG9jYWxlQW5kQ2FsIiwiQXBwbGVMb2NhbGUiLCJzcGxpdCIsImN1ckxvYyIsIm5ld0xvY2FsZUFuZENhbCIsInNpemUiXSwic291cmNlcyI6WyIuLi8uLi9saWIvc2V0dGluZ3MuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IHBsaXN0IH0gZnJvbSAnQGFwcGl1bS9zdXBwb3J0JztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgc2VtdmVyIGZyb20gJ3NlbXZlcic7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5cbmNvbnN0IFBMSVNUX0lERU5USUZJRVIgPSBPYmplY3QuZnJlZXplKHtcbiAgV0VCX0lOU1BFQ1RPUjogJ3dlYkluc3BlY3RvcicsXG4gIE1PQklMRV9TQUZBUkk6ICdtb2JpbGVTYWZhcmknLFxuICBHTE9CQUxfTU9CSUxFX1NBRkFSSTogJ2dsb2JhbE1vYmlsZVNhZmFyaScsXG4gIFdFQl9VSTogJ3dlYlVJJyxcbiAgV0VCX0ZPVU5EQVRJT046ICd3ZWJGb3VuZGF0aW9uJyxcbiAgUFJFRkVSRU5DRVM6ICdwcmVmZXJlbmNlcycsXG4gIEdMT0JBTF9QUkVGRVJFTkNFUzogJ2dsb2JhbFByZWZlcmVuY2VzJyxcbiAgTE9DQVRJT05fU0VSVklDRVM6ICdsb2NhdGlvblNlcnZpY2VzJyxcbiAgTE9DQVRJT05fQ0xJRU5UUzogJ2xvY2F0aW9uQ2xpZW50cycsXG4gIExPQ0FUSU9OX0NBQ0hFOiAnbG9jYXRpb25DYWNoZScsXG4gIFVTRVJfU0VUVElOR1M6ICd1c2VyU2V0dGluZ3MnLFxuICBFRkZFQ1RJVkVfVVNFUl9TRVRUSU5HUzogJ2VmZmVjdGl2ZVVzZXJTZXR0aW5ncycsXG4gIEFDQ0VTU0lCTElUWV9TRVRUSU5HUzogJ2FjY2Vzc2liaWxpdHlTZXR0aW5ncycsXG4gIFVJX1NUWUxFX1NFVFRJTkdTOiAndWlTdHlsZVNldHRpbmdzJyxcbn0pO1xuXG4vKipcbiAqIFJldHJpZXZlcyB0aGUgbGlzdCBvZiBtYXRjaGluZyBkaXJlY3RvcnkgcGF0aHMgZm9yIHRoZSBnaXZlbiBpZGVudGlmaWVyXG4gKlxuICogQHBhcmFtIHtvYmplY3R9IHNpbSBTaW11bGF0b3IgaW5zdGFuY2VcbiAqIEBwYXJhbSB7c3RyaW5nfSBpZGVudGlmaWVyIE9uZSBvZiBzdXBwb3J0ZWQgcGF0aCBpZGVudGlmaWVyc1xuICogQHJldHVybnMge3N0cmluZ1tdfSBUaGUgbGlzdCBvZiBtYXRjaGVkIHBhdGhzXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHBsaXN0UGF0aHMgKHNpbSwgaWRlbnRpZmllcikge1xuICBjb25zdCBzaW1EaXJlY3RvcnkgPSBzaW0uZ2V0RGlyKCk7XG5cbiAgc3dpdGNoIChpZGVudGlmaWVyKSB7XG4gICAgY2FzZSBQTElTVF9JREVOVElGSUVSLldFQl9JTlNQRUNUT1I6XG4gICAgICByZXR1cm4gW3BhdGgucmVzb2x2ZShzaW1EaXJlY3RvcnksICdMaWJyYXJ5JywgJ1ByZWZlcmVuY2VzJywgJ2NvbS5hcHBsZS53ZWJJbnNwZWN0b3IucGxpc3QnKV07XG4gICAgY2FzZSBQTElTVF9JREVOVElGSUVSLk1PQklMRV9TQUZBUkk6XG4gICAgICByZXR1cm4gW1xuICAgICAgICBwYXRoLnJlc29sdmUoYXdhaXQgc2ltLmdldEFwcERpcignY29tLmFwcGxlLm1vYmlsZXNhZmFyaScpLCAnTGlicmFyeScsICdQcmVmZXJlbmNlcycsICdjb20uYXBwbGUubW9iaWxlc2FmYXJpLnBsaXN0JylcbiAgICAgIF07XG4gICAgY2FzZSBQTElTVF9JREVOVElGSUVSLkdMT0JBTF9NT0JJTEVfU0FGQVJJOlxuICAgICAgcmV0dXJuIFtwYXRoLnJlc29sdmUoc2ltRGlyZWN0b3J5LCAnTGlicmFyeScsICdQcmVmZXJlbmNlcycsICdjb20uYXBwbGUubW9iaWxlc2FmYXJpLnBsaXN0JyldO1xuICAgIGNhc2UgUExJU1RfSURFTlRJRklFUi5XRUJfVUk6XG4gICAgICByZXR1cm4gW3BhdGgucmVzb2x2ZShzaW1EaXJlY3RvcnksICdMaWJyYXJ5JywgJ1ByZWZlcmVuY2VzJywgJ2NvbS5hcHBsZS5XZWJVSS5wbGlzdCcpXTtcbiAgICBjYXNlIFBMSVNUX0lERU5USUZJRVIuV0VCX0ZPVU5EQVRJT046XG4gICAgICByZXR1cm4gW3BhdGgucmVzb2x2ZShzaW1EaXJlY3RvcnksICdMaWJyYXJ5JywgJ1ByZWZlcmVuY2VzJywgJ2NvbS5hcHBsZS5XZWJGb3VuZGF0aW9uLnBsaXN0JyldO1xuICAgIGNhc2UgUExJU1RfSURFTlRJRklFUi5QUkVGRVJFTkNFUzpcbiAgICAgIHJldHVybiBbcGF0aC5yZXNvbHZlKHNpbURpcmVjdG9yeSwgJ0xpYnJhcnknLCAnUHJlZmVyZW5jZXMnLCAnY29tLmFwcGxlLlByZWZlcmVuY2VzLnBsaXN0JyldO1xuICAgIGNhc2UgUExJU1RfSURFTlRJRklFUi5HTE9CQUxfUFJFRkVSRU5DRVM6XG4gICAgICByZXR1cm4gW3BhdGgucmVzb2x2ZShzaW1EaXJlY3RvcnksICdMaWJyYXJ5JywgJ1ByZWZlcmVuY2VzJywgJy5HbG9iYWxQcmVmZXJlbmNlcy5wbGlzdCcpXTtcbiAgICBjYXNlIFBMSVNUX0lERU5USUZJRVIuTE9DQVRJT05fU0VSVklDRVM6XG4gICAgICByZXR1cm4gW3BhdGgucmVzb2x2ZShzaW1EaXJlY3RvcnksICdMaWJyYXJ5JywgJ1ByZWZlcmVuY2VzJywgJ2NvbS5hcHBsZS5sb2NhdGlvbmQucGxpc3QnKV07XG4gICAgY2FzZSBQTElTVF9JREVOVElGSUVSLkxPQ0FUSU9OX0NMSUVOVFM6XG4gICAgICByZXR1cm4gW3BhdGgucmVzb2x2ZShzaW1EaXJlY3RvcnksICdMaWJyYXJ5JywgJ0NhY2hlcycsICdsb2NhdGlvbmQnLCAnY2xpZW50cy5wbGlzdCcpXTtcbiAgICBjYXNlIFBMSVNUX0lERU5USUZJRVIuTE9DQVRJT05fQ0FDSEU6XG4gICAgICByZXR1cm4gW1xuICAgICAgICBbJ0NhY2hlcycsICdsb2NhdGlvbmQnLCAnY2FjaGUucGxpc3QnXSxcbiAgICAgICAgWydQcmVmZXJlbmNlcycsICdjb20uYXBwbGUubG9jYXRpb25kLnBsaXN0J11cbiAgICAgIF0ubWFwKCh4KSA9PiBwYXRoLnJlc29sdmUoc2ltRGlyZWN0b3J5LCAnTGlicmFyeScsIC4uLngpKTtcbiAgICBjYXNlIFBMSVNUX0lERU5USUZJRVIuVVNFUl9TRVRUSU5HUzoge1xuICAgICAgY29uc3QgcHJvZmlsZXNEaXJOYW1lID0gc2VtdmVyLmx0KHNlbXZlci5jb2VyY2Uoc2ltLnhjb2RlVmVyc2lvbi52ZXJzaW9uU3RyaW5nKSwgc2VtdmVyLmNvZXJjZSgnNy4zJykpXG4gICAgICAgID8gJ0NvbmZpZ3VyYXRpb25Qcm9maWxlcydcbiAgICAgICAgOiAnVXNlckNvbmZpZ3VyYXRpb25Qcm9maWxlcyc7XG4gICAgICByZXR1cm4gW1xuICAgICAgICBbJ1VzZXJTZXR0aW5ncy5wbGlzdCddLFxuICAgICAgICBbJ0VmZmVjdGl2ZVVzZXJTZXR0aW5ncy5wbGlzdCddLFxuICAgICAgICBbJ1B1YmxpY0luZm8nLCAnUHVibGljRWZmZWN0aXZlVXNlclNldHRpbmdzLnBsaXN0J10sXG4gICAgICBdLm1hcCgoeCkgPT4gcGF0aC5yZXNvbHZlKHNpbURpcmVjdG9yeSwgJ0xpYnJhcnknLCBwcm9maWxlc0Rpck5hbWUsIC4uLngpKTtcbiAgICB9XG4gICAgY2FzZSBQTElTVF9JREVOVElGSUVSLkVGRkVDVElWRV9VU0VSX1NFVFRJTkdTOlxuICAgICAgcmV0dXJuIFtcbiAgICAgICAgWydFZmZlY3RpdmVVc2VyU2V0dGluZ3MucGxpc3QnXSxcbiAgICAgICAgWydQdWJsaWNJbmZvJywgJ1B1YmxpY0VmZmVjdGl2ZVVzZXJTZXR0aW5ncy5wbGlzdCddXG4gICAgICBdLm1hcCgoeCkgPT4gcGF0aC5yZXNvbHZlKHNpbURpcmVjdG9yeSwgJ0xpYnJhcnknLCAnQ29uZmlndXJhdGlvblByb2ZpbGVzJywgLi4ueCkpO1xuICAgIGNhc2UgUExJU1RfSURFTlRJRklFUi5BQ0NFU1NJQkxJVFlfU0VUVElOR1M6XG4gICAgICByZXR1cm4gW3BhdGgucmVzb2x2ZShzaW1EaXJlY3RvcnksICdMaWJyYXJ5JywgJ1ByZWZlcmVuY2VzJywgJ2NvbS5hcHBsZS5BY2Nlc3NpYmlsaXR5LnBsaXN0JyldO1xuICAgIGNhc2UgUExJU1RfSURFTlRJRklFUi5VSV9TVFlMRV9TRVRUSU5HUzpcbiAgICAgIHJldHVybiBbcGF0aC5yZXNvbHZlKHNpbURpcmVjdG9yeSwgJ0xpYnJhcnknLCAnUHJlZmVyZW5jZXMnLCAnY29tLmFwcGxlLnVpa2l0c2VydmljZXMudXNlckludGVyZmFjZVN0eWxlTW9kZS5wbGlzdCcpXTtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIFtdO1xuICB9XG59XG5cbi8qKlxuICogVXBkYXRlcyBwbGlzdCBmaWxlcyB3aXRoIHRoZSBnaXZlbiBQTElTVF9JREVOVElGSUVSXG4gKlxuICogQHBhcmFtIHtvYmplY3R9IHNpbSBTaW11bGF0b3IgaW5zdGFuY2VcbiAqIEBwYXJhbSB7c3RyaW5nfSBwbGlzdCBPbmUgb2YgUExJU1RfSURFTlRJRklFUiBjb25zdGFudHNcbiAqIEBwYXJhbSB7b2JqZWN0fSB1cGRhdGVzIFBsaXN0IHVwZGF0ZXMgdG8gYXBwbHlcbiAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIGF0IGxlYXN0IG9uZSAucGxpc3QgZmlsZSBoYXMgYmVlbiBjaGFuZ2VkXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVNldHRpbmdzIChzaW0sIHBsaXN0LCB1cGRhdGVzKSB7XG4gIGNvbnN0IHBhdGhzID0gYXdhaXQgcGxpc3RQYXRocyhzaW0sIHBsaXN0KTtcbiAgaWYgKF8uaXNFbXB0eShwYXRocykpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IEIuYWxsKHBhdGhzLm1hcCgocCkgPT4gdXBkYXRlKHAsIHVwZGF0ZXMpKSk7XG4gIHJldHVybiBfLnNvbWUocmVzdWx0cywgQm9vbGVhbik7XG59XG5cbi8qKlxuICogVXBkYXRlIGEgcGxpc3QgZmlsZSwgbG9jYXRlZCBhdCBwYXRoVG9QbGlzdFxuICogcGFzcyBpbiBhbiBvYmplY3QsIGFsbCBzZXR0aW5ncyBzcGVjaWZpZWQgaW4gdGhlIG9iamVjdCB3aWxsIGJlXG4gKiB1cGRhdGVkIG9uIHRoZSBwbGlzdCwgYWxsIG90aGVycyBsZWZ0IGFzLWlzXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBhdGhUb1BsaXN0IFRoZSBmdWxsIHBhdGggdG8gLnBsaXN0IGZpbGVcbiAqIEBwYXJhbSB7b2JqZWN0fSB1cGRhdGVzIEFjdHVhbCB1cGRhdGVzIG9iamVjdCB0byBhcHBseVxuICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdXBkYXRlcyB3ZXJlIGFwcGxpZWQgYW5kIGNoYW5nZWQgdGhlIGFjdHVhbCBwbGlzdFxuICovXG5hc3luYyBmdW5jdGlvbiB1cGRhdGUgKHBhdGhUb1BsaXN0LCB1cGRhdGVzKSB7XG4gIGNvbnN0IGN1cnJlbnRTZXR0aW5ncyA9IGF3YWl0IHJlYWQocGF0aFRvUGxpc3QpO1xuICBjb25zdCBuZXdTZXR0aW5ncyA9IE9iamVjdC5hc3NpZ24oe30sIGN1cnJlbnRTZXR0aW5ncywgdXBkYXRlcyk7XG5cbiAgaWYgKF8uaXNFcXVhbChjdXJyZW50U2V0dGluZ3MsIG5ld1NldHRpbmdzKSkge1xuICAgIC8vIG5vIHNldHRpbmcgY2hhbmdlcywgc28gZG8gbm90aGluZ1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGF3YWl0IHBsaXN0LnVwZGF0ZVBsaXN0RmlsZShwYXRoVG9QbGlzdCwgbmV3U2V0dGluZ3MsIHRydWUsIGZhbHNlKTtcbiAgcmV0dXJuIHRydWU7XG59XG5cbi8qKlxuICogUmV0cmlldmVzIGRhdGEgZnJvbSB0aGUgZ2l2ZW4gLnBsaXN0IGZpbGVzXG4gKlxuICogQHBhcmFtIHtvYmplY3R9IHNpbSBTaW11bGF0b3IgaW5zdGFuY2VcbiAqIEBwYXJhbSB7c3RyaW5nfSBwbGlzdCBPbmUgb2YgUExJU1RfSURFTlRJRklFUiBjb25zdGFudHNcbiAqIEByZXR1cm5zIHtvYmplY3R9IE1hcHBpbmcgd2hlcmUga2V5cyBhcmUgZmlsZSBwYXRocyBhbmQgdmFsdWVzIGFyZSB0aGVpciBjb250ZW50c1xuICovXG5hc3luYyBmdW5jdGlvbiByZWFkU2V0dGluZ3MgKHNpbSwgcGxpc3QpIHtcbiAgY29uc3QgcGF0aHMgPSBhd2FpdCBwbGlzdFBhdGhzKHNpbSwgcGxpc3QpO1xuICBpZiAoXy5pc0VtcHR5KHBhdGhzKSkge1xuICAgIHJldHVybiB7fTtcbiAgfVxuICBjb25zdCBzZXR0aW5ncyA9IGF3YWl0IEIuYWxsKHBhdGhzLm1hcChyZWFkKSk7XG4gIHJldHVybiBfLmZyb21QYWlycyhfLnppcChwYXRocywgc2V0dGluZ3MpKTtcbn1cblxuLyoqXG4gKiBSZXRyaWV2ZXMgZGF0YSBmcm9tIHRoZSBnaXZlbiAucGxpc3QgZmlsZVxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoVG9QbGlzdCBGdWxsIHBhdGggdG8gYSAuc3BsaXN0IGZpbGVcbiAqIEByZXR1cm5zIHsqfSBQbGlzdCBjb250ZW50XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHJlYWQgKHBhdGhUb1BsaXN0KSB7XG4gIHJldHVybiBhd2FpdCBwbGlzdC5wYXJzZVBsaXN0RmlsZShwYXRoVG9QbGlzdCwgZmFsc2UpO1xufVxuXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVMb2NhdGlvblNldHRpbmdzIChzaW0sIGJ1bmRsZUlkLCBhdXRob3JpemVkKSB7XG4gIC8vIHVwZGF0ZSBsb2NhdGlvbiBjYWNoZVxuICBjb25zdCBuZXdDYWNoZVByZWZzID0ge1xuICAgIExhc3RGZW5jZUFjdGl2aXR5VGltZXN0YW1wOiA0MTIxMjIxMDMuMjMyOTgzLFxuICAgIENsZWFuU2h1dGRvd246IHRydWVcbiAgfTtcbiAgY29uc3QgdXBkYXRlZCA9IGF3YWl0IHVwZGF0ZVNldHRpbmdzKHNpbSwgUExJU1RfSURFTlRJRklFUi5MT0NBVElPTl9DQUNIRSwge1xuICAgIFtidW5kbGVJZF06IG5ld0NhY2hlUHJlZnNcbiAgfSk7XG5cbiAgLy8gdXBkYXRlIGxvY2F0aW9uIGNsaWVudHNcbiAgY29uc3QgbmV3Q2xpZW50UHJlZnMgPSB7XG4gICAgQnVuZGxlSWQ6IGJ1bmRsZUlkLFxuICAgIEF1dGhvcml6ZWQ6ICEhYXV0aG9yaXplZCxcbiAgICBXaGl0ZWxpc3RlZDogZmFsc2UsXG4gIH07XG5cbiAgY29uc3QgcGF0aHMgPSBhd2FpdCBwbGlzdFBhdGhzKHNpbSwgUExJU1RfSURFTlRJRklFUi5MT0NBVElPTl9DTElFTlRTKTtcbiAgaWYgKF8uaXNFbXB0eShwYXRocykpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgY29uc3QgY29udGVudHMgPSBhd2FpdCBCLmFsbChwYXRocy5tYXAocmVhZCkpO1xuICBjb25zdCBwcm9taXNlcyA9IFtdO1xuICBmb3IgKGNvbnN0IFtmaWxlLCBjb250ZW50XSBvZiBfLnppcChwYXRocywgY29udGVudHMpKSB7XG4gICAgbG9nLmRlYnVnKGBVcGRhdGluZyBsb2NhdGlvbiBjbGllbnQgZmlsZTogJHtmaWxlfWApO1xuXG4gICAgY29uc3QgdXBkYXRlcyA9IHt9O1xuICAgIC8vIHJhbmRvbSBkYXRhIHRoYXQgYWx3YXlzIHNlZW1zIHRvIGJlIGluIHRoZSBjbGllbnRzLnBsaXN0XG4gICAgY29uc3Qgd2VpcmRMb2NLZXkgPSAnY29tLmFwcGxlLmxvY2F0aW9uZC5idW5kbGUtL1N5c3RlbS9MaWJyYXJ5LycgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJ1ByaXZhdGVGcmFtZXdvcmtzL0FPU05vdGlmaWNhdGlvbi5mcmFtZXdvcmsnO1xuICAgIGlmICghXy5oYXMoY29udGVudCwgd2VpcmRMb2NLZXkpKSB7XG4gICAgICB1cGRhdGVzW3dlaXJkTG9jS2V5XSA9IHtcbiAgICAgICAgQnVuZGxlUGF0aDogJy9TeXN0ZW0vTGlicmFyeS9Qcml2YXRlRnJhbWV3b3Jrcy9BT1NOb3RpZmljYXRpb24uZnJhbWV3b3JrJyxcbiAgICAgICAgV2hpdGVsaXN0ZWQ6IGZhbHNlLFxuICAgICAgICBFeGVjdXRhYmxlOiAnJyxcbiAgICAgICAgUmVnaXN0ZXJlZDogJydcbiAgICAgIH07XG4gICAgfVxuICAgIC8vIGNyZWF0ZSB0aGUgdXBkYXRlLCBhbmQgbWFrZSBzdXJlIGl0IGhhcyBzZW5zaWJsZSB2YWx1ZXNcbiAgICBjb25zdCBiYXNlU2V0dGluZyA9IF8uaGFzKGNvbnRlbnQsIGJ1bmRsZUlkKSA/IGNvbnRlbnRbYnVuZGxlSWRdIDoge307XG4gICAgdXBkYXRlc1tidW5kbGVJZF0gPSBfLmRlZmF1bHRzKG5ld0NsaWVudFByZWZzLCBiYXNlU2V0dGluZyk7XG4gICAgdXBkYXRlc1tidW5kbGVJZF0uRXhlY3V0YWJsZSA9IHVwZGF0ZXNbYnVuZGxlSWRdLkV4ZWN1dGFibGUgfHwgJyc7XG4gICAgdXBkYXRlc1tidW5kbGVJZF0uUmVnaXN0ZXJlZCA9IHVwZGF0ZXNbYnVuZGxlSWRdLlJlZ2lzdGVyZWQgfHwgJyc7XG5cbiAgICBwcm9taXNlcy5wdXNoKHVwZGF0ZShmaWxlLCB1cGRhdGVzKSk7XG4gIH1cbiAgcmV0dXJuIChfLmlzRW1wdHkocHJvbWlzZXMpID8gZmFsc2UgOiBfLnNvbWUoYXdhaXQgQi5hbGwocHJvbWlzZXMpLCBCb29sZWFuKSkgfHwgdXBkYXRlZDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2V0UmVkdWNlTW90aW9uIChzaW0sIHJlZHVjZU1vdGlvbiA9IHRydWUpIHtcbiAgbG9nLmRlYnVnKGBVcGRhdGluZyByZWR1Y2UgbW90aW9uLiBTZXR0aW5nIHRvICR7cmVkdWNlTW90aW9ufS5gKTtcbiAgYXdhaXQgdXBkYXRlU2V0dGluZ3Moc2ltLCBQTElTVF9JREVOVElGSUVSLkFDQ0VTU0lCTElUWV9TRVRUSU5HUywge1xuICAgIFJlZHVjZU1vdGlvbkVuYWJsZWQ6IHJlZHVjZU1vdGlvbiA/IDEgOiAwXG4gIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzZXRSZWR1Y2VUcmFuc3BhcmVuY3kgKHNpbSwgcmVkdWNlVHJhbnNwYXJlbmN5KSB7XG4gIGxvZy5kZWJ1ZyhgVXBkYXRpbmcgcmVkdWNlIHRyYW5jZXBhcmVuY3kuIFNldHRpbmcgdG8gJHtyZWR1Y2VUcmFuc3BhcmVuY3l9LmApO1xuICBhd2FpdCB1cGRhdGVTZXR0aW5ncyhzaW0sIFBMSVNUX0lERU5USUZJRVIuQUNDRVNTSUJMSVRZX1NFVFRJTkdTLCB7XG4gICAgRW5oYW5jZWRCYWNrZ3JvdW5kQ29udHJhc3RFbmFibGVkOiByZWR1Y2VUcmFuc3BhcmVuY3kgPyAxIDogMFxuICB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlU2FmYXJpR2xvYmFsU2V0dGluZ3MgKHNpbSwgc2V0dGluZ1NldCkge1xuICBsb2cuZGVidWcoJ1VwZGF0aW5nIFNhZmFyaSBnbG9iYWwgc2V0dGluZ3MnKTtcblxuICBjb25zdCBwcm9taXNlcyA9IFtdO1xuICBmb3IgKGNvbnN0IFtmaWxlLCBzYWZhcmlTZXR0aW5nU2V0XSBvZiBfLnRvUGFpcnMoYXdhaXQgcmVhZFNldHRpbmdzKHNpbSwgUExJU1RfSURFTlRJRklFUi5HTE9CQUxfTU9CSUxFX1NBRkFSSSkpKSB7XG4gICAgY29uc3QgbmV3U2V0dGluZ3MgPSB7fTtcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBfLnRvUGFpcnMoc2V0dGluZ1NldCkpIHtcbiAgICAgIGlmIChzYWZhcmlTZXR0aW5nU2V0W2tleV0gIT09IHZhbHVlKSB7XG4gICAgICAgIG5ld1NldHRpbmdzW2tleV0gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKF8uaXNFbXB0eShuZXdTZXR0aW5ncykpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBwcm9taXNlcy5wdXNoKHVwZGF0ZShmaWxlLCBuZXdTZXR0aW5ncykpO1xuICB9XG4gIHJldHVybiBfLmlzRW1wdHkocHJvbWlzZXMpID8gZmFsc2UgOiBfLnNvbWUoYXdhaXQgQi5hbGwocHJvbWlzZXMpLCBCb29sZWFuKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlU2FmYXJpVXNlclNldHRpbmdzIChzaW0sIHNldHRpbmdTZXQpIHtcbiAgbG9nLmRlYnVnKCdVcGRhdGluZyBTYWZhcmkgdXNlciBzZXR0aW5ncycpO1xuXG4gIC8vIGFkZCBleHRyYSBzdHVmZiB0byBVc2VyU2V0dGluZ3MucGxpc3QgYW5kIEVmZmVjdGl2ZVVzZXJTZXR0aW5ncy5wbGlzdFxuICBjb25zdCBuZXdVc2VyU2V0dGluZ3MgPSB7fTtcbiAgaWYgKF8uaGFzKHNldHRpbmdTZXQsICdXZWJLaXRKYXZhU2NyaXB0RW5hYmxlZCcpKSB7XG4gICAgbmV3VXNlclNldHRpbmdzLnNhZmFyaUFsbG93SmF2YVNjcmlwdCA9IHNldHRpbmdTZXQuV2ViS2l0SmF2YVNjcmlwdEVuYWJsZWQ7XG4gIH1cbiAgaWYgKF8uaGFzKHNldHRpbmdTZXQsICdXZWJLaXRKYXZhU2NyaXB0Q2FuT3BlbldpbmRvd3NBdXRvbWF0aWNhbGx5JykpIHtcbiAgICBuZXdVc2VyU2V0dGluZ3Muc2FmYXJpQWxsb3dQb3B1cHMgPSBzZXR0aW5nU2V0LldlYktpdEphdmFTY3JpcHRDYW5PcGVuV2luZG93c0F1dG9tYXRpY2FsbHk7XG4gIH1cbiAgaWYgKF8uaGFzKHNldHRpbmdTZXQsICdXYXJuQWJvdXRGcmF1ZHVsZW50V2Vic2l0ZXMnKSkge1xuICAgIG5ld1VzZXJTZXR0aW5ncy5zYWZhcmlGb3JjZUZyYXVkV2FybmluZyA9ICFzZXR0aW5nU2V0Lldhcm5BYm91dEZyYXVkdWxlbnRXZWJzaXRlcztcbiAgfVxuICBpZiAoXy5pc0VtcHR5KG5ld1VzZXJTZXR0aW5ncykpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBjb25zdCBwcm9taXNlcyA9IFtdO1xuICBmb3IgKGNvbnN0IFtmaWxlLCB1c2VyU2V0dGluZ1NldF0gb2YgXy50b1BhaXJzKGF3YWl0IHJlYWRTZXR0aW5ncyhzaW0sIFBMSVNUX0lERU5USUZJRVIuVVNFUl9TRVRUSU5HUykpKSB7XG4gICAgLy8gdGhlIHVzZXIgc2V0dGluZ3MgcGxpc3QgaGFzIHR3byBidWNrZXRzLCBvbmUgZm9yXG4gICAgLy8gYm9vbGVhbiBzZXR0aW5ncyAoYHJlc3RyaWN0ZWRCb29sYCkgYW5kIG9uZSBmb3JcbiAgICAvLyBvdGhlciB2YWx1ZSBzZXR0aW5ncyAoYHJlc3RyaWN0ZWRWYWx1ZWApLiBJbiBlYWNoLCB0aGUgdmFsdWVcbiAgICAvLyBpcyBpbiBhIGB2YWx1ZWAgc3ViLWZpZWxkLlxuICAgIGlmICghXy5oYXModXNlclNldHRpbmdTZXQsICdyZXN0cmljdGVkQm9vbCcpKSB7XG4gICAgICB1c2VyU2V0dGluZ1NldC5yZXN0cmljdGVkQm9vbCA9IHt9O1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBfLnRvUGFpcnMobmV3VXNlclNldHRpbmdzKSkge1xuICAgICAgdXNlclNldHRpbmdTZXQucmVzdHJpY3RlZEJvb2xba2V5XSA9IHt2YWx1ZX07XG4gICAgfVxuXG4gICAgcHJvbWlzZXMucHVzaCh1cGRhdGUoZmlsZSwgdXNlclNldHRpbmdTZXQpKTtcbiAgfVxuICByZXR1cm4gXy5pc0VtcHR5KHByb21pc2VzKSA/IGZhbHNlIDogXy5zb21lKGF3YWl0IEIuYWxsKHByb21pc2VzKSwgQm9vbGVhbik7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUxvY2FsZSAoc2ltLCBsYW5ndWFnZSwgbG9jYWxlLCBjYWxlbmRhckZvcm1hdCkge1xuICBjb25zdCBnbG9iYWxQcmVmcyA9IChhd2FpdCBwbGlzdFBhdGhzKHNpbSwgUExJU1RfSURFTlRJRklFUi5HTE9CQUxfUFJFRkVSRU5DRVMpKVswXTtcbiAgaWYgKCFnbG9iYWxQcmVmcykge1xuICAgIHRocm93IG5ldyBFcnJvcignR2xvYmFsIHByZWZlcmVuY2VzIGZvbGRlciBwYXRoIGNhbm5vdCBiZSByZXRyaWV2ZWQnKTtcbiAgfVxuXG4gIC8vIGdldCB0aGUgY3VycmVudCBkYXRhXG4gIGxldCBkYXRhID0gYXdhaXQgcmVhZChnbG9iYWxQcmVmcyk7XG4gIGxldCB1cGRhdGVzID0ge307XG5cbiAgLy8gaWYgd2UgYXJlIHNldHRpbmcgdGhlIGxhbmd1YWdlLCBhZGQgaXQgdG8gdGhlIGJlZ2lubmluZyBvZiB0aGUgbGlzdCBvZiBsYW5ndWFnZXNcbiAgaWYgKGxhbmd1YWdlKSB7XG4gICAgbG9nLmRlYnVnKGBOZXcgbGFuZ3VhZ2U6ICR7bGFuZ3VhZ2V9YCk7XG4gICAgbGV0IHN1cHBvcnRlZExhbmdzID0gZGF0YS5BcHBsZUxhbmd1YWdlcyB8fCBbXTtcbiAgICAvLyBpZiB0aGUgbGFuZ3VhZ2UgaXMgZmlyc3QsIHdlIGRvbid0IG5lZWQgdG8gZG8gYW55dGhpbmdcbiAgICBpZiAoc3VwcG9ydGVkTGFuZ3MuaW5kZXhPZihsYW5ndWFnZSkgIT09IDApIHtcbiAgICAgIHVwZGF0ZXMuQXBwbGVMYW5ndWFnZXMgPSBbbGFuZ3VhZ2VdLmNvbmNhdChfLndpdGhvdXQoc3VwcG9ydGVkTGFuZ3MsIGxhbmd1YWdlKSk7XG4gICAgfVxuICB9XG4gIC8vIGlmIHdlIGFyZSBzZXR0aW5nIHRoZSBsb2NhbGUgb3IgY2FsZW5kYXIgZm9ybWF0LCBzZXQgdGhlbSBhcyBhcHByb3ByaWF0ZVxuICBpZiAobG9jYWxlIHx8IGNhbGVuZGFyRm9ybWF0KSB7XG4gICAgbGV0IGNhbFNwbGl0ID0gJ0BjYWxlbmRhcj0nO1xuICAgIGxldCBjdXJMb2NhbGVBbmRDYWwgPSBkYXRhLkFwcGxlTG9jYWxlIHx8IGxhbmd1YWdlIHx8ICdlbic7XG5cbiAgICBsZXQgc3BsaXQgPSBjdXJMb2NhbGVBbmRDYWwuc3BsaXQoY2FsU3BsaXQpO1xuICAgIGxldCBjdXJMb2MgPSBzcGxpdFswXTtcbiAgICBpZiAoY2FsZW5kYXJGb3JtYXQgfHwgc3BsaXRbMV0pIHtcbiAgICAgIGNhbGVuZGFyRm9ybWF0ID0gYCR7Y2FsU3BsaXR9JHtjYWxlbmRhckZvcm1hdCB8fCBzcGxpdFsxXSB8fCAnJ31gO1xuICAgIH1cbiAgICBjYWxlbmRhckZvcm1hdCA9IGNhbGVuZGFyRm9ybWF0IHx8ICcnO1xuICAgIGxldCBuZXdMb2NhbGVBbmRDYWwgPSBsb2NhbGUgPyBsb2NhbGUgOiBjdXJMb2M7XG4gICAgaWYgKGNhbGVuZGFyRm9ybWF0KSB7XG4gICAgICBuZXdMb2NhbGVBbmRDYWwgPSBgJHtuZXdMb2NhbGVBbmRDYWx9JHtjYWxlbmRhckZvcm1hdH1gO1xuICAgIH1cbiAgICAvLyBvbmx5IG5lZWQgdG8gdXBkYXRlIGlmIGl0IGhhcyBjaGFuZ2VkXG4gICAgaWYgKG5ld0xvY2FsZUFuZENhbCAhPT0gY3VyTG9jYWxlQW5kQ2FsKSB7XG4gICAgICBsb2cuZGVidWcoYE5ldyBsb2NhbGU6ICR7bmV3TG9jYWxlQW5kQ2FsfWApO1xuICAgICAgdXBkYXRlcy5BcHBsZUxvY2FsZSA9IG5ld0xvY2FsZUFuZENhbDtcbiAgICB9XG4gIH1cblxuICBpZiAoXy5zaXplKHVwZGF0ZXMpID09PSAwKSB7XG4gICAgbG9nLmRlYnVnKCdObyBsb2NhbGUgdXBkYXRlcyBuZWNlc3NhcnkuJyk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgbG9nLmRlYnVnKCdXcml0aW5nIG5ldyBsb2NhbGUgcGxpc3QgZGF0YScpO1xuICBhd2FpdCB1cGRhdGUoZ2xvYmFsUHJlZnMsIHVwZGF0ZXMpO1xuICByZXR1cm4gdHJ1ZTtcbn1cblxuZXhwb3J0IHtcbiAgdXBkYXRlLCB1cGRhdGVTZXR0aW5ncywgdXBkYXRlTG9jYXRpb25TZXR0aW5ncywgc2V0UmVkdWNlTW90aW9uLCBzZXRSZWR1Y2VUcmFuc3BhcmVuY3ksXG4gIHVwZGF0ZVNhZmFyaVVzZXJTZXR0aW5ncywgdXBkYXRlU2FmYXJpR2xvYmFsU2V0dGluZ3MsIHVwZGF0ZUxvY2FsZSwgcmVhZCxcbiAgcmVhZFNldHRpbmdzLCBQTElTVF9JREVOVElGSUVSXG59O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQSxNQUFNQSxnQkFBZ0IsR0FBR0MsTUFBTSxDQUFDQyxNQUFNLENBQUM7RUFDckNDLGFBQWEsRUFBRSxjQUFjO0VBQzdCQyxhQUFhLEVBQUUsY0FBYztFQUM3QkMsb0JBQW9CLEVBQUUsb0JBQW9CO0VBQzFDQyxNQUFNLEVBQUUsT0FBTztFQUNmQyxjQUFjLEVBQUUsZUFBZTtFQUMvQkMsV0FBVyxFQUFFLGFBQWE7RUFDMUJDLGtCQUFrQixFQUFFLG1CQUFt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