"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
require("source-map-support/register");
var _path = _interopRequireDefault(require("path"));
var _support = require("@appium/support");
var _utils = require("./utils");
class TCCDB {
  constructor(xcodeVersion, sharedResourcesDir) {
    this.xcodeVersion = xcodeVersion;
    this.sharedResourcesDir = sharedResourcesDir;
  }
  async getDB() {
    if (this.db) {
      return this.db;
    }
    const tccPath = _path.default.resolve(this.sharedResourcesDir, 'Library', 'TCC');
    if (!(await _support.fs.exists(tccPath))) {
      await (0, _support.mkdirp)(tccPath);
    }
    this.db = _path.default.resolve(tccPath, 'TCC.db');
    await (0, _utils.execSQLiteQuery)(this.db, `CREATE TABLE IF NOT EXISTS access (
      service TEXT NOT NULL DEFAULT '',
      client TEXT NOT NULL DEFAULT '',
      client_type INTEGER,
      allowed INTEGER,
      prompt_count INTEGER,
      csreq BLOB NOT NULL DEFAULT '',
      policy_ID INTEGER,
      PRIMARY KEY(service, client, client_type)
    );`);
    return this.db;
  }
  async execQuery(query, ...params) {
    return await (0, _utils.execSQLiteQuery)(await this.getDB(), query, ...params);
  }
}
var _default = TCCDB;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJUQ0NEQiIsImNvbnN0cnVjdG9yIiwieGNvZGVWZXJzaW9uIiwic2hhcmVkUmVzb3VyY2VzRGlyIiwiZ2V0REIiLCJkYiIsInRjY1BhdGgiLCJwYXRoIiwicmVzb2x2ZSIsImZzIiwiZXhpc3RzIiwibWtkaXJwIiwiZXhlY1NRTGl0ZVF1ZXJ5IiwiZXhlY1F1ZXJ5IiwicXVlcnkiLCJwYXJhbXMiXSwic291cmNlcyI6WyIuLi8uLi9saWIvdGNjLWRiLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgZnMsIG1rZGlycCB9IGZyb20gJ0BhcHBpdW0vc3VwcG9ydCc7XG5pbXBvcnQgeyBleGVjU1FMaXRlUXVlcnkgfSBmcm9tICcuL3V0aWxzJztcblxuY2xhc3MgVENDREIge1xuICBjb25zdHJ1Y3RvciAoeGNvZGVWZXJzaW9uLCBzaGFyZWRSZXNvdXJjZXNEaXIpIHtcbiAgICB0aGlzLnhjb2RlVmVyc2lvbiA9IHhjb2RlVmVyc2lvbjtcbiAgICB0aGlzLnNoYXJlZFJlc291cmNlc0RpciA9IHNoYXJlZFJlc291cmNlc0RpcjtcbiAgfVxuXG4gIGFzeW5jIGdldERCICgpIHtcbiAgICBpZiAodGhpcy5kYikge1xuICAgICAgcmV0dXJuIHRoaXMuZGI7XG4gICAgfVxuXG4gICAgY29uc3QgdGNjUGF0aCA9IHBhdGgucmVzb2x2ZSh0aGlzLnNoYXJlZFJlc291cmNlc0RpciwgJ0xpYnJhcnknLCAnVENDJyk7XG4gICAgaWYgKCEoYXdhaXQgZnMuZXhpc3RzKHRjY1BhdGgpKSkge1xuICAgICAgYXdhaXQgbWtkaXJwKHRjY1BhdGgpO1xuICAgIH1cblxuICAgIHRoaXMuZGIgPSBwYXRoLnJlc29sdmUodGNjUGF0aCwgJ1RDQy5kYicpO1xuICAgIGF3YWl0IGV4ZWNTUUxpdGVRdWVyeSh0aGlzLmRiLCBgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgYWNjZXNzIChcbiAgICAgIHNlcnZpY2UgVEVYVCBOT1QgTlVMTCBERUZBVUxUICcnLFxuICAgICAgY2xpZW50IFRFWFQgTk9UIE5VTEwgREVGQVVMVCAnJyxcbiAgICAgIGNsaWVudF90eXBlIElOVEVHRVIsXG4gICAgICBhbGxvd2VkIElOVEVHRVIsXG4gICAgICBwcm9tcHRfY291bnQgSU5URUdFUixcbiAgICAgIGNzcmVxIEJMT0IgTk9UIE5VTEwgREVGQVVMVCAnJyxcbiAgICAgIHBvbGljeV9JRCBJTlRFR0VSLFxuICAgICAgUFJJTUFSWSBLRVkoc2VydmljZSwgY2xpZW50LCBjbGllbnRfdHlwZSlcbiAgICApO2ApO1xuXG4gICAgcmV0dXJuIHRoaXMuZGI7XG4gIH1cblxuICBhc3luYyBleGVjUXVlcnkgKHF1ZXJ5LCAuLi5wYXJhbXMpIHtcbiAgICByZXR1cm4gYXdhaXQgZXhlY1NRTGl0ZVF1ZXJ5KGF3YWl0IHRoaXMuZ2V0REIoKSwgcXVlcnksIC4uLnBhcmFtcyk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgVENDREI7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBRUEsTUFBTUEsS0FBSyxDQUFDO0VBQ1ZDLFdBQVcsQ0FBRUMsWUFBWSxFQUFFQyxrQkFBa0IsRUFBRTtJQUM3QyxJQUFJLENBQUNELFlBQVksR0FBR0EsWUFBWTtJQUNoQyxJQUFJLENBQUNDLGtCQUFrQixHQUFHQSxrQkFBa0I7RUFDOUM7RUFFQSxNQUFNQyxLQUFLLEdBQUk7SUFDYixJQUFJLElBQUksQ0FBQ0MsRUFBRSxFQUFFO01BQ1gsT0FBTyxJQUFJLENBQUNBLEVBQUU7SUFDaEI7SUFFQSxNQUFNQyxPQUFPLEdBQUdDLGFBQUksQ0FBQ0MsT0FBTyxDQUFDLElBQUksQ0FBQ0wsa0JBQWtCLEVBQUUsU0FBUyxFQUFFLEtBQUssQ0FBQztJQUN2RSxJQUFJLEVBQUUsTUFBTU0sV0FBRSxDQUFDQyxNQUFNLENBQUNKLE9BQU8sQ0FBQyxDQUFDLEVBQUU7TUFDL0IsTUFBTSxJQUFBSyxlQUFNLEVBQUNMLE9BQU8sQ0FBQztJQUN2QjtJQUVBLElBQUksQ0FBQ0QsRUFBRSxHQUFHRSxhQUFJLENBQUNDLE9BQU8sQ0FBQ0YsT0FBTyxFQUFFLFFBQVEsQ0FBQztJQUN6QyxNQUFNLElBQUFNLHNCQUFlLEVBQUMsSUFBSSxDQUFDUCxFQUFFLEVBQUc7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU8sQ0FBQztJQUVKLE9BQU8sSUFBSSxDQUFDQSxFQUFFO0VBQ2hCO0VBRUEsTUFBTVEsU0FBUyxDQUFFQyxLQUFLLEVBQUUsR0FBR0MsTUFBTSxFQUFFO0lBQ2pDLE9BQU8sTUFBTSxJQUFBSCxzQkFBZSxFQUFDLE1BQU0sSUFBSSxDQUFDUixLQUFLLEVBQUUsRUFBRVUsS0FBSyxFQUFFLEdBQUdDLE1BQU0sQ0FBQztFQUNwRTtBQUNGO0FBQUMsZUFFY2YsS0FBSztBQUFBIn0=