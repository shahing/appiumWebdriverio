"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.SimulatorXcode6 = exports.SPRINGBOARD_BUNDLE_ID = exports.BOOT_COMPLETED_EVENT = void 0;
require("source-map-support/register");
var _path = _interopRequireDefault(require("path"));
var _appiumXcode = _interopRequireWildcard(require("appium-xcode"));
var _logger = _interopRequireDefault(require("./logger"));
var _support = require("@appium/support");
var _bluebird = _interopRequireDefault(require("bluebird"));
var _lodash = _interopRequireDefault(require("lodash"));
var _asyncLock = _interopRequireDefault(require("async-lock"));
var _utils = require("./utils.js");
var _asyncbox = require("asyncbox");
var settings = _interopRequireWildcard(require("./settings"));
var _teen_process = require("teen_process");
var _tailUntil = require("./tail-until.js");
var _index = _interopRequireDefault(require("./extensions/index"));
var _events = require("events");
var _calendar = _interopRequireDefault(require("./calendar"));
var _permissions = _interopRequireDefault(require("./permissions"));
var _nodeSimctl = _interopRequireDefault(require("node-simctl"));
function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }
function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }
const STARTUP_TIMEOUT = 60 * 1000;
const EXTRA_STARTUP_TIME = 2000;
const UI_CLIENT_ACCESS_GUARD = new _asyncLock.default();
const UI_CLIENT_BUNDLE_ID = 'com.apple.iphonesimulator';
const SPRINGBOARD_BUNDLE_ID = 'com.apple.SpringBoard';
exports.SPRINGBOARD_BUNDLE_ID = SPRINGBOARD_BUNDLE_ID;
const BOOT_COMPLETED_EVENT = 'bootCompleted';
exports.BOOT_COMPLETED_EVENT = BOOT_COMPLETED_EVENT;
class SimulatorXcode6 extends _events.EventEmitter {
  constructor(udid, xcodeVersion) {
    super();
    this.udid = String(udid);
    this.simctl = new _nodeSimctl.default({
      udid: this.udid
    });
    this.xcodeVersion = xcodeVersion;
    this._platformVersion = null;
    this.keychainPath = _path.default.resolve(this.getDir(), 'Library', 'Keychains');
    this.simulatorApp = 'iOS Simulator.app';
    this.appDataBundlePaths = {};
    this.isFreshFiles = ['Library/ConfigurationProfiles', 'Library/Cookies', 'Library/Preferences/.GlobalPreferences.plist', 'Library/Preferences/com.apple.springboard.plist', 'var/run/syslog.pid'];
    this.extraStartupTime = EXTRA_STARTUP_TIME;
    this.calendar = new _calendar.default(xcodeVersion, this.getDir());
    this.permissions = new _permissions.default(xcodeVersion, this.getDir(), this.udid);
  }
  get uiClientBundleId() {
    return UI_CLIENT_BUNDLE_ID;
  }
  get devicesSetPath() {
    return this.simctl.devicesSetPath;
  }
  set devicesSetPath(value) {
    this.simctl.devicesSetPath = value;
  }
  async getUIClientPid() {
    let stdout;
    try {
      ({
        stdout
      } = await (0, _teen_process.exec)('pgrep', ['-fn', `${this.simulatorApp}/Contents/MacOS/`]));
    } catch (e) {
      return null;
    }
    if (isNaN(parseInt(stdout, 10))) {
      return null;
    }
    stdout = stdout.trim();
    _logger.default.debug(`Got Simulator UI client PID: ${stdout}`);
    return stdout;
  }
  async isUIClientRunning() {
    return !_lodash.default.isNull(await this.getUIClientPid());
  }
  get startupTimeout() {
    return STARTUP_TIMEOUT;
  }
  async getPlatformVersion() {
    if (!this._platformVersion) {
      let {
        sdk
      } = await this.stat();
      this._platformVersion = sdk;
    }
    return this._platformVersion;
  }
  getRootDir() {
    let home = process.env.HOME;
    return _path.default.resolve(home, 'Library', 'Developer', 'CoreSimulator', 'Devices');
  }
  getDir() {
    return _path.default.resolve(this.getRootDir(), this.udid, 'data');
  }
  getLogDir() {
    let home = process.env.HOME;
    return _path.default.resolve(home, 'Library', 'Logs', 'CoreSimulator', this.udid);
  }
  async installApp(app) {
    return await this.simctl.installApp(app);
  }
  async isAppInstalled(bundleId, appFile = null) {
    let appDirs = await this.getAppDirs(appFile, bundleId);
    return appDirs.length !== 0;
  }
  async getUserInstalledBundleIdsByBundleName(bundleName) {
    const rootUserAppDir = await this.buildBundlePathMap('Bundle');
    const bundleIds = [];
    if (_lodash.default.isEmpty(rootUserAppDir)) {
      return bundleIds;
    }
    for (const [bundleId, userAppDirPath] of Object.entries(rootUserAppDir)) {
      const appFile = (await _support.fs.readdir(userAppDirPath)).find(file => _path.default.extname(file).toLowerCase() === '.app');
      const infoPlistPath = _path.default.resolve(userAppDirPath, appFile, 'Info.plist');
      if (!(await _support.fs.exists(infoPlistPath))) {
        continue;
      }
      try {
        const infoPlist = await _support.plist.parsePlistFile(infoPlistPath, false);
        if (infoPlist.CFBundleName === bundleName) {
          bundleIds.push(bundleId);
        }
      } catch (err) {
        _logger.default.warn(`Failed to read plist ${infoPlistPath}. Original error '${err.message}'`);
        continue;
      }
    }
    _logger.default.debug(`The simulator has '${bundleIds.length}' bundles which have '${bundleName}' as their 'CFBundleName':`);
    for (const bundleId of bundleIds) {
      _logger.default.debug(`    '${bundleId}'`);
    }
    return bundleIds;
  }
  async getAppDir(id, subDir = 'Data') {
    this.appDataBundlePaths[subDir] = this.appDataBundlePaths[subDir] || {};
    if (_lodash.default.isEmpty(this.appDataBundlePaths[subDir]) && !(await this.isFresh())) {
      this.appDataBundlePaths[subDir] = await this.buildBundlePathMap(subDir);
    }
    return this.appDataBundlePaths[subDir][id];
  }
  async buildBundlePathMap(subDir = 'Data') {
    _logger.default.debug('Building bundle path map');
    let applicationList;
    let pathBundlePair;
    if ((await this.getPlatformVersion()) === '7.1') {
      applicationList = _path.default.resolve(this.getDir(), 'Applications');
      pathBundlePair = async dir => {
        dir = _path.default.resolve(applicationList, dir);
        let appFiles = await _support.fs.glob(`${dir}/*.app`);
        let bundleId = appFiles[0].match(/.*\/(.*)\.app/)[1];
        return {
          path: dir,
          bundleId
        };
      };
    } else {
      applicationList = _path.default.resolve(this.getDir(), 'Containers', subDir, 'Application');
      let readBundleId = async dir => {
        let plist = _path.default.resolve(dir, '.com.apple.mobile_container_manager.metadata.plist');
        let metadata = await settings.read(plist);
        return metadata.MCMMetadataIdentifier;
      };
      pathBundlePair = async dir => {
        dir = _path.default.resolve(applicationList, dir);
        let bundleId = await readBundleId(dir);
        return {
          path: dir,
          bundleId
        };
      };
    }
    if (!(await _support.fs.exists(applicationList))) {
      _logger.default.warn(`No directory path '${applicationList}'`);
      return {};
    }
    let bundlePathDirs = await _support.fs.readdir(applicationList);
    let bundlePathPairs = await (0, _asyncbox.asyncmap)(bundlePathDirs, async function (dir) {
      return await pathBundlePair(dir);
    }, false);
    return bundlePathPairs.reduce((bundleMap, bundlePath) => {
      bundleMap[bundlePath.bundleId] = bundlePath.path;
      return bundleMap;
    }, {});
  }
  async stat() {
    for (let [sdk, deviceArr] of _lodash.default.toPairs(await this.simctl.getDevices())) {
      for (let device of deviceArr) {
        if (device.udid === this.udid) {
          device.sdk = sdk;
          return device;
        }
      }
    }
    return {};
  }
  async isFresh() {
    let files = this.isFreshFiles;
    let pv = await this.getPlatformVersion();
    if (pv !== '7.1') {
      files.push('Library/Preferences/com.apple.Preferences.plist');
    } else {
      files.push('Applications');
    }
    const dir = this.getDir();
    files = files.map(s => _path.default.resolve(dir, s));
    const existences = await (0, _asyncbox.asyncmap)(files, async f => await _support.fs.hasAccess(f));
    const fresh = _lodash.default.compact(existences).length !== files.length;
    _logger.default.debug(`Checking whether simulator has been run before: ${fresh ? 'no' : 'yes'}`);
    return fresh;
  }
  async isRunning() {
    try {
      await this.simctl.getEnv('dummy');
      return true;
    } catch (e) {
      return false;
    }
  }
  async isShutdown() {
    try {
      await this.simctl.getEnv('dummy');
      return false;
    } catch (e) {
      return _lodash.default.includes(e.stderr, 'Current state: Shutdown');
    }
  }
  async waitForBoot(startupTimeout) {
    let bootedIndicator = await this.getBootedIndicatorString();
    await this.tailLogsUntil(bootedIndicator, startupTimeout);
    _logger.default.debug(`Waiting an extra ${this.extraStartupTime}ms for the simulator to really finish booting`);
    await _bluebird.default.delay(this.extraStartupTime);
    _logger.default.debug('Done waiting extra time for simulator');
    this.emit(BOOT_COMPLETED_EVENT);
  }
  async getBootedIndicatorString() {
    let indicator;
    let platformVersion = await this.getPlatformVersion();
    switch (platformVersion) {
      case '7.1':
      case '8.1':
      case '8.2':
      case '8.3':
      case '8.4':
        indicator = 'profiled: Service starting...';
        break;
      case '9.0':
      case '9.1':
      case '9.2':
      case '9.3':
        indicator = 'System app "com.apple.springboard" finished startup';
        break;
      case '10.0':
        indicator = 'Switching to keyboard';
        break;
      default:
        _logger.default.warn(`No boot indicator case for platform version '${platformVersion}'`);
        indicator = 'no boot indicator string available';
    }
    return indicator;
  }
  async startUIClient(opts = {}) {
    opts = _lodash.default.cloneDeep(opts);
    _lodash.default.defaultsDeep(opts, {
      scaleFactor: null,
      startupTimeout: this.startupTimeout
    });
    const simulatorApp = _path.default.resolve(await (0, _appiumXcode.getPath)(), 'Applications', this.simulatorApp);
    const args = ['-Fn', simulatorApp, '--args', '-CurrentDeviceUDID', this.udid];
    if (opts.scaleFactor) {
      const {
        name
      } = await this.stat();
      const formattedDeviceName = name.replace(/\s+/g, '-');
      const argumentName = `-SimulatorWindowLastScale-com.apple.CoreSimulator.SimDeviceType.${formattedDeviceName}`;
      args.push(argumentName, opts.scaleFactor);
    }
    _logger.default.info(`Starting Simulator UI with command: open ${args.join(' ')}`);
    try {
      await (0, _teen_process.exec)('open', args, {
        timeout: opts.startupTimeout
      });
    } catch (err) {
      if (!(err.stdout || '').includes('-10825') && !(err.stderr || '').includes('-10825')) {
        throw err;
      }
      _logger.default.warn(`Error while opening UI: ${err.stdout || err.stderr}. Continuing`);
    }
  }
  async run(opts = {}) {
    opts = Object.assign({
      startupTimeout: this.startupTimeout
    }, opts);
    const isServerRunning = await this.isRunning();
    const isUIClientRunning = await this.isUIClientRunning();
    if (isServerRunning && isUIClientRunning) {
      _logger.default.info(`Both Simulator with UDID ${this.udid} and the UI client are currently running`);
      return;
    }
    const timer = new _support.timing.Timer().start();
    try {
      await this.shutdown();
    } catch (err) {
      _logger.default.warn(`Error on Simulator shutdown: ${err.message}`);
    }
    await this.startUIClient(opts);
    await this.waitForBoot(opts.startupTimeout);
    _logger.default.info(`Simulator with UDID ${this.udid} booted in ${timer.getDuration().asSeconds.toFixed(3)}s`);
  }
  async clean() {
    await this.endSimulatorDaemon();
    _logger.default.info(`Cleaning simulator ${this.udid}`);
    await this.simctl.eraseDevice(10000);
  }
  async scrubCustomApp(appFile, appBundleId) {
    return await this.cleanCustomApp(appFile, appBundleId, true);
  }
  async cleanCustomApp(appFile, appBundleId, scrub = false) {
    _logger.default.debug(`Cleaning app data files for '${appFile}', '${appBundleId}'`);
    if (!scrub) {
      _logger.default.debug(`Deleting app altogether`);
    }
    let appDirs = await this.getAppDirs(appFile, appBundleId, scrub);
    if (appDirs.length === 0) {
      _logger.default.debug('Could not find app directories to delete. It is probably not installed');
      return;
    }
    let deletePromises = [];
    for (let dir of appDirs) {
      _logger.default.debug(`Deleting directory: '${dir}'`);
      deletePromises.push(_support.fs.rimraf(dir));
    }
    if ((await this.getPlatformVersion()) >= 8) {
      let relRmPath = `Library/Preferences/${appBundleId}.plist`;
      let rmPath = _path.default.resolve(this.getRootDir(), relRmPath);
      _logger.default.debug(`Deleting file: '${rmPath}'`);
      deletePromises.push(_support.fs.rimraf(rmPath));
    }
    await _bluebird.default.all(deletePromises);
  }
  async getAppDirs(appFile, appBundleId, scrub = false) {
    let dirs = [];
    if ((await this.getPlatformVersion()) >= 8) {
      let data = await this.getAppDir(appBundleId);
      if (!data) return dirs;
      let bundle = !scrub ? await this.getAppDir(appBundleId, 'Bundle') : undefined;
      for (let src of [data, bundle]) {
        if (src) {
          dirs.push(src);
        }
      }
    } else {
      let data = await this.getAppDir(appFile);
      if (data) {
        dirs.push(data);
      }
    }
    return dirs;
  }
  async launchAndQuit(safari = false, startupTimeout = this.startupTimeout) {
    _logger.default.debug('Attempting to launch and quit the simulator to create the directory structure');
    await this.run({
      startupTimeout
    });
    if (safari) {
      _logger.default.debug('Spawning Safari browser in order to create the necessary file system items');
      await (0, _utils.launchApp)(this.simctl, _utils.MOBILE_SAFARI_BUNDLE_ID);
    }
    try {
      await (0, _asyncbox.retryInterval)(60, 250, async () => {
        if (await this.isFresh()) {
          throw new Error('Simulator files not fully created. Waiting a bit');
        }
      });
    } catch (err) {
      _logger.default.warn(`Timeout waiting for simulator files to be created. Continuing`);
    }
    await this.shutdown();
  }
  async endSimulatorDaemon() {
    _logger.default.debug(`Killing any simulator daemons for ${this.udid}`);
    let launchctlCmd = `launchctl list | grep ${this.udid} | cut -f 3 | xargs -n 1 launchctl`;
    try {
      let stopCmd = `${launchctlCmd} stop`;
      await (0, _teen_process.exec)('bash', ['-c', stopCmd]);
    } catch (err) {
      _logger.default.warn(`Could not stop simulator daemons: ${err.message}`);
      _logger.default.debug('Carrying on anyway!');
    }
    try {
      let removeCmd = `${launchctlCmd} remove`;
      await (0, _teen_process.exec)('bash', ['-c', removeCmd]);
    } catch (err) {
      _logger.default.warn(`Could not remove simulator daemons: ${err.message}`);
      _logger.default.debug('Carrying on anyway!');
    }
    try {
      await (0, _asyncbox.waitForCondition)(async () => {
        let {
          stdout
        } = await (0, _teen_process.exec)('bash', ['-c', `ps -e  | grep ${this.udid} | grep launchd_sim | grep -v bash | grep -v grep | awk {'print$1'}`]);
        return stdout.trim().length === 0;
      }, {
        waitMs: 10000,
        intervalMs: 500
      });
    } catch (err) {
      _logger.default.warn(`Could not end simulator daemon for ${this.udid}: ${err.message}`);
      _logger.default.debug('Carrying on anyway!');
    }
  }
  async shutdown(opts = {}) {
    if (await this.isShutdown()) {
      return;
    }
    await (0, _asyncbox.retryInterval)(5, 500, this.simctl.shutdownDevice.bind(this.simctl));
    const waitMs = parseInt(opts.timeout, 10);
    if (waitMs > 0) {
      try {
        await (0, _asyncbox.waitForCondition)(async () => await this.isShutdown(), {
          waitMs,
          intervalMs: 100
        });
      } catch (err) {
        throw new Error(`Simulator is not in 'Shutdown' state after ${waitMs}ms`);
      }
    }
  }
  async delete() {
    await this.simctl.deleteDevice();
  }
  async updateSettings(plist, updates) {
    return await settings.updateSettings(this, plist, updates);
  }
  async updateLocationSettings(bundleId, authorized) {
    await this.setPermission(bundleId, 'location', authorized ? 'always' : 'never');
  }
  async setReduceMotion(reduceMotion = true) {
    await settings.setReduceMotion(this, reduceMotion);
  }
  async setReduceTransparency(reduceTransparency) {
    await settings.setReduceTransparency(this, reduceTransparency);
  }
  async setAppearance() {
    throw new Error(`Xcode SDK '${this.xcodeVersion}' is too old to set UI appearance`);
  }
  async getAppearance() {
    throw new Error(`Xcode SDK '${this.xcodeVersion}' is too old to get UI appearance`);
  }
  async updateSafariSettings(updates) {
    const promises = [settings.updateSafariUserSettings(this, updates), settings.updateSettings(this, settings.PLIST_IDENTIFIER.MOBILE_SAFARI, updates)];
    return _lodash.default.some(await _bluebird.default.all(promises), Boolean);
  }
  async updateSafariGlobalSettings(updates) {
    return await settings.updateSafariGlobalSettings(this, updates);
  }
  async updateLocale(language, locale, calendarFormat) {
    return await settings.updateLocale(this, language, locale, calendarFormat);
  }
  async deleteSafari() {
    _logger.default.debug('Deleting Safari apps from simulator');
    let dirs = [];
    dirs.push(await this.getAppDir(_utils.MOBILE_SAFARI_BUNDLE_ID));
    let pv = await this.getPlatformVersion();
    if (pv >= 8) {
      dirs.push(await this.getAppDir(_utils.MOBILE_SAFARI_BUNDLE_ID, 'Bundle'));
    }
    let deletePromises = [];
    for (let dir of _lodash.default.compact(dirs)) {
      _logger.default.debug(`Deleting directory: '${dir}'`);
      deletePromises.push(_support.fs.rimraf(dir));
    }
    await _bluebird.default.all(deletePromises);
  }
  async cleanSafari(keepPrefs = true) {
    _logger.default.debug('Cleaning mobile safari data files');
    if (await this.isFresh()) {
      _logger.default.info('Could not find Safari support directories to clean out old ' + 'data. Probably there is nothing to clean out');
      return;
    }
    let libraryDir = _path.default.resolve(this.getDir(), 'Library');
    let safariRoot = await this.getAppDir(_utils.MOBILE_SAFARI_BUNDLE_ID);
    if (!safariRoot) {
      _logger.default.info('Could not find Safari support directories to clean out old ' + 'data. Probably there is nothing to clean out');
      return;
    }
    let safariLibraryDir = _path.default.resolve(safariRoot, 'Library');
    let filesToDelete = [`Caches/Snapshots/${_utils.MOBILE_SAFARI_BUNDLE_ID}`, `Caches/${_utils.MOBILE_SAFARI_BUNDLE_ID}/*`, 'Caches/com.apple.WebAppCache/*', 'Caches/com.apple.WebKit.Networking/*', 'Caches/com.apple.WebKit.WebContent/*', 'Image Cache/*', `WebKit/${_utils.MOBILE_SAFARI_BUNDLE_ID}/*`, 'WebKit/GeolocationSites.plist', 'WebKit/LocalStorage/*.*', 'Safari/*', 'Cookies/*.binarycookies', 'Caches/com.apple.UIStatusBar/*', 'Caches/com.apple.keyboards/images/*', 'Caches/com.apple.Safari.SafeBrowsing/*', `../tmp/${_utils.MOBILE_SAFARI_BUNDLE_ID}/*`];
    let deletePromises = [];
    for (let file of filesToDelete) {
      deletePromises.push(_support.fs.rimraf(_path.default.resolve(libraryDir, file)));
      deletePromises.push(_support.fs.rimraf(_path.default.resolve(safariLibraryDir, file)));
    }
    if (!keepPrefs) {
      deletePromises.push(_support.fs.rimraf(_path.default.resolve(safariLibraryDir, 'Preferences/*.plist')));
    }
    await _bluebird.default.all(deletePromises);
  }
  async removeApp(bundleId) {
    await this.simctl.removeApp(bundleId);
  }
  async moveBuiltInApp(appName, appPath, newAppPath) {
    await (0, _utils.safeRimRaf)(newAppPath);
    await _support.fs.copyFile(appPath, newAppPath);
    _logger.default.debug(`Copied '${appName}' to '${newAppPath}'`);
    await _support.fs.rimraf(appPath);
    _logger.default.debug(`Temporarily deleted original app at '${appPath}'`);
    return [newAppPath, appPath];
  }
  async openUrl(url) {
    const SAFARI_BOOTED_INDICATOR = 'MobileSafari[';
    const SAFARI_STARTUP_TIMEOUT = 15 * 1000;
    const EXTRA_STARTUP_TIME = 3 * 1000;
    if (await this.isRunning()) {
      await (0, _asyncbox.retry)(5000, this.simctl.openUrl.bind(this.simctl), url);
      await this.tailLogsUntil(SAFARI_BOOTED_INDICATOR, SAFARI_STARTUP_TIMEOUT);
      _logger.default.debug(`Safari started, waiting ${EXTRA_STARTUP_TIME}ms for it to fully start`);
      await _bluebird.default.delay(EXTRA_STARTUP_TIME);
      _logger.default.debug('Done waiting for Safari');
      return;
    } else {
      throw new Error('Tried to open a url, but the Simulator is not Booted');
    }
  }
  async clearCaches(...folderNames) {
    const cachesRoot = _path.default.resolve(this.getDir(), 'Library', 'Caches');
    if (!(await _support.fs.hasAccess(cachesRoot))) {
      _logger.default.debug(`Caches root at '${cachesRoot}' does not exist or is not accessible. Nothing to do there`);
      return 0;
    }
    let itemsToRemove = folderNames.length ? folderNames : await _support.fs.readdir(cachesRoot);
    itemsToRemove = itemsToRemove.map(x => _path.default.resolve(cachesRoot, x));
    if (folderNames.length) {
      itemsToRemove = await _bluebird.default.filter(itemsToRemove, x => _support.fs.hasAccess(x));
    }
    itemsToRemove = await _bluebird.default.filter(itemsToRemove, async x => (await _support.fs.stat(x)).isDirectory());
    if (!itemsToRemove.length) {
      _logger.default.debug(`No Simulator cache items for cleanup were matched in '${cachesRoot}'`);
      return 0;
    }
    _logger.default.debug(`Matched ${_support.util.pluralize('simulator cache item', itemsToRemove.length, true)} ` + `for cleanup: ${itemsToRemove}`);
    try {
      await _bluebird.default.all(itemsToRemove, x => _support.fs.rimraf(x));
    } catch (e) {
      _logger.default.warn(`Got an exception while cleaning Simulator caches: ${e.message}`);
    }
    return itemsToRemove.length;
  }
  async tailLogsUntil(bootedIndicator, timeoutMs) {
    let simLog = _path.default.resolve(this.getLogDir(), 'system.log');
    await (0, _asyncbox.retryInterval)(200, 200, async () => {
      let exists = await _support.fs.exists(simLog);
      if (!exists) {
        throw new Error(`Could not find Simulator log: '${simLog}'`);
      }
    });
    _logger.default.info(`Simulator log at '${simLog}'`);
    _logger.default.info(`Tailing simulator logs until we encounter the string "${bootedIndicator}"`);
    _logger.default.info(`We will time out after ${timeoutMs}ms`);
    try {
      await (0, _tailUntil.tailUntil)(simLog, bootedIndicator, timeoutMs);
    } catch (err) {
      _logger.default.debug('Simulator startup timed out. Continuing anyway.');
    }
  }
  async enableCalendarAccess(bundleID) {
    await this.calendar.enableCalendarAccess(bundleID);
  }
  async disableCalendarAccess(bundleID) {
    await this.calendar.disableCalendarAccess(bundleID);
  }
  async hasCalendarAccess(bundleID) {
    return await this.calendar.hasCalendarAccess(bundleID);
  }
  async _activateWindow() {
    const pid = await this.getUIClientPid();
    if (pid) {
      try {
        return await (0, _utils.activateApp)(pid);
      } catch (e) {
        _logger.default.debug(e.stderr || e.message);
      }
    }
    return `
      tell application "System Events"
        tell process "Simulator"
          set frontmost to false
          set frontmost to true
        end tell
      end tell
    `;
  }
  async executeUIClientScript(appleScript) {
    const windowActivationScript = await this._activateWindow();
    const resultScript = `${windowActivationScript ? windowActivationScript + '\n' : ''}${appleScript}`;
    _logger.default.debug(`Executing UI Apple Script on Simulator with UDID ${this.udid}: ${resultScript}`);
    return await UI_CLIENT_ACCESS_GUARD.acquire(this.simulatorApp, async () => {
      try {
        const {
          stdout
        } = await (0, _teen_process.exec)('osascript', ['-e', resultScript]);
        return stdout;
      } catch (err) {
        _logger.default.errorAndThrow(`Could not complete operation. Make sure Simulator UI is running and the parent Appium application (e. g. Appium.app or Terminal.app) ` + `is present in System Preferences > Security & Privacy > Privacy > Accessibility list. If the operation is still unsuccessful then ` + `it is not supported by this Simulator. ` + `Original error: ${err.message}`);
      }
    });
  }
  async isBiometricEnrolled() {
    const output = await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          set dstMenuItem to menu item "Touch ID Enrolled" of menu 1 of menu bar item "Hardware" of menu bar 1
          set isChecked to (value of attribute "AXMenuItemMarkChar" of dstMenuItem) is "✓"
        end tell
      end tell
    `);
    _logger.default.debug(`Touch ID enrolled state: ${output}`);
    return _lodash.default.isString(output) && output.trim() === 'true';
  }
  async enrollBiometric(isEnabled = true) {
    await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          set dstMenuItem to menu item "Touch ID Enrolled" of menu 1 of menu bar item "Hardware" of menu bar 1
          set isChecked to (value of attribute "AXMenuItemMarkChar" of dstMenuItem) is "✓"
          if ${isEnabled ? 'not ' : ''}isChecked then
            click dstMenuItem
          end if
        end tell
      end tell
    `);
  }
  async sendBiometricMatch(shouldMatch = true) {
    await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          set dstMenuItem to menu item "${shouldMatch ? 'Matching' : 'Non-matching'}" of menu 1 of menu item "Simulate Finger Touch" of menu 1 of menu bar item "Hardware" of menu bar 1
          click dstMenuItem
        end tell
      end tell
    `);
  }
  async dismissDatabaseAlert(increase = true) {
    let button = increase ? 'Increase' : 'Cancel';
    _logger.default.debug(`Attempting to dismiss database alert with '${button}' button`);
    await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          click button "${button}" of window 1
        end tell
      end tell
    `);
  }
  async backupKeychains() {
    if (!(await _support.fs.exists(this.keychainPath))) {
      return false;
    }
    const backupPath = await _support.tempDir.path({
      prefix: `keychains_backup_${Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1)}`,
      suffix: '.zip'
    });
    const zipArgs = ['-r', backupPath, `${this.keychainPath}${_path.default.sep}`];
    _logger.default.debug(`Creating keychains backup with 'zip ${zipArgs.join(' ')}' command`);
    await (0, _teen_process.exec)('zip', zipArgs);
    if (_lodash.default.isString(this._keychainsBackupPath) && (await _support.fs.exists(this._keychainsBackupPath))) {
      await _support.fs.unlink(this._keychainsBackupPath);
    }
    this._keychainsBackupPath = backupPath;
    return true;
  }
  async restoreKeychains(excludePatterns = []) {
    if (!_lodash.default.isString(this._keychainsBackupPath) || !(await _support.fs.exists(this._keychainsBackupPath))) {
      throw new Error(`The keychains backup archive does not exist. ` + `Are you sure it was created before?`);
    }
    if (_lodash.default.isString(excludePatterns)) {
      excludePatterns = excludePatterns.split(',').map(x => x.trim());
    }
    const isServerRunning = await this.isRunning();
    let plistPath;
    if (isServerRunning) {
      plistPath = _path.default.resolve(await this.getLaunchDaemonsRoot(), 'com.apple.securityd.plist');
      if (!(await _support.fs.exists(plistPath))) {
        throw new Error(`Cannot clear keychains because '${plistPath}' does not exist`);
      }
      await this.simctl.spawnProcess(['launchctl', 'unload', plistPath]);
    }
    try {
      await _support.fs.rimraf(this.keychainPath);
      await (0, _support.mkdirp)(this.keychainPath);
      const unzipArgs = ['-o', this._keychainsBackupPath, ..._lodash.default.flatMap(excludePatterns.map(x => ['-x', x])), '-d', '/'];
      _logger.default.debug(`Restoring keychains with 'unzip ${unzipArgs.join(' ')}' command`);
      await (0, _teen_process.exec)('unzip', unzipArgs);
      await _support.fs.unlink(this._keychainsBackupPath);
      this._keychainsBackupPath = null;
    } finally {
      if (isServerRunning && plistPath) {
        await this.simctl.spawnProcess(['launchctl', 'load', plistPath]);
      }
    }
    return true;
  }
  async clearKeychains() {
    const plistPath = _path.default.resolve(await this.getLaunchDaemonsRoot(), 'com.apple.securityd.plist');
    if (!(await _support.fs.exists(plistPath))) {
      throw new Error(`Cannot clear keychains because '${plistPath}' does not exist`);
    }
    await this.simctl.spawnProcess(['launchctl', 'unload', plistPath]);
    try {
      if (await _support.fs.exists(this.keychainPath)) {
        await _support.fs.rimraf(this.keychainPath);
        await (0, _support.mkdirp)(this.keychainPath);
      }
    } finally {
      await this.simctl.spawnProcess(['launchctl', 'load', plistPath]);
    }
  }
  async ps() {
    const {
      stdout
    } = await this.simctl.spawnProcess(['launchctl', 'print', 'system']);
    const servicesMatch = /^\s*services\s*=\s*{([^}]+)/m.exec(stdout);
    if (!servicesMatch) {
      _logger.default.debug(stdout);
      throw new Error(`The list of active processes cannot be retrieved`);
    }
    const result = [];
    const pattern = /^\s*(\d+)\s+[\d-]+\s+([\w\-.]+:)?([\w\-.]+)/gm;
    let match;
    while (match = pattern.exec(servicesMatch[1])) {
      result.push({
        pid: parseInt(match[1], 10),
        group: _lodash.default.trimEnd(match[2], ':') || null,
        name: match[3]
      });
    }
    return result;
  }
  async setPermission(bundleId, permission, value) {
    await this.setPermissions(bundleId, {
      [permission]: value
    });
  }
  async setPermissions(bundleId, permissionsMapping) {
    _logger.default.debug(`Setting access for '${bundleId}': ` + JSON.stringify(permissionsMapping, null, 2));
    await this.permissions.setAccess(bundleId, permissionsMapping);
  }
  async getPermission(bundleId, serviceName) {
    const result = await this.permissions.getAccess(bundleId, serviceName);
    _logger.default.debug(`Got ${serviceName} access status for '${bundleId}': ${result}`);
    return result;
  }
  async addCertificate(payload) {
    if (await (0, _utils.hasSSLCert)(payload, this.udid)) {
      _logger.default.info(`SSL certificate '${_lodash.default.truncate(payload, {
        length: 20
      })}' already installed`);
      return false;
    }
    _logger.default.info(`Installing SSL root certificate '${_lodash.default.truncate(payload, {
      length: 20
    })}'`);
    await (0, _utils.installSSLCert)(payload, this.udid);
    return true;
  }
  async pushNotification() {
    throw new Error(`Xcode SDK '${this.xcodeVersion}' is too old to push notifications`);
  }
  async getLaunchDaemonsRoot() {
    const devRoot = await (0, _utils.getDeveloperRoot)();
    return _path.default.resolve(devRoot, 'Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator.sdk/System/Library/LaunchDaemons');
  }
  static async _getDeviceStringPlatformVersion(platformVersion) {
    let reqVersion = platformVersion;
    if (!reqVersion) {
      reqVersion = await _appiumXcode.default.getMaxIOSSDK();
      _logger.default.warn(`No platform version set. Using max SDK version: ${reqVersion}`);
      if (!_lodash.default.isString(reqVersion)) {
        reqVersion = reqVersion % 1 ? String(reqVersion) : `${reqVersion}.0`;
      }
    }
    return reqVersion;
  }
  static async _getDeviceStringVersionString(platformVersion) {
    let reqVersion = await this._getDeviceStringPlatformVersion(platformVersion);
    return `(${reqVersion} Simulator)`;
  }
  static _getDeviceStringConfigFix() {
    return {
      'iPad Simulator (7.1 Simulator)': 'iPad 2 (7.1 Simulator)',
      'iPad Simulator (8.0 Simulator)': 'iPad 2 (8.0 Simulator)',
      'iPad Simulator (8.1 Simulator)': 'iPad 2 (8.1 Simulator)',
      'iPad Simulator (8.2 Simulator)': 'iPad 2 (8.2 Simulator)',
      'iPad Simulator (8.3 Simulator)': 'iPad 2 (8.3 Simulator)',
      'iPad Simulator (8.4 Simulator)': 'iPad 2 (8.4 Simulator)',
      'iPhone Simulator (7.1 Simulator)': 'iPhone 5s (7.1 Simulator)',
      'iPhone Simulator (8.4 Simulator)': 'iPhone 6 (8.4 Simulator)',
      'iPhone Simulator (8.3 Simulator)': 'iPhone 6 (8.3 Simulator)',
      'iPhone Simulator (8.2 Simulator)': 'iPhone 6 (8.2 Simulator)',
      'iPhone Simulator (8.1 Simulator)': 'iPhone 6 (8.1 Simulator)',
      'iPhone Simulator (8.0 Simulator)': 'iPhone 6 (8.0 Simulator)'
    };
  }
  static async getDeviceString(opts) {
    opts = Object.assign({}, {
      deviceName: null,
      platformVersion: null,
      forceIphone: false,
      forceIpad: false
    }, opts);
    let logOpts = {
      deviceName: opts.deviceName,
      platformVersion: opts.platformVersion,
      forceIphone: opts.forceIphone,
      forceIpad: opts.forceIpad
    };
    _logger.default.debug(`Getting device string from options: ${JSON.stringify(logOpts)}`);
    if ((opts.deviceName || '')[0] === '=') {
      return opts.deviceName.substring(1);
    }
    let isiPhone = !!opts.forceIphone || !opts.forceIpad;
    if (opts.deviceName) {
      let device = opts.deviceName.toLowerCase();
      if (device.indexOf('iphone') !== -1) {
        isiPhone = true;
      } else if (device.indexOf('ipad') !== -1) {
        isiPhone = false;
      }
    }
    let iosDeviceString = opts.deviceName || (isiPhone ? 'iPhone Simulator' : 'iPad Simulator');
    if (/^(iPhone|iPad)$/.test(iosDeviceString)) {
      iosDeviceString += ' Simulator';
    }
    if (/[^(iPhone|iPad)] Simulator/.test(iosDeviceString)) {
      iosDeviceString = iosDeviceString.replace(' Simulator', '');
    }
    iosDeviceString += ` ${await this._getDeviceStringVersionString(opts.platformVersion)}`;
    let CONFIG_FIX = this._getDeviceStringConfigFix();
    let configFix = CONFIG_FIX;
    if (configFix[iosDeviceString]) {
      iosDeviceString = configFix[iosDeviceString];
      _logger.default.debug(`Fixing device. Changed from '${opts.deviceName}' ` + `to '${iosDeviceString}'`);
    }
    _logger.default.debug(`Final device string is '${iosDeviceString}'`);
    return iosDeviceString;
  }
  async getWebInspectorSocket() {
    return null;
  }
}
exports.SimulatorXcode6 = SimulatorXcode6;
for (let [cmd, fn] of _lodash.default.toPairs(_index.default)) {
  SimulatorXcode6.prototype[cmd] = fn;
}
var _default = SimulatorXcode6;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTVEFSVFVQX1RJTUVPVVQiLCJFWFRSQV9TVEFSVFVQX1RJTUUiLCJVSV9DTElFTlRfQUNDRVNTX0dVQVJEIiwiQXN5bmNMb2NrIiwiVUlfQ0xJRU5UX0JVTkRMRV9JRCIsIlNQUklOR0JPQVJEX0JVTkRMRV9JRCIsIkJPT1RfQ09NUExFVEVEX0VWRU5UIiwiU2ltdWxhdG9yWGNvZGU2IiwiRXZlbnRFbWl0dGVyIiwiY29uc3RydWN0b3IiLCJ1ZGlkIiwieGNvZGVWZXJzaW9uIiwiU3RyaW5nIiwic2ltY3RsIiwiU2ltY3RsIiwiX3BsYXRmb3JtVmVyc2lvbiIsImtleWNoYWluUGF0aCIsInBhdGgiLCJyZXNvbHZlIiwiZ2V0RGlyIiwic2ltdWxhdG9yQXBwIiwiYXBwRGF0YUJ1bmRsZVBhdGhzIiwiaXNGcmVzaEZpbGVzIiwiZXh0cmFTdGFydHVwVGltZSIsImNhbGVuZGFyIiwiQ2FsZW5kYXIiLCJwZXJtaXNzaW9ucyIsIlBlcm1pc3Npb25zIiwidWlDbGllbnRCdW5kbGVJZCIsImRldmljZXNTZXRQYXRoIiwidmFsdWUiLCJnZXRVSUNsaWVudFBpZCIsInN0ZG91dCIsImV4ZWMiLCJlIiwiaXNOYU4iLCJwYXJzZUludCIsInRyaW0iLCJsb2ciLCJkZWJ1ZyIsImlzVUlDbGllbnRSdW5uaW5nIiwiXyIsImlzTnVsbCIsInN0YXJ0dXBUaW1lb3V0IiwiZ2V0UGxhdGZvcm1WZXJzaW9uIiwic2RrIiwic3RhdCIsImdldFJvb3REaXIiLCJob21lIiwicHJvY2VzcyIsImVudiIsIkhPTUUiLCJnZXRMb2dEaXIiLCJpbnN0YWxsQXBwIiwiYXBwIiwiaXNBcHBJbnN0YWxsZWQiLCJidW5kbGVJZCIsImFwcEZpbGUiLCJhcHBEaXJzIiwiZ2V0QXBwRGlycyIsImxlbmd0aCIsImdldFVzZXJJbnN0YWxsZWRCdW5kbGVJZHNCeUJ1bmRsZU5hbWUiLCJidW5kbGVOYW1lIiwicm9vdFVzZXJBcHBEaXIiLCJidWlsZEJ1bmRsZVBhdGhNYXAiLCJidW5kbGVJZHMiLCJpc0VtcHR5IiwidXNlckFwcERpclBhdGgiLCJPYmplY3QiLCJlbnRyaWVzIiwiZnMiLCJyZWFkZGlyIiwiZmluZCIsImZpbGUiLCJleHRuYW1lIiwidG9Mb3dlckNhc2UiLCJpbmZvUGxpc3RQYXRoIiwiZXhpc3RzIiwiaW5mb1BsaXN0IiwicGxpc3QiLCJwYXJzZVBsaXN0RmlsZSIsIkNGQnVuZGxlTmFtZSIsInB1c2giLCJlcnIiLCJ3YXJuIiwibWVzc2FnZSIsImdldEFwcERpciIsImlkIiwic3ViRGlyIiwiaXNGcmVzaCIsImFwcGxpY2F0aW9uTGlzdCIsInBhdGhCdW5kbGVQYWlyIiwiZGlyIiwiYXBwRmlsZXMiLCJnbG9iIiwibWF0Y2giLCJyZWFkQnVuZGxlSWQiLCJtZXRhZGF0YSIsInNldHRpbmdzIiwicmVhZCIsIk1DTU1ldGFkYXRhSWRlbnRpZmllciIsImJ1bmRsZVBhdGhEaXJzIiwiYnVuZGxlUGF0aFBhaXJzIiwiYXN5bmNtYXAiLCJyZWR1Y2UiLCJidW5kbGVNYXAiLCJidW5kbGVQYXRoIiwiZGV2aWNlQXJyIiwidG9QYWlycyIsImdldERldmljZXMiLCJkZXZpY2UiLCJmaWxlcyIsInB2IiwibWFwIiwicyIsImV4aXN0ZW5jZXMiLCJmIiwiaGFzQWNjZXNzIiwiZnJlc2giLCJjb21wYWN0IiwiaXNSdW5uaW5nIiwiZ2V0RW52IiwiaXNTaHV0ZG93biIsImluY2x1ZGVzIiwic3RkZXJyIiwid2FpdEZvckJvb3QiLCJib290ZWRJbmRpY2F0b3IiLCJnZXRCb290ZWRJbmRpY2F0b3JTdHJpbmciLCJ0YWlsTG9nc1VudGlsIiwiQiIsImRlbGF5IiwiZW1pdCIsImluZGljYXRvciIsInBsYXRmb3JtVmVyc2lvbiIsInN0YXJ0VUlDbGllbnQiLCJvcHRzIiwiY2xvbmVEZWVwIiwiZGVmYXVsdHNEZWVwIiwic2NhbGVGYWN0b3IiLCJnZXRYY29kZVBhdGgiLCJhcmdzIiwibmFtZSIsImZvcm1hdHRlZERldmljZU5hbWUiLCJyZXBsYWNlIiwiYXJndW1lbnROYW1lIiwiaW5mbyIsImpvaW4iLCJ0aW1lb3V0IiwicnVuIiwiYXNzaWduIiwiaXNTZXJ2ZXJSdW5uaW5nIiwidGltZXIiLCJ0aW1pbmciLCJUaW1lciIsInN0YXJ0Iiwic2h1dGRvd24iLCJnZXREdXJhdGlvbiIsImFzU2Vjb25kcyIsInRvRml4ZWQiLCJjbGVhbiIsImVuZFNpbXVsYXRvckRhZW1vbiIsImVyYXNlRGV2aWNlIiwic2NydWJDdXN0b21BcHAiLCJhcHBCdW5kbGVJZCIsImNsZWFuQ3VzdG9tQXBwIiwic2NydWIiLCJkZWxldGVQcm9taXNlcyIsInJpbXJhZiIsInJlbFJtUGF0aCIsInJtUGF0aCIsImFsbCIsImRpcnMiLCJkYXRhIiwiYnVuZGxlIiwidW5kZWZpbmVkIiwic3JjIiwibGF1bmNoQW5kUXVpdCIsInNhZmFyaSIsImxhdW5jaEFwcCIsIk1PQklMRV9TQUZBUklfQlVORExFX0lEIiwicmV0cnlJbnRlcnZhbCIsIkVycm9yIiwibGF1bmNoY3RsQ21kIiwic3RvcENtZCIsInJlbW92ZUNtZCIsIndhaXRGb3JDb25kaXRpb24iLCJ3YWl0TXMiLCJpbnRlcnZhbE1zIiwic2h1dGRvd25EZXZpY2UiLCJiaW5kIiwiZGVsZXRlIiwiZGVsZXRlRGV2aWNlIiwidXBkYXRlU2V0dGluZ3MiLCJ1cGRhdGVzIiwidXBkYXRlTG9jYXRpb25TZXR0aW5ncyIsImF1dGhvcml6ZWQiLCJzZXRQZXJtaXNzaW9uIiwic2V0UmVkdWNlTW90aW9uIiwicmVkdWNlTW90aW9uIiwic2V0UmVkdWNlVHJhbnNwYXJlbmN5IiwicmVkdWNlVHJhbnNwYXJlbmN5Iiwic2V0QXBwZWFyYW5jZSIsImdldEFwcGVhcmFuY2UiLCJ1cGRhdGVTYWZhcmlTZXR0aW5ncyIsInByb21pc2VzIiwidXBkYXRlU2FmYXJpVXNlclNldHRpbmdzIiwiUExJU1RfSURFTlRJRklFUiIsIk1PQklMRV9TQUZBUkkiLCJzb21lIiwiQm9vbGVhbiIsInVwZGF0ZVNhZmFyaUdsb2JhbFNldHRpbmdzIiwidXBkYXRlTG9jYWxlIiwibGFuZ3VhZ2UiLCJsb2NhbGUiLCJjYWxlbmRhckZvcm1hdCIsImRlbGV0ZVNhZmFyaSIsImNsZWFuU2FmYXJpIiwia2VlcFByZWZzIiwibGlicmFyeURpciIsInNhZmFyaVJvb3QiLCJzYWZhcmlMaWJyYXJ5RGlyIiwiZmlsZXNUb0RlbGV0ZSIsInJlbW92ZUFwcCIsIm1vdmVCdWlsdEluQXBwIiwiYXBwTmFtZSIsImFwcFBhdGgiLCJuZXdBcHBQYXRoIiwic2FmZVJpbVJhZiIsImNvcHlGaWxlIiwib3BlblVybCIsInVybCIsIlNBRkFSSV9CT09URURfSU5ESUNBVE9SIiwiU0FGQVJJX1NUQVJUVVBfVElNRU9VVCIsInJldHJ5IiwiY2xlYXJDYWNoZXMiLCJmb2xkZXJOYW1lcyIsImNhY2hlc1Jvb3QiLCJpdGVtc1RvUmVtb3ZlIiwieCIsImZpbHRlciIsImlzRGlyZWN0b3J5IiwidXRpbCIsInBsdXJhbGl6ZSIsInRpbWVvdXRNcyIsInNpbUxvZyIsInRhaWxVbnRpbCIsImVuYWJsZUNhbGVuZGFyQWNjZXNzIiwiYnVuZGxlSUQiLCJkaXNhYmxlQ2FsZW5kYXJBY2Nlc3MiLCJoYXNDYWxlbmRhckFjY2VzcyIsIl9hY3RpdmF0ZVdpbmRvdyIsInBpZCIsImFjdGl2YXRlQXBwIiwiZXhlY3V0ZVVJQ2xpZW50U2NyaXB0IiwiYXBwbGVTY3JpcHQiLCJ3aW5kb3dBY3RpdmF0aW9uU2NyaXB0IiwicmVzdWx0U2NyaXB0IiwiYWNxdWlyZSIsImVycm9yQW5kVGhyb3ciLCJpc0Jpb21ldHJpY0Vucm9sbGVkIiwib3V0cHV0IiwiaXNTdHJpbmciLCJlbnJvbGxCaW9tZXRyaWMiLCJpc0VuYWJsZWQiLCJzZW5kQmlvbWV0cmljTWF0Y2giLCJzaG91bGRNYXRjaCIsImRpc21pc3NEYXRhYmFzZUFsZXJ0IiwiaW5jcmVhc2UiLCJidXR0b24iLCJiYWNrdXBLZXljaGFpbnMiLCJiYWNrdXBQYXRoIiwidGVtcERpciIsInByZWZpeCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyaW5nIiwic3VmZml4IiwiemlwQXJncyIsInNlcCIsIl9rZXljaGFpbnNCYWNrdXBQYXRoIiwidW5saW5rIiwicmVzdG9yZUtleWNoYWlucyIsImV4Y2x1ZGVQYXR0ZXJucyIsInNwbGl0IiwicGxpc3RQYXRoIiwiZ2V0TGF1bmNoRGFlbW9uc1Jvb3QiLCJzcGF3blByb2Nlc3MiLCJta2RpcnAiLCJ1bnppcEFyZ3MiLCJmbGF0TWFwIiwiY2xlYXJLZXljaGFpbnMiLCJwcyIsInNlcnZpY2VzTWF0Y2giLCJyZXN1bHQiLCJwYXR0ZXJuIiwiZ3JvdXAiLCJ0cmltRW5kIiwicGVybWlzc2lvbiIsInNldFBlcm1pc3Npb25zIiwicGVybWlzc2lvbnNNYXBwaW5nIiwiSlNPTiIsInN0cmluZ2lmeSIsInNldEFjY2VzcyIsImdldFBlcm1pc3Npb24iLCJzZXJ2aWNlTmFtZSIsImdldEFjY2VzcyIsImFkZENlcnRpZmljYXRlIiwicGF5bG9hZCIsImhhc1NTTENlcnQiLCJ0cnVuY2F0ZSIsImluc3RhbGxTU0xDZXJ0IiwicHVzaE5vdGlmaWNhdGlvbiIsImRldlJvb3QiLCJnZXREZXZlbG9wZXJSb290IiwiX2dldERldmljZVN0cmluZ1BsYXRmb3JtVmVyc2lvbiIsInJlcVZlcnNpb24iLCJ4Y29kZSIsImdldE1heElPU1NESyIsIl9nZXREZXZpY2VTdHJpbmdWZXJzaW9uU3RyaW5nIiwiX2dldERldmljZVN0cmluZ0NvbmZpZ0ZpeCIsImdldERldmljZVN0cmluZyIsImRldmljZU5hbWUiLCJmb3JjZUlwaG9uZSIsImZvcmNlSXBhZCIsImxvZ09wdHMiLCJpc2lQaG9uZSIsImluZGV4T2YiLCJpb3NEZXZpY2VTdHJpbmciLCJ0ZXN0IiwiQ09ORklHX0ZJWCIsImNvbmZpZ0ZpeCIsImdldFdlYkluc3BlY3RvclNvY2tldCIsImNtZCIsImZuIiwiZXh0ZW5zaW9ucyIsInByb3RvdHlwZSJdLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9zaW11bGF0b3IteGNvZGUtNi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IGRlZmF1bHQgYXMgeGNvZGUsIGdldFBhdGggYXMgZ2V0WGNvZGVQYXRoIH0gZnJvbSAnYXBwaXVtLXhjb2RlJztcbmltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IHsgZnMsIHRlbXBEaXIsIG1rZGlycCwgcGxpc3QsIHRpbWluZywgdXRpbCB9IGZyb20gJ0BhcHBpdW0vc3VwcG9ydCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IEFzeW5jTG9jayBmcm9tICdhc3luYy1sb2NrJztcbmltcG9ydCB7XG4gIHNhZmVSaW1SYWYsIGdldERldmVsb3BlclJvb3QsIGluc3RhbGxTU0xDZXJ0LCBoYXNTU0xDZXJ0LCBhY3RpdmF0ZUFwcCxcbiAgTU9CSUxFX1NBRkFSSV9CVU5ETEVfSUQsIGxhdW5jaEFwcFxufSBmcm9tICcuL3V0aWxzLmpzJztcbmltcG9ydCB7IGFzeW5jbWFwLCByZXRyeUludGVydmFsLCB3YWl0Rm9yQ29uZGl0aW9uLCByZXRyeSB9IGZyb20gJ2FzeW5jYm94JztcbmltcG9ydCAqIGFzIHNldHRpbmdzIGZyb20gJy4vc2V0dGluZ3MnO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgeyB0YWlsVW50aWwgfSBmcm9tICcuL3RhaWwtdW50aWwuanMnO1xuaW1wb3J0IGV4dGVuc2lvbnMgZnJvbSAnLi9leHRlbnNpb25zL2luZGV4JztcbmltcG9ydCB7IEV2ZW50RW1pdHRlciB9IGZyb20gJ2V2ZW50cyc7XG5pbXBvcnQgQ2FsZW5kYXIgZnJvbSAnLi9jYWxlbmRhcic7XG5pbXBvcnQgUGVybWlzc2lvbnMgZnJvbSAnLi9wZXJtaXNzaW9ucyc7XG5pbXBvcnQgU2ltY3RsIGZyb20gJ25vZGUtc2ltY3RsJztcblxuXG5jb25zdCBTVEFSVFVQX1RJTUVPVVQgPSA2MCAqIDEwMDA7XG5jb25zdCBFWFRSQV9TVEFSVFVQX1RJTUUgPSAyMDAwO1xuY29uc3QgVUlfQ0xJRU5UX0FDQ0VTU19HVUFSRCA9IG5ldyBBc3luY0xvY2soKTtcbmNvbnN0IFVJX0NMSUVOVF9CVU5ETEVfSUQgPSAnY29tLmFwcGxlLmlwaG9uZXNpbXVsYXRvcic7XG5jb25zdCBTUFJJTkdCT0FSRF9CVU5ETEVfSUQgPSAnY29tLmFwcGxlLlNwcmluZ0JvYXJkJztcblxuLypcbiAqIFRoaXMgZXZlbnQgaXMgZW1pdHRlZCBhcyBzb29uIGFzIGlPUyBTaW11bGF0b3JcbiAqIGhhcyBmaW5pc2hlZCBib290aW5nIGFuZCBpdCBpcyByZWFkeSB0byBhY2NlcHQgeGNydW4gY29tbWFuZHMuXG4gKiBUaGUgZXZlbnQgaGFuZGxlciBpcyBjYWxsZWQgYWZ0ZXIgJ3J1bicgbWV0aG9kIGlzIGNvbXBsZXRlZFxuICogZm9yIFhjb2RlIDcgYW5kIG9sZGVyIGFuZCBpcyBvbmx5IHVzZWZ1bCBpbiBYY29kZSA4KyxcbiAqIHNpbmNlIG9uZSBjYW4gc3RhcnQgZG9pbmcgc3R1ZmYgKGZvciBleGFtcGxlIGluc3RhbGwvdW5pbnN0YWxsIGFuIGFwcCkgaW4gcGFyYWxsZWxcbiAqIHdpdGggU2ltdWxhdG9yIFVJIHN0YXJ0dXAsIHdoaWNoIHNob3J0ZW5zIHNlc3Npb24gc3RhcnR1cCB0aW1lLlxuICovXG5jb25zdCBCT09UX0NPTVBMRVRFRF9FVkVOVCA9ICdib290Q29tcGxldGVkJztcblxuXG5jbGFzcyBTaW11bGF0b3JYY29kZTYgZXh0ZW5kcyBFdmVudEVtaXR0ZXIge1xuXG4gIC8qKlxuICAgKiBDb25zdHJ1Y3RzIHRoZSBvYmplY3Qgd2l0aCB0aGUgYHVkaWRgIGFuZCB2ZXJzaW9uIG9mIFhjb2RlLiBVc2UgdGhlIGV4cG9ydGVkIGBnZXRTaW11bGF0b3IodWRpZClgIG1ldGhvZCBpbnN0ZWFkLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIFRoZSBTaW11bGF0b3IgSUQuXG4gICAqIEBwYXJhbSB7b2JqZWN0fSB4Y29kZVZlcnNpb24gLSBUaGUgdGFyZ2V0IFhjb2RlIHZlcnNpb24gaW4gZm9ybWF0IHttYWpvciwgbWlub3IsIGJ1aWxkfS5cbiAgICovXG4gIGNvbnN0cnVjdG9yICh1ZGlkLCB4Y29kZVZlcnNpb24pIHtcbiAgICBzdXBlcigpO1xuXG4gICAgdGhpcy51ZGlkID0gU3RyaW5nKHVkaWQpO1xuICAgIHRoaXMuc2ltY3RsID0gbmV3IFNpbWN0bCh7XG4gICAgICB1ZGlkOiB0aGlzLnVkaWQsXG4gICAgfSk7XG4gICAgdGhpcy54Y29kZVZlcnNpb24gPSB4Y29kZVZlcnNpb247XG5cbiAgICAvLyBwbGF0Zm9ybVZlcnNpb24gY2Fubm90IGJlIGZvdW5kIGluaXRpYWxseSwgc2luY2UgZ2V0dGluZyBpdCBoYXMgc2lkZSBlZmZlY3RzIGZvclxuICAgIC8vIG91ciBsb2dpYyBmb3IgZmlndXJpbmcgb3V0IGlmIGEgc2ltIGhhcyBiZWVuIHJ1blxuICAgIC8vIGl0IHdpbGwgYmUgc2V0IHdoZW4gaXQgaXMgbmVlZGVkXG4gICAgdGhpcy5fcGxhdGZvcm1WZXJzaW9uID0gbnVsbDtcblxuICAgIHRoaXMua2V5Y2hhaW5QYXRoID0gcGF0aC5yZXNvbHZlKHRoaXMuZ2V0RGlyKCksICdMaWJyYXJ5JywgJ0tleWNoYWlucycpO1xuICAgIHRoaXMuc2ltdWxhdG9yQXBwID0gJ2lPUyBTaW11bGF0b3IuYXBwJztcblxuICAgIHRoaXMuYXBwRGF0YUJ1bmRsZVBhdGhzID0ge307XG5cbiAgICAvLyBsaXN0IG9mIGZpbGVzIHRvIGNoZWNrIGZvciB3aGVuIHNlZWluZyBpZiBhIHNpbXVsYXRvciBpcyBcImZyZXNoXCJcbiAgICAvLyAobWVhbmluZyBpdCBoYXMgbmV2ZXIgYmVlbiBib290ZWQpLlxuICAgIC8vIElmIHRoZXNlIGZpbGVzIGFyZSBwcmVzZW50LCB3ZSBhc3N1bWUgaXQncyBiZWVuIHN1Y2Nlc3NmdWxseSBib290ZWRcbiAgICB0aGlzLmlzRnJlc2hGaWxlcyA9IFtcbiAgICAgICdMaWJyYXJ5L0NvbmZpZ3VyYXRpb25Qcm9maWxlcycsXG4gICAgICAnTGlicmFyeS9Db29raWVzJyxcbiAgICAgICdMaWJyYXJ5L1ByZWZlcmVuY2VzLy5HbG9iYWxQcmVmZXJlbmNlcy5wbGlzdCcsXG4gICAgICAnTGlicmFyeS9QcmVmZXJlbmNlcy9jb20uYXBwbGUuc3ByaW5nYm9hcmQucGxpc3QnLFxuICAgICAgJ3Zhci9ydW4vc3lzbG9nLnBpZCdcbiAgICBdO1xuXG4gICAgLy8gZXh0cmEgdGltZSB0byB3YWl0IGZvciBzaW11bGF0b3IgdG8gYmUgZGVlbWVkIGJvb3RlZFxuICAgIHRoaXMuZXh0cmFTdGFydHVwVGltZSA9IEVYVFJBX1NUQVJUVVBfVElNRTtcblxuICAgIHRoaXMuY2FsZW5kYXIgPSBuZXcgQ2FsZW5kYXIoeGNvZGVWZXJzaW9uLCB0aGlzLmdldERpcigpKTtcbiAgICB0aGlzLnBlcm1pc3Npb25zID0gbmV3IFBlcm1pc3Npb25zKHhjb2RlVmVyc2lvbiwgdGhpcy5nZXREaXIoKSwgdGhpcy51ZGlkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IEJ1bmRsZSBpZGVudGlmaWVyIG9mIFNpbXVsYXRvciBVSSBjbGllbnQuXG4gICAqL1xuICBnZXQgdWlDbGllbnRCdW5kbGVJZCAoKSB7XG4gICAgcmV0dXJuIFVJX0NMSUVOVF9CVU5ETEVfSUQ7XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybiB7P3N0cmluZ30gVGhlIGZ1bGwgcGF0aCB0byB0aGUgZGV2aWNlcyBzZXQgd2hlcmUgdGhlIGN1cnJlbnQgc2ltdWxhdG9yIGlzIGxvY2F0ZWQuXG4gICAqIGBudWxsYCB2YWx1ZSBtZWFucyB0aGF0IHRoZSBkZWZhdWx0IHBhdGggaXMgdXNlZCwgd2hpY2ggaXMgdXN1YWxseSBgfi9MaWJyYXJ5L0RldmVsb3Blci9Db3JlU2ltdWxhdG9yL0RldmljZXNgXG4gICAqL1xuICBnZXQgZGV2aWNlc1NldFBhdGggKCkge1xuICAgIHJldHVybiB0aGlzLnNpbWN0bC5kZXZpY2VzU2V0UGF0aDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIGZ1bGwgcGF0aCB0byB0aGUgZGV2aWNlcyBzZXQuIEl0IGlzIHJlY29tbWVuZGVkIHRvIHNldCB0aGlzIHZhbHVlXG4gICAqIG9uY2UgcmlnaHQgYWZ0ZXIgU2ltdWxhdG9yIGluc3RhbmNlIGlzIGNyZWF0ZWQgYW5kIHRvIG5vdCBjaGFuZ2UgaXQgZHVyaW5nXG4gICAqIHRoZSBpbnN0YW5jZSBsaWZlY3ljbGVcbiAgICpcbiAgICogQHBhcmFtIHs/c3RyaW5nfSB2YWx1ZSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBkZXZpY2VzIHNldCByb290IG9uIHRoZVxuICAgKiBsb2NhbCBmaWxlIHN5c3RlbVxuICAgKi9cbiAgc2V0IGRldmljZXNTZXRQYXRoICh2YWx1ZSkge1xuICAgIHRoaXMuc2ltY3RsLmRldmljZXNTZXRQYXRoID0gdmFsdWU7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIHRoZSBjdXJyZW50IHByb2Nlc3MgaWQgb2YgdGhlIFVJIGNsaWVudFxuICAgKlxuICAgKiBAcmV0dXJuIHs/c3RyaW5nfSBUaGUgcHJvY2VzcyBJRCBvciBudWxsIGlmIHRoZSBVSSBjbGllbnQgaXMgbm90IHJ1bm5pbmdcbiAgICovXG4gIGFzeW5jIGdldFVJQ2xpZW50UGlkICgpIHtcbiAgICBsZXQgc3Rkb3V0O1xuICAgIHRyeSB7XG4gICAgICAoe3N0ZG91dH0gPSBhd2FpdCBleGVjKCdwZ3JlcCcsIFsnLWZuJywgYCR7dGhpcy5zaW11bGF0b3JBcHB9L0NvbnRlbnRzL01hY09TL2BdKSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGlmIChpc05hTihwYXJzZUludChzdGRvdXQsIDEwKSkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBzdGRvdXQgPSBzdGRvdXQudHJpbSgpO1xuICAgIGxvZy5kZWJ1ZyhgR290IFNpbXVsYXRvciBVSSBjbGllbnQgUElEOiAke3N0ZG91dH1gKTtcbiAgICByZXR1cm4gc3Rkb3V0O1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIHRoZSBzdGF0ZSBvZiBTaW11bGF0b3IgVUkgY2xpZW50LlxuICAgKlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIG9mIGlmIFVJIGNsaWVudCBpcyBydW5uaW5nIG9yIGZhbHNlIG90aGVyd2lzZS5cbiAgICovXG4gIGFzeW5jIGlzVUlDbGllbnRSdW5uaW5nICgpIHtcbiAgICByZXR1cm4gIV8uaXNOdWxsKGF3YWl0IHRoaXMuZ2V0VUlDbGllbnRQaWQoKSk7XG4gIH1cblxuICAvKipcbiAgICogSG93IGxvbmcgdG8gd2FpdCBiZWZvcmUgdGhyb3dpbmcgYW4gZXJyb3IgYWJvdXQgU2ltdWxhdG9yIHN0YXJ0dXAgdGltZW91dCBoYXBwZW5lZC5cbiAgICpcbiAgICogQHJldHVybiB7bnVtYmVyfSBUaGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcy5cbiAgICovXG4gIGdldCBzdGFydHVwVGltZW91dCAoKSB7XG4gICAgcmV0dXJuIFNUQVJUVVBfVElNRU9VVDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHBsYXRmb3JtIHZlcnNpb24gb2YgdGhlIGN1cnJlbnQgU2ltdWxhdG9yLlxuICAgKlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFNESyB2ZXJzaW9uLCBmb3IgZXhhbXBsZSAnOC4zJy5cbiAgICovXG4gIGFzeW5jIGdldFBsYXRmb3JtVmVyc2lvbiAoKSB7XG4gICAgaWYgKCF0aGlzLl9wbGF0Zm9ybVZlcnNpb24pIHtcbiAgICAgIGxldCB7c2RrfSA9IGF3YWl0IHRoaXMuc3RhdCgpO1xuICAgICAgdGhpcy5fcGxhdGZvcm1WZXJzaW9uID0gc2RrO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fcGxhdGZvcm1WZXJzaW9uO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIHRoZSBmdWxsIHBhdGggdG8gdGhlIGRpcmVjdG9yeSB3aGVyZSBTaW11bGF0b3Igc3R1ZmYgaXMgbG9jYXRlZC5cbiAgICpcbiAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgcGF0aCBzdHJpbmcuXG4gICAqL1xuICBnZXRSb290RGlyICgpIHtcbiAgICBsZXQgaG9tZSA9IHByb2Nlc3MuZW52LkhPTUU7XG4gICAgcmV0dXJuIHBhdGgucmVzb2x2ZShob21lLCAnTGlicmFyeScsICdEZXZlbG9wZXInLCAnQ29yZVNpbXVsYXRvcicsICdEZXZpY2VzJyk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgdGhlIGZ1bGwgcGF0aCB0byB0aGUgZGlyZWN0b3J5IHdoZXJlIFNpbXVsYXRvciBhcHBsaWNhdGlvbnMgZGF0YSBpcyBsb2NhdGVkLlxuICAgKlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBwYXRoIHN0cmluZy5cbiAgICovXG4gIGdldERpciAoKSB7XG4gICAgcmV0dXJuIHBhdGgucmVzb2x2ZSh0aGlzLmdldFJvb3REaXIoKSwgdGhpcy51ZGlkLCAnZGF0YScpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIHRoZSBmdWxsIHBhdGggdG8gdGhlIGRpcmVjdG9yeSB3aGVyZSBTaW11bGF0b3IgbG9ncyBhcmUgc3RvcmVkLlxuICAgKlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBwYXRoIHN0cmluZy5cbiAgICovXG4gIGdldExvZ0RpciAoKSB7XG4gICAgbGV0IGhvbWUgPSBwcm9jZXNzLmVudi5IT01FO1xuICAgIHJldHVybiBwYXRoLnJlc29sdmUoaG9tZSwgJ0xpYnJhcnknLCAnTG9ncycsICdDb3JlU2ltdWxhdG9yJywgdGhpcy51ZGlkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbnN0YWxsIHZhbGlkIC5hcHAgcGFja2FnZSBvbiBTaW11bGF0b3IuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHAgLSBUaGUgcGF0aCB0byB0aGUgLmFwcCBwYWNrYWdlLlxuICAgKi9cbiAgYXN5bmMgaW5zdGFsbEFwcCAoYXBwKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuc2ltY3RsLmluc3RhbGxBcHAoYXBwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZnkgd2hldGhlciB0aGUgcGFydGljdWxhciBhcHBsaWNhdGlvbiBpcyBpbnN0YWxsZWQgb24gU2ltdWxhdG9yLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSWQgLSBUaGUgYnVuZGxlIGlkIG9mIHRoZSBhcHBsaWNhdGlvbiB0byBiZSBjaGVja2VkLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwRnVsZSAtIEFwcGxpY2F0aW9uIG5hbWUgbWludXMgXCIuYXBwXCIgKGZvciBpT1MgNy4xKVxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBnaXZlbiBhcHBsaWNhdGlvbiBpcyBpbnN0YWxsZWRcbiAgICovXG4gIGFzeW5jIGlzQXBwSW5zdGFsbGVkIChidW5kbGVJZCwgYXBwRmlsZSA9IG51bGwpIHtcbiAgICAvLyBgYXBwRmlsZWAgYXJndW1lbnQgb25seSBuZWNlc3NhcnkgZm9yIGlPUyBiZWxvdyB2ZXJzaW9uIDhcbiAgICBsZXQgYXBwRGlycyA9IGF3YWl0IHRoaXMuZ2V0QXBwRGlycyhhcHBGaWxlLCBidW5kbGVJZCk7XG4gICAgcmV0dXJuIGFwcERpcnMubGVuZ3RoICE9PSAwO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdXNlciBpbnN0YWxsZWQgYnVuZGxlIGlkcyB3aGljaCBoYXMgJ2J1bmRsZU5hbWUnIGluIHRoZWlyIEluZm8uUGxpc3QgYXMgJ0NGQnVuZGxlTmFtZSdcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gVGhlIGJ1bmRsZSBpZCBvZiB0aGUgYXBwbGljYXRpb24gdG8gYmUgY2hlY2tlZC5cbiAgICogQHJldHVybiB7YXJyYXk8c3RyaW5nPn0gLSBUaGUgbGlzdCBvZiBidW5kbGUgaWRzIHdoaWNoIGhhdmUgJ2J1bmRsZU5hbWUnXG4gICAqL1xuICBhc3luYyBnZXRVc2VySW5zdGFsbGVkQnVuZGxlSWRzQnlCdW5kbGVOYW1lIChidW5kbGVOYW1lKSB7XG4gICAgY29uc3Qgcm9vdFVzZXJBcHBEaXIgPSBhd2FpdCB0aGlzLmJ1aWxkQnVuZGxlUGF0aE1hcCgnQnVuZGxlJyk7XG4gICAgY29uc3QgYnVuZGxlSWRzID0gW107XG4gICAgaWYgKF8uaXNFbXB0eShyb290VXNlckFwcERpcikpIHtcbiAgICAgIHJldHVybiBidW5kbGVJZHM7XG4gICAgfVxuXG4gICAgZm9yIChjb25zdCBbYnVuZGxlSWQsIHVzZXJBcHBEaXJQYXRoXSBvZiBPYmplY3QuZW50cmllcyhyb290VXNlckFwcERpcikpIHtcbiAgICAgIGNvbnN0IGFwcEZpbGUgPSAoYXdhaXQgZnMucmVhZGRpcih1c2VyQXBwRGlyUGF0aCkpLmZpbmQoXG4gICAgICAgIChmaWxlKSA9PiBwYXRoLmV4dG5hbWUoZmlsZSkudG9Mb3dlckNhc2UoKSA9PT0gJy5hcHAnKTtcbiAgICAgIGNvbnN0IGluZm9QbGlzdFBhdGggPSBwYXRoLnJlc29sdmUodXNlckFwcERpclBhdGgsIGFwcEZpbGUsICdJbmZvLnBsaXN0Jyk7XG4gICAgICBpZiAoIWF3YWl0IGZzLmV4aXN0cyhpbmZvUGxpc3RQYXRoKSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGluZm9QbGlzdCA9IGF3YWl0IHBsaXN0LnBhcnNlUGxpc3RGaWxlKGluZm9QbGlzdFBhdGgsIGZhbHNlKTtcbiAgICAgICAgaWYgKGluZm9QbGlzdC5DRkJ1bmRsZU5hbWUgPT09IGJ1bmRsZU5hbWUpIHtcbiAgICAgICAgICBidW5kbGVJZHMucHVzaChidW5kbGVJZCk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBsb2cud2FybihgRmFpbGVkIHRvIHJlYWQgcGxpc3QgJHtpbmZvUGxpc3RQYXRofS4gT3JpZ2luYWwgZXJyb3IgJyR7ZXJyLm1lc3NhZ2V9J2ApO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgbG9nLmRlYnVnKGBUaGUgc2ltdWxhdG9yIGhhcyAnJHtidW5kbGVJZHMubGVuZ3RofScgYnVuZGxlcyB3aGljaCBoYXZlICcke2J1bmRsZU5hbWV9JyBhcyB0aGVpciAnQ0ZCdW5kbGVOYW1lJzpgKTtcbiAgICBmb3IgKGNvbnN0IGJ1bmRsZUlkIG9mIGJ1bmRsZUlkcykge1xuICAgICAgbG9nLmRlYnVnKGAgICAgJyR7YnVuZGxlSWR9J2ApO1xuICAgIH1cbiAgICByZXR1cm4gYnVuZGxlSWRzO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIHRoZSBkaXJlY3RvcnkgZm9yIGEgcGFydGljdWxhciBhcHBsaWNhdGlvbidzIGRhdGEuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBpZCAtIEVpdGhlciBhIGJ1bmRsZUlkIChlLmcuLCBjb20uYXBwbGUubW9iaWxlc2FmYXJpKSBvciwgZm9yIGlPUyA3LjEsIHRoZSBhcHAgbmFtZSB3aXRob3V0IGAuYXBwYCAoZS5nLiwgTW9iaWxlU2FmYXJpKVxuICAgKiBAcGFyYW0ge3N0cmluZ30gc3ViZGlyIC0gVGhlIHN1Yi1kaXJlY3Rvcnkgd2UgZXhwZWN0IHRvIGJlIHdpdGhpbiB0aGUgYXBwbGljYXRpb24gZGlyZWN0b3J5LiBEZWZhdWx0cyB0byBcIkRhdGFcIi5cbiAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgcm9vdCBhcHBsaWNhdGlvbiBmb2xkZXIuXG4gICAqL1xuICBhc3luYyBnZXRBcHBEaXIgKGlkLCBzdWJEaXIgPSAnRGF0YScpIHtcbiAgICB0aGlzLmFwcERhdGFCdW5kbGVQYXRoc1tzdWJEaXJdID0gdGhpcy5hcHBEYXRhQnVuZGxlUGF0aHNbc3ViRGlyXSB8fCB7fTtcbiAgICBpZiAoXy5pc0VtcHR5KHRoaXMuYXBwRGF0YUJ1bmRsZVBhdGhzW3N1YkRpcl0pICYmICFhd2FpdCB0aGlzLmlzRnJlc2goKSkge1xuICAgICAgdGhpcy5hcHBEYXRhQnVuZGxlUGF0aHNbc3ViRGlyXSA9IGF3YWl0IHRoaXMuYnVpbGRCdW5kbGVQYXRoTWFwKHN1YkRpcik7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmFwcERhdGFCdW5kbGVQYXRoc1tzdWJEaXJdW2lkXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgeGNvZGUgNiBzaW11bGF0b3JzIGFyZSByZWFsbHkgYW5ub3lpbmcsIGFuZCBidXJ5IHRoZSBtYWluIGFwcFxuICAgKiBkaXJlY3RvcmllcyBpbnNpZGUgZGlyZWN0b3JpZXMganVzdCBuYW1lZCB3aXRoIEhhc2hlcy5cbiAgICogVGhpcyBmdW5jdGlvbiBmaW5kcyB0aGUgcHJvcGVyIGRpcmVjdG9yeSBieSB0cmF2ZXJzaW5nIGFsbCBvZiB0aGVtXG4gICAqIGFuZCByZWFkaW5nIGEgbWV0YWRhdGEgcGxpc3QgKE1vYmlsZSBDb250YWluZXIgTWFuYWdlcikgdG8gZ2V0IHRoZVxuICAgKiBidW5kbGUgaWQuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzdWJkaXIgLSBUaGUgc3ViLWRpcmVjdG9yeSB3ZSBleHBlY3QgdG8gYmUgd2l0aGluIHRoZSBhcHBsaWNhdGlvbiBkaXJlY3RvcnkuIERlZmF1bHRzIHRvIFwiRGF0YVwiLlxuICAgKiBAcmV0dXJuIHtvYmplY3R9IFRoZSBsaXN0IG9mIHBhdGgtYnVuZGxlIHBhaXJzIHRvIGFuIG9iamVjdCB3aGVyZSBidW5kbGVJZHMgYXJlIG1hcHBlZCB0byBwYXRocy5cbiAgICovXG4gIGFzeW5jIGJ1aWxkQnVuZGxlUGF0aE1hcCAoc3ViRGlyID0gJ0RhdGEnKSB7XG4gICAgbG9nLmRlYnVnKCdCdWlsZGluZyBidW5kbGUgcGF0aCBtYXAnKTtcbiAgICBsZXQgYXBwbGljYXRpb25MaXN0O1xuICAgIGxldCBwYXRoQnVuZGxlUGFpcjtcbiAgICBpZiAoYXdhaXQgdGhpcy5nZXRQbGF0Zm9ybVZlcnNpb24oKSA9PT0gJzcuMScpIHtcbiAgICAgIC8vIGFwcHMgYXZhaWxhYmxlXG4gICAgICAvLyAgIFdlYi5hcHAsXG4gICAgICAvLyAgIFdlYlZpZXdTZXJ2aWNlLmFwcCxcbiAgICAgIC8vICAgTW9iaWxlU2FmYXJpLmFwcCxcbiAgICAgIC8vICAgV2ViQ29udGVudEFuYWx5c2lzVUkuYXBwLFxuICAgICAgLy8gICBEREFjdGlvbnNTZXJ2aWNlLmFwcCxcbiAgICAgIC8vICAgU3RvcmVLaXRVSVNlcnZpY2UuYXBwXG4gICAgICBhcHBsaWNhdGlvbkxpc3QgPSBwYXRoLnJlc29sdmUodGhpcy5nZXREaXIoKSwgJ0FwcGxpY2F0aW9ucycpO1xuICAgICAgcGF0aEJ1bmRsZVBhaXIgPSBhc3luYyAoZGlyKSA9PiB7XG4gICAgICAgIGRpciA9IHBhdGgucmVzb2x2ZShhcHBsaWNhdGlvbkxpc3QsIGRpcik7XG4gICAgICAgIGxldCBhcHBGaWxlcyA9IGF3YWl0IGZzLmdsb2IoYCR7ZGlyfS8qLmFwcGApO1xuICAgICAgICBsZXQgYnVuZGxlSWQgPSBhcHBGaWxlc1swXS5tYXRjaCgvLipcXC8oLiopXFwuYXBwLylbMV07XG4gICAgICAgIHJldHVybiB7cGF0aDogZGlyLCBidW5kbGVJZH07XG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBhcHBsaWNhdGlvbkxpc3QgPSBwYXRoLnJlc29sdmUodGhpcy5nZXREaXIoKSwgJ0NvbnRhaW5lcnMnLCBzdWJEaXIsICdBcHBsaWNhdGlvbicpO1xuICAgICAgLy8gZ2l2ZW4gYSBkaXJlY3RvcnksIGZpbmQgdGhlIHBsaXN0IGZpbGUgYW5kIHB1bGwgdGhlIGJ1bmRsZSBpZCBmcm9tIGl0XG4gICAgICBsZXQgcmVhZEJ1bmRsZUlkID0gYXN5bmMgKGRpcikgPT4ge1xuICAgICAgICBsZXQgcGxpc3QgPSBwYXRoLnJlc29sdmUoZGlyLCAnLmNvbS5hcHBsZS5tb2JpbGVfY29udGFpbmVyX21hbmFnZXIubWV0YWRhdGEucGxpc3QnKTtcbiAgICAgICAgbGV0IG1ldGFkYXRhID0gYXdhaXQgc2V0dGluZ3MucmVhZChwbGlzdCk7XG4gICAgICAgIHJldHVybiBtZXRhZGF0YS5NQ01NZXRhZGF0YUlkZW50aWZpZXI7XG4gICAgICB9O1xuICAgICAgLy8gZ2l2ZW4gYSBkaXJlY3RvcnksIHJldHVybiB0aGUgcGF0aCBhbmQgYnVuZGxlIGlkIGFzc29jaWF0ZWQgd2l0aCBpdFxuICAgICAgcGF0aEJ1bmRsZVBhaXIgPSBhc3luYyAoZGlyKSA9PiB7XG4gICAgICAgIGRpciA9IHBhdGgucmVzb2x2ZShhcHBsaWNhdGlvbkxpc3QsIGRpcik7XG4gICAgICAgIGxldCBidW5kbGVJZCA9IGF3YWl0IHJlYWRCdW5kbGVJZChkaXIpO1xuICAgICAgICByZXR1cm4ge3BhdGg6IGRpciwgYnVuZGxlSWR9O1xuICAgICAgfTtcbiAgICB9XG5cbiAgICBpZiAoIWF3YWl0IGZzLmV4aXN0cyhhcHBsaWNhdGlvbkxpc3QpKSB7XG4gICAgICBsb2cud2FybihgTm8gZGlyZWN0b3J5IHBhdGggJyR7YXBwbGljYXRpb25MaXN0fSdgKTtcbiAgICAgIHJldHVybiB7fTtcbiAgICB9XG5cbiAgICBsZXQgYnVuZGxlUGF0aERpcnMgPSBhd2FpdCBmcy5yZWFkZGlyKGFwcGxpY2F0aW9uTGlzdCk7XG4gICAgbGV0IGJ1bmRsZVBhdGhQYWlycyA9IGF3YWl0IGFzeW5jbWFwKGJ1bmRsZVBhdGhEaXJzLCBhc3luYyBmdW5jdGlvbiAoZGlyKSB7XG4gICAgICByZXR1cm4gYXdhaXQgcGF0aEJ1bmRsZVBhaXIoZGlyKTtcbiAgICB9LCBmYWxzZSk7XG5cbiAgICAvLyByZWR1Y2UgdGhlIGxpc3Qgb2YgcGF0aC1idW5kbGUgcGFpcnMgdG8gYW4gb2JqZWN0IHdoZXJlIGJ1bmRsZUlkcyBhcmUgbWFwcGVkIHRvIHBhdGhzXG4gICAgcmV0dXJuIGJ1bmRsZVBhdGhQYWlycy5yZWR1Y2UoKGJ1bmRsZU1hcCwgYnVuZGxlUGF0aCkgPT4ge1xuICAgICAgYnVuZGxlTWFwW2J1bmRsZVBhdGguYnVuZGxlSWRdID0gYnVuZGxlUGF0aC5wYXRoO1xuICAgICAgcmV0dXJuIGJ1bmRsZU1hcDtcbiAgICB9LCB7fSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBzdGF0ZSBhbmQgc3BlY2lmaWNzIG9mIHRoaXMgc2ltLlxuICAgKlxuICAgKiBAcmV0dXJuIHtvYmplY3R9IFNpbXVsYXRvciBzdGF0cyBtYXBwaW5nLCBmb3IgZXhhbXBsZTpcbiAgICogeyBuYW1lOiAnaVBob25lIDRzJyxcbiAgICogICB1ZGlkOiAnQzA5QjM0RTUtN0RDQi00NDJFLUI3OUMtQUI2QkMwMzU3NDE3JyxcbiAgICogICBzdGF0ZTogJ1NodXRkb3duJyxcbiAgICogICBzZGs6ICc4LjMnXG4gICAqIH1cbiAgICovXG4gIGFzeW5jIHN0YXQgKCkge1xuICAgIGZvciAobGV0IFtzZGssIGRldmljZUFycl0gb2YgXy50b1BhaXJzKGF3YWl0IHRoaXMuc2ltY3RsLmdldERldmljZXMoKSkpIHtcbiAgICAgIGZvciAobGV0IGRldmljZSBvZiBkZXZpY2VBcnIpIHtcbiAgICAgICAgaWYgKGRldmljZS51ZGlkID09PSB0aGlzLnVkaWQpIHtcbiAgICAgICAgICBkZXZpY2Uuc2RrID0gc2RrO1xuICAgICAgICAgIHJldHVybiBkZXZpY2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge307XG4gIH1cblxuICAvKipcbiAgICogVGhpcyBpcyBhIGJlc3QtYmV0IGhldXJpc3RpYyBmb3Igd2hldGhlciBvciBub3QgYSBzaW0gaGFzIGJlZW4gYm9vdGVkXG4gICAqIGJlZm9yZS4gV2UgdXN1YWxseSB3YW50IHRvIHN0YXJ0IGEgc2ltdWxhdG9yIHRvIFwid2FybVwiIGl0IHVwLCBoYXZlXG4gICAqIFhjb2RlIHBvcHVsYXRlIGl0IHdpdGggcGxpc3RzIGZvciB1cyB0byBtYW5pcHVsYXRlIGJlZm9yZSBhIHJlYWxcbiAgICogdGVzdCBydW4uXG4gICAqXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdGhlIGN1cnJlbnQgU2ltdWxhdG9yIGhhcyBuZXZlciBiZWVuIHN0YXJ0ZWQgYmVmb3JlXG4gICAqL1xuICBhc3luYyBpc0ZyZXNoICgpIHtcbiAgICAvLyBpZiB0aGUgZm9sbG93aW5nIGZpbGVzIGRvbid0IGV4aXN0LCBpdCBoYXNuJ3QgYmVlbiBib290ZWQuXG4gICAgLy8gVEhJUyBJUyBOT1QgQU4gRVhIQVVTVElWRSBMSVNUXG4gICAgbGV0IGZpbGVzID0gdGhpcy5pc0ZyZXNoRmlsZXM7XG5cbiAgICBsZXQgcHYgPSBhd2FpdCB0aGlzLmdldFBsYXRmb3JtVmVyc2lvbigpO1xuICAgIGlmIChwdiAhPT0gJzcuMScpIHtcbiAgICAgIGZpbGVzLnB1c2goJ0xpYnJhcnkvUHJlZmVyZW5jZXMvY29tLmFwcGxlLlByZWZlcmVuY2VzLnBsaXN0Jyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZpbGVzLnB1c2goJ0FwcGxpY2F0aW9ucycpO1xuICAgIH1cblxuICAgIGNvbnN0IGRpciA9IHRoaXMuZ2V0RGlyKCk7XG4gICAgZmlsZXMgPSBmaWxlcy5tYXAoKHMpID0+IHBhdGgucmVzb2x2ZShkaXIsIHMpKTtcblxuICAgIGNvbnN0IGV4aXN0ZW5jZXMgPSBhd2FpdCBhc3luY21hcChmaWxlcywgYXN5bmMgKGYpID0+IGF3YWl0IGZzLmhhc0FjY2VzcyhmKSk7XG4gICAgY29uc3QgZnJlc2ggPSBfLmNvbXBhY3QoZXhpc3RlbmNlcykubGVuZ3RoICE9PSBmaWxlcy5sZW5ndGg7XG4gICAgbG9nLmRlYnVnKGBDaGVja2luZyB3aGV0aGVyIHNpbXVsYXRvciBoYXMgYmVlbiBydW4gYmVmb3JlOiAke2ZyZXNoID8gJ25vJyA6ICd5ZXMnfWApO1xuXG4gICAgcmV0dXJuIGZyZXNoO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyB0aGUgc3RhdGUgb2YgdGhlIGN1cnJlbnQgU2ltdWxhdG9yLiBPbmUgc2hvdWxkIGRpc3Rpbmd1aXNoIHRoZVxuICAgKiBzdGF0ZXMgb2YgU2ltdWxhdG9yIFVJIGFuZCB0aGUgU2ltdWxhdG9yIGl0c2VsZi5cbiAgICpcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgY3VycmVudCBTaW11bGF0b3IgaXMgcnVubmluZy5cbiAgICovXG4gIGFzeW5jIGlzUnVubmluZyAoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuc2ltY3RsLmdldEVudignZHVtbXknKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2tzIGlmIHRoZSBzaW11bGF0b3IgaXMgaW4gc2h1dGRvd24gc3RhdGUuXG4gICAqIFRoaXMgbWV0aG9kIGlzIG5lY2Vzc2FyeSwgYmVjYXVzZSBTaW11bGF0b3IgbWlnaHQgYWxzbyBiZVxuICAgKiBpbiB0aGUgdHJhbnNpdGlvbmFsIFNodXR0aW5nIERvd24gc3RhdGUgcmlnaHQgYWZ0ZXIgdGhlIGBzaHV0ZG93bmBcbiAgICogY29tbWFuZCBoYXMgYmVlbiBpc3N1ZWQuXG4gICAqXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdGhlIGN1cnJlbnQgU2ltdWxhdG9yIGlzIHNodXQgZG93bi5cbiAgICovXG4gIGFzeW5jIGlzU2h1dGRvd24gKCkge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLnNpbWN0bC5nZXRFbnYoJ2R1bW15Jyk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIF8uaW5jbHVkZXMoZS5zdGRlcnIsICdDdXJyZW50IHN0YXRlOiBTaHV0ZG93bicpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZnkgd2hldGhlciB0aGUgU2ltdWxhdG9yIGJvb3RpbmcgaXMgY29tcGxldGVkIGFuZC9vciB3YWl0IGZvciBpdFxuICAgKiB1bnRpbCB0aGUgdGltZW91dCBleHBpcmVzLlxuICAgKlxuICAgKiBAcGFyYW0ge251bWJlcn0gc3RhcnR1cFRpbWVvdXQgLSB0aGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IHVudGlsIGJvb3RpbmcgaXMgY29tcGxldGVkLlxuICAgKiBAZW1pdHMgQk9PVF9DT01QTEVURURfRVZFTlQgaWYgdGhlIGN1cnJlbnQgU2ltdWxhdG9yIGlzIHJlYWR5IHRvIGFjY2VwdCBzaW1jdGwgY29tbWFuZHMsIGxpa2UgJ2luc3RhbGwnLlxuICAgKi9cbiAgYXN5bmMgd2FpdEZvckJvb3QgKHN0YXJ0dXBUaW1lb3V0KSB7XG4gICAgLy8gd2FpdCBmb3IgdGhlIHNpbXVsYXRvciB0byBib290XG4gICAgLy8gd2FpdGluZyBmb3IgdGhlIHNpbXVsYXRvciBzdGF0dXMgdG8gYmUgJ2Jvb3RlZCcgaXNuJ3QgZ29vZCBlbm91Z2hcbiAgICAvLyBpdCBjbGFpbXMgdG8gYmUgYm9vdGVkIHdheSBiZWZvcmUgZmluaXNoaW5nIGxvYWRpbmdcbiAgICAvLyBsZXQncyB0YWlsIHRoZSBzaW11bGF0b3Igc3lzdGVtIGxvZyB1bnRpbCB3ZSBzZWUgYSBtYWdpYyBsaW5lICh0aGlzLmJvb3RlZEluZGljYXRvcilcbiAgICBsZXQgYm9vdGVkSW5kaWNhdG9yID0gYXdhaXQgdGhpcy5nZXRCb290ZWRJbmRpY2F0b3JTdHJpbmcoKTtcbiAgICBhd2FpdCB0aGlzLnRhaWxMb2dzVW50aWwoYm9vdGVkSW5kaWNhdG9yLCBzdGFydHVwVGltZW91dCk7XG5cbiAgICAvLyBzbyBzb3JyeSwgYnV0IHdlIHNob3VsZCB3YWl0IGFub3RoZXIgdHdvIHNlY29uZHMsIGp1c3QgdG8gbWFrZSBzdXJlIHdlJ3ZlIHJlYWxseSBzdGFydGVkXG4gICAgLy8gd2UgY2FuJ3QgbG9vayBmb3IgYW5vdGhlciBtYWdpYyBsb2cgbGluZSwgYmVjYXVzZSB0aGV5IHNlZW0gdG8gYmUgYXBwLWRlcGVuZGVudCAobm90IHN5c3RlbSBkZXBlbmRlbnQpXG4gICAgbG9nLmRlYnVnKGBXYWl0aW5nIGFuIGV4dHJhICR7dGhpcy5leHRyYVN0YXJ0dXBUaW1lfW1zIGZvciB0aGUgc2ltdWxhdG9yIHRvIHJlYWxseSBmaW5pc2ggYm9vdGluZ2ApO1xuICAgIGF3YWl0IEIuZGVsYXkodGhpcy5leHRyYVN0YXJ0dXBUaW1lKTtcbiAgICBsb2cuZGVidWcoJ0RvbmUgd2FpdGluZyBleHRyYSB0aW1lIGZvciBzaW11bGF0b3InKTtcblxuICAgIHRoaXMuZW1pdChCT09UX0NPTVBMRVRFRF9FVkVOVCk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhIG1hZ2ljIHN0cmluZywgd2hpY2gsIGlmIHByZXNlbnQgaW4gbG9ncywgcmVmbGVjdHMgdGhlIGZhY3QgdGhhdCBzaW11bGF0b3IgYm9vdGluZyBoYXMgYmVlbiBjb21wbGV0ZWQuXG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIG1hZ2ljIGxvZyBzdHJpbmcuXG4gICAqL1xuICBhc3luYyBnZXRCb290ZWRJbmRpY2F0b3JTdHJpbmcgKCkge1xuICAgIGxldCBpbmRpY2F0b3I7XG4gICAgbGV0IHBsYXRmb3JtVmVyc2lvbiA9IGF3YWl0IHRoaXMuZ2V0UGxhdGZvcm1WZXJzaW9uKCk7XG4gICAgc3dpdGNoIChwbGF0Zm9ybVZlcnNpb24pIHtcbiAgICAgIGNhc2UgJzcuMSc6XG4gICAgICBjYXNlICc4LjEnOlxuICAgICAgY2FzZSAnOC4yJzpcbiAgICAgIGNhc2UgJzguMyc6XG4gICAgICBjYXNlICc4LjQnOlxuICAgICAgICBpbmRpY2F0b3IgPSAncHJvZmlsZWQ6IFNlcnZpY2Ugc3RhcnRpbmcuLi4nO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJzkuMCc6XG4gICAgICBjYXNlICc5LjEnOlxuICAgICAgY2FzZSAnOS4yJzpcbiAgICAgIGNhc2UgJzkuMyc6XG4gICAgICAgIGluZGljYXRvciA9ICdTeXN0ZW0gYXBwIFwiY29tLmFwcGxlLnNwcmluZ2JvYXJkXCIgZmluaXNoZWQgc3RhcnR1cCc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnMTAuMCc6XG4gICAgICAgIGluZGljYXRvciA9ICdTd2l0Y2hpbmcgdG8ga2V5Ym9hcmQnO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGxvZy53YXJuKGBObyBib290IGluZGljYXRvciBjYXNlIGZvciBwbGF0Zm9ybSB2ZXJzaW9uICcke3BsYXRmb3JtVmVyc2lvbn0nYCk7XG4gICAgICAgIGluZGljYXRvciA9ICdubyBib290IGluZGljYXRvciBzdHJpbmcgYXZhaWxhYmxlJztcbiAgICB9XG4gICAgcmV0dXJuIGluZGljYXRvcjtcbiAgfVxuXG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IFNpbXVsYXRvck9wdGlvbnNcbiAgICogQHByb3BlcnR5IHs/c3RyaW5nfSBzY2FsZUZhY3RvciBbbnVsbF0gLSBEZWZpbmVzIHRoZSB3aW5kb3cgc2NhbGUgdmFsdWUgZm9yIHRoZSBVSSBjbGllbnQgd2luZG93IGZvciB0aGUgY3VycmVudCBTaW11bGF0b3IuXG4gICAqICAgRXF1YWxzIHRvIG51bGwgYnkgZGVmYXVsdCwgd2hpY2gga2VlcHMgdGhlIGN1cnJlbnQgc2NhbGUgdW5jaGFuZ2VkLlxuICAgKiAgIEl0IHNob3VsZCBiZSBvbmUgb2YgWycxLjAnLCAnMC43NScsICcwLjUnLCAnMC4zMycsICcwLjI1J10uXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBzdGFydHVwVGltZW91dCBbNjAwMDBdIC0gTnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IHVudGlsIFNpbXVsYXRvciBib290aW5nXG4gICAqICAgcHJvY2VzcyBpcyBjb21wbGV0ZWQuIFRoZSBkZWZhdWx0IHRpbWVvdXQgd2lsbCBiZSB1c2VkIGlmIG5vdCBzZXQgZXhwbGljaXRseS5cbiAgICovXG5cbiAgLyoqXG4gICAqIFN0YXJ0IHRoZSBTaW11bGF0b3IgVUkgY2xpZW50IHdpdGggdGhlIGdpdmVuIGFyZ3VtZW50c1xuICAgKiBAcGFyYW0ge1NpbXVsYXRvck9wdGlvbnN9IG9wdHMgLSBTaW11bGF0b3Igc3RhcnR1cCBvcHRpb25zXG4gICAqL1xuICBhc3luYyBzdGFydFVJQ2xpZW50IChvcHRzID0ge30pIHtcbiAgICBvcHRzID0gXy5jbG9uZURlZXAob3B0cyk7XG4gICAgXy5kZWZhdWx0c0RlZXAob3B0cywge1xuICAgICAgc2NhbGVGYWN0b3I6IG51bGwsXG4gICAgICBzdGFydHVwVGltZW91dDogdGhpcy5zdGFydHVwVGltZW91dCxcbiAgICB9KTtcblxuICAgIGNvbnN0IHNpbXVsYXRvckFwcCA9IHBhdGgucmVzb2x2ZShhd2FpdCBnZXRYY29kZVBhdGgoKSwgJ0FwcGxpY2F0aW9ucycsIHRoaXMuc2ltdWxhdG9yQXBwKTtcbiAgICBjb25zdCBhcmdzID0gW1xuICAgICAgJy1GbicsIHNpbXVsYXRvckFwcCxcbiAgICAgICctLWFyZ3MnLCAnLUN1cnJlbnREZXZpY2VVRElEJywgdGhpcy51ZGlkLFxuICAgIF07XG5cbiAgICBpZiAob3B0cy5zY2FsZUZhY3Rvcikge1xuICAgICAgY29uc3Qge25hbWV9ID0gYXdhaXQgdGhpcy5zdGF0KCk7XG4gICAgICBjb25zdCBmb3JtYXR0ZWREZXZpY2VOYW1lID0gbmFtZS5yZXBsYWNlKC9cXHMrL2csICctJyk7XG4gICAgICBjb25zdCBhcmd1bWVudE5hbWUgPSBgLVNpbXVsYXRvcldpbmRvd0xhc3RTY2FsZS1jb20uYXBwbGUuQ29yZVNpbXVsYXRvci5TaW1EZXZpY2VUeXBlLiR7Zm9ybWF0dGVkRGV2aWNlTmFtZX1gO1xuICAgICAgYXJncy5wdXNoKGFyZ3VtZW50TmFtZSwgb3B0cy5zY2FsZUZhY3Rvcik7XG4gICAgfVxuXG4gICAgbG9nLmluZm8oYFN0YXJ0aW5nIFNpbXVsYXRvciBVSSB3aXRoIGNvbW1hbmQ6IG9wZW4gJHthcmdzLmpvaW4oJyAnKX1gKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZXhlYygnb3BlbicsIGFyZ3MsIHt0aW1lb3V0OiBvcHRzLnN0YXJ0dXBUaW1lb3V0fSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoIShlcnIuc3Rkb3V0IHx8ICcnKS5pbmNsdWRlcygnLTEwODI1JykgJiYgIShlcnIuc3RkZXJyIHx8ICcnKS5pbmNsdWRlcygnLTEwODI1JykpIHtcbiAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgfVxuICAgICAgbG9nLndhcm4oYEVycm9yIHdoaWxlIG9wZW5pbmcgVUk6ICR7ZXJyLnN0ZG91dCB8fCBlcnIuc3RkZXJyfS4gQ29udGludWluZ2ApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlcyBnaXZlbiBTaW11bGF0b3Igd2l0aCBvcHRpb25zLiBUaGUgU2ltdWxhdG9yIHdpbGwgbm90IGJlIHJlc3RhcnRlZCBpZlxuICAgKiBpdCBpcyBhbHJlYWR5IHJ1bm5pbmcuXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRzIC0gT25lIG9yIG1vcmUgb2YgYXZhaWxhYmxlIFNpbXVsYXRvciBvcHRpb25zLlxuICAgKiAgIFNlZSB7I3N0YXJ0VUlDbGllbnQob3B0cyl9IGRvY3VtZW50YXRpb24gZm9yIG1vcmUgZGV0YWlscyBvbiBvdGhlciBzdXBwb3J0ZWQga2V5cy5cbiAgICovXG4gIGFzeW5jIHJ1biAob3B0cyA9IHt9KSB7XG4gICAgb3B0cyA9IE9iamVjdC5hc3NpZ24oe1xuICAgICAgc3RhcnR1cFRpbWVvdXQ6IHRoaXMuc3RhcnR1cFRpbWVvdXQsXG4gICAgfSwgb3B0cyk7XG4gICAgY29uc3QgaXNTZXJ2ZXJSdW5uaW5nID0gYXdhaXQgdGhpcy5pc1J1bm5pbmcoKTtcbiAgICBjb25zdCBpc1VJQ2xpZW50UnVubmluZyA9IGF3YWl0IHRoaXMuaXNVSUNsaWVudFJ1bm5pbmcoKTtcbiAgICBpZiAoaXNTZXJ2ZXJSdW5uaW5nICYmIGlzVUlDbGllbnRSdW5uaW5nKSB7XG4gICAgICBsb2cuaW5mbyhgQm90aCBTaW11bGF0b3Igd2l0aCBVRElEICR7dGhpcy51ZGlkfSBhbmQgdGhlIFVJIGNsaWVudCBhcmUgY3VycmVudGx5IHJ1bm5pbmdgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgdGltZXIgPSBuZXcgdGltaW5nLlRpbWVyKCkuc3RhcnQoKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5zaHV0ZG93bigpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLndhcm4oYEVycm9yIG9uIFNpbXVsYXRvciBzaHV0ZG93bjogJHtlcnIubWVzc2FnZX1gKTtcbiAgICB9XG4gICAgYXdhaXQgdGhpcy5zdGFydFVJQ2xpZW50KG9wdHMpO1xuXG4gICAgYXdhaXQgdGhpcy53YWl0Rm9yQm9vdChvcHRzLnN0YXJ0dXBUaW1lb3V0KTtcbiAgICBsb2cuaW5mbyhgU2ltdWxhdG9yIHdpdGggVURJRCAke3RoaXMudWRpZH0gYm9vdGVkIGluICR7dGltZXIuZ2V0RHVyYXRpb24oKS5hc1NlY29uZHMudG9GaXhlZCgzKX1zYCk7XG4gIH1cblxuICAvLyBUT0RPIGtlZXAga2V5Y2hhaW5zXG4gIC8qKlxuICAgKiBSZXNldCB0aGUgY3VycmVudCBTaW11bGF0b3IgdG8gdGhlIGNsZWFuIHN0YXRlLlxuICAgKi9cbiAgYXN5bmMgY2xlYW4gKCkge1xuICAgIGF3YWl0IHRoaXMuZW5kU2ltdWxhdG9yRGFlbW9uKCk7XG4gICAgbG9nLmluZm8oYENsZWFuaW5nIHNpbXVsYXRvciAke3RoaXMudWRpZH1gKTtcbiAgICBhd2FpdCB0aGlzLnNpbWN0bC5lcmFzZURldmljZSgxMDAwMCk7XG4gIH1cblxuICAvKipcbiAgICogU2NydWIgKGRlbGV0ZSB0aGUgcHJlZmVyZW5jZXMgYW5kIGNoYW5nZWQgZmlsZXMpIHRoZSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uIG9uIFNpbXVsYXRvci5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGFwcEZpbGUgLSBBcHBsaWNhdGlvbiBuYW1lIG1pbnVzIFwiLmFwcFwiLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwQnVuZGxlSWQgLSBCdW5kbGUgaWRlbnRpZmllciBvZiB0aGUgYXBwbGljYXRpb24uXG4gICAqL1xuICBhc3luYyBzY3J1YkN1c3RvbUFwcCAoYXBwRmlsZSwgYXBwQnVuZGxlSWQpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5jbGVhbkN1c3RvbUFwcChhcHBGaWxlLCBhcHBCdW5kbGVJZCwgdHJ1ZSk7XG4gIH1cblxuICAvKipcbiAgICogQ2xlYW4vc2NydWIgdGhlIHBhcnRpY3VsYXIgYXBwbGljYXRpb24gb24gU2ltdWxhdG9yLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwRmlsZSAtIEFwcGxpY2F0aW9uIG5hbWUgbWludXMgXCIuYXBwXCIuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBCdW5kbGVJZCAtIEJ1bmRsZSBpZGVudGlmaWVyIG9mIHRoZSBhcHBsaWNhdGlvbi5cbiAgICogQHBhcmFtIHtib29sZWFufSBzY3J1YiAtIElmIGBzY3J1YmAgaXMgZmFsc2UsIHdlIHdhbnQgdG8gY2xlYW4gYnkgZGVsZXRpbmcgdGhlIGFwcCBhbmQgYWxsXG4gICAqICAgZmlsZXMgYXNzb2NpYXRlZCB3aXRoIGl0LiBJZiBgc2NydWJgIGlzIHRydWUsIHdlIGp1c3Qgd2FudCB0byBkZWxldGUgdGhlIHByZWZlcmVuY2VzIGFuZFxuICAgKiAgIGNoYW5nZWQgZmlsZXMuXG4gICAqL1xuICBhc3luYyBjbGVhbkN1c3RvbUFwcCAoYXBwRmlsZSwgYXBwQnVuZGxlSWQsIHNjcnViID0gZmFsc2UpIHtcbiAgICBsb2cuZGVidWcoYENsZWFuaW5nIGFwcCBkYXRhIGZpbGVzIGZvciAnJHthcHBGaWxlfScsICcke2FwcEJ1bmRsZUlkfSdgKTtcbiAgICBpZiAoIXNjcnViKSB7XG4gICAgICBsb2cuZGVidWcoYERlbGV0aW5nIGFwcCBhbHRvZ2V0aGVyYCk7XG4gICAgfVxuXG4gICAgLy8gZ2V0IHRoZSBkaXJlY3RvcmllcyB0byBiZSBkZWxldGVkXG4gICAgbGV0IGFwcERpcnMgPSBhd2FpdCB0aGlzLmdldEFwcERpcnMoYXBwRmlsZSwgYXBwQnVuZGxlSWQsIHNjcnViKTtcblxuICAgIGlmIChhcHBEaXJzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgbG9nLmRlYnVnKCdDb3VsZCBub3QgZmluZCBhcHAgZGlyZWN0b3JpZXMgdG8gZGVsZXRlLiBJdCBpcyBwcm9iYWJseSBub3QgaW5zdGFsbGVkJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IGRlbGV0ZVByb21pc2VzID0gW107XG5cbiAgICBmb3IgKGxldCBkaXIgb2YgYXBwRGlycykge1xuICAgICAgbG9nLmRlYnVnKGBEZWxldGluZyBkaXJlY3Rvcnk6ICcke2Rpcn0nYCk7XG4gICAgICBkZWxldGVQcm9taXNlcy5wdXNoKGZzLnJpbXJhZihkaXIpKTtcbiAgICB9XG5cbiAgICBpZiAoYXdhaXQgdGhpcy5nZXRQbGF0Zm9ybVZlcnNpb24oKSA+PSA4KSB7XG4gICAgICBsZXQgcmVsUm1QYXRoID0gYExpYnJhcnkvUHJlZmVyZW5jZXMvJHthcHBCdW5kbGVJZH0ucGxpc3RgO1xuICAgICAgbGV0IHJtUGF0aCA9IHBhdGgucmVzb2x2ZSh0aGlzLmdldFJvb3REaXIoKSwgcmVsUm1QYXRoKTtcbiAgICAgIGxvZy5kZWJ1ZyhgRGVsZXRpbmcgZmlsZTogJyR7cm1QYXRofSdgKTtcbiAgICAgIGRlbGV0ZVByb21pc2VzLnB1c2goZnMucmltcmFmKHJtUGF0aCkpO1xuICAgIH1cblxuICAgIGF3YWl0IEIuYWxsKGRlbGV0ZVByb21pc2VzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSBwYXRocyB0byBkaXJzIHdoZXJlIGFwcGxpY2F0aW9uIGRhdGEgaXMgc3RvcmVkLiBpT1MgOCsgc3RvcmVzIGFwcCBkYXRhIGluIHR3byBwbGFjZXMsXG4gICAqIGFuZCBpT1MgNy4xIGhhcyBvbmx5IG9uZSBkaXJlY3RvcnlcbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGFwcEZpbGUgLSBBcHBsaWNhdGlvbiBuYW1lIG1pbnVzIFwiLmFwcFwiLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwQnVuZGxlSWQgLSBCdW5kbGUgaWRlbnRpZmllciBvZiB0aGUgYXBwbGljYXRpb24uXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gc2NydWIgLSBUaGUgYEJ1bmRsZWAgZGlyZWN0b3J5IGhhcyB0aGUgYWN0dWFsIGFwcCBpbiBpdC4gSWYgd2UgYXJlIGp1c3Qgc2NydWJiaW5nLFxuICAgKiAgIHdlIHdhbnQgdGhpcyB0byBzdGF5LiBJZiB3ZSBhcmUgY2xlYW5pbmcgd2UgZGVsZXRlLlxuICAgKiBAcmV0dXJuIHthcnJheTxzdHJpbmc+fSBBcnJheSBvZiBhcHBsaWNhdGlvbiBkYXRhIHBhdGhzLlxuICAgKi9cbiAgYXN5bmMgZ2V0QXBwRGlycyAoYXBwRmlsZSwgYXBwQnVuZGxlSWQsIHNjcnViID0gZmFsc2UpIHtcbiAgICBsZXQgZGlycyA9IFtdO1xuICAgIGlmIChhd2FpdCB0aGlzLmdldFBsYXRmb3JtVmVyc2lvbigpID49IDgpIHtcbiAgICAgIGxldCBkYXRhID0gYXdhaXQgdGhpcy5nZXRBcHBEaXIoYXBwQnVuZGxlSWQpO1xuICAgICAgaWYgKCFkYXRhKSByZXR1cm4gZGlyczsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjdXJseVxuXG4gICAgICBsZXQgYnVuZGxlID0gIXNjcnViID8gYXdhaXQgdGhpcy5nZXRBcHBEaXIoYXBwQnVuZGxlSWQsICdCdW5kbGUnKSA6IHVuZGVmaW5lZDtcblxuICAgICAgZm9yIChsZXQgc3JjIG9mIFtkYXRhLCBidW5kbGVdKSB7XG4gICAgICAgIGlmIChzcmMpIHtcbiAgICAgICAgICBkaXJzLnB1c2goc3JjKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgZGF0YSA9IGF3YWl0IHRoaXMuZ2V0QXBwRGlyKGFwcEZpbGUpO1xuICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgZGlycy5wdXNoKGRhdGEpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZGlycztcbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIHRoZSBTaW11bGF0b3IgaW4gb3JkZXIgdG8gaGF2ZSB0aGUgaW5pdGlhbCBmaWxlIHN0cnVjdHVyZSBjcmVhdGVkIGFuZCBzaHV0ZG93biBpdCBhZnRlcndhcmRzLlxuICAgKlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IHNhZmFyaSAtIFdoZXRoZXIgdG8gZXhlY3V0ZSBtb2JpbGUgU2FmYXJpIGFmdGVyIHN0YXJ0dXAuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydHVwVGltZW91dCAtIEhvdyBsb25nIHRvIHdhaXQgdW50aWwgU2ltdWxhdG9yIGJvb3RpbmcgaXMgY29tcGxldGVkIChpbiBtaWxsaXNlY29uZHMpLlxuICAgKi9cbiAgYXN5bmMgbGF1bmNoQW5kUXVpdCAoc2FmYXJpID0gZmFsc2UsIHN0YXJ0dXBUaW1lb3V0ID0gdGhpcy5zdGFydHVwVGltZW91dCkge1xuICAgIGxvZy5kZWJ1ZygnQXR0ZW1wdGluZyB0byBsYXVuY2ggYW5kIHF1aXQgdGhlIHNpbXVsYXRvciB0byBjcmVhdGUgdGhlIGRpcmVjdG9yeSBzdHJ1Y3R1cmUnKTtcbiAgICBhd2FpdCB0aGlzLnJ1bih7c3RhcnR1cFRpbWVvdXR9KTtcblxuICAgIGlmIChzYWZhcmkpIHtcbiAgICAgIGxvZy5kZWJ1ZygnU3Bhd25pbmcgU2FmYXJpIGJyb3dzZXIgaW4gb3JkZXIgdG8gY3JlYXRlIHRoZSBuZWNlc3NhcnkgZmlsZSBzeXN0ZW0gaXRlbXMnKTtcbiAgICAgIGF3YWl0IGxhdW5jaEFwcCh0aGlzLnNpbWN0bCwgTU9CSUxFX1NBRkFSSV9CVU5ETEVfSUQpO1xuICAgIH1cblxuICAgIC8vIHdhaXQgZm9yIHRoZSBzeXN0ZW0gdG8gY3JlYXRlIHRoZSBmaWxlcyB3ZSB3aWxsIG1hbmlwdWxhdGVcbiAgICAvLyBuZWVkIHF1aXRlIGEgaGlnaCByZXRyeSBudW1iZXIsIGluIG9yZGVyIHRvIGFjY29tbW9kYXRlIGlPUyA3LjFcbiAgICAvLyBsb2NhbGx5LCA3LjEgYXZlcmFnZXMgOC41IHJldHJpZXMgKGZyb20gNiAtIDEyKVxuICAgIC8vICAgICAgICAgIDggYXZlcmFnZXMgMC42IHJldHJpZXMgKGZyb20gMCAtIDIpXG4gICAgLy8gICAgICAgICAgOSBhdmVyYWdlcyAxNCByZXRyaWVzXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHJldHJ5SW50ZXJ2YWwoNjAsIDI1MCwgYXN5bmMgKCkgPT4ge1xuICAgICAgICBpZiAoYXdhaXQgdGhpcy5pc0ZyZXNoKCkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NpbXVsYXRvciBmaWxlcyBub3QgZnVsbHkgY3JlYXRlZC4gV2FpdGluZyBhIGJpdCcpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy53YXJuKGBUaW1lb3V0IHdhaXRpbmcgZm9yIHNpbXVsYXRvciBmaWxlcyB0byBiZSBjcmVhdGVkLiBDb250aW51aW5nYCk7XG4gICAgfVxuXG4gICAgLy8gYW5kIHF1aXRcbiAgICBhd2FpdCB0aGlzLnNodXRkb3duKCk7XG4gIH1cblxuICAvKipcbiAgICogTG9va3MgZm9yIGxhdW5jaGQgZGFlbW9ucyBjb3JyZXNwb25kaW5nIHRvIHRoZSBzaW0gdWRpZCBhbmQgdHJpZXMgdG8gc3RvcCB0aGVtIGNsZWFubHlcbiAgICogVGhpcyBwcmV2ZW50cyB4Y3J1biBzaW1jdGwgZXJhc2UgZnJvbSBoYW5naW5nLlxuICAgKi9cbiAgYXN5bmMgZW5kU2ltdWxhdG9yRGFlbW9uICgpIHtcbiAgICBsb2cuZGVidWcoYEtpbGxpbmcgYW55IHNpbXVsYXRvciBkYWVtb25zIGZvciAke3RoaXMudWRpZH1gKTtcblxuICAgIGxldCBsYXVuY2hjdGxDbWQgPSBgbGF1bmNoY3RsIGxpc3QgfCBncmVwICR7dGhpcy51ZGlkfSB8IGN1dCAtZiAzIHwgeGFyZ3MgLW4gMSBsYXVuY2hjdGxgO1xuICAgIHRyeSB7XG4gICAgICBsZXQgc3RvcENtZCA9IGAke2xhdW5jaGN0bENtZH0gc3RvcGA7XG4gICAgICBhd2FpdCBleGVjKCdiYXNoJywgWyctYycsIHN0b3BDbWRdKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy53YXJuKGBDb3VsZCBub3Qgc3RvcCBzaW11bGF0b3IgZGFlbW9uczogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIGxvZy5kZWJ1ZygnQ2Fycnlpbmcgb24gYW55d2F5IScpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgbGV0IHJlbW92ZUNtZCA9IGAke2xhdW5jaGN0bENtZH0gcmVtb3ZlYDtcbiAgICAgIGF3YWl0IGV4ZWMoJ2Jhc2gnLCBbJy1jJywgcmVtb3ZlQ21kXSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2cud2FybihgQ291bGQgbm90IHJlbW92ZSBzaW11bGF0b3IgZGFlbW9uczogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIGxvZy5kZWJ1ZygnQ2Fycnlpbmcgb24gYW55d2F5IScpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgLy8gV2FpdHMgMTAgc2VjIGZvciB0aGUgc2ltdWxhdG9yIGxhdW5jaGQgc2VydmljZXMgdG8gc3RvcC5cbiAgICAgIGF3YWl0IHdhaXRGb3JDb25kaXRpb24oYXN5bmMgKCkgPT4ge1xuICAgICAgICBsZXQge3N0ZG91dH0gPSBhd2FpdCBleGVjKCdiYXNoJywgWyctYycsXG4gICAgICAgICAgYHBzIC1lICB8IGdyZXAgJHt0aGlzLnVkaWR9IHwgZ3JlcCBsYXVuY2hkX3NpbSB8IGdyZXAgLXYgYmFzaCB8IGdyZXAgLXYgZ3JlcCB8IGF3ayB7J3ByaW50JDEnfWBdKTtcbiAgICAgICAgcmV0dXJuIHN0ZG91dC50cmltKCkubGVuZ3RoID09PSAwO1xuICAgICAgfSwge3dhaXRNczogMTAwMDAsIGludGVydmFsTXM6IDUwMH0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLndhcm4oYENvdWxkIG5vdCBlbmQgc2ltdWxhdG9yIGRhZW1vbiBmb3IgJHt0aGlzLnVkaWR9OiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgbG9nLmRlYnVnKCdDYXJyeWluZyBvbiBhbnl3YXkhJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IFNodXRkb3duT3B0aW9uc1xuICAgKiBAcHJvcGVydHkgez9udW1iZXJ8c3RyaW5nfSB0aW1lb3V0IFRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgdW50aWxcbiAgICogU2ltdWxhdG9yIGlzIHNodXQgZG93biBjb21wbGV0ZWx5LiBObyB3YWl0IGhhcHBlbnMgaWYgdGhlIHRpbWVvdXQgdmFsdWUgaXMgbm90IHNldFxuICAgKi9cblxuICAvKipcbiAgICogU2h1dCBkb3duIHRoZSBjdXJyZW50IFNpbXVsYXRvci5cbiAgICpcbiAgICogQHBhcmFtIHs/U2h1dGRvd25PcHRpb25zfSBvcHRzXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiBTaW11bGF0b3IgZmFpbHMgdG8gdHJhbnNpdGlvbiBpbnRvIFNodXRkb3duIHN0YXRlIGFmdGVyXG4gICAqIHRoZSBnaXZlbiB0aW1lb3V0XG4gICAqL1xuICBhc3luYyBzaHV0ZG93biAob3B0cyA9IHt9KSB7XG4gICAgaWYgKGF3YWl0IHRoaXMuaXNTaHV0ZG93bigpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgYXdhaXQgcmV0cnlJbnRlcnZhbCg1LCA1MDAsIHRoaXMuc2ltY3RsLnNodXRkb3duRGV2aWNlLmJpbmQodGhpcy5zaW1jdGwpKTtcbiAgICBjb25zdCB3YWl0TXMgPSBwYXJzZUludChvcHRzLnRpbWVvdXQsIDEwKTtcbiAgICBpZiAod2FpdE1zID4gMCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgd2FpdEZvckNvbmRpdGlvbihhc3luYyAoKSA9PiBhd2FpdCB0aGlzLmlzU2h1dGRvd24oKSwge1xuICAgICAgICAgIHdhaXRNcyxcbiAgICAgICAgICBpbnRlcnZhbE1zOiAxMDAsXG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgU2ltdWxhdG9yIGlzIG5vdCBpbiAnU2h1dGRvd24nIHN0YXRlIGFmdGVyICR7d2FpdE1zfW1zYCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERlbGV0ZSB0aGUgcGFydGljdWxhciBTaW11bGF0b3IgZnJvbSBkZXZpY2VzIGxpc3RcbiAgICovXG4gIGFzeW5jIGRlbGV0ZSAoKSB7XG4gICAgYXdhaXQgdGhpcy5zaW1jdGwuZGVsZXRlRGV2aWNlKCk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRoZSBwYXJ0aWN1bGFyIHByZWZlcmVuY2UgZmlsZSB3aXRoIHRoZSBnaXZlbiBrZXkvdmFsdWUgcGFpcnMuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwbGlzdCAtIFRoZSBwcmVmZXJlbmNlcyBmaWxlIHRvIHVwZGF0ZS5cbiAgICogQHBhcmFtIHtvYmplY3R9IHVwZGF0ZXMgLSBUaGUga2V5L3ZhbHVlIHBhaXJzIHRvIHVwZGF0ZS5cbiAgICovXG4gIGFzeW5jIHVwZGF0ZVNldHRpbmdzIChwbGlzdCwgdXBkYXRlcykge1xuICAgIHJldHVybiBhd2FpdCBzZXR0aW5ncy51cGRhdGVTZXR0aW5ncyh0aGlzLCBwbGlzdCwgdXBkYXRlcyk7XG4gIH1cblxuICAvKipcbiAgICogQXV0aG9yaXplL2RlLWF1dGhvcml6ZSBsb2NhdGlvbiBzZXR0aW5ncyBmb3IgYSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSWQgLSBUaGUgYXBwbGljYXRpb24gSUQgdG8gdXBkYXRlLlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGF1dGhvcml6ZWQgLSBXaGV0aGVyIG9yIG5vdCB0byBhdXRob3JpemUuXG4gICAqL1xuICBhc3luYyB1cGRhdGVMb2NhdGlvblNldHRpbmdzIChidW5kbGVJZCwgYXV0aG9yaXplZCkge1xuICAgIGF3YWl0IHRoaXMuc2V0UGVybWlzc2lvbihidW5kbGVJZCwgJ2xvY2F0aW9uJywgYXV0aG9yaXplZCA/ICdhbHdheXMnIDogJ25ldmVyJyk7XG4gIH1cblxuICAvKipcbiAgICogRW5hYmxlL0Rpc2FibGUgcmVkdWNlIG1vdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIHtib29sZWFufSByZWR1Y2VNb3Rpb24gLSBXaGV0aGVyIG9yIG5vdCB0byBlbmFibGUgaXQuXG4gICAqL1xuICBhc3luYyBzZXRSZWR1Y2VNb3Rpb24gKHJlZHVjZU1vdGlvbiA9IHRydWUpIHtcbiAgICBhd2FpdCBzZXR0aW5ncy5zZXRSZWR1Y2VNb3Rpb24odGhpcywgcmVkdWNlTW90aW9uKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbmFibGUvRGlzYWJsZSByZWR1Y2UgdHJhbnNwYXJlbmN5LlxuICAgKlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IHJlZHVjZU1vdGlvbiAtIFdoZXRoZXIgb3Igbm90IHRvIGVuYWJsZSBpdC5cbiAgICovXG4gIGFzeW5jIHNldFJlZHVjZVRyYW5zcGFyZW5jeSAocmVkdWNlVHJhbnNwYXJlbmN5KSB7XG4gICAgYXdhaXQgc2V0dGluZ3Muc2V0UmVkdWNlVHJhbnNwYXJlbmN5KHRoaXMsIHJlZHVjZVRyYW5zcGFyZW5jeSk7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyBVSSBhcHBlYXJhbmNlIHN0eWxlLlxuICAgKiBUaGlzIGZ1bmN0aW9uIGNhbiBvbmx5IGJlIGNhbGxlZCBvbiBhIGJvb3RlZCBzaW11bGF0b3IuXG4gICAqXG4gICAqIEBzaW5jZSBYY29kZSBTREsgMTEuNFxuICAgKi9cbiAgYXN5bmMgc2V0QXBwZWFyYW5jZSAoLyogdmFsdWUgKi8pIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgdGhyb3cgbmV3IEVycm9yKGBYY29kZSBTREsgJyR7dGhpcy54Y29kZVZlcnNpb259JyBpcyB0b28gb2xkIHRvIHNldCBVSSBhcHBlYXJhbmNlYCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgY3VycmVudCBVSSBhcHBlYXJhbmNlIHN0eWxlXG4gICAqIFRoaXMgZnVuY3Rpb24gY2FuIG9ubHkgYmUgY2FsbGVkIG9uIGEgYm9vdGVkIHNpbXVsYXRvci5cbiAgICpcbiAgICogQHNpbmNlIFhjb2RlIFNESyAxMS40XG4gICAqL1xuICBhc3luYyBnZXRBcHBlYXJhbmNlICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgdGhyb3cgbmV3IEVycm9yKGBYY29kZSBTREsgJyR7dGhpcy54Y29kZVZlcnNpb259JyBpcyB0b28gb2xkIHRvIGdldCBVSSBhcHBlYXJhbmNlYCk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHNldHRpbmdzIGZvciBTYWZhcmkuXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSB1cGRhdGVzIC0gVGhlIGhhc2ggb2Yga2V5L3ZhbHVlIHBhaXJzIHRvIHVwZGF0ZSBmb3IgU2FmYXJpLlxuICAgKi9cbiAgYXN5bmMgdXBkYXRlU2FmYXJpU2V0dGluZ3MgKHVwZGF0ZXMpIHtcbiAgICBjb25zdCBwcm9taXNlcyA9IFtcbiAgICAgIHNldHRpbmdzLnVwZGF0ZVNhZmFyaVVzZXJTZXR0aW5ncyh0aGlzLCB1cGRhdGVzKSxcbiAgICAgIHNldHRpbmdzLnVwZGF0ZVNldHRpbmdzKHRoaXMsIHNldHRpbmdzLlBMSVNUX0lERU5USUZJRVIuTU9CSUxFX1NBRkFSSSwgdXBkYXRlcylcbiAgICBdO1xuICAgIHJldHVybiBfLnNvbWUoYXdhaXQgQi5hbGwocHJvbWlzZXMpLCBCb29sZWFuKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgZ2xvYmFsIHNldHRpbmdzIGZvciBTYWZhcmkuXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSB1cGRhdGVzIC0gVGhlIGhhc2ggb2Yga2V5L3ZhbHVlIHBhaXJzIHRvIHVwZGF0ZSBmb3IgU2FmYXJpLlxuICAgKi9cbiAgYXN5bmMgdXBkYXRlU2FmYXJpR2xvYmFsU2V0dGluZ3MgKHVwZGF0ZXMpIHtcbiAgICByZXR1cm4gYXdhaXQgc2V0dGluZ3MudXBkYXRlU2FmYXJpR2xvYmFsU2V0dGluZ3ModGhpcywgdXBkYXRlcyk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRoZSBsb2NhbGUgZm9yIHRoZSBTaW11bGF0b3IuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBsYW5ndWFnZSAtIFRoZSBsYW5ndWFnZSBmb3IgdGhlIHNpbXVsYXRvci4gRS5nLiwgYFwiZnJfVVNcImAuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBsb2NhbGUgLSBUaGUgbG9jYWxlIHRvIHNldCBmb3IgdGhlIHNpbXVsYXRvci4gRS5nLiwgYFwiZW5cImAuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjYWxlbmRhckZvcm1hdCAtIFRoZSBmb3JtYXQgb2YgdGhlIGNhbGVuZGFyLlxuICAgKi9cbiAgYXN5bmMgdXBkYXRlTG9jYWxlIChsYW5ndWFnZSwgbG9jYWxlLCBjYWxlbmRhckZvcm1hdCkge1xuICAgIHJldHVybiBhd2FpdCBzZXR0aW5ncy51cGRhdGVMb2NhbGUodGhpcywgbGFuZ3VhZ2UsIGxvY2FsZSwgY2FsZW5kYXJGb3JtYXQpO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbXBsZXRlbHkgZGVsZXRlIG1vYmlsZSBTYWZhcmkgYXBwbGljYXRpb24gZnJvbSB0aGUgY3VycmVudCBTaW11bGF0b3IuXG4gICAqL1xuICBhc3luYyBkZWxldGVTYWZhcmkgKCkge1xuICAgIGxvZy5kZWJ1ZygnRGVsZXRpbmcgU2FmYXJpIGFwcHMgZnJvbSBzaW11bGF0b3InKTtcblxuICAgIGxldCBkaXJzID0gW107XG5cbiAgICAvLyBnZXQgdGhlIGRhdGEgZGlyZWN0b3J5XG4gICAgZGlycy5wdXNoKGF3YWl0IHRoaXMuZ2V0QXBwRGlyKE1PQklMRV9TQUZBUklfQlVORExFX0lEKSk7XG5cbiAgICBsZXQgcHYgPSBhd2FpdCB0aGlzLmdldFBsYXRmb3JtVmVyc2lvbigpO1xuICAgIGlmIChwdiA+PSA4KSB7XG4gICAgICAvLyBnZXQgdGhlIGJ1bmRsZSBkaXJlY3RvcnlcbiAgICAgIGRpcnMucHVzaChhd2FpdCB0aGlzLmdldEFwcERpcihNT0JJTEVfU0FGQVJJX0JVTkRMRV9JRCwgJ0J1bmRsZScpKTtcbiAgICB9XG5cbiAgICBsZXQgZGVsZXRlUHJvbWlzZXMgPSBbXTtcbiAgICBmb3IgKGxldCBkaXIgb2YgXy5jb21wYWN0KGRpcnMpKSB7XG4gICAgICBsb2cuZGVidWcoYERlbGV0aW5nIGRpcmVjdG9yeTogJyR7ZGlyfSdgKTtcbiAgICAgIGRlbGV0ZVByb21pc2VzLnB1c2goZnMucmltcmFmKGRpcikpO1xuICAgIH1cbiAgICBhd2FpdCBCLmFsbChkZWxldGVQcm9taXNlcyk7XG4gIH1cblxuICAvKipcbiAgICogQ2xlYW4gdXAgdGhlIGRpcmVjdG9yaWVzIGZvciBtb2JpbGUgU2FmYXJpLlxuICAgKlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGtlZXBQcmVmcyAtIFdoZXRoZXIgdG8ga2VlcCBTYWZhcmkgcHJlZmVyZW5jZXMgZnJvbSBiZWluZyBkZWxldGVkLlxuICAgKi9cbiAgYXN5bmMgY2xlYW5TYWZhcmkgKGtlZXBQcmVmcyA9IHRydWUpIHtcbiAgICBsb2cuZGVidWcoJ0NsZWFuaW5nIG1vYmlsZSBzYWZhcmkgZGF0YSBmaWxlcycpO1xuICAgIGlmIChhd2FpdCB0aGlzLmlzRnJlc2goKSkge1xuICAgICAgbG9nLmluZm8oJ0NvdWxkIG5vdCBmaW5kIFNhZmFyaSBzdXBwb3J0IGRpcmVjdG9yaWVzIHRvIGNsZWFuIG91dCBvbGQgJyArXG4gICAgICAgICAgICAgICAnZGF0YS4gUHJvYmFibHkgdGhlcmUgaXMgbm90aGluZyB0byBjbGVhbiBvdXQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgbGlicmFyeURpciA9IHBhdGgucmVzb2x2ZSh0aGlzLmdldERpcigpLCAnTGlicmFyeScpO1xuICAgIGxldCBzYWZhcmlSb290ID0gYXdhaXQgdGhpcy5nZXRBcHBEaXIoTU9CSUxFX1NBRkFSSV9CVU5ETEVfSUQpO1xuICAgIGlmICghc2FmYXJpUm9vdCkge1xuICAgICAgbG9nLmluZm8oJ0NvdWxkIG5vdCBmaW5kIFNhZmFyaSBzdXBwb3J0IGRpcmVjdG9yaWVzIHRvIGNsZWFuIG91dCBvbGQgJyArXG4gICAgICAgICAgICAgICAnZGF0YS4gUHJvYmFibHkgdGhlcmUgaXMgbm90aGluZyB0byBjbGVhbiBvdXQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGV0IHNhZmFyaUxpYnJhcnlEaXIgPSBwYXRoLnJlc29sdmUoc2FmYXJpUm9vdCwgJ0xpYnJhcnknKTtcbiAgICBsZXQgZmlsZXNUb0RlbGV0ZSA9IFtcbiAgICAgIGBDYWNoZXMvU25hcHNob3RzLyR7TU9CSUxFX1NBRkFSSV9CVU5ETEVfSUR9YCxcbiAgICAgIGBDYWNoZXMvJHtNT0JJTEVfU0FGQVJJX0JVTkRMRV9JRH0vKmAsXG4gICAgICAnQ2FjaGVzL2NvbS5hcHBsZS5XZWJBcHBDYWNoZS8qJyxcbiAgICAgICdDYWNoZXMvY29tLmFwcGxlLldlYktpdC5OZXR3b3JraW5nLyonLFxuICAgICAgJ0NhY2hlcy9jb20uYXBwbGUuV2ViS2l0LldlYkNvbnRlbnQvKicsXG4gICAgICAnSW1hZ2UgQ2FjaGUvKicsXG4gICAgICBgV2ViS2l0LyR7TU9CSUxFX1NBRkFSSV9CVU5ETEVfSUR9LypgLFxuICAgICAgJ1dlYktpdC9HZW9sb2NhdGlvblNpdGVzLnBsaXN0JyxcbiAgICAgICdXZWJLaXQvTG9jYWxTdG9yYWdlLyouKicsXG4gICAgICAnU2FmYXJpLyonLFxuICAgICAgJ0Nvb2tpZXMvKi5iaW5hcnljb29raWVzJyxcbiAgICAgICdDYWNoZXMvY29tLmFwcGxlLlVJU3RhdHVzQmFyLyonLFxuICAgICAgJ0NhY2hlcy9jb20uYXBwbGUua2V5Ym9hcmRzL2ltYWdlcy8qJyxcbiAgICAgICdDYWNoZXMvY29tLmFwcGxlLlNhZmFyaS5TYWZlQnJvd3NpbmcvKicsXG4gICAgICBgLi4vdG1wLyR7TU9CSUxFX1NBRkFSSV9CVU5ETEVfSUR9LypgXG4gICAgXTtcbiAgICBsZXQgZGVsZXRlUHJvbWlzZXMgPSBbXTtcblxuICAgIGZvciAobGV0IGZpbGUgb2YgZmlsZXNUb0RlbGV0ZSkge1xuICAgICAgZGVsZXRlUHJvbWlzZXMucHVzaChmcy5yaW1yYWYocGF0aC5yZXNvbHZlKGxpYnJhcnlEaXIsIGZpbGUpKSk7XG4gICAgICBkZWxldGVQcm9taXNlcy5wdXNoKGZzLnJpbXJhZihwYXRoLnJlc29sdmUoc2FmYXJpTGlicmFyeURpciwgZmlsZSkpKTtcbiAgICB9XG5cbiAgICBpZiAoIWtlZXBQcmVmcykge1xuICAgICAgZGVsZXRlUHJvbWlzZXMucHVzaChmcy5yaW1yYWYocGF0aC5yZXNvbHZlKHNhZmFyaUxpYnJhcnlEaXIsICdQcmVmZXJlbmNlcy8qLnBsaXN0JykpKTtcbiAgICB9XG5cbiAgICBhd2FpdCBCLmFsbChkZWxldGVQcm9taXNlcyk7XG4gIH1cblxuICAvKipcbiAgICogVW5pbnN0YWxsIHRoZSBnaXZlbiBhcHBsaWNhdGlvbiBmcm9tIHRoZSBjdXJyZW50IFNpbXVsYXRvci5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gVGhlIGJ1aW5kbGUgSUQgb2YgdGhlIGFwcGxpY2F0aW9uIHRvIGJlIHJlbW92ZWQuXG4gICAqL1xuICBhc3luYyByZW1vdmVBcHAgKGJ1bmRsZUlkKSB7XG4gICAgYXdhaXQgdGhpcy5zaW1jdGwucmVtb3ZlQXBwKGJ1bmRsZUlkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNb3ZlIGEgYnVpbHQtaW4gYXBwbGljYXRpb24gdG8gYSBuZXcgcGxhY2UgKGFjdHVhbGx5LCByZW5hbWUgaXQpLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwTmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBhcHAgdG8gYmUgbW92ZWQuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBQYXRoIC0gVGhlIGN1cnJlbnQgcGF0aCB0byB0aGUgYXBwbGljYXRpb24uXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBuZXdBcHBQYXRoIC0gVGhlIG5ldyBwYXRoIHRvIHRoZSBhcHBsaWNhdGlvbi5cbiAgICogICBJZiBzb21lIGFwcGxpY2F0aW9uIGFscmVhZHkgZXhpc3RzIGJ5IHRoaXMgcGF0aCB0aGVuIGl0J3MgZ29pbmcgdG8gYmUgcmVtb3ZlZC5cbiAgICovXG4gIGFzeW5jIG1vdmVCdWlsdEluQXBwIChhcHBOYW1lLCBhcHBQYXRoLCBuZXdBcHBQYXRoKSB7XG4gICAgYXdhaXQgc2FmZVJpbVJhZihuZXdBcHBQYXRoKTtcbiAgICBhd2FpdCBmcy5jb3B5RmlsZShhcHBQYXRoLCBuZXdBcHBQYXRoKTtcbiAgICBsb2cuZGVidWcoYENvcGllZCAnJHthcHBOYW1lfScgdG8gJyR7bmV3QXBwUGF0aH0nYCk7XG5cbiAgICBhd2FpdCBmcy5yaW1yYWYoYXBwUGF0aCk7XG4gICAgbG9nLmRlYnVnKGBUZW1wb3JhcmlseSBkZWxldGVkIG9yaWdpbmFsIGFwcCBhdCAnJHthcHBQYXRofSdgKTtcblxuICAgIHJldHVybiBbbmV3QXBwUGF0aCwgYXBwUGF0aF07XG4gIH1cblxuICAvKipcbiAgICogT3BlbiB0aGUgZ2l2ZW4gVVJMIGluIG1vYmlsZSBTYWZhcmkgYnJvd3Nlci5cbiAgICogVGhlIGJyb3dzZXIgd2lsbCBiZSBzdGFydGVkIGF1dG9tYXRpY2FsbHkgaWYgaXQgaXMgbm90IHJ1bm5pbmcuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSBUaGUgVVJMIHRvIGJlIG9wZW5lZC5cbiAgICovXG4gIGFzeW5jIG9wZW5VcmwgKHVybCkge1xuICAgIGNvbnN0IFNBRkFSSV9CT09URURfSU5ESUNBVE9SID0gJ01vYmlsZVNhZmFyaVsnO1xuICAgIGNvbnN0IFNBRkFSSV9TVEFSVFVQX1RJTUVPVVQgPSAxNSAqIDEwMDA7XG4gICAgY29uc3QgRVhUUkFfU1RBUlRVUF9USU1FID0gMyAqIDEwMDA7XG5cbiAgICBpZiAoYXdhaXQgdGhpcy5pc1J1bm5pbmcoKSkge1xuICAgICAgYXdhaXQgcmV0cnkoNTAwMCwgdGhpcy5zaW1jdGwub3BlblVybC5iaW5kKHRoaXMuc2ltY3RsKSwgdXJsKTtcbiAgICAgIGF3YWl0IHRoaXMudGFpbExvZ3NVbnRpbChTQUZBUklfQk9PVEVEX0lORElDQVRPUiwgU0FGQVJJX1NUQVJUVVBfVElNRU9VVCk7XG4gICAgICAvLyBTbyBzb3JyeSwgYnV0IHRoZSBsb2dzIGhhdmUgbm90aGluZyBlbHNlIGZvciBTYWZhcmkgc3RhcnRpbmcuLiBqdXN0IGRlbGF5IGEgbGl0dGxlIGJpdFxuICAgICAgbG9nLmRlYnVnKGBTYWZhcmkgc3RhcnRlZCwgd2FpdGluZyAke0VYVFJBX1NUQVJUVVBfVElNRX1tcyBmb3IgaXQgdG8gZnVsbHkgc3RhcnRgKTtcbiAgICAgIGF3YWl0IEIuZGVsYXkoRVhUUkFfU1RBUlRVUF9USU1FKTtcbiAgICAgIGxvZy5kZWJ1ZygnRG9uZSB3YWl0aW5nIGZvciBTYWZhcmknKTtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUcmllZCB0byBvcGVuIGEgdXJsLCBidXQgdGhlIFNpbXVsYXRvciBpcyBub3QgQm9vdGVkJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFBlcmZvcm0gU2ltdWxhdG9yIGNhY2hlcyBjbGVhbnVwLlxuICAgKlxuICAgKiBAcGFyYW0gey4uLnN0cmluZ30gZm9sZGVyTmFtZXMgLSBUaGUgbmFtZXMgb2YgQ2FjaGVzIHN1YmZvbGRlcnMgdG8gYmUgY2xlYW5lZC5cbiAgICogICBOb24tYWNjZXNzaWJsZS9ub24tZXhpc3Rpbmcgc3ViZm9sZGVycyB3aWxsIGJlIHNraXBwZWQuXG4gICAqICAgQWxsIGV4aXN0aW5nIHN1YmZvbGRlcnMgdW5kZXIgQ2FjaGVzIHdpbGwgYmUgZGVsZXRlZCBpZiB0aGlzIHBhcmFtZXRlciBpcyBvbWl0dGVkLlxuICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgY291bnQgb2YgY2xlYW5lZCBjYWNoZSBpdGVtcy5cbiAgICogICBaZXJvIGlzIHJldHVybmVkIGlmIG5vIGl0ZW1zIHdlcmUgbWF0Y2hlZCBmb3IgY2xlYW51cCAoZWl0aGVyIG5vdCBhY2Nlc3NpYmxlIG9yIG5vdCBkaXJlY3RvcmllcykuXG4gICAqL1xuICBhc3luYyBjbGVhckNhY2hlcyAoLi4uZm9sZGVyTmFtZXMpIHtcbiAgICBjb25zdCBjYWNoZXNSb290ID0gcGF0aC5yZXNvbHZlKHRoaXMuZ2V0RGlyKCksICdMaWJyYXJ5JywgJ0NhY2hlcycpO1xuICAgIGlmICghKGF3YWl0IGZzLmhhc0FjY2VzcyhjYWNoZXNSb290KSkpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgQ2FjaGVzIHJvb3QgYXQgJyR7Y2FjaGVzUm9vdH0nIGRvZXMgbm90IGV4aXN0IG9yIGlzIG5vdCBhY2Nlc3NpYmxlLiBOb3RoaW5nIHRvIGRvIHRoZXJlYCk7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG5cbiAgICBsZXQgaXRlbXNUb1JlbW92ZSA9IGZvbGRlck5hbWVzLmxlbmd0aCA/IGZvbGRlck5hbWVzIDogKGF3YWl0IGZzLnJlYWRkaXIoY2FjaGVzUm9vdCkpO1xuICAgIGl0ZW1zVG9SZW1vdmUgPSBpdGVtc1RvUmVtb3ZlLm1hcCgoeCkgPT4gcGF0aC5yZXNvbHZlKGNhY2hlc1Jvb3QsIHgpKTtcbiAgICBpZiAoZm9sZGVyTmFtZXMubGVuZ3RoKSB7XG4gICAgICBpdGVtc1RvUmVtb3ZlID0gYXdhaXQgQi5maWx0ZXIoaXRlbXNUb1JlbW92ZSwgKHgpID0+IGZzLmhhc0FjY2Vzcyh4KSk7XG4gICAgfVxuICAgIGl0ZW1zVG9SZW1vdmUgPSBhd2FpdCBCLmZpbHRlcihpdGVtc1RvUmVtb3ZlLCBhc3luYyAoeCkgPT4gKGF3YWl0IGZzLnN0YXQoeCkpLmlzRGlyZWN0b3J5KCkpO1xuICAgIGlmICghaXRlbXNUb1JlbW92ZS5sZW5ndGgpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgTm8gU2ltdWxhdG9yIGNhY2hlIGl0ZW1zIGZvciBjbGVhbnVwIHdlcmUgbWF0Y2hlZCBpbiAnJHtjYWNoZXNSb290fSdgKTtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cblxuICAgIGxvZy5kZWJ1ZyhgTWF0Y2hlZCAke3V0aWwucGx1cmFsaXplKCdzaW11bGF0b3IgY2FjaGUgaXRlbScsIGl0ZW1zVG9SZW1vdmUubGVuZ3RoLCB0cnVlKX0gYCArXG4gICAgICBgZm9yIGNsZWFudXA6ICR7aXRlbXNUb1JlbW92ZX1gKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgQi5hbGwoaXRlbXNUb1JlbW92ZSwgKHgpID0+IGZzLnJpbXJhZih4KSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgbG9nLndhcm4oYEdvdCBhbiBleGNlcHRpb24gd2hpbGUgY2xlYW5pbmcgU2ltdWxhdG9yIGNhY2hlczogJHtlLm1lc3NhZ2V9YCk7XG4gICAgfVxuICAgIHJldHVybiBpdGVtc1RvUmVtb3ZlLmxlbmd0aDtcbiAgfVxuXG4gIC8qKlxuICAgKiBCbG9ja3MgdW50aWwgdGhlIGdpdmVuIGluZGljYXRlciBzdHJpbmcgYXBwZWFycyBpbiBTaW11bGF0b3IgbG9ncy5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJvb3RlZEluZGljYXRvciAtIFRoZSBtYWdpYyBzdHJpbmcsIHdoaWNoIGFwcGVhcnMgaW4gbG9ncyBhZnRlciBTaW11bGF0b3IgYm9vdGluZyBpcyBjb21wbGV0ZWQuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB0aW1lb3V0TXMgLSBUaGUgbWF4aW11bW0gbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IGZvciB0aGUgc3RyaW5nIGluZGljYXRvciBwcmVzZW5jZS5cbiAgICogQHJldHVybnMge1Byb21pc2V9IEEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIGlvcyBzaW11bGF0b3IgbG9ncyBvdXRwdXQgYSBsaW5lIG1hdGNoaW5nIGBib290ZWRJbmRpY2F0b3JgXG4gICAqIHRpbWVzIG91dCBhZnRlciB0aW1lb3V0TXNcbiAgICovXG4gIGFzeW5jIHRhaWxMb2dzVW50aWwgKGJvb3RlZEluZGljYXRvciwgdGltZW91dE1zKSB7XG4gICAgbGV0IHNpbUxvZyA9IHBhdGgucmVzb2x2ZSh0aGlzLmdldExvZ0RpcigpLCAnc3lzdGVtLmxvZycpO1xuXG4gICAgLy8gd2UgbmVlZCB0byBtYWtlIHN1cmUgbG9nIGZpbGUgZXhpc3RzIGJlZm9yZSB3ZSBjYW4gdGFpbCBpdFxuICAgIGF3YWl0IHJldHJ5SW50ZXJ2YWwoMjAwLCAyMDAsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBleGlzdHMgPSBhd2FpdCBmcy5leGlzdHMoc2ltTG9nKTtcbiAgICAgIGlmICghZXhpc3RzKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IGZpbmQgU2ltdWxhdG9yIGxvZzogJyR7c2ltTG9nfSdgKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGxvZy5pbmZvKGBTaW11bGF0b3IgbG9nIGF0ICcke3NpbUxvZ30nYCk7XG4gICAgbG9nLmluZm8oYFRhaWxpbmcgc2ltdWxhdG9yIGxvZ3MgdW50aWwgd2UgZW5jb3VudGVyIHRoZSBzdHJpbmcgXCIke2Jvb3RlZEluZGljYXRvcn1cImApO1xuICAgIGxvZy5pbmZvKGBXZSB3aWxsIHRpbWUgb3V0IGFmdGVyICR7dGltZW91dE1zfW1zYCk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRhaWxVbnRpbChzaW1Mb2csIGJvb3RlZEluZGljYXRvciwgdGltZW91dE1zKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy5kZWJ1ZygnU2ltdWxhdG9yIHN0YXJ0dXAgdGltZWQgb3V0LiBDb250aW51aW5nIGFueXdheS4nKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRW5hYmxlIENhbGVuZGFyIGFjY2VzcyBmb3IgdGhlIGdpdmVuIGFwcGxpY2F0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSUQgLSBCdW5kbGUgSUQgb2YgdGhlIGFwcGxpY2F0aW9uLCBmb3Igd2hpY2ggdGhlIGFjY2VzcyBzaG91bGQgYmUgZ3JhbnRlZC5cbiAgICovXG4gIGFzeW5jIGVuYWJsZUNhbGVuZGFyQWNjZXNzIChidW5kbGVJRCkge1xuICAgIGF3YWl0IHRoaXMuY2FsZW5kYXIuZW5hYmxlQ2FsZW5kYXJBY2Nlc3MoYnVuZGxlSUQpO1xuICB9XG5cbiAgLyoqXG4gICAqIERpc2FibGUgQ2FsZW5kYXIgYWNjZXNzIGZvciB0aGUgZ2l2ZW4gYXBwbGljYXRpb24uXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJRCAtIEJ1bmRsZSBJRCBvZiB0aGUgYXBwbGljYXRpb24sIGZvciB3aGljaCB0aGUgYWNjZXNzIHNob3VsZCBiZSBkZW5pZWQuXG4gICAqL1xuICBhc3luYyBkaXNhYmxlQ2FsZW5kYXJBY2Nlc3MgKGJ1bmRsZUlEKSB7XG4gICAgYXdhaXQgdGhpcy5jYWxlbmRhci5kaXNhYmxlQ2FsZW5kYXJBY2Nlc3MoYnVuZGxlSUQpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIHdoZXRoZXIgdGhlIGdpdmVuIGFwcGxpY2F0aW9uIGhhcyBhY2Nlc3MgdG8gQ2FsZW5kYXIuXG4gICAqXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdGhlIGdpdmVuIGFwcGxpY2F0aW9uIGhhcyB0aGUgYWNjZXNzLlxuICAgKi9cbiAgYXN5bmMgaGFzQ2FsZW5kYXJBY2Nlc3MgKGJ1bmRsZUlEKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY2FsZW5kYXIuaGFzQ2FsZW5kYXJBY2Nlc3MoYnVuZGxlSUQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFjdGl2YXRlcyBTaW11bGF0b3Igd2luZG93LlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcmV0dXJucyB7P3N0cmluZ30gSWYgdGhlIG1ldGhvZCByZXR1cm5zIGEgc3RyaW5nIHRoZW4gaXQgc2hvdWxkIGJlIGEgdmFsaWQgQXBwbGUgU2NyaXB0IHdoaWNoXG4gICAqIGlzIGFwcGVuZGVkIGJlZm9yZSBlYWNoIFVJIGNsaWVudCBjb21tYW5kIGlzIGV4ZWN1dGVkLiBPdGhlcndpc2UgdGhlIG1ldGhvZCBzaG91bGQgYWN0aXZhdGUgdGhlIHdpbmRvd1xuICAgKiBpdHNlbGYgYW5kIHJldHVybiBub3RoaW5nLlxuICAgKi9cbiAgYXN5bmMgX2FjdGl2YXRlV2luZG93ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgY29uc3QgcGlkID0gYXdhaXQgdGhpcy5nZXRVSUNsaWVudFBpZCgpO1xuICAgIGlmIChwaWQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBhd2FpdCBhY3RpdmF0ZUFwcChwaWQpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBsb2cuZGVidWcoZS5zdGRlcnIgfHwgZS5tZXNzYWdlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGBcbiAgICAgIHRlbGwgYXBwbGljYXRpb24gXCJTeXN0ZW0gRXZlbnRzXCJcbiAgICAgICAgdGVsbCBwcm9jZXNzIFwiU2ltdWxhdG9yXCJcbiAgICAgICAgICBzZXQgZnJvbnRtb3N0IHRvIGZhbHNlXG4gICAgICAgICAgc2V0IGZyb250bW9zdCB0byB0cnVlXG4gICAgICAgIGVuZCB0ZWxsXG4gICAgICBlbmQgdGVsbFxuICAgIGA7XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSBnaXZlbiBBcHBsZSBTY3JpcHQgaW5zaWRlIGEgY3JpdGljYWwgc2VjdGlvbiwgc28gb3RoZXJcbiAgICogc2Vzc2lvbnMgY2Fubm90IGluZmx1ZW5jZSB0aGUgVUkgY2xpZW50IGF0IHRoZSBzYW1lIHRpbWUuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBsZVNjcmlwdCAtIFRoZSB2YWxpZCBBcHBsZSBTY3JpcHQgc25pcHBldCB0byBiZSBleGVjdXRlZC5cbiAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgc3Rkb3V0IG91dHB1dCBwcm9kdWNlZCBieSB0aGUgc2NyaXB0LlxuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgb3Nhc2NyaXB0IHRvb2wgcmV0dXJucyBub24temVybyBleGl0IGNvZGUuXG4gICAqL1xuICBhc3luYyBleGVjdXRlVUlDbGllbnRTY3JpcHQgKGFwcGxlU2NyaXB0KSB7XG4gICAgY29uc3Qgd2luZG93QWN0aXZhdGlvblNjcmlwdCA9IGF3YWl0IHRoaXMuX2FjdGl2YXRlV2luZG93KCk7XG4gICAgY29uc3QgcmVzdWx0U2NyaXB0ID0gYCR7d2luZG93QWN0aXZhdGlvblNjcmlwdCA/IHdpbmRvd0FjdGl2YXRpb25TY3JpcHQgKyAnXFxuJyA6ICcnfSR7YXBwbGVTY3JpcHR9YDtcbiAgICBsb2cuZGVidWcoYEV4ZWN1dGluZyBVSSBBcHBsZSBTY3JpcHQgb24gU2ltdWxhdG9yIHdpdGggVURJRCAke3RoaXMudWRpZH06ICR7cmVzdWx0U2NyaXB0fWApO1xuICAgIHJldHVybiBhd2FpdCBVSV9DTElFTlRfQUNDRVNTX0dVQVJELmFjcXVpcmUodGhpcy5zaW11bGF0b3JBcHAsIGFzeW5jICgpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYygnb3Nhc2NyaXB0JywgWyctZScsIHJlc3VsdFNjcmlwdF0pO1xuICAgICAgICByZXR1cm4gc3Rkb3V0O1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGxvZy5lcnJvckFuZFRocm93KGBDb3VsZCBub3QgY29tcGxldGUgb3BlcmF0aW9uLiBNYWtlIHN1cmUgU2ltdWxhdG9yIFVJIGlzIHJ1bm5pbmcgYW5kIHRoZSBwYXJlbnQgQXBwaXVtIGFwcGxpY2F0aW9uIChlLiBnLiBBcHBpdW0uYXBwIG9yIFRlcm1pbmFsLmFwcCkgYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGBpcyBwcmVzZW50IGluIFN5c3RlbSBQcmVmZXJlbmNlcyA+IFNlY3VyaXR5ICYgUHJpdmFjeSA+IFByaXZhY3kgPiBBY2Nlc3NpYmlsaXR5IGxpc3QuIElmIHRoZSBvcGVyYXRpb24gaXMgc3RpbGwgdW5zdWNjZXNzZnVsIHRoZW4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGBpdCBpcyBub3Qgc3VwcG9ydGVkIGJ5IHRoaXMgU2ltdWxhdG9yLiBgICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgY3VycmVudCBzdGF0ZSBvZiBCaW9tZXRyaWMgRW5yb2xsbWVudCBmZWF0dXJlLlxuICAgKlxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gRWl0aGVyIHRydWUgb3IgZmFsc2VcbiAgICogQHRocm93cyB7RXJyb3J9IElmIEVucm9sbG1lbnQgc3RhdGUgY2Fubm90IGJlIGRldGVybWluZWRcbiAgICovXG4gIGFzeW5jIGlzQmlvbWV0cmljRW5yb2xsZWQgKCkge1xuICAgIGNvbnN0IG91dHB1dCA9IGF3YWl0IHRoaXMuZXhlY3V0ZVVJQ2xpZW50U2NyaXB0KGBcbiAgICAgIHRlbGwgYXBwbGljYXRpb24gXCJTeXN0ZW0gRXZlbnRzXCJcbiAgICAgICAgdGVsbCBwcm9jZXNzIFwiU2ltdWxhdG9yXCJcbiAgICAgICAgICBzZXQgZHN0TWVudUl0ZW0gdG8gbWVudSBpdGVtIFwiVG91Y2ggSUQgRW5yb2xsZWRcIiBvZiBtZW51IDEgb2YgbWVudSBiYXIgaXRlbSBcIkhhcmR3YXJlXCIgb2YgbWVudSBiYXIgMVxuICAgICAgICAgIHNldCBpc0NoZWNrZWQgdG8gKHZhbHVlIG9mIGF0dHJpYnV0ZSBcIkFYTWVudUl0ZW1NYXJrQ2hhclwiIG9mIGRzdE1lbnVJdGVtKSBpcyBcIuKck1wiXG4gICAgICAgIGVuZCB0ZWxsXG4gICAgICBlbmQgdGVsbFxuICAgIGApO1xuICAgIGxvZy5kZWJ1ZyhgVG91Y2ggSUQgZW5yb2xsZWQgc3RhdGU6ICR7b3V0cHV0fWApO1xuICAgIHJldHVybiBfLmlzU3RyaW5nKG91dHB1dCkgJiYgb3V0cHV0LnRyaW0oKSA9PT0gJ3RydWUnO1xuICB9XG5cbiAgLyoqXG4gICAqIEVucm9sbHMgYmlvbWV0cmljIChUb3VjaElkLCBGYWNlSWQpIGZlYXR1cmUgdGVzdGluZyBpbiBTaW11bGF0b3IgVUkgY2xpZW50LlxuICAgKlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGlzRW5hYmxlZCAtIERlZmluZXMgd2hldGhlciBiaW9tZXRyaWMgc3RhdGUgaXMgZW5hYmxlZC9kaXNhYmxlZFxuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGVucm9sbGVkIHN0YXRlIGNhbm5vdCBiZSBjaGFuZ2VkXG4gICAqL1xuICBhc3luYyBlbnJvbGxCaW9tZXRyaWMgKGlzRW5hYmxlZCA9IHRydWUpIHtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVVSUNsaWVudFNjcmlwdChgXG4gICAgICB0ZWxsIGFwcGxpY2F0aW9uIFwiU3lzdGVtIEV2ZW50c1wiXG4gICAgICAgIHRlbGwgcHJvY2VzcyBcIlNpbXVsYXRvclwiXG4gICAgICAgICAgc2V0IGRzdE1lbnVJdGVtIHRvIG1lbnUgaXRlbSBcIlRvdWNoIElEIEVucm9sbGVkXCIgb2YgbWVudSAxIG9mIG1lbnUgYmFyIGl0ZW0gXCJIYXJkd2FyZVwiIG9mIG1lbnUgYmFyIDFcbiAgICAgICAgICBzZXQgaXNDaGVja2VkIHRvICh2YWx1ZSBvZiBhdHRyaWJ1dGUgXCJBWE1lbnVJdGVtTWFya0NoYXJcIiBvZiBkc3RNZW51SXRlbSkgaXMgXCLinJNcIlxuICAgICAgICAgIGlmICR7aXNFbmFibGVkID8gJ25vdCAnIDogJyd9aXNDaGVja2VkIHRoZW5cbiAgICAgICAgICAgIGNsaWNrIGRzdE1lbnVJdGVtXG4gICAgICAgICAgZW5kIGlmXG4gICAgICAgIGVuZCB0ZWxsXG4gICAgICBlbmQgdGVsbFxuICAgIGApO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbmRzIGEgbm90aWZpY2F0aW9uIHRvIG1hdGNoL25vdCBtYXRjaCB0aGUgdG91Y2ggaWQuXG4gICAqXG4gICAqIEBwYXJhbSB7P2Jvb2xlYW59IHNob3VsZE1hdGNoIFt0cnVlXSAtIFNldCBpdCB0byB0cnVlIG9yIGZhbHNlIGluIG9yZGVyIHRvIGVtdWxhdGVcbiAgICogbWF0Y2hpbmcvbm90IG1hdGNoaW5nIHRoZSBjb3JyZXNwb25kaW5nIGJpb21ldHJpY1xuICAgKi9cbiAgYXN5bmMgc2VuZEJpb21ldHJpY01hdGNoIChzaG91bGRNYXRjaCA9IHRydWUpIHtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVVSUNsaWVudFNjcmlwdChgXG4gICAgICB0ZWxsIGFwcGxpY2F0aW9uIFwiU3lzdGVtIEV2ZW50c1wiXG4gICAgICAgIHRlbGwgcHJvY2VzcyBcIlNpbXVsYXRvclwiXG4gICAgICAgICAgc2V0IGRzdE1lbnVJdGVtIHRvIG1lbnUgaXRlbSBcIiR7c2hvdWxkTWF0Y2ggPyAnTWF0Y2hpbmcnIDogJ05vbi1tYXRjaGluZyd9XCIgb2YgbWVudSAxIG9mIG1lbnUgaXRlbSBcIlNpbXVsYXRlIEZpbmdlciBUb3VjaFwiIG9mIG1lbnUgMSBvZiBtZW51IGJhciBpdGVtIFwiSGFyZHdhcmVcIiBvZiBtZW51IGJhciAxXG4gICAgICAgICAgY2xpY2sgZHN0TWVudUl0ZW1cbiAgICAgICAgZW5kIHRlbGxcbiAgICAgIGVuZCB0ZWxsXG4gICAgYCk7XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSBhIHNwZWNpYWwgQXBwbGUgc2NyaXB0LCB3aGljaCBjbGlja3MgdGhlIHBhcnRpY3VsYXIgYnV0dG9uIG9uIERhdGFiYXNlIGFsZXJ0LlxuICAgKlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGluY3JlYXNlIC0gQ2xpY2sgdGhlIGJ1dHRvbiB3aXRoICdJbmNyZWFzZScgdGl0bGUgb24gdGhlIGFsZXJ0IGlmIHRoaXNcbiAgICogICBwYXJhbWV0ZXIgaXMgdHJ1ZS4gVGhlICdDYW5jZWwnIGJ1dHRvbiB3aWxsIGJlIGNsaWNrZWQgb3RoZXJ3aXNlLlxuICAgKi9cbiAgYXN5bmMgZGlzbWlzc0RhdGFiYXNlQWxlcnQgKGluY3JlYXNlID0gdHJ1ZSkge1xuICAgIGxldCBidXR0b24gPSBpbmNyZWFzZSA/ICdJbmNyZWFzZScgOiAnQ2FuY2VsJztcbiAgICBsb2cuZGVidWcoYEF0dGVtcHRpbmcgdG8gZGlzbWlzcyBkYXRhYmFzZSBhbGVydCB3aXRoICcke2J1dHRvbn0nIGJ1dHRvbmApO1xuICAgIGF3YWl0IHRoaXMuZXhlY3V0ZVVJQ2xpZW50U2NyaXB0KGBcbiAgICAgIHRlbGwgYXBwbGljYXRpb24gXCJTeXN0ZW0gRXZlbnRzXCJcbiAgICAgICAgdGVsbCBwcm9jZXNzIFwiU2ltdWxhdG9yXCJcbiAgICAgICAgICBjbGljayBidXR0b24gXCIke2J1dHRvbn1cIiBvZiB3aW5kb3cgMVxuICAgICAgICBlbmQgdGVsbFxuICAgICAgZW5kIHRlbGxcbiAgICBgKTtcbiAgfVxuXG4gIC8vcmVnaW9uIEtleWNoYWlucyBJbnRlcmFjdGlvblxuICAvKipcbiAgICogQ3JlYXRlIHRoZSBiYWNrdXAgb2Yga2V5Y2hhaW5zIGZvbGRlci5cbiAgICogVGhlIHByZXZpb3VzbHkgY3JlYXRlZCBiYWNrdXAgd2lsbCBiZSBhdXRvbWF0aWNhbGx5XG4gICAqIGRlbGV0ZWQgaWYgdGhpcyBtZXRob2Qgd2FzIGNhbGxlZCB0d2ljZSBpbiBhIHJvdyB3aXRob3V0XG4gICAqIGByZXN0b3JlS2V5Y2hhaW5zYCBiZWluZyBpbnZva2VkLlxuICAgKlxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgYmFja3VwIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bGwuXG4gICAqL1xuICBhc3luYyBiYWNrdXBLZXljaGFpbnMgKCkge1xuICAgIGlmICghYXdhaXQgZnMuZXhpc3RzKHRoaXMua2V5Y2hhaW5QYXRoKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IGJhY2t1cFBhdGggPSBhd2FpdCB0ZW1wRGlyLnBhdGgoe1xuICAgICAgcHJlZml4OiBga2V5Y2hhaW5zX2JhY2t1cF8ke01hdGguZmxvb3IoKDEgKyBNYXRoLnJhbmRvbSgpKSAqIDB4MTAwMDApLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMSl9YCxcbiAgICAgIHN1ZmZpeDogJy56aXAnLFxuICAgIH0pO1xuICAgIGNvbnN0IHppcEFyZ3MgPSBbXG4gICAgICAnLXInLCBiYWNrdXBQYXRoLFxuICAgICAgYCR7dGhpcy5rZXljaGFpblBhdGh9JHtwYXRoLnNlcH1gXG4gICAgXTtcbiAgICBsb2cuZGVidWcoYENyZWF0aW5nIGtleWNoYWlucyBiYWNrdXAgd2l0aCAnemlwICR7emlwQXJncy5qb2luKCcgJyl9JyBjb21tYW5kYCk7XG4gICAgYXdhaXQgZXhlYygnemlwJywgemlwQXJncyk7XG4gICAgaWYgKF8uaXNTdHJpbmcodGhpcy5fa2V5Y2hhaW5zQmFja3VwUGF0aCkgJiYgYXdhaXQgZnMuZXhpc3RzKHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgpKSB7XG4gICAgICBhd2FpdCBmcy51bmxpbmsodGhpcy5fa2V5Y2hhaW5zQmFja3VwUGF0aCk7XG4gICAgfVxuICAgIHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGggPSBiYWNrdXBQYXRoO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc3RvcmUgdGhlIHByZXZpc291bHkgY3JlYXRlZCBrZXljaGFpbnMgYmFja3VwLlxuICAgKlxuICAgKiBAcGFyYW0gez9zdHJpbmd8QXJyYXk8c3RyaW5nPn0gZXhjbHVkZVBhdHRlcm5zIC0gVGhlIGxpc3RcbiAgICogb2YgZmlsZSBuYW1lIHBhdHRlcm5zIHRvIGJlIGV4Y2x1ZGVkIGZyb20gcmVzdG9yZS4gVGhlIGZvcm1hdFxuICAgKiBvZiBlYWNoIGl0ZW0gc2hvdWxkIGJlIHRoZSBzYW1lIGFzICcteCcgb3B0aW9uIGZvcm1hdCBmb3JcbiAgICogJ3VuemlwJyB1dGlsaXR5LiBUaGlzIGNhbiBhbHNvIGJlIGEgY29tbWEtc2VwYXJhdGVkIHN0cmluZyxcbiAgICogd2hpY2ggaXMgZ29pbmcgYmUgdHJhbnNmb3JtZWQgaW50byBhIGxpc3QgYXV0b21hdGljYWxseSxcbiAgICogZm9yIGV4YW1wbGU6ICcqLmRiKixibGFibGEuc3FsaXRlJ1xuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gSWYgdGhlIHJlc3RvcmUgb3ByYXRpb24gd2FzIHN1Y2Nlc3NmdWwuXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSBpcyBubyBrZXljaGFpbnMgYmFja3VwIGF2YWlsYWJsZSBmb3IgcmVzdG9yZS5cbiAgICovXG4gIGFzeW5jIHJlc3RvcmVLZXljaGFpbnMgKGV4Y2x1ZGVQYXR0ZXJucyA9IFtdKSB7XG4gICAgaWYgKCFfLmlzU3RyaW5nKHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgpIHx8ICFhd2FpdCBmcy5leGlzdHModGhpcy5fa2V5Y2hhaW5zQmFja3VwUGF0aCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGtleWNoYWlucyBiYWNrdXAgYXJjaGl2ZSBkb2VzIG5vdCBleGlzdC4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgYEFyZSB5b3Ugc3VyZSBpdCB3YXMgY3JlYXRlZCBiZWZvcmU/YCk7XG4gICAgfVxuXG4gICAgaWYgKF8uaXNTdHJpbmcoZXhjbHVkZVBhdHRlcm5zKSkge1xuICAgICAgZXhjbHVkZVBhdHRlcm5zID0gZXhjbHVkZVBhdHRlcm5zLnNwbGl0KCcsJykubWFwKCh4KSA9PiB4LnRyaW0oKSk7XG4gICAgfVxuICAgIGNvbnN0IGlzU2VydmVyUnVubmluZyA9IGF3YWl0IHRoaXMuaXNSdW5uaW5nKCk7XG4gICAgbGV0IHBsaXN0UGF0aDtcbiAgICBpZiAoaXNTZXJ2ZXJSdW5uaW5nKSB7XG4gICAgICBwbGlzdFBhdGggPSBwYXRoLnJlc29sdmUoYXdhaXQgdGhpcy5nZXRMYXVuY2hEYWVtb25zUm9vdCgpLCAnY29tLmFwcGxlLnNlY3VyaXR5ZC5wbGlzdCcpO1xuICAgICAgaWYgKCFhd2FpdCBmcy5leGlzdHMocGxpc3RQYXRoKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBjbGVhciBrZXljaGFpbnMgYmVjYXVzZSAnJHtwbGlzdFBhdGh9JyBkb2VzIG5vdCBleGlzdGApO1xuICAgICAgfVxuICAgICAgYXdhaXQgdGhpcy5zaW1jdGwuc3Bhd25Qcm9jZXNzKFsnbGF1bmNoY3RsJywgJ3VubG9hZCcsIHBsaXN0UGF0aF0pO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgYXdhaXQgZnMucmltcmFmKHRoaXMua2V5Y2hhaW5QYXRoKTtcbiAgICAgIGF3YWl0IG1rZGlycCh0aGlzLmtleWNoYWluUGF0aCk7XG4gICAgICBjb25zdCB1bnppcEFyZ3MgPSBbXG4gICAgICAgICctbycsIHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgsXG4gICAgICAgIC4uLihfLmZsYXRNYXAoZXhjbHVkZVBhdHRlcm5zLm1hcCgoeCkgPT4gWycteCcsIHhdKSkpLFxuICAgICAgICAnLWQnLCAnLydcbiAgICAgIF07XG4gICAgICBsb2cuZGVidWcoYFJlc3RvcmluZyBrZXljaGFpbnMgd2l0aCAndW56aXAgJHt1bnppcEFyZ3Muam9pbignICcpfScgY29tbWFuZGApO1xuICAgICAgYXdhaXQgZXhlYygndW56aXAnLCB1bnppcEFyZ3MpO1xuICAgICAgYXdhaXQgZnMudW5saW5rKHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgpO1xuICAgICAgdGhpcy5fa2V5Y2hhaW5zQmFja3VwUGF0aCA9IG51bGw7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGlmIChpc1NlcnZlclJ1bm5pbmcgJiYgcGxpc3RQYXRoKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuc2ltY3RsLnNwYXduUHJvY2VzcyhbJ2xhdW5jaGN0bCcsICdsb2FkJywgcGxpc3RQYXRoXSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFycyBLZXljaGFpbnMgZm9yIHRoZSBwYXJ0aWN1bGFyIHNpbXVsYXRvciBpbiBydW50aW1lICh0aGVyZSBpcyBubyBuZWVkIHRvIHN0b3AgaXQpLlxuICAgKlxuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYga2V5Y2hhaW4gY2xlYW51cCBoYXMgZmFpbGVkLlxuICAgKi9cbiAgYXN5bmMgY2xlYXJLZXljaGFpbnMgKCkge1xuICAgIGNvbnN0IHBsaXN0UGF0aCA9IHBhdGgucmVzb2x2ZShhd2FpdCB0aGlzLmdldExhdW5jaERhZW1vbnNSb290KCksICdjb20uYXBwbGUuc2VjdXJpdHlkLnBsaXN0Jyk7XG4gICAgaWYgKCFhd2FpdCBmcy5leGlzdHMocGxpc3RQYXRoKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgY2xlYXIga2V5Y2hhaW5zIGJlY2F1c2UgJyR7cGxpc3RQYXRofScgZG9lcyBub3QgZXhpc3RgKTtcbiAgICB9XG4gICAgYXdhaXQgdGhpcy5zaW1jdGwuc3Bhd25Qcm9jZXNzKFsnbGF1bmNoY3RsJywgJ3VubG9hZCcsIHBsaXN0UGF0aF0pO1xuICAgIHRyeSB7XG4gICAgICBpZiAoYXdhaXQgZnMuZXhpc3RzKHRoaXMua2V5Y2hhaW5QYXRoKSkge1xuICAgICAgICBhd2FpdCBmcy5yaW1yYWYodGhpcy5rZXljaGFpblBhdGgpO1xuICAgICAgICBhd2FpdCBta2RpcnAodGhpcy5rZXljaGFpblBhdGgpO1xuICAgICAgfVxuICAgIH0gZmluYWxseSB7XG4gICAgICBhd2FpdCB0aGlzLnNpbWN0bC5zcGF3blByb2Nlc3MoWydsYXVuY2hjdGwnLCAnbG9hZCcsIHBsaXN0UGF0aF0pO1xuICAgIH1cbiAgfVxuXG4gIC8vZW5kcmVnaW9uXG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IFByb2Nlc3NJbmZvXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBwaWQgVGhlIGFjdHVhbCBwcm9jZXNzIGlkZW50aWZpZXIuXG4gICAqIENvdWxkIGJlIHplcm8gaWYgdGhlIHByb2Nlc3MgaXMgdGhlIHN5c3RlbSBvbmUuXG4gICAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gZ3JvdXAgVGhlIHByb2Nlc3MgZ3JvdXAgaWRlbnRpZmllci5cbiAgICogVGhpcyBjb3VsZCBiZSBgbnVsbGAgaWYgdGhlIHByb2Nlc3MgaXMgbm90IGEgcGFydCBvZiB0aGVcbiAgICogcGFydGljdWxhciBncm91cC4gRm9yIGBub3JtYWxgIGFwcGxpY2F0aW9uIHByb2Nlc3NlcyB0aGUgZ3JvdXBcbiAgICogbmFtZSB1c3VhbGx5IGVxdWFscyB0byBgVUlLaXRBcHBsaWNhdGlvbmAuXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBuYW1lIFRoZSBwcm9jZXNzIG5hbWUsIGZvciBleGFtcGxlXG4gICAqIGBjb20uYXBwbGUuUHJlZmVyZW5jZXNgXG4gICAqL1xuXG4gIC8qKlxuICAgKiBMaXN0cyBwcm9jZXNzZXMgdGhhdCBhcmUgY3VycmVudGx5IHJ1bm5pbmcgb24gdGhlIGdpdmVuIFNpbXVsYXRvci5cbiAgICogVGhlIHNpbXVsYXRvciBtdXN0IGJlIGluIHJ1bm5pbmcgc3RhdGUgaW4gb3JkZXIgZm9yIHRoaXNcbiAgICogbWV0aG9kIHRvIHdvcmsgcHJvcGVybHkuXG4gICAqXG4gICAqIEByZXR1cm4ge0FycmF5PFByb2Nlc3NJbmZvPn0gVGhlIGxpc3Qgb2YgcmV0cmlldmVkIHByb2Nlc3NcbiAgICogaW5mb3JtYXRpb25cbiAgICogQHRocm93cyB7RXJyb3J9IGlmIG5vIHByb2Nlc3MgaW5mb3JtYXRpb24gY291bGQgYmUgcmV0cmlldmVkLlxuICAgKi9cbiAgYXN5bmMgcHMgKCkge1xuICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgdGhpcy5zaW1jdGwuc3Bhd25Qcm9jZXNzKFtcbiAgICAgICdsYXVuY2hjdGwnLFxuICAgICAgJ3ByaW50JyxcbiAgICAgICdzeXN0ZW0nLFxuICAgIF0pO1xuXG4gICAgY29uc3Qgc2VydmljZXNNYXRjaCA9IC9eXFxzKnNlcnZpY2VzXFxzKj1cXHMqeyhbXn1dKykvbS5leGVjKHN0ZG91dCk7XG4gICAgaWYgKCFzZXJ2aWNlc01hdGNoKSB7XG4gICAgICBsb2cuZGVidWcoc3Rkb3V0KTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGxpc3Qgb2YgYWN0aXZlIHByb2Nlc3NlcyBjYW5ub3QgYmUgcmV0cmlldmVkYCk7XG4gICAgfVxuICAgIC8qXG4gICAgRXhhbXBsZSBtYXRjaDpcbiAgICAgICAgMCAgICAgNzggXHRjb20uYXBwbGUucmVzb3VyY2VncmFiYmVyZFxuICAgIDgyMTU4ICAgICAgLSBcdGNvbS5hcHBsZS5hc3Npc3RhbnRfc2VydmljZVxuICAgIDgyMTIwICAgICAgLSBcdGNvbS5hcHBsZS5uYW5vcmVnaXN0cnlkXG4gICAgODIwODcgICAgICAtIFx0Y29tLmFwcGxlLm5vdGlmeWRcbiAgICA4MjI2NCAgICAgIC0gXHRVSUtpdEFwcGxpY2F0aW9uOmNvbS5hcHBsZS5QcmVmZXJlbmNlc1s3MDRiXVtyYi1sZWdhY3ldXG4gICAgKi9cbiAgICBjb25zdCByZXN1bHQgPSBbXTtcbiAgICBjb25zdCBwYXR0ZXJuID0gL15cXHMqKFxcZCspXFxzK1tcXGQtXStcXHMrKFtcXHdcXC0uXSs6KT8oW1xcd1xcLS5dKykvZ207XG4gICAgbGV0IG1hdGNoO1xuICAgIHdoaWxlICgobWF0Y2ggPSBwYXR0ZXJuLmV4ZWMoc2VydmljZXNNYXRjaFsxXSkpKSB7XG4gICAgICByZXN1bHQucHVzaCh7XG4gICAgICAgIHBpZDogcGFyc2VJbnQobWF0Y2hbMV0sIDEwKSxcbiAgICAgICAgZ3JvdXA6IF8udHJpbUVuZChtYXRjaFsyXSwgJzonKSB8fCBudWxsLFxuICAgICAgICBuYW1lOiBtYXRjaFszXSxcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIHBhcnRpY3VsYXIgcGVybWlzc2lvbiB0byB0aGUgYXBwbGljYXRpb24gYnVuZGxlLiBTZWVcbiAgICogaHR0cHM6Ly9naXRodWIuY29tL3dpeC9BcHBsZVNpbXVsYXRvclV0aWxzIGZvciBtb3JlIGRldGFpbHMgb25cbiAgICogdGhlIGF2YWlsYWJsZSBzZXJ2aWNlIG5hbWVzIGFuZCBzdGF0dXNlcy5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gQXBwbGljYXRpb24gYnVuZGxlIGlkZW50aWZpZXIuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwZXJtaXNzaW9uIC0gU2VydmljZSBuYW1lIHRvIGJlIHNldC5cbiAgICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlIC0gVGhlIGRlc2lyZWQgc3RhdHVzIGZvciB0aGUgc2VydmljZS5cbiAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSBjaGFuZ2luZyBwZXJtaXNzaW9uLlxuICAgKi9cbiAgYXN5bmMgc2V0UGVybWlzc2lvbiAoYnVuZGxlSWQsIHBlcm1pc3Npb24sIHZhbHVlKSB7XG4gICAgYXdhaXQgdGhpcy5zZXRQZXJtaXNzaW9ucyhidW5kbGVJZCwge1twZXJtaXNzaW9uXTogdmFsdWV9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBwZXJtaXNzaW9ucyBmb3IgdGhlIHBhcnRpY3VsYXIgYXBwbGljYXRpb24gYnVuZGxlLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSWQgLSBBcHBsaWNhdGlvbiBidW5kbGUgaWRlbnRpZmllci5cbiAgICogQHBhcmFtIHtPYmplY3R9IHBlcm1pc3Npb25zTWFwcGluZyAtIEEgbWFwcGluZyB3aGVyZSBrYXlzXG4gICAqIGFyZSBzZXJ2aWNlIG5hbWVzIGFuZCB2YWx1ZXMgYXJlIHRoZWlyIGNvcnJlc3BvbmRpbmcgc3RhdHVzIHZhbHVlcy5cbiAgICogU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS93aXgvQXBwbGVTaW11bGF0b3JVdGlsc1xuICAgKiBmb3IgbW9yZSBkZXRhaWxzIG9uIGF2YWlsYWJsZSBzZXJ2aWNlIG5hbWVzIGFuZCBzdGF0dXNlcy5cbiAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSBjaGFuZ2luZyBwZXJtaXNzaW9ucy5cbiAgICovXG4gIGFzeW5jIHNldFBlcm1pc3Npb25zIChidW5kbGVJZCwgcGVybWlzc2lvbnNNYXBwaW5nKSB7XG4gICAgbG9nLmRlYnVnKGBTZXR0aW5nIGFjY2VzcyBmb3IgJyR7YnVuZGxlSWR9JzogYCArXG4gICAgICBKU09OLnN0cmluZ2lmeShwZXJtaXNzaW9uc01hcHBpbmcsIG51bGwsIDIpKTtcbiAgICBhd2FpdCB0aGlzLnBlcm1pc3Npb25zLnNldEFjY2VzcyhidW5kbGVJZCwgcGVybWlzc2lvbnNNYXBwaW5nKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgY3VycmVudCBwZXJtaXNzaW9uIHN0YXR1cyBmb3IgdGhlIGdpdmVuIGFwcGxpY2F0aW9uIGJ1bmRsZS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gQXBwbGljYXRpb24gYnVuZGxlIGlkZW50aWZpZXIuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzZXJ2aWNlTmFtZSAtIE9uZSBvZiBhdmFpbGFibGUgc2VydmljZSBuYW1lcy5cbiAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSByZXRyaWV2aW5nIHBlcm1pc3Npb25zLlxuICAgKi9cbiAgYXN5bmMgZ2V0UGVybWlzc2lvbiAoYnVuZGxlSWQsIHNlcnZpY2VOYW1lKSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5wZXJtaXNzaW9ucy5nZXRBY2Nlc3MoYnVuZGxlSWQsIHNlcnZpY2VOYW1lKTtcbiAgICBsb2cuZGVidWcoYEdvdCAke3NlcnZpY2VOYW1lfSBhY2Nlc3Mgc3RhdHVzIGZvciAnJHtidW5kbGVJZH0nOiAke3Jlc3VsdH1gKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgdGhlIGdpdmVuIGNlcnRpZmljYXRlIGludG8gdGhlIFRydXN0ZWQgUm9vdCBTdG9yZSBvbiB0aGUgc2ltdWxhdG9yLlxuICAgKiBUaGUgc2ltdWxhdG9yIG11c3QgYmUgc2h1dCBkb3duIGluIG9yZGVyIGZvciB0aGlzIG1ldGhvZCB0byB3b3JrIHByb3Blcmx5LlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gcGF5bG9hZCB0aGUgY29udGVudCBvZiB0aGUgUEVNIGNlcnRpZmljYXRlXG4gICAqIEByZXR1cm5zIHtib29sZWFufSBgdHJ1ZWAgaWYgdGhlIGNlcnRpZmljYXRlIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBpbnN0YWxsZWRcbiAgICogb3IgYGZhbHNlYCBpZiBpdCBoYXMgYWxyZWFkeSBiZWVuIHRoZXJlXG4gICAqL1xuICBhc3luYyBhZGRDZXJ0aWZpY2F0ZSAocGF5bG9hZCwgLyogb3B0cyA9IHt9ICovKSB7XG4gICAgaWYgKGF3YWl0IGhhc1NTTENlcnQocGF5bG9hZCwgdGhpcy51ZGlkKSkge1xuICAgICAgbG9nLmluZm8oYFNTTCBjZXJ0aWZpY2F0ZSAnJHtfLnRydW5jYXRlKHBheWxvYWQsIHtsZW5ndGg6IDIwfSl9JyBhbHJlYWR5IGluc3RhbGxlZGApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBsb2cuaW5mbyhgSW5zdGFsbGluZyBTU0wgcm9vdCBjZXJ0aWZpY2F0ZSAnJHtfLnRydW5jYXRlKHBheWxvYWQsIHtsZW5ndGg6IDIwfSl9J2ApO1xuICAgIGF3YWl0IGluc3RhbGxTU0xDZXJ0KHBheWxvYWQsIHRoaXMudWRpZCk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogU2ltdWxhdGVzIHB1c2ggbm90aWZpY2F0aW9uIGRlbGl2ZXJ5XG4gICAqXG4gICAqIEBzaW5jZSBYY29kZSBTREsgMTEuNFxuICAgKi9cbiAgYXN5bmMgcHVzaE5vdGlmaWNhdGlvbiAoLyogcGF5bG9hZCAqLykgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFhjb2RlIFNESyAnJHt0aGlzLnhjb2RlVmVyc2lvbn0nIGlzIHRvbyBvbGQgdG8gcHVzaCBub3RpZmljYXRpb25zYCk7XG4gIH1cblxuICBhc3luYyBnZXRMYXVuY2hEYWVtb25zUm9vdCAoKSB7XG4gICAgY29uc3QgZGV2Um9vdCA9IGF3YWl0IGdldERldmVsb3BlclJvb3QoKTtcbiAgICByZXR1cm4gcGF0aC5yZXNvbHZlKGRldlJvb3QsXG4gICAgICAnUGxhdGZvcm1zL2lQaG9uZVNpbXVsYXRvci5wbGF0Zm9ybS9EZXZlbG9wZXIvU0RLcy9pUGhvbmVTaW11bGF0b3Iuc2RrL1N5c3RlbS9MaWJyYXJ5L0xhdW5jaERhZW1vbnMnKTtcbiAgfVxuXG4gIHN0YXRpYyBhc3luYyBfZ2V0RGV2aWNlU3RyaW5nUGxhdGZvcm1WZXJzaW9uIChwbGF0Zm9ybVZlcnNpb24pIHtcbiAgICBsZXQgcmVxVmVyc2lvbiA9IHBsYXRmb3JtVmVyc2lvbjtcbiAgICBpZiAoIXJlcVZlcnNpb24pIHtcbiAgICAgIHJlcVZlcnNpb24gPSBhd2FpdCB4Y29kZS5nZXRNYXhJT1NTREsoKTtcbiAgICAgIGxvZy53YXJuKGBObyBwbGF0Zm9ybSB2ZXJzaW9uIHNldC4gVXNpbmcgbWF4IFNESyB2ZXJzaW9uOiAke3JlcVZlcnNpb259YCk7XG4gICAgICAvLyB0aGlzIHdpbGwgYmUgYSBudW1iZXIsIGFuZCBwb3NzaWJseSBhbiBpbnRlZ2VyIChlLmcuLCBpZiBtYXggaU9TIFNESyBpcyA5KVxuICAgICAgLy8gc28gdHVybiBpdCBpbnRvIGEgc3RyaW5nIGFuZCBhZGQgYSAuMCBpZiBuZWNlc3NhcnlcbiAgICAgIGlmICghXy5pc1N0cmluZyhyZXFWZXJzaW9uKSkge1xuICAgICAgICByZXFWZXJzaW9uID0gKHJlcVZlcnNpb24gJSAxKSA/IFN0cmluZyhyZXFWZXJzaW9uKSA6IGAke3JlcVZlcnNpb259LjBgO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVxVmVyc2lvbjtcbiAgfVxuXG4gIC8vIGNoYW5nZSB0aGUgZm9ybWF0IGluIHN1YmNsYXNzZXMsIGFzIG5lY2Vzc2FyeVxuICBzdGF0aWMgYXN5bmMgX2dldERldmljZVN0cmluZ1ZlcnNpb25TdHJpbmcgKHBsYXRmb3JtVmVyc2lvbikge1xuICAgIGxldCByZXFWZXJzaW9uID0gYXdhaXQgdGhpcy5fZ2V0RGV2aWNlU3RyaW5nUGxhdGZvcm1WZXJzaW9uKHBsYXRmb3JtVmVyc2lvbik7XG5cbiAgICByZXR1cm4gYCgke3JlcVZlcnNpb259IFNpbXVsYXRvcilgO1xuICB9XG5cbiAgLy8gY2hhbmdlIHRoZSBmb3JtYXQgaW4gc3ViY2xhc3NlcywgYXMgbmVjZXNzYXJ5XG4gIHN0YXRpYyBfZ2V0RGV2aWNlU3RyaW5nQ29uZmlnRml4ICgpIHtcbiAgICAvLyBzb21lIGRldmljZXMgbmVlZCB0byBiZSB1cGRhdGVkXG4gICAgcmV0dXJuIHtcbiAgICAgICdpUGFkIFNpbXVsYXRvciAoNy4xIFNpbXVsYXRvciknOiAnaVBhZCAyICg3LjEgU2ltdWxhdG9yKScsXG4gICAgICAnaVBhZCBTaW11bGF0b3IgKDguMCBTaW11bGF0b3IpJzogJ2lQYWQgMiAoOC4wIFNpbXVsYXRvciknLFxuICAgICAgJ2lQYWQgU2ltdWxhdG9yICg4LjEgU2ltdWxhdG9yKSc6ICdpUGFkIDIgKDguMSBTaW11bGF0b3IpJyxcbiAgICAgICdpUGFkIFNpbXVsYXRvciAoOC4yIFNpbXVsYXRvciknOiAnaVBhZCAyICg4LjIgU2ltdWxhdG9yKScsXG4gICAgICAnaVBhZCBTaW11bGF0b3IgKDguMyBTaW11bGF0b3IpJzogJ2lQYWQgMiAoOC4zIFNpbXVsYXRvciknLFxuICAgICAgJ2lQYWQgU2ltdWxhdG9yICg4LjQgU2ltdWxhdG9yKSc6ICdpUGFkIDIgKDguNCBTaW11bGF0b3IpJyxcbiAgICAgICdpUGhvbmUgU2ltdWxhdG9yICg3LjEgU2ltdWxhdG9yKSc6ICdpUGhvbmUgNXMgKDcuMSBTaW11bGF0b3IpJyxcbiAgICAgICdpUGhvbmUgU2ltdWxhdG9yICg4LjQgU2ltdWxhdG9yKSc6ICdpUGhvbmUgNiAoOC40IFNpbXVsYXRvciknLFxuICAgICAgJ2lQaG9uZSBTaW11bGF0b3IgKDguMyBTaW11bGF0b3IpJzogJ2lQaG9uZSA2ICg4LjMgU2ltdWxhdG9yKScsXG4gICAgICAnaVBob25lIFNpbXVsYXRvciAoOC4yIFNpbXVsYXRvciknOiAnaVBob25lIDYgKDguMiBTaW11bGF0b3IpJyxcbiAgICAgICdpUGhvbmUgU2ltdWxhdG9yICg4LjEgU2ltdWxhdG9yKSc6ICdpUGhvbmUgNiAoOC4xIFNpbXVsYXRvciknLFxuICAgICAgJ2lQaG9uZSBTaW11bGF0b3IgKDguMCBTaW11bGF0b3IpJzogJ2lQaG9uZSA2ICg4LjAgU2ltdWxhdG9yKSdcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFRha2VzIGEgc2V0IG9mIG9wdGlvbnMgYW5kIGZpbmRzIHRoZSBjb3JyZWN0IGRldmljZSBzdHJpbmcgaW4gb3JkZXIgZm9yIEluc3RydW1lbnRzIHRvXG4gICAqIGlkZW50aWZ5IHRoZSBjb3JyZWN0IHNpbXVsYXRvci5cbiAgICpcbiAgICogQHBhcmFtIHtvYmplY3R9IG9wdHMgLSBUaGUgb3B0aW9ucyBhdmFpbGFibGUgYXJlOlxuICAgKiAgIC0gYGRldmljZU5hbWVgIC0gYSBuYW1lIGZvciB0aGUgZGV2aWNlLiBJZiB0aGUgZ2l2ZW4gZGV2aWNlIG5hbWUgc3RhcnRzIHdpdGggYD1gLCB0aGUgbmFtZSwgbGVzcyB0aGUgZXF1YWxzIHNpZ24sIGlzIHJldHVybmVkLlxuICAgKiAgIC0gYHBsYXRmb3JtVmVyc2lvbmAgLSB0aGUgdmVyc2lvbiBvZiBpT1MgdG8gdXNlLiBEZWZhdWx0cyB0byB0aGUgY3VycmVudCBYY29kZSdzIG1heGltdW0gU0RLIHZlcnNpb24uXG4gICAqICAgLSBgZm9yY2VJcGhvbmVgIC0gZm9yY2UgdGhlIGNvbmZpZ3VyYXRpb24gb2YgdGhlIGRldmljZSBzdHJpbmcgdG8gaVBob25lLiBEZWZhdWx0cyB0byBgZmFsc2VgLlxuICAgKiAgIC0gYGZvcmNlSXBhZGAgLSBmb3JjZSB0aGUgY29uZmlndXJhdGlvbiBvZiB0aGUgZGV2aWNlIHN0cmluZyB0byBpUGFkLiBEZWZhdWx0cyB0byBgZmFsc2VgLlxuICAgKiAgIElmIGJvdGggYGZvcmNlSXBob25lYCBhbmQgYGZvcmNlSXBhZGAgYXJlIHRydWUsIHRoZSBkZXZpY2Ugd2lsbCBiZSBmb3JjZWQgdG8gaVBob25lLlxuICAgKlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBmb3VuZCBkZXZpY2Ugc3RyaW5nLlxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGdldERldmljZVN0cmluZyAob3B0cykge1xuICAgIG9wdHMgPSBPYmplY3QuYXNzaWduKHt9LCB7XG4gICAgICBkZXZpY2VOYW1lOiBudWxsLFxuICAgICAgcGxhdGZvcm1WZXJzaW9uOiBudWxsLFxuICAgICAgZm9yY2VJcGhvbmU6IGZhbHNlLFxuICAgICAgZm9yY2VJcGFkOiBmYWxzZVxuICAgIH0sIG9wdHMpO1xuICAgIGxldCBsb2dPcHRzID0ge1xuICAgICAgZGV2aWNlTmFtZTogb3B0cy5kZXZpY2VOYW1lLFxuICAgICAgcGxhdGZvcm1WZXJzaW9uOiBvcHRzLnBsYXRmb3JtVmVyc2lvbixcbiAgICAgIGZvcmNlSXBob25lOiBvcHRzLmZvcmNlSXBob25lLFxuICAgICAgZm9yY2VJcGFkOiBvcHRzLmZvcmNlSXBhZFxuICAgIH07XG4gICAgbG9nLmRlYnVnKGBHZXR0aW5nIGRldmljZSBzdHJpbmcgZnJvbSBvcHRpb25zOiAke0pTT04uc3RyaW5naWZ5KGxvZ09wdHMpfWApO1xuXG4gICAgLy8gc2hvcnQgY2lyY3VpdCBpZiB3ZSBhbHJlYWR5IGhhdmUgYSBkZXZpY2UgbmFtZVxuICAgIGlmICgob3B0cy5kZXZpY2VOYW1lIHx8ICcnKVswXSA9PT0gJz0nKSB7XG4gICAgICByZXR1cm4gb3B0cy5kZXZpY2VOYW1lLnN1YnN0cmluZygxKTtcbiAgICB9XG5cbiAgICBsZXQgaXNpUGhvbmUgPSAhIW9wdHMuZm9yY2VJcGhvbmUgfHwgIW9wdHMuZm9yY2VJcGFkO1xuXG4gICAgaWYgKG9wdHMuZGV2aWNlTmFtZSkge1xuICAgICAgbGV0IGRldmljZSA9IG9wdHMuZGV2aWNlTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgaWYgKGRldmljZS5pbmRleE9mKCdpcGhvbmUnKSAhPT0gLTEpIHtcbiAgICAgICAgaXNpUGhvbmUgPSB0cnVlO1xuICAgICAgfSBlbHNlIGlmIChkZXZpY2UuaW5kZXhPZignaXBhZCcpICE9PSAtMSkge1xuICAgICAgICBpc2lQaG9uZSA9IGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGxldCBpb3NEZXZpY2VTdHJpbmcgPSBvcHRzLmRldmljZU5hbWUgfHwgKGlzaVBob25lID8gJ2lQaG9uZSBTaW11bGF0b3InIDogJ2lQYWQgU2ltdWxhdG9yJyk7XG5cbiAgICAvLyBpZiBzb21lb25lIHBhc3NlcyBpbiBqdXN0IFwiaVBob25lXCIsIG1ha2UgdGhhdCBcImlQaG9uZSBTaW11bGF0b3JcIiB0b1xuICAgIC8vIGNvbmZvcm0gdG8gYWxsIHRoZSBsb2dpYyBiZWxvd1xuICAgIGlmICgvXihpUGhvbmV8aVBhZCkkLy50ZXN0KGlvc0RldmljZVN0cmluZykpIHtcbiAgICAgIGlvc0RldmljZVN0cmluZyArPSAnIFNpbXVsYXRvcic7XG4gICAgfVxuXG4gICAgLy8gd2Ugc3VwcG9ydCBkZXZpY2VOYW1lOiBcImlQaG9uZSBTaW11bGF0b3JcIiwgYW5kIGFsc28gd2FudCB0byBzdXBwb3J0XG4gICAgLy8gXCJpUGhvbmUgWFlaIFNpbXVsYXRvclwiLCBidXQgdGhlc2Ugc3RyaW5ncyBhcmVuJ3QgaW4gdGhlIGRldmljZSBsaXN0LlxuICAgIC8vIFNvLCBpZiBzb21lb25lIHNlbnQgaW4gXCJpUGhvbmUgWFlaIFNpbXVsYXRvclwiLCBzdHJpcCBvZmYgXCIgU2ltdWxhdG9yXCJcbiAgICAvLyBpbiBvcmRlciB0byBhbGxvdyB0aGUgZGVmYXVsdCBcImlQaG9uZSBYWVpcIiBtYXRjaFxuICAgIGlmICgvW14oaVBob25lfGlQYWQpXSBTaW11bGF0b3IvLnRlc3QoaW9zRGV2aWNlU3RyaW5nKSkge1xuICAgICAgaW9zRGV2aWNlU3RyaW5nID0gaW9zRGV2aWNlU3RyaW5nLnJlcGxhY2UoJyBTaW11bGF0b3InLCAnJyk7XG4gICAgfVxuICAgIGlvc0RldmljZVN0cmluZyArPSBgICR7YXdhaXQgdGhpcy5fZ2V0RGV2aWNlU3RyaW5nVmVyc2lvblN0cmluZyhvcHRzLnBsYXRmb3JtVmVyc2lvbil9YDtcblxuICAgIGxldCBDT05GSUdfRklYID0gdGhpcy5fZ2V0RGV2aWNlU3RyaW5nQ29uZmlnRml4KCk7XG5cbiAgICBsZXQgY29uZmlnRml4ID0gQ09ORklHX0ZJWDtcbiAgICBpZiAoY29uZmlnRml4W2lvc0RldmljZVN0cmluZ10pIHtcbiAgICAgIGlvc0RldmljZVN0cmluZyA9IGNvbmZpZ0ZpeFtpb3NEZXZpY2VTdHJpbmddO1xuICAgICAgbG9nLmRlYnVnKGBGaXhpbmcgZGV2aWNlLiBDaGFuZ2VkIGZyb20gJyR7b3B0cy5kZXZpY2VOYW1lfScgYCArXG4gICAgICAgICAgICAgICAgYHRvICcke2lvc0RldmljZVN0cmluZ30nYCk7XG4gICAgfVxuXG4gICAgbG9nLmRlYnVnKGBGaW5hbCBkZXZpY2Ugc3RyaW5nIGlzICcke2lvc0RldmljZVN0cmluZ30nYCk7XG4gICAgcmV0dXJuIGlvc0RldmljZVN0cmluZztcbiAgfVxuXG4gIC8qKlxuICAgKiBAcmV0dXJuIHs/c3RyaW5nfSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBzaW11bGF0b3IncyBXZWJJbnNwZWN0b3IgVW5peCBEb21haW4gU29ja2V0XG4gICAqICAgb3IgYG51bGxgIGlmIHRoZXJlIGlzIG5vIHNvY2tldC5cbiAgICovXG4gIGFzeW5jIGdldFdlYkluc3BlY3RvclNvY2tldCAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIC8vIHRoZXJlIGlzIG5vIFdlYkluc3BlY3RvciBzb2NrZXQgZm9yIHRoaXMgdmVyc2lvbiBvZiBYY29kZVxuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbmZvciAobGV0IFtjbWQsIGZuXSBvZiBfLnRvUGFpcnMoZXh0ZW5zaW9ucykpIHtcbiAgU2ltdWxhdG9yWGNvZGU2LnByb3RvdHlwZVtjbWRdID0gZm47XG59XG5cbmV4cG9ydCBkZWZhdWx0IFNpbXVsYXRvclhjb2RlNjtcbmV4cG9ydCB7IFNpbXVsYXRvclhjb2RlNiwgQk9PVF9DT01QTEVURURfRVZFTlQsIFNQUklOR0JPQVJEX0JVTkRMRV9JRCB9O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBaUM7QUFBQTtBQUdqQyxNQUFNQSxlQUFlLEdBQUcsRUFBRSxHQUFHLElBQUk7QUFDakMsTUFBTUMsa0JBQWtCLEdBQUcsSUFBSTtBQUMvQixNQUFNQyxzQkFBc0IsR0FBRyxJQUFJQyxrQkFBUyxFQUFFO0FBQzlDLE1BQU1DLG1CQUFtQixHQUFHLDJC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