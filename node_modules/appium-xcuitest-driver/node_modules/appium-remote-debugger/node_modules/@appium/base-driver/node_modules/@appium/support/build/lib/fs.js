"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.fs = exports.default = void 0;

require("source-map-support/register");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _crypto = _interopRequireDefault(require("crypto"));

var _fs = require("fs");

var _glob = _interopRequireDefault(require("glob"));

var _klaw = _interopRequireDefault(require("klaw"));

var _lodash = _interopRequireDefault(require("lodash"));

var _mv = _interopRequireDefault(require("mv"));

var _ncp = _interopRequireDefault(require("ncp"));

var _path = _interopRequireDefault(require("path"));

var _pkgDir = _interopRequireDefault(require("pkg-dir"));

var _readPkg = _interopRequireDefault(require("read-pkg"));

var _rimraf = _interopRequireDefault(require("rimraf"));

var _sanitizeFilename = _interopRequireDefault(require("sanitize-filename"));

var _which = _interopRequireDefault(require("which"));

var _logger = _interopRequireDefault(require("./logger"));

var _timing = _interopRequireDefault(require("./timing"));

var _system = require("./system");

var _util = require("./util");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const ncpAsync = _bluebird.default.promisify(_ncp.default);

const findRootCached = _lodash.default.memoize(_pkgDir.default.sync);

const fs = {
  async hasAccess(path) {
    try {
      await _fs.promises.access(path, _fs.constants.R_OK);
    } catch {
      return false;
    }

    return true;
  },

  async isExecutable(path) {
    try {
      if ((0, _system.isWindows)()) {
        return await fs.hasAccess(path);
      }

      await _fs.promises.access(path, _fs.constants.R_OK | _fs.constants.X_OK);
    } catch {
      return false;
    }

    return true;
  },

  async exists(path) {
    return await fs.hasAccess(path);
  },

  rimraf: _bluebird.default.promisify(_rimraf.default),
  rimrafSync: _rimraf.default.sync,

  async mkdir(filepath, opts = {}) {
    try {
      return await _fs.promises.mkdir(filepath, opts);
    } catch (err) {
      if ((err === null || err === void 0 ? void 0 : err.code) !== 'EEXIST') {
        throw err;
      }
    }
  },

  async copyFile(source, destination, opts = {}) {
    if (!(await fs.hasAccess(source))) {
      throw new Error(`The file at '${source}' does not exist or is not accessible`);
    }

    return await ncpAsync(source, destination, opts);
  },

  async md5(filePath) {
    return await fs.hash(filePath, 'md5');
  },

  mv: _bluebird.default.promisify(_mv.default),
  which: _which.default,
  glob: _bluebird.default.promisify(_glob.default),
  sanitizeName: _sanitizeFilename.default,

  async hash(filePath, algorithm = 'sha1') {
    return await new _bluebird.default((resolve, reject) => {
      const fileHash = _crypto.default.createHash(algorithm);

      const readStream = (0, _fs.createReadStream)(filePath);
      readStream.on('error', e => reject(new Error(`Cannot calculate ${algorithm} hash for '${filePath}'. Original error: ${e.message}`)));
      readStream.on('data', chunk => fileHash.update(chunk));
      readStream.on('end', () => resolve(fileHash.digest('hex')));
    });
  },

  walk(dir, opts) {
    return (0, _klaw.default)(dir, opts);
  },

  async mkdirp(dir) {
    return await fs.mkdir(dir, {
      recursive: true
    });
  },

  async walkDir(dir, recursive, callback) {
    let isValidRoot = false;
    let errMsg = null;

    try {
      isValidRoot = (await fs.stat(dir)).isDirectory();
    } catch (e) {
      errMsg = e.message;
    }

    if (!isValidRoot) {
      throw Error(`'${dir}' is not a valid root directory` + (errMsg ? `. Original error: ${errMsg}` : ''));
    }

    let walker;
    let fileCount = 0;
    let directoryCount = 0;
    const timer = new _timing.default().start();
    return await new _bluebird.default(function (resolve, reject) {
      let lastFileProcessed = _bluebird.default.resolve();

      walker = (0, _klaw.default)(dir, {
        depthLimit: recursive ? -1 : 0
      });
      walker.on('data', function (item) {
        walker.pause();

        if (!item.stats.isDirectory()) {
          fileCount++;
        } else {
          directoryCount++;
        }

        lastFileProcessed = _bluebird.default.try(async () => await callback(item.path, item.stats.isDirectory())).then(function (done = false) {
          if (done) {
            resolve(item.path);
          } else {
            walker.resume();
          }
        }).catch(reject);
      }).on('error', function (err, item) {
        _logger.default.warn(`Got an error while walking '${item.path}': ${err.message}`);

        if (err.code === 'ENOENT') {
          _logger.default.warn('All files may not have been accessed');

          reject(err);
        }
      }).on('end', function () {
        lastFileProcessed.then(file => {
          resolve(file ?? null);
        }).catch(function (err) {
          _logger.default.warn(`Unexpected error: ${err.message}`);

          reject(err);
        });
      });
    }).finally(function () {
      _logger.default.debug(`Traversed ${(0, _util.pluralize)('directory', directoryCount, true)} ` + `and ${(0, _util.pluralize)('file', fileCount, true)} ` + `in ${timer.getDuration().asMilliSeconds.toFixed(0)}ms`);

      if (walker) {
        walker.destroy();
      }
    });
  },

  readPackageJsonFrom(dir, opts = {}) {
    const cwd = fs.findRoot(dir);

    try {
      return _readPkg.default.sync({ ...opts,
        cwd
      });
    } catch (err) {
      err.message = `Failed to read a \`package.json\` from dir \`${dir}\`:\n\n${err.message}`;
      throw err;
    }
  },

  findRoot(dir) {
    if (!dir || !_path.default.isAbsolute(dir)) {
      throw new TypeError('`findRoot()` must be provided a non-empty, absolute path');
    }

    const result = findRootCached(dir);

    if (!result) {
      throw new Error(`\`findRoot()\` could not find \`package.json\` from ${dir}`);
    }

    return result;
  },

  access: _fs.promises.access,
  appendFile: _fs.promises.appendFile,
  chmod: _fs.promises.chmod,
  close: _bluebird.default.promisify(_fs.close),
  constants: _fs.constants,
  createWriteStream: _fs.createWriteStream,
  createReadStream: _fs.createReadStream,
  lstat: _fs.promises.lstat,
  open: _bluebird.default.promisify(_fs.open),
  openFile: _fs.promises.open,
  readdir: _fs.promises.readdir,
  read: _bluebird.default.promisify(_fs.read),
  readFile: _fs.promises.readFile,
  readlink: _fs.promises.readlink,
  realpath: _fs.promises.realpath,
  rename: _fs.promises.rename,
  stat: _fs.promises.stat,
  symlink: _fs.promises.symlink,
  unlink: _fs.promises.unlink,
  write: _bluebird.default.promisify(_fs.write),
  writeFile: _fs.promises.writeFile,
  F_OK: _fs.constants.F_OK,
  R_OK: _fs.constants.R_OK,
  W_OK: _fs.constants.W_OK,
  X_OK: _fs.constants.X_OK
};
exports.fs = fs;
var _default = fs;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJuY3BBc3luYyIsIkIiLCJwcm9taXNpZnkiLCJuY3AiLCJmaW5kUm9vdENhY2hlZCIsIl8iLCJtZW1vaXplIiwicGtnRGlyIiwic3luYyIsImZzIiwiaGFzQWNjZXNzIiwicGF0aCIsImZzUHJvbWlzZXMiLCJhY2Nlc3MiLCJjb25zdGFudHMiLCJSX09LIiwiaXNFeGVjdXRhYmxlIiwiaXNXaW5kb3dzIiwiWF9PSyIsImV4aXN0cyIsInJpbXJhZiIsInJpbXJhZklkeCIsInJpbXJhZlN5bmMiLCJta2RpciIsImZpbGVwYXRoIiwib3B0cyIsImVyciIsImNvZGUiLCJjb3B5RmlsZSIsInNvdXJjZSIsImRlc3RpbmF0aW9uIiwiRXJyb3IiLCJtZDUiLCJmaWxlUGF0aCIsImhhc2giLCJtdiIsIndoaWNoIiwiZ2xvYiIsInNhbml0aXplTmFtZSIsInNhbml0aXplIiwiYWxnb3JpdGhtIiwicmVzb2x2ZSIsInJlamVjdCIsImZpbGVIYXNoIiwiY3J5cHRvIiwiY3JlYXRlSGFzaCIsInJlYWRTdHJlYW0iLCJjcmVhdGVSZWFkU3RyZWFtIiwib24iLCJlIiwibWVzc2FnZSIsImNodW5rIiwidXBkYXRlIiwiZGlnZXN0Iiwid2FsayIsImRpciIsImtsYXciLCJta2RpcnAiLCJyZWN1cnNpdmUiLCJ3YWxrRGlyIiwiY2FsbGJhY2siLCJpc1ZhbGlkUm9vdCIsImVyck1zZyIsInN0YXQiLCJpc0RpcmVjdG9yeSIsIndhbGtlciIsImZpbGVDb3VudCIsImRpcmVjdG9yeUNvdW50IiwidGltZXIiLCJUaW1lciIsInN0YXJ0IiwibGFzdEZpbGVQcm9jZXNzZWQiLCJkZXB0aExpbWl0IiwiaXRlbSIsInBhdXNlIiwic3RhdHMiLCJ0cnkiLCJ0aGVuIiwiZG9uZSIsInJlc3VtZSIsImNhdGNoIiwibG9nIiwid2FybiIsImZpbGUiLCJmaW5hbGx5IiwiZGVidWciLCJwbHVyYWxpemUiLCJnZXREdXJhdGlvbiIsImFzTWlsbGlTZWNvbmRzIiwidG9GaXhlZCIsImRlc3Ryb3kiLCJyZWFkUGFja2FnZUpzb25Gcm9tIiwiY3dkIiwiZmluZFJvb3QiLCJyZWFkUGtnIiwiaXNBYnNvbHV0ZSIsIlR5cGVFcnJvciIsInJlc3VsdCIsImFwcGVuZEZpbGUiLCJjaG1vZCIsImNsb3NlIiwiY3JlYXRlV3JpdGVTdHJlYW0iLCJsc3RhdCIsIm9wZW4iLCJvcGVuRmlsZSIsInJlYWRkaXIiLCJyZWFkIiwicmVhZEZpbGUiLCJyZWFkbGluayIsInJlYWxwYXRoIiwicmVuYW1lIiwic3ltbGluayIsInVubGluayIsIndyaXRlIiwid3JpdGVGaWxlIiwiRl9PSyIsIldfT0siXSwic291cmNlcyI6WyIuLi8uLi9saWIvZnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQHRzLWNoZWNrXG5cbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCBjcnlwdG8gZnJvbSAnY3J5cHRvJztcbmltcG9ydCB7XG4gIGNsb3NlLFxuICBjb25zdGFudHMsXG4gIGNyZWF0ZVJlYWRTdHJlYW0sXG4gIGNyZWF0ZVdyaXRlU3RyZWFtLFxuICBwcm9taXNlcyBhcyBmc1Byb21pc2VzLFxuICByZWFkLFxuICB3cml0ZSxcbiAgb3Blbixcbn0gZnJvbSAnZnMnO1xuaW1wb3J0IGdsb2IgZnJvbSAnZ2xvYic7XG5pbXBvcnQga2xhdyBmcm9tICdrbGF3JztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgbXYgZnJvbSAnbXYnO1xuaW1wb3J0IG5jcCBmcm9tICduY3AnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgcGtnRGlyIGZyb20gJ3BrZy1kaXInO1xuaW1wb3J0IHJlYWRQa2cgZnJvbSAncmVhZC1wa2cnO1xuaW1wb3J0IHJpbXJhZklkeCBmcm9tICdyaW1yYWYnO1xuaW1wb3J0IHNhbml0aXplIGZyb20gJ3Nhbml0aXplLWZpbGVuYW1lJztcbmltcG9ydCB3aGljaCBmcm9tICd3aGljaCc7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCBUaW1lciBmcm9tICcuL3RpbWluZyc7XG5pbXBvcnQge2lzV2luZG93c30gZnJvbSAnLi9zeXN0ZW0nO1xuaW1wb3J0IHtwbHVyYWxpemV9IGZyb20gJy4vdXRpbCc7XG5cbmNvbnN0IG5jcEFzeW5jID1cbiAgLyoqIEB0eXBlIHsoc291cmNlOiBzdHJpbmcsIGRlc3Q6IHN0cmluZywgb3B0czogbmNwLk9wdGlvbnN8dW5kZWZpbmVkKSA9PiBCPHZvaWQ+fSAqLyAoXG4gICAgQi5wcm9taXNpZnkobmNwKVxuICApO1xuY29uc3QgZmluZFJvb3RDYWNoZWQgPSBfLm1lbW9pemUocGtnRGlyLnN5bmMpO1xuXG5jb25zdCBmcyA9IHtcbiAgLyoqXG4gICAqIFJlc29sdmVzIGB0cnVlYCBpZiBgcGF0aGAgaXMgX3JlYWRhYmxlXywgd2hpY2ggZGlmZmVycyBmcm9tIE5vZGUuanMnIGRlZmF1bHQgYmVoYXZpb3Igb2YgXCJjYW4gd2Ugc2VlIGl0P1wiXG4gICAqXG4gICAqIE9uIFdpbmRvd3MsIEFDTHMgYXJlIG5vdCBzdXBwb3J0ZWQsIHNvIHRoaXMgYmVjb21lcyBhIHNpbXBsZSBjaGVjayBmb3IgZXhpc3RlbmNlLlxuICAgKlxuICAgKiBUaGlzIGZ1bmN0aW9uIHdpbGwgbmV2ZXIgcmVqZWN0LlxuICAgKiBAcGFyYW0ge1BhdGhMaWtlfSBwYXRoXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fVxuICAgKi9cbiAgYXN5bmMgaGFzQWNjZXNzKHBhdGgpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZnNQcm9taXNlcy5hY2Nlc3MocGF0aCwgY29uc3RhbnRzLlJfT0spO1xuICAgIH0gY2F0Y2gge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSxcblxuICAvKipcbiAgICogUmVzb2x2ZXMgYHRydWVgIGlmIGBwYXRoYCBpcyBleGVjdXRhYmxlOyBgZmFsc2VgIG90aGVyd2lzZS5cbiAgICpcbiAgICogT24gV2luZG93cywgdGhpcyBmdW5jdGlvbiBkZWxlZ2F0ZXMgdG8ge0BsaW5rY29kZSBmcy5oYXNBY2Nlc3N9LlxuICAgKlxuICAgKiBUaGlzIGZ1bmN0aW9uIHdpbGwgbmV2ZXIgcmVqZWN0LlxuICAgKiBAcGFyYW0ge1BhdGhMaWtlfSBwYXRoXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fVxuICAgKi9cbiAgYXN5bmMgaXNFeGVjdXRhYmxlKHBhdGgpIHtcbiAgICB0cnkge1xuICAgICAgaWYgKGlzV2luZG93cygpKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCBmcy5oYXNBY2Nlc3MocGF0aCk7XG4gICAgICB9XG4gICAgICBhd2FpdCBmc1Byb21pc2VzLmFjY2VzcyhwYXRoLCBjb25zdGFudHMuUl9PSyB8IGNvbnN0YW50cy5YX09LKTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEFsaWFzIGZvciB7QGxpbmtjb2RlIGZzLmhhc0FjY2Vzc31cbiAgICogQHBhcmFtIHtQYXRoTGlrZX0gcGF0aFxuICAgKi9cbiAgYXN5bmMgZXhpc3RzKHBhdGgpIHtcbiAgICByZXR1cm4gYXdhaXQgZnMuaGFzQWNjZXNzKHBhdGgpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZW1vdmUgYSBkaXJlY3RvcnkgYW5kIGFsbCBpdHMgY29udGVudHMsIHJlY3Vyc2l2ZWx5XG4gICAqIEB0b2RvIFJlcGxhY2Ugd2l0aCBgcm0oKWAgZnJvbSBgZnMucHJvbWlzZXNgIHdoZW4gTm9kZS5qcyB2MTIgc3VwcG9ydCBpcyBkcm9wcGVkLlxuICAgKi9cbiAgcmltcmFmOiAvKiogQHR5cGUgeyhkaXJwYXRoOiBzdHJpbmcsIG9wdHM/OiBpbXBvcnQoJ3JpbXJhZicpLk9wdGlvbnMpID0+IFByb21pc2U8dm9pZD59ICovIChcbiAgICBCLnByb21pc2lmeShyaW1yYWZJZHgpXG4gICksXG5cbiAgLyoqXG4gICAqIEFsaWFzIG9mIHtAbGlua2NvZGUgcmltcmFmSWR4LnN5bmN9XG4gICAqIEB0b2RvIFJlcGxhY2Ugd2l0aCBgcm1TeW5jKClgIGZyb20gYGZzYCB3aGVuIE5vZGUuanMgdjEyIHN1cHBvcnQgaXMgZHJvcHBlZC5cbiAgICovXG4gIHJpbXJhZlN5bmM6IHJpbXJhZklkeC5zeW5jLFxuXG4gIC8qKlxuICAgKiBMaWtlIE5vZGUuanMnIGBmc1Byb21pc2VzLm1rZGlyKClgLCBidXQgd2lsbCBfbm90XyByZWplY3QgaWYgdGhlIGRpcmVjdG9yeSBhbHJlYWR5IGV4aXN0cy5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd8QnVmZmVyfFVSTH0gZmlsZXBhdGhcbiAgICogQHBhcmFtIHtpbXBvcnQoJ2ZzJykuTWFrZURpcmVjdG9yeU9wdGlvbnN9IFtvcHRzXVxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmd8dW5kZWZpbmVkPn1cbiAgICogQHNlZSBodHRwczovL25vZGVqcy5vcmcvYXBpL2ZzLmh0bWwjZnNwcm9taXNlc21rZGlycGF0aC1vcHRpb25zXG4gICAqL1xuICBhc3luYyBta2RpcihmaWxlcGF0aCwgb3B0cyA9IHt9KSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCBmc1Byb21pc2VzLm1rZGlyKGZpbGVwYXRoLCBvcHRzKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmIChlcnI/LmNvZGUgIT09ICdFRVhJU1QnKSB7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIC8qKlxuICAgKiBDb3BpZXMgZmlsZXMgX2FuZCBlbnRpcmUgZGlyZWN0b3JpZXNfXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzb3VyY2UgLSBTb3VyY2UgdG8gY29weVxuICAgKiBAcGFyYW0ge3N0cmluZ30gZGVzdGluYXRpb24gLSBEZXN0aW5hdGlvbiB0byBjb3B5IHRvXG4gICAqIEBwYXJhbSB7bmNwLk9wdGlvbnN9IFtvcHRzXSAtIEFkZGl0aW9uYWwgYXJndW1lbnRzIHRvIHBhc3MgdG8gYG5jcGBcbiAgICogQHNlZSBodHRwczovL25wbS5pbS9uY3BcbiAgICogQHJldHVybnMge1Byb21pc2U8dm9pZD59XG4gICAqL1xuICBhc3luYyBjb3B5RmlsZShzb3VyY2UsIGRlc3RpbmF0aW9uLCBvcHRzID0ge30pIHtcbiAgICBpZiAoIShhd2FpdCBmcy5oYXNBY2Nlc3Moc291cmNlKSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGZpbGUgYXQgJyR7c291cmNlfScgZG9lcyBub3QgZXhpc3Qgb3IgaXMgbm90IGFjY2Vzc2libGVgKTtcbiAgICB9XG4gICAgcmV0dXJuIGF3YWl0IG5jcEFzeW5jKHNvdXJjZSwgZGVzdGluYXRpb24sIG9wdHMpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYW4gTUQ1IGhhc2ggb2YgYSBmaWxlLlxuICAgKiBAcGFyYW0ge1BhdGhMaWtlfSBmaWxlUGF0aFxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmc+fVxuICAgKi9cbiAgYXN5bmMgbWQ1KGZpbGVQYXRoKSB7XG4gICAgcmV0dXJuIGF3YWl0IGZzLmhhc2goZmlsZVBhdGgsICdtZDUnKTtcbiAgfSxcblxuICAvKipcbiAgICogTW92ZSBhIGZpbGVcbiAgICovXG4gIG12OiAvKiogQHR5cGUgeyhmcm9tOiBzdHJpbmcsIHRvOiBzdHJpbmcsIG9wdHM/OiBtdi5PcHRpb25zKSA9PiBCPHZvaWQ+fSAqLyAoQi5wcm9taXNpZnkobXYpKSxcblxuICAvKipcbiAgICogRmluZCBwYXRoIHRvIGFuIGV4ZWN1dGFibGUgaW4gc3lzdGVtIGBQQVRIYFxuICAgKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ucG0vbm9kZS13aGljaFxuICAgKi9cbiAgd2hpY2gsXG5cbiAgLyoqXG4gICAqIEdpdmVuIGEgZ2xvYiBwYXR0ZXJuLCByZXNvbHZlIHdpdGggbGlzdCBvZiBmaWxlcyBtYXRjaGluZyB0aGF0IHBhdHRlcm5cbiAgICogQHNlZSBodHRwczovL2dpdGh1Yi5jb20vaXNhYWNzL25vZGUtZ2xvYlxuICAgKi9cbiAgZ2xvYjogLyoqIEB0eXBlIHsocGF0dGVybjogc3RyaW5nLCBvcHRzPzogZ2xvYi5JT3B0aW9ucykgPT4gQjxzdHJpbmdbXT59ICovIChCLnByb21pc2lmeShnbG9iKSksXG5cbiAgLyoqXG4gICAqIFNhbml0aXplIGEgZmlsZW5hbWVcbiAgICogQHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGFyc2hhcC9ub2RlLXNhbml0aXplLWZpbGVuYW1lXG4gICAqL1xuICBzYW5pdGl6ZU5hbWU6IHNhbml0aXplLFxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBoZXggZGlnZXN0IG9mIHNvbWUgZmlsZSBhdCBgZmlsZVBhdGhgXG4gICAqIEBwYXJhbSB7UGF0aExpa2V9IGZpbGVQYXRoXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBbYWxnb3JpdGhtXVxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmc+fVxuICAgKi9cbiAgYXN5bmMgaGFzaChmaWxlUGF0aCwgYWxnb3JpdGhtID0gJ3NoYTEnKSB7XG4gICAgcmV0dXJuIGF3YWl0IG5ldyBCKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGNvbnN0IGZpbGVIYXNoID0gY3J5cHRvLmNyZWF0ZUhhc2goYWxnb3JpdGhtKTtcbiAgICAgIGNvbnN0IHJlYWRTdHJlYW0gPSBjcmVhdGVSZWFkU3RyZWFtKGZpbGVQYXRoKTtcbiAgICAgIHJlYWRTdHJlYW0ub24oJ2Vycm9yJywgKGUpID0+XG4gICAgICAgIHJlamVjdChcbiAgICAgICAgICBuZXcgRXJyb3IoXG4gICAgICAgICAgICBgQ2Fubm90IGNhbGN1bGF0ZSAke2FsZ29yaXRobX0gaGFzaCBmb3IgJyR7ZmlsZVBhdGh9Jy4gT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWBcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgICByZWFkU3RyZWFtLm9uKCdkYXRhJywgKGNodW5rKSA9PiBmaWxlSGFzaC51cGRhdGUoY2h1bmspKTtcbiAgICAgIHJlYWRTdHJlYW0ub24oJ2VuZCcsICgpID0+IHJlc29sdmUoZmlsZUhhc2guZGlnZXN0KCdoZXgnKSkpO1xuICAgIH0pO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGFuIGBXYWxrZXJgIGluc3RhbmNlLCB3aGljaCBpcyBhIHJlYWRhYmxlIHN0cmVhbSAoYW5kIHRodXNseSBhbiBhc3luYyBpdGVyYXRvcikuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBkaXIgLSBEaXIgdG8gc3RhcnQgd2Fsa2luZyBhdFxuICAgKiBAcGFyYW0ge2ltcG9ydCgna2xhdycpLk9wdGlvbnN9IFtvcHRzXVxuICAgKiBAcmV0dXJucyB7aW1wb3J0KCdrbGF3JykuV2Fsa2VyfVxuICAgKiBAc2VlIGh0dHBzOi8vd3d3Lm5wbWpzLmNvbS9wYWNrYWdlL2tsYXdcbiAgICovXG4gIHdhbGsoZGlyLCBvcHRzKSB7XG4gICAgcmV0dXJuIGtsYXcoZGlyLCBvcHRzKTtcbiAgfSxcblxuICAvKipcbiAgICogUmVjdXJzaXZlbHkgY3JlYXRlIGEgZGlyZWN0b3J5LlxuICAgKiBAcGFyYW0ge1BhdGhMaWtlfSBkaXJcbiAgICogQHJldHVybnMge1Byb21pc2U8c3RyaW5nfHVuZGVmaW5lZD59XG4gICAqL1xuICBhc3luYyBta2RpcnAoZGlyKSB7XG4gICAgcmV0dXJuIGF3YWl0IGZzLm1rZGlyKGRpciwge3JlY3Vyc2l2ZTogdHJ1ZX0pO1xuICB9LFxuXG4gIC8qKlxuICAgKiBXYWxrcyBhIGRpcmVjdG9yeSBnaXZlbiBhY2NvcmRpbmcgdG8gdGhlIHBhcmFtZXRlcnMgZ2l2ZW4uIFRoZSBjYWxsYmFjayB3aWxsIGJlIGludm9rZWQgd2l0aCBhIHBhdGggam9pbmVkIHdpdGggdGhlIGRpciBwYXJhbWV0ZXJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGRpciBEaXJlY3RvcnkgcGF0aCB3aGVyZSB3ZSB3aWxsIHN0YXJ0IHdhbGtpbmdcbiAgICogQHBhcmFtIHtib29sZWFufSByZWN1cnNpdmUgU2V0IGl0IHRvIHRydWUgaWYgeW91IHdhbnQgdG8gY29udGludWUgd2Fsa2luZyBzdWIgZGlyZWN0b3JpZXNcbiAgICogQHBhcmFtIHtXYWxrRGlyQ2FsbGJhY2t9IGNhbGxiYWNrIFRoZSBjYWxsYmFjayB0byBiZSBjYWxsZWQgd2hlbiBhIG5ldyBwYXRoIGlzIGZvdW5kXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgYGRpcmAgcGFyYW1ldGVyIGNvbnRhaW5zIGEgcGF0aCB0byBhbiBpbnZhbGlkIGZvbGRlclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmc/Pn0gcmV0dXJucyB0aGUgZm91bmQgcGF0aCBvciBudWxsIGlmIHRoZSBpdGVtIHdhcyBub3QgZm91bmRcbiAgICovXG4gIGFzeW5jIHdhbGtEaXIoZGlyLCByZWN1cnNpdmUsIGNhbGxiYWNrKSB7XG4gICAgLy9lc2xpbnQtZGlzYWJsZS1saW5lIHByb21pc2UvcHJlZmVyLWF3YWl0LXRvLWNhbGxiYWNrc1xuICAgIGxldCBpc1ZhbGlkUm9vdCA9IGZhbHNlO1xuICAgIGxldCBlcnJNc2cgPSBudWxsO1xuICAgIHRyeSB7XG4gICAgICBpc1ZhbGlkUm9vdCA9IChhd2FpdCBmcy5zdGF0KGRpcikpLmlzRGlyZWN0b3J5KCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgZXJyTXNnID0gZS5tZXNzYWdlO1xuICAgIH1cbiAgICBpZiAoIWlzVmFsaWRSb290KSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgYCcke2Rpcn0nIGlzIG5vdCBhIHZhbGlkIHJvb3QgZGlyZWN0b3J5YCArIChlcnJNc2cgPyBgLiBPcmlnaW5hbCBlcnJvcjogJHtlcnJNc2d9YCA6ICcnKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBsZXQgd2Fsa2VyO1xuICAgIGxldCBmaWxlQ291bnQgPSAwO1xuICAgIGxldCBkaXJlY3RvcnlDb3VudCA9IDA7XG4gICAgY29uc3QgdGltZXIgPSBuZXcgVGltZXIoKS5zdGFydCgpO1xuICAgIHJldHVybiBhd2FpdCBuZXcgQihmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICBsZXQgbGFzdEZpbGVQcm9jZXNzZWQgPSBCLnJlc29sdmUoKTtcbiAgICAgIHdhbGtlciA9IGtsYXcoZGlyLCB7XG4gICAgICAgIGRlcHRoTGltaXQ6IHJlY3Vyc2l2ZSA/IC0xIDogMCxcbiAgICAgIH0pO1xuICAgICAgd2Fsa2VyXG4gICAgICAgIC5vbignZGF0YScsIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgd2Fsa2VyLnBhdXNlKCk7XG5cbiAgICAgICAgICBpZiAoIWl0ZW0uc3RhdHMuaXNEaXJlY3RvcnkoKSkge1xuICAgICAgICAgICAgZmlsZUNvdW50Kys7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRpcmVjdG9yeUNvdW50Kys7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHByb21pc2UvcHJlZmVyLWF3YWl0LXRvLWNhbGxiYWNrc1xuICAgICAgICAgIGxhc3RGaWxlUHJvY2Vzc2VkID0gQi50cnkoYXN5bmMgKCkgPT4gYXdhaXQgY2FsbGJhY2soaXRlbS5wYXRoLCBpdGVtLnN0YXRzLmlzRGlyZWN0b3J5KCkpKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRvbmUgPSBmYWxzZSkge1xuICAgICAgICAgICAgICBpZiAoZG9uZSkge1xuICAgICAgICAgICAgICAgIHJlc29sdmUoaXRlbS5wYXRoKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB3YWxrZXIucmVzdW1lKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2gocmVqZWN0KTtcbiAgICAgICAgfSlcbiAgICAgICAgLm9uKCdlcnJvcicsIGZ1bmN0aW9uIChlcnIsIGl0ZW0pIHtcbiAgICAgICAgICBsb2cud2FybihgR290IGFuIGVycm9yIHdoaWxlIHdhbGtpbmcgJyR7aXRlbS5wYXRofSc6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICAgICAgLy8ga2xhdyBjYW5ub3QgZ2V0IGJhY2sgZnJvbSBhbiBFTk9FTlQgZXJyb3JcbiAgICAgICAgICBpZiAoZXJyLmNvZGUgPT09ICdFTk9FTlQnKSB7XG4gICAgICAgICAgICBsb2cud2FybignQWxsIGZpbGVzIG1heSBub3QgaGF2ZSBiZWVuIGFjY2Vzc2VkJyk7XG4gICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC5vbignZW5kJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGxhc3RGaWxlUHJvY2Vzc2VkXG4gICAgICAgICAgICAudGhlbigoZmlsZSkgPT4ge1xuICAgICAgICAgICAgICByZXNvbHZlKC8qKiBAdHlwZSB7c3RyaW5nfHVuZGVmaW5lZH0gKi8gKGZpbGUpID8/IG51bGwpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgIGxvZy53YXJuKGBVbmV4cGVjdGVkIGVycm9yOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgIGxvZy5kZWJ1ZyhcbiAgICAgICAgYFRyYXZlcnNlZCAke3BsdXJhbGl6ZSgnZGlyZWN0b3J5JywgZGlyZWN0b3J5Q291bnQsIHRydWUpfSBgICtcbiAgICAgICAgICBgYW5kICR7cGx1cmFsaXplKCdmaWxlJywgZmlsZUNvdW50LCB0cnVlKX0gYCArXG4gICAgICAgICAgYGluICR7dGltZXIuZ2V0RHVyYXRpb24oKS5hc01pbGxpU2Vjb25kcy50b0ZpeGVkKDApfW1zYFxuICAgICAgKTtcbiAgICAgIGlmICh3YWxrZXIpIHtcbiAgICAgICAgd2Fsa2VyLmRlc3Ryb3koKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcbiAgLyoqXG4gICAqIFJlYWRzIHRoZSBjbG9zZXN0IGBwYWNrYWdlLmpzb25gIGZpbGUgZnJvbSBhYnNvbHV0ZSBwYXRoIGBkaXJgLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gZGlyIC0gRGlyZWN0b3J5IHRvIHNlYXJjaCBmcm9tXG4gICAqIEBwYXJhbSB7aW1wb3J0KCdyZWFkLXBrZycpLk9wdGlvbnN9IFtvcHRzXSAtIEFkZGl0aW9uYWwgb3B0aW9ucyBmb3IgYHJlYWQtcGtnYFxuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgd2VyZSBwcm9ibGVtcyBmaW5kaW5nIG9yIHJlYWRpbmcgYSBgcGFja2FnZS5qc29uYCBmaWxlXG4gICAqIEByZXR1cm5zIHtvYmplY3R9IEEgcGFyc2VkIGBwYWNrYWdlLmpzb25gXG4gICAqL1xuICByZWFkUGFja2FnZUpzb25Gcm9tKGRpciwgb3B0cyA9IHt9KSB7XG4gICAgY29uc3QgY3dkID0gZnMuZmluZFJvb3QoZGlyKTtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIHJlYWRQa2cuc3luYyh7Li4ub3B0cywgY3dkfSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBlcnIubWVzc2FnZSA9IGBGYWlsZWQgdG8gcmVhZCBhIFxcYHBhY2thZ2UuanNvblxcYCBmcm9tIGRpciBcXGAke2Rpcn1cXGA6XFxuXFxuJHtlcnIubWVzc2FnZX1gO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgfSxcbiAgLyoqXG4gICAqIEZpbmRzIHRoZSBwcm9qZWN0IHJvb3QgZGlyZWN0b3J5IGZyb20gYGRpcmAuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBkaXIgLSBEaXJlY3RvcnkgdG8gc2VhcmNoIGZyb21cbiAgICogQHRocm93cyB7VHlwZUVycm9yfSBJZiBgZGlyYCBpcyBub3QgYSBub25lbXB0eSBzdHJpbmcgb3IgcmVsYXRpdmUgcGF0aFxuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgd2VyZSBwcm9ibGVtcyBmaW5kaW5nIHRoZSBwcm9qZWN0IHJvb3RcbiAgICogQHJldHVybnMge3N0cmluZ30gVGhlIGNsb3Nlc2V0IHBhcmVudCBkaXIgY29udGFpbmluZyBgcGFja2FnZS5qc29uYFxuICAgKi9cbiAgZmluZFJvb3QoZGlyKSB7XG4gICAgaWYgKCFkaXIgfHwgIXBhdGguaXNBYnNvbHV0ZShkaXIpKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdgZmluZFJvb3QoKWAgbXVzdCBiZSBwcm92aWRlZCBhIG5vbi1lbXB0eSwgYWJzb2x1dGUgcGF0aCcpO1xuICAgIH1cbiAgICBjb25zdCByZXN1bHQgPSBmaW5kUm9vdENhY2hlZChkaXIpO1xuICAgIGlmICghcmVzdWx0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFxcYGZpbmRSb290KClcXGAgY291bGQgbm90IGZpbmQgXFxgcGFja2FnZS5qc29uXFxgIGZyb20gJHtkaXJ9YCk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH0sXG5cbiAgLy8gYWRkIHRoZSBzdXBwb3J0ZWQgYGZzYCBmdW5jdGlvbnNcbiAgYWNjZXNzOiBmc1Byb21pc2VzLmFjY2VzcyxcbiAgYXBwZW5kRmlsZTogZnNQcm9taXNlcy5hcHBlbmRGaWxlLFxuICBjaG1vZDogZnNQcm9taXNlcy5jaG1vZCxcbiAgY2xvc2U6IEIucHJvbWlzaWZ5KGNsb3NlKSxcbiAgY29uc3RhbnRzLFxuICBjcmVhdGVXcml0ZVN0cmVhbSxcbiAgY3JlYXRlUmVhZFN0cmVhbSxcbiAgbHN0YXQ6IGZzUHJvbWlzZXMubHN0YXQsXG4gIC8qKlxuICAgKiBXYXJuaW5nOiB0aGlzIGlzIGEgcHJvbWlzaWZpZWQge0BsaW5rY29kZSBvcGVuIGZzLm9wZW59LlxuICAgKiBJdCByZXNvbHZlcyB3L2EgZmlsZSBkZXNjcmlwdG9yIGluc3RlYWQgb2YgYSB7QGxpbmtjb2RlIGZzUHJvbWlzZXMuRmlsZUhhbmRsZSBGaWxlSGFuZGxlfSBvYmplY3QsIGFzIHtAbGlua2NvZGUgZnNQcm9taXNlcy5vcGVufSBkb2VzLiBVc2Uge0BsaW5rY29kZSBmcy5vcGVuRmlsZX0gaWYgeW91IHdhbnQgYSBgRmlsZUhhbmRsZWAuXG4gICAqIEB0eXBlIHsocGF0aDogUGF0aExpa2UsIGZsYWdzOiBpbXBvcnQoJ2ZzJykuT3Blbk1vZGUsIG1vZGU/OiBpbXBvcnQoJ2ZzJykuTW9kZSkgPT4gUHJvbWlzZTxudW1iZXI+fVxuICAgKi9cbiAgb3BlbjogQi5wcm9taXNpZnkob3BlbiksXG4gIG9wZW5GaWxlOiBmc1Byb21pc2VzLm9wZW4sXG4gIHJlYWRkaXI6IGZzUHJvbWlzZXMucmVhZGRpcixcbiAgcmVhZDogQi5wcm9taXNpZnkocmVhZCksXG4gIHJlYWRGaWxlOiBmc1Byb21pc2VzLnJlYWRGaWxlLFxuICByZWFkbGluazogZnNQcm9taXNlcy5yZWFkbGluayxcbiAgcmVhbHBhdGg6IGZzUHJvbWlzZXMucmVhbHBhdGgsXG4gIHJlbmFtZTogZnNQcm9taXNlcy5yZW5hbWUsXG4gIHN0YXQ6IGZzUHJvbWlzZXMuc3RhdCxcbiAgc3ltbGluazogZnNQcm9taXNlcy5zeW1saW5rLFxuICB1bmxpbms6IGZzUHJvbWlzZXMudW5saW5rLFxuICB3cml0ZTogQi5wcm9taXNpZnkod3JpdGUpLFxuICB3cml0ZUZpbGU6IGZzUHJvbWlzZXMud3JpdGVGaWxlLFxuXG4gIC8vIGRlcHJlY2F0ZWQgcHJvcHNcblxuICAvKipcbiAgICogVXNlIGBjb25zdGFudHMuRl9PS2AgaW5zdGVhZC5cbiAgICogQGRlcHJlY2F0ZWRcbiAgICovXG4gIEZfT0s6IGNvbnN0YW50cy5GX09LLFxuXG4gIC8qKlxuICAgKiBVc2UgYGNvbnN0YW50cy5SX09LYCBpbnN0ZWFkLlxuICAgKiBAZGVwcmVjYXRlZFxuICAgKi9cbiAgUl9PSzogY29uc3RhbnRzLlJfT0ssXG5cbiAgLyoqXG4gICAqIFVzZSBgY29uc3RhbnRzLldfT0tgIGluc3RlYWQuXG4gICAqIEBkZXByZWNhdGVkXG4gICAqL1xuICBXX09LOiBjb25zdGFudHMuV19PSyxcblxuICAvKipcbiAgICogVXNlIGBjb25zdGFudHMuWF9PS2AgaW5zdGVhZC5cbiAgICogQGRlcHJlY2F0ZWRcbiAgICovXG4gIFhfT0s6IGNvbnN0YW50cy5YX09LLFxufTtcblxuZXhwb3J0IHtmc307XG5leHBvcnQgZGVmYXVsdCBmcztcblxuLyoqXG4gKiBUaGUgY2FsbGJhY2sgZnVuY3Rpb24gd2hpY2ggd2lsbCBiZSBjYWxsZWQgZHVyaW5nIHRoZSBkaXJlY3Rvcnkgd2Fsa2luZ1xuICogQGNhbGxiYWNrIFdhbGtEaXJDYWxsYmFja1xuICogQHBhcmFtIHtzdHJpbmd9IGl0ZW1QYXRoIFRoZSBwYXRoIG9mIHRoZSBmaWxlIG9yIGZvbGRlclxuICogQHBhcmFtIHtib29sZWFufSBpc0RpcmVjdG9yeSBTaG93cyBpZiBpdCBpcyBhIGRpcmVjdG9yeSBvciBhIGZpbGVcbiAqIEByZXR1cm4ge2Jvb2xlYW59IHJldHVybiB0cnVlIGlmIHlvdSB3YW50IHRvIHN0b3Agd2Fsa2luZ1xuICovXG5cbi8qKlxuICogQHR5cGVkZWYge2ltcG9ydCgnZ2xvYicpfSBnbG9iXG4gKiBAdHlwZWRlZiB7aW1wb3J0KCdtdicpfSBtdlxuICogQHR5cGVkZWYge2ltcG9ydCgnZnMnKS5QYXRoTGlrZX0gUGF0aExpa2VcbiAqL1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFFQTs7QUFDQTs7QUFDQTs7QUFVQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUVBLE1BQU1BLFFBQVEsR0FFVkMsaUJBQUEsQ0FBRUMsU0FBRixDQUFZQyxZQUFaLENBRko7O0FBSUEsTUFBTUMsY0FBYyxHQUFHQyxlQUFBLENBQUVDLE9BQUYsQ0FBVUMsZUFBQSxDQUFPQyxJQUFqQixDQUF2Qjs7QUFFQSxNQUFNQyxFQUFFLEdBQUc7RUFVVCxNQUFNQyxTQUFOLENBQWdCQyxJQUFoQixFQUFzQjtJQUNwQixJQUFJO01BQ0YsTUFBTUMsWUFBQSxDQUFXQyxNQUFYLENBQWtCRixJQUFsQixFQUF3QkcsYUFBQSxDQUFVQyxJQUFsQyxDQUFOO0lBQ0QsQ0FGRCxDQUVFLE1BQU07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