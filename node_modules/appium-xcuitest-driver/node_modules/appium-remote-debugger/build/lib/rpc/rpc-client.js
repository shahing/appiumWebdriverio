"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
require("source-map-support/register");
var _remoteMessages = _interopRequireDefault(require("./remote-messages"));
var _asyncbox = require("asyncbox");
var _logger = _interopRequireDefault(require("../logger"));
var _lodash = _interopRequireDefault(require("lodash"));
var _bluebird = _interopRequireDefault(require("bluebird"));
var _rpcMessageHandler = _interopRequireDefault(require("./rpc-message-handler"));
var _support = require("@appium/support");
const DATA_LOG_LENGTH = {
  length: 200
};
const WAIT_FOR_TARGET_TIMEOUT = 10000;
const WAIT_FOR_TARGET_INTERVAL = 1000;
const MIN_PLATFORM_FOR_TARGET_BASED = '12.2';
const MIN_PLATFORM_NO_TARGET_EXISTS = '13.4';
function isTargetBased(isSafari, platformVersion) {
  const isHighVersion = _support.util.compareVersions(platformVersion, '>=', MIN_PLATFORM_FOR_TARGET_BASED);
  _logger.default.debug(`Checking which communication style to use (${isSafari ? '' : 'non-'}Safari on platform version '${platformVersion}')`);
  _logger.default.debug(`Platform version equal or higher than '${MIN_PLATFORM_FOR_TARGET_BASED}': ${isHighVersion}`);
  return isHighVersion;
}
class RpcClient {
  constructor(opts = {}) {
    this._targets = [];
    this._shouldCheckForTarget = !!opts.shouldCheckForTarget;
    const {
      bundleId,
      platformVersion = {},
      isSafari = true,
      logAllCommunication = false,
      logAllCommunicationHexDump = false,
      webInspectorMaxFrameLength,
      socketChunkSize,
      fullPageInitialization = false
    } = opts;
    this.isSafari = isSafari;
    this.isConnected = false;
    this.connId = _support.util.uuidV4();
    this.senderId = _support.util.uuidV4();
    this.msgId = 0;
    this.logAllCommunication = logAllCommunication;
    this.logAllCommunicationHexDump = logAllCommunicationHexDump;
    this.socketChunkSize = socketChunkSize;
    this.webInspectorMaxFrameLength = webInspectorMaxFrameLength;
    this.fullPageInitialization = fullPageInitialization;
    this.bundleId = bundleId;
    this.platformVersion = platformVersion;
    this._contexts = [];
    this._targets = {};
    this.isTargetBased = isTargetBased(isSafari, this.platformVersion);
  }
  get contexts() {
    return this._contexts;
  }
  get needsTarget() {
    return this.shouldCheckForTarget && this.isTargetBased;
  }
  get targets() {
    return this._targets;
  }
  get shouldCheckForTarget() {
    return this._shouldCheckForTarget;
  }
  set shouldCheckForTarget(shouldCheckForTarget) {
    this._shouldCheckForTarget = !!shouldCheckForTarget;
  }
  get isConnected() {
    return this.connected;
  }
  set isConnected(connected) {
    this.connected = !!connected;
  }
  on(event, listener) {
    this.messageHandler.on(event, listener);
    return this;
  }
  once(event, listener) {
    this.messageHandler.once(event, listener);
    return this;
  }
  off(event, listener) {
    this.messageHandler.off(event, listener);
    return this;
  }
  set isTargetBased(isTargetBased) {
    _logger.default.warn(`Setting communication protocol: using ${isTargetBased ? 'Target-based' : 'full Web Inspector protocol'} communication`);
    this._isTargetBased = isTargetBased;
    if (!this.remoteMessages) {
      this.remoteMessages = new _remoteMessages.default(isTargetBased);
    } else {
      this.remoteMessages.isTargetBased = isTargetBased;
    }
    if (!this.messageHandler) {
      this.messageHandler = new _rpcMessageHandler.default(isTargetBased);
      this.messageHandler.on('Target.targetCreated', this.addTarget.bind(this));
      this.messageHandler.on('Target.didCommitProvisionalTarget', this.updateTarget.bind(this));
      this.messageHandler.on('Target.targetDestroyed', this.removeTarget.bind(this));
      this.messageHandler.on('Runtime.executionContextCreated', this.onExecutionContextCreated.bind(this));
      this.messageHandler.on('Heap.garbageCollected', this.onGarbageCollected.bind(this));
    } else {
      this.messageHandler.isTargetBased = isTargetBased;
    }
  }
  get isTargetBased() {
    return this._isTargetBased;
  }
  async waitForTarget(appIdKey, pageIdKey, force = false) {
    if (!force && !this.needsTarget) {
      return;
    }
    if (this.getTarget(appIdKey, pageIdKey)) {
      return;
    }
    try {
      await (0, _asyncbox.waitForCondition)(() => !_lodash.default.isEmpty(this.getTarget(appIdKey, pageIdKey)), {
        waitMs: WAIT_FOR_TARGET_TIMEOUT,
        intervalMs: WAIT_FOR_TARGET_INTERVAL,
        error: 'No targets found, unable to communicate with device'
      });
    } catch (err) {
      if (!err.message.includes('Condition unmet')) {
        throw err;
      }
      throw new Error('No targets found, unable to communicate with device');
    }
  }
  async send(command, opts = {}, waitForResponse = true) {
    const timer = new _support.timing.Timer().start();
    const {
      appIdKey,
      pageIdKey
    } = opts;
    try {
      if (!_lodash.default.isEmpty(appIdKey) && !_lodash.default.isEmpty(pageIdKey)) {
        await this.waitForTarget(appIdKey, pageIdKey);
      }
      return await this.sendToDevice(command, opts, waitForResponse);
    } catch (err) {
      let {
        message = ''
      } = err;
      message = message.toLowerCase();
      if (message.includes(`'target' domain was not found`)) {
        _logger.default.info('The target device does not support Target based communication. ' + 'Will follow non-target based communication.');
        this.isTargetBased = false;
        return await this.sendToDevice(command, opts, waitForResponse);
      } else if (message.includes(`domain was not found`) || message.includes(`some arguments of method`) || message.includes(`missing target`)) {
        this.isTargetBased = true;
        await this.waitForTarget(appIdKey, pageIdKey);
        return await this.sendToDevice(command, opts, waitForResponse);
      }
      throw err;
    } finally {
      _logger.default.debug(`Sending to Web Inspector took ${timer.getDuration().asMilliSeconds.toFixed(0)}ms`);
    }
  }
  async sendToDevice(command, opts = {}, waitForResponse = true) {
    return await new _bluebird.default(async (resolve, reject) => {
      var _cmd$__argument, _cmd$__argument2;
      const msgId = this.msgId++;
      let wrapperMsgId = msgId;
      if (this.isTargetBased) {
        wrapperMsgId = this.msgId++;
        this.messageHandler.on(wrapperMsgId.toString(), function (err) {
          if (err) {
            reject(err);
          }
        });
      }
      const appIdKey = opts.appIdKey;
      const pageIdKey = opts.pageIdKey;
      const targetId = this.getTarget(appIdKey, pageIdKey);
      const fullOpts = _lodash.default.defaults({
        connId: this.connId,
        senderId: this.senderId,
        targetId,
        id: msgId
      }, opts);
      const cmd = this.remoteMessages.getRemoteCommand(command, fullOpts);
      if (cmd !== null && cmd !== void 0 && (_cmd$__argument = cmd.__argument) !== null && _cmd$__argument !== void 0 && _cmd$__argument.WIRSocketDataKey) {
        if (_lodash.default.isNil(cmd.__argument.WIRSocketDataKey.id)) {
          cmd.__argument.WIRSocketDataKey.id = wrapperMsgId;
        }
        cmd.__argument.WIRSocketDataKey = Buffer.from(JSON.stringify(cmd.__argument.WIRSocketDataKey));
      }
      let messageHandled = true;
      if (!waitForResponse) {
        messageHandled = false;
        this.messageHandler.once(msgId.toString(), function (err) {
          if (err) {
            _logger.default.error(`Received error from send that is not being waited for (id: ${msgId}): '${_lodash.default.truncate(JSON.stringify(err), DATA_LOG_LENGTH)}'`);
            reject(err);
          }
        });
      } else if (this.messageHandler.listeners(cmd.__selector).length) {
        this.messageHandler.prependOnceListener(cmd.__selector, function (err, ...args) {
          if (err) {
            return reject(err);
          }
          _logger.default.debug(`Received response from send (id: ${msgId}): '${_lodash.default.truncate(JSON.stringify(args), DATA_LOG_LENGTH)}'`);
          resolve(args);
        });
      } else if (cmd !== null && cmd !== void 0 && (_cmd$__argument2 = cmd.__argument) !== null && _cmd$__argument2 !== void 0 && _cmd$__argument2.WIRSocketDataKey) {
        this.messageHandler.once(msgId.toString(), function (err, value) {
          if (err) {
            return reject(new Error(`Remote debugger error with code '${err.code}': ${err.message}`));
          }
          _logger.default.debug(`Received data response from send (id: ${msgId}): '${_lodash.default.truncate(JSON.stringify(value), DATA_LOG_LENGTH)}'`);
          resolve(value);
        });
      } else {
        messageHandled = false;
      }
      const msg = `Sending '${cmd.__selector}' message` + (fullOpts.appIdKey ? ` to app '${fullOpts.appIdKey}'` : '') + (fullOpts.pageIdKey ? `, page '${fullOpts.pageIdKey}'` : '') + (this.needsTarget && targetId ? `, target '${targetId}'` : '') + ` (id: ${msgId}): '${command}'`;
      _logger.default.debug(msg);
      try {
        const res = await this.sendMessage(cmd);
        if (!messageHandled) {
          resolve(res);
        }
      } catch (err) {
        return reject(err);
      }
    });
  }
  async connect() {
    throw new Error(`Sub-classes need to implement a 'connect' function`);
  }
  async disconnect() {
    this.messageHandler.removeAllListeners();
  }
  async sendMessage() {
    throw new Error(`Sub-classes need to implement a 'sendMessage' function`);
  }
  async receive() {
    throw new Error(`Sub-classes need to implement a 'receive' function`);
  }
  addTarget(err, app, targetInfo) {
    if (_lodash.default.isNil(targetInfo === null || targetInfo === void 0 ? void 0 : targetInfo.targetId)) {
      _logger.default.warn(`Received 'Target.targetCreated' event for app '${app}' with no target. Skipping`);
      return;
    }
    if (_lodash.default.isEmpty(this.pendingTargetNotification) && !targetInfo.isProvisional) {
      _logger.default.warn(`Received 'Target.targetCreated' event for app '${app}' with no pending request: ${JSON.stringify(targetInfo)}`);
      return;
    }
    if (targetInfo.isProvisional) {
      _logger.default.debug(`Provisional target created for app '${app}', '${targetInfo.targetId}'. Ignoring until target update event`);
      return;
    }
    const [appIdKey, pageIdKey] = this.pendingTargetNotification;
    _logger.default.debug(`Target created for app '${appIdKey}' and page '${pageIdKey}': ${JSON.stringify(targetInfo)}`);
    if (_lodash.default.has(this.targets[appIdKey], pageIdKey)) {
      _logger.default.debug(`There is already a target for this app and page ('${this.targets[appIdKey][pageIdKey]}'). This might cause problems`);
    }
    this.targets[app] = this.targets[app] || {};
    this.targets[appIdKey][pageIdKey] = targetInfo.targetId;
  }
  updateTarget(err, app, oldTargetId, newTargetId) {
    _logger.default.debug(`Target updated for app '${app}'. Old target: '${oldTargetId}', new target: '${newTargetId}'`);
    if (!this.targets[app]) {
      _logger.default.warn(`No existing target for app '${app}'. Not sure what to do`);
      return;
    }
    this.targets[app].provisional = {
      oldTargetId,
      newTargetId
    };
  }
  removeTarget(err, app, targetInfo) {
    var _this$targets$app, _this$targets$app$pro;
    if (_lodash.default.isNil(targetInfo === null || targetInfo === void 0 ? void 0 : targetInfo.targetId)) {
      _logger.default.debug(`Received 'Target.targetDestroyed' event with no target. Skipping`);
      return;
    }
    _logger.default.debug(`Target destroyed for app '${app}': ${targetInfo.targetId}`);
    if (((_this$targets$app = this.targets[app]) === null || _this$targets$app === void 0 ? void 0 : (_this$targets$app$pro = _this$targets$app.provisional) === null || _this$targets$app$pro === void 0 ? void 0 : _this$targets$app$pro.oldTargetId) === targetInfo.targetId) {
      const {
        oldTargetId,
        newTargetId
      } = this.targets[app].provisional;
      delete this.targets[app].provisional;
      const targets = this.targets[app];
      for (const [page, targetId] of _lodash.default.toPairs(targets)) {
        if (targetId === oldTargetId) {
          _logger.default.debug(`Found provisional target for app '${app}'. Old target: '${oldTargetId}', new target: '${newTargetId}'. Updating`);
          targets[page] = newTargetId;
          return;
        }
      }
      _logger.default.warn(`Provisional target for app '${app}' found, but no suitable existing target found. This may cause problems`);
      _logger.default.warn(`Old target: '${oldTargetId}', new target: '${newTargetId}'. Existing targets: ${JSON.stringify(targets)}`);
    }
    const targets = this.targets[app];
    for (const [page, targetId] of _lodash.default.toPairs(targets)) {
      if (targetId === targetInfo.targetId) {
        delete targets[page];
        return;
      }
    }
    _logger.default.debug(`Target '${targetInfo.targetId}' deleted for app '${app}', but no such target exists`);
  }
  getTarget(appIdKey, pageIdKey) {
    return (this.targets[appIdKey] || {})[pageIdKey];
  }
  async selectPage(appIdKey, pageIdKey) {
    this.pendingTargetNotification = [appIdKey, pageIdKey];
    this.shouldCheckForTarget = false;
    const sendOpts = {
      appIdKey,
      pageIdKey
    };
    for (const enabled of [true, false]) {
      await this.send('indicateWebView', Object.assign({
        enabled
      }, sendOpts), false);
    }
    await this.send('setSenderKey', sendOpts);
    _logger.default.debug('Sender key set');
    if (this.isTargetBased && _support.util.compareVersions(this.platformVersion, '<', MIN_PLATFORM_NO_TARGET_EXISTS)) {
      await this.send('Target.exists', sendOpts, false);
    }
    this.shouldCheckForTarget = true;
    if (this.fullPageInitialization) {
      await this.initializePageFull(appIdKey, pageIdKey);
    } else {
      await this.initializePage(appIdKey, pageIdKey);
    }
  }
  async initializePage(appIdKey, pageIdKey) {
    const sendOpts = {
      appIdKey,
      pageIdKey
    };
    await this.send('Inspector.enable', sendOpts, false);
    await this.send('Page.enable', sendOpts, false);
    await this.send('Network.enable', sendOpts, false);
    await this.send('Runtime.enable', sendOpts, false);
    await this.send('Heap.enable', sendOpts, false);
    await this.send('Debugger.enable', sendOpts, false);
    await this.send('Console.enable', sendOpts, false);
    await this.send('Inspector.initialized', sendOpts, false);
  }
  async initializePageFull(appIdKey, pageIdKey) {
    const sendOpts = {
      appIdKey,
      pageIdKey
    };
    await this.send('Inspector.enable', sendOpts, false);
    await this.send('Page.enable', sendOpts, false);
    await this.send('Page.getResourceTree', sendOpts, false);
    await this.send('Network.enable', sendOpts, false);
    await this.send('Network.setResourceCachingDisabled', Object.assign({
      disabled: false
    }, sendOpts), false);
    await this.send('DOMStorage.enable', sendOpts, false);
    await this.send('Database.enable', sendOpts, false);
    await this.send('IndexedDB.enable', sendOpts, false);
    await this.send('CSS.enable', sendOpts, false);
    await this.send('Runtime.enable', sendOpts, false);
    await this.send('Heap.enable', sendOpts, false);
    await this.send('Memory.enable', sendOpts, false);
    await this.send('ApplicationCache.enable', sendOpts, false);
    await this.send('ApplicationCache.getFramesWithManifests', sendOpts, false);
    await this.send('Timeline.setInstruments', Object.assign({
      instruments: ['Timeline', 'ScriptProfiler', 'CPU']
    }, sendOpts), false);
    await this.send('Timeline.setAutoCaptureEnabled', Object.assign({
      enabled: false
    }, sendOpts), false);
    await this.send('Debugger.enable', sendOpts, false);
    await this.send('Debugger.setBreakpointsActive', Object.assign({
      active: true
    }, sendOpts), false);
    await this.send('Debugger.setPauseOnExceptions', Object.assign({
      state: 'none'
    }, sendOpts), false);
    await this.send('Debugger.setPauseOnAssertions', Object.assign({
      enabled: false
    }, sendOpts), false);
    await this.send('Debugger.setAsyncStackTraceDepth', Object.assign({
      depth: 200
    }, sendOpts), false);
    await this.send('Debugger.setPauseForInternalScripts', Object.assign({
      shouldPause: false
    }, sendOpts), false);
    await this.send('LayerTree.enable', sendOpts, false);
    await this.send('Worker.enable', sendOpts, false);
    await this.send('Canvas.enable', sendOpts, false);
    await this.send('Console.enable', sendOpts, false);
    await this.send('DOM.getDocument', sendOpts, false);
    const loggingChannels = await this.send('Console.getLoggingChannels', sendOpts);
    for (const source of (loggingChannels.channels || []).map(entry => entry.source)) {
      await this.send('Console.setLoggingChannelLevel', Object.assign({
        source,
        level: 'verbose'
      }, sendOpts), false);
    }
    await this.send('Inspector.initialized', sendOpts, false);
  }
  async selectApp(appIdKey) {
    return await new _bluebird.default((resolve, reject) => {
      const onAppChange = (err, dict) => {
        if (err) {
          return reject(err);
        }
        const oldAppIdKey = dict.WIRHostApplicationIdentifierKey;
        const correctAppIdKey = dict.WIRApplicationIdentifierKey;
        if (oldAppIdKey && correctAppIdKey !== oldAppIdKey) {
          _logger.default.debug(`We were notified we might have connected to the wrong app. ` + `Using id ${correctAppIdKey} instead of ${oldAppIdKey}`);
        }
        reject(new Error('New application has connected'));
      };
      this.messageHandler.prependOnceListener('_rpc_applicationConnected:', onAppChange);
      return (async () => {
        let pageDict, connectedAppIdKey;
        try {
          [connectedAppIdKey, pageDict] = await this.send('connectToApp', {
            appIdKey
          });
        } catch (err) {
          _logger.default.warn(`Unable to connect to app: ${err.message}`);
          reject(err);
        }
        if (_lodash.default.isEmpty(pageDict)) {
          let msg = 'Empty page dictionary received';
          _logger.default.debug(msg);
          reject(new Error(msg));
        } else {
          resolve([connectedAppIdKey, pageDict]);
        }
      })();
    });
  }
  onExecutionContextCreated(err, context) {
    this.contexts.push(context.id);
  }
  onGarbageCollected() {
    _logger.default.debug(`Web Inspector garbage collected`);
  }
  onScriptParsed(err, scriptInfo) {
    _logger.default.debug(`Script parsed: ${JSON.stringify(scriptInfo)}`);
  }
}
exports.default = RpcClient;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEQVRBX0xPR19MRU5HVEgiLCJsZW5ndGgiLCJXQUlUX0ZPUl9UQVJHRVRfVElNRU9VVCIsIldBSVRfRk9SX1RBUkdFVF9JTlRFUlZBTCIsIk1JTl9QTEFURk9STV9GT1JfVEFSR0VUX0JBU0VEIiwiTUlOX1BMQVRGT1JNX05PX1RBUkdFVF9FWElTVFMiLCJpc1RhcmdldEJhc2VkIiwiaXNTYWZhcmkiLCJwbGF0Zm9ybVZlcnNpb24iLCJpc0hpZ2hWZXJzaW9uIiwidXRpbCIsImNvbXBhcmVWZXJzaW9ucyIsImxvZyIsImRlYnVnIiwiUnBjQ2xpZW50IiwiY29uc3RydWN0b3IiLCJvcHRzIiwiX3RhcmdldHMiLCJfc2hvdWxkQ2hlY2tGb3JUYXJnZXQiLCJzaG91bGRDaGVja0ZvclRhcmdldCIsImJ1bmRsZUlkIiwibG9nQWxsQ29tbXVuaWNhdGlvbiIsImxvZ0FsbENvbW11bmljYXRpb25IZXhEdW1wIiwid2ViSW5zcGVjdG9yTWF4RnJhbWVMZW5ndGgiLCJzb2NrZXRDaHVua1NpemUiLCJmdWxsUGFnZUluaXRpYWxpemF0aW9uIiwiaXNDb25uZWN0ZWQiLCJjb25uSWQiLCJ1dWlkVjQiLCJzZW5kZXJJZCIsIm1zZ0lkIiwiX2NvbnRleHRzIiwiY29udGV4dHMiLCJuZWVkc1RhcmdldCIsInRhcmdldHMiLCJjb25uZWN0ZWQiLCJvbiIsImV2ZW50IiwibGlzdGVuZXIiLCJtZXNzYWdlSGFuZGxlciIsIm9uY2UiLCJvZmYiLCJ3YXJuIiwiX2lzVGFyZ2V0QmFzZWQiLCJyZW1vdGVNZXNzYWdlcyIsIlJlbW90ZU1lc3NhZ2VzIiwiUnBjTWVzc2FnZUhhbmRsZXIiLCJhZGRUYXJnZXQiLCJiaW5kIiwidXBkYXRlVGFyZ2V0IiwicmVtb3ZlVGFyZ2V0Iiwib25FeGVjdXRpb25Db250ZXh0Q3JlYXRlZCIsIm9uR2FyYmFnZUNvbGxlY3RlZCIsIndhaXRGb3JUYXJnZXQiLCJhcHBJZEtleSIsInBhZ2VJZEtleSIsImZvcmNlIiwiZ2V0VGFyZ2V0Iiwid2FpdEZvckNvbmRpdGlvbiIsIl8iLCJpc0VtcHR5Iiwid2FpdE1zIiwiaW50ZXJ2YWxNcyIsImVycm9yIiwiZXJyIiwibWVzc2FnZSIsImluY2x1ZGVzIiwiRXJyb3IiLCJzZW5kIiwiY29tbWFuZCIsIndhaXRGb3JSZXNwb25zZSIsInRpbWVyIiwidGltaW5nIiwiVGltZXIiLCJzdGFydCIsInNlbmRUb0RldmljZSIsInRvTG93ZXJDYXNlIiwiaW5mbyIsImdldER1cmF0aW9uIiwiYXNNaWxsaVNlY29uZHMiLCJ0b0ZpeGVkIiwiQiIsInJlc29sdmUiLCJyZWplY3QiLCJ3cmFwcGVyTXNnSWQiLCJ0b1N0cmluZyIsInRhcmdldElkIiwiZnVsbE9wdHMiLCJkZWZhdWx0cyIsImlkIiwiY21kIiwiZ2V0UmVtb3RlQ29tbWFuZCIsIl9fYXJndW1lbnQiLCJXSVJTb2NrZXREYXRhS2V5IiwiaXNOaWwiLCJCdWZmZXIiLCJmcm9tIiwiSlNPTiIsInN0cmluZ2lmeSIsIm1lc3NhZ2VIYW5kbGVkIiwidHJ1bmNhdGUiLCJsaXN0ZW5lcnMiLCJfX3NlbGVjdG9yIiwicHJlcGVuZE9uY2VMaXN0ZW5lciIsImFyZ3MiLCJ2YWx1ZSIsImNvZGUiLCJtc2ciLCJyZXMiLCJzZW5kTWVzc2FnZSIsImNvbm5lY3QiLCJkaXNjb25uZWN0IiwicmVtb3ZlQWxsTGlzdGVuZXJzIiwicmVjZWl2ZSIsImFwcCIsInRhcmdldEluZm8iLCJwZW5kaW5nVGFyZ2V0Tm90aWZpY2F0aW9uIiwiaXNQcm92aXNpb25hbCIsImhhcyIsIm9sZFRhcmdldElkIiwibmV3VGFyZ2V0SWQiLCJwcm92aXNpb25hbCIsInBhZ2UiLCJ0b1BhaXJzIiwic2VsZWN0UGFnZSIsInNlbmRPcHRzIiwiZW5hYmxlZCIsIk9iamVjdCIsImFzc2lnbiIsImluaXRpYWxpemVQYWdlRnVsbCIsImluaXRpYWxpemVQYWdlIiwiZGlzYWJsZWQiLCJpbnN0cnVtZW50cyIsImFjdGl2ZSIsInN0YXRlIiwiZGVwdGgiLCJzaG91bGRQYXVzZSIsImxvZ2dpbmdDaGFubmVscyIsInNvdXJjZSIsImNoYW5uZWxzIiwibWFwIiwiZW50cnkiLCJsZXZlbCIsInNlbGVjdEFwcCIsIm9uQXBwQ2hhbmdlIiwiZGljdCIsIm9sZEFwcElkS2V5IiwiV0lSSG9zdEFwcGxpY2F0aW9uSWRlbnRpZmllcktleSIsImNvcnJlY3RBcHBJZEtleSIsIldJUkFwcGxpY2F0aW9uSWRlbnRpZmllcktleSIsInBhZ2VEaWN0IiwiY29ubmVjdGVkQXBwSWRLZXkiLCJjb250ZXh0IiwicHVzaCIsIm9uU2NyaXB0UGFyc2VkIiwic2NyaXB0SW5mbyJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9ycGMvcnBjLWNsaWVudC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVtb3RlTWVzc2FnZXMgZnJvbSAnLi9yZW1vdGUtbWVzc2FnZXMnO1xuaW1wb3J0IHsgd2FpdEZvckNvbmRpdGlvbiB9IGZyb20gJ2FzeW5jYm94JztcbmltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgUnBjTWVzc2FnZUhhbmRsZXIgZnJvbSAnLi9ycGMtbWVzc2FnZS1oYW5kbGVyJztcbmltcG9ydCB7IHV0aWwsIHRpbWluZyB9IGZyb20gJ0BhcHBpdW0vc3VwcG9ydCc7XG5cblxuY29uc3QgREFUQV9MT0dfTEVOR1RIID0ge2xlbmd0aDogMjAwfTtcblxuY29uc3QgV0FJVF9GT1JfVEFSR0VUX1RJTUVPVVQgPSAxMDAwMDtcbmNvbnN0IFdBSVRfRk9SX1RBUkdFVF9JTlRFUlZBTCA9IDEwMDA7XG5cbmNvbnN0IE1JTl9QTEFURk9STV9GT1JfVEFSR0VUX0JBU0VEID0gJzEyLjInO1xuXG4vLyBgVGFyZ2V0LmV4aXN0c2AgcHJvdG9jb2wgbWV0aG9kIHdhcyByZW1vdmVkIGZyb20gV2ViS2l0IGluIDEzLjRcbmNvbnN0IE1JTl9QTEFURk9STV9OT19UQVJHRVRfRVhJU1RTID0gJzEzLjQnO1xuXG5mdW5jdGlvbiBpc1RhcmdldEJhc2VkIChpc1NhZmFyaSwgcGxhdGZvcm1WZXJzaW9uKSB7XG4gIC8vIE9uIGlPUyAxMi4yIHRoZSBtZXNzYWdlcyBnZXQgc2VudCB0aHJvdWdoIHRoZSBUYXJnZXQgZG9tYWluXG4gIC8vIE9uIGlPUyAxMy4wKywgV0tXZWJWaWV3IGFsc28gbmVlZHMgdG8gZm9sbG93IHRoZSBUYXJnZXQgZG9tYWluLFxuICAvLyBzbyBoZXJlIG9ubHkgY2hlY2sgdGhlIHRhcmdldCBPUyB2ZXJzaW9uIGFzIHRoZSBkZWZhdWx0IGJlaGF2aW91ci5cbiAgY29uc3QgaXNIaWdoVmVyc2lvbiA9IHV0aWwuY29tcGFyZVZlcnNpb25zKHBsYXRmb3JtVmVyc2lvbiwgJz49JywgTUlOX1BMQVRGT1JNX0ZPUl9UQVJHRVRfQkFTRUQpO1xuICBsb2cuZGVidWcoYENoZWNraW5nIHdoaWNoIGNvbW11bmljYXRpb24gc3R5bGUgdG8gdXNlICgke2lzU2FmYXJpID8gJycgOiAnbm9uLSd9U2FmYXJpIG9uIHBsYXRmb3JtIHZlcnNpb24gJyR7cGxhdGZvcm1WZXJzaW9ufScpYCk7XG4gIGxvZy5kZWJ1ZyhgUGxhdGZvcm0gdmVyc2lvbiBlcXVhbCBvciBoaWdoZXIgdGhhbiAnJHtNSU5fUExBVEZPUk1fRk9SX1RBUkdFVF9CQVNFRH0nOiAke2lzSGlnaFZlcnNpb259YCk7XG4gIHJldHVybiBpc0hpZ2hWZXJzaW9uO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBScGNDbGllbnQge1xuICBjb25zdHJ1Y3RvciAob3B0cyA9IHt9KSB7XG4gICAgdGhpcy5fdGFyZ2V0cyA9IFtdO1xuICAgIHRoaXMuX3Nob3VsZENoZWNrRm9yVGFyZ2V0ID0gISFvcHRzLnNob3VsZENoZWNrRm9yVGFyZ2V0O1xuXG4gICAgY29uc3Qge1xuICAgICAgYnVuZGxlSWQsXG4gICAgICBwbGF0Zm9ybVZlcnNpb24gPSB7fSxcbiAgICAgIGlzU2FmYXJpID0gdHJ1ZSxcbiAgICAgIGxvZ0FsbENvbW11bmljYXRpb24gPSBmYWxzZSxcbiAgICAgIGxvZ0FsbENvbW11bmljYXRpb25IZXhEdW1wID0gZmFsc2UsXG4gICAgICB3ZWJJbnNwZWN0b3JNYXhGcmFtZUxlbmd0aCxcbiAgICAgIHNvY2tldENodW5rU2l6ZSxcbiAgICAgIGZ1bGxQYWdlSW5pdGlhbGl6YXRpb24gPSBmYWxzZSxcbiAgICB9ID0gb3B0cztcblxuICAgIHRoaXMuaXNTYWZhcmkgPSBpc1NhZmFyaTtcblxuICAgIHRoaXMuaXNDb25uZWN0ZWQgPSBmYWxzZTtcbiAgICB0aGlzLmNvbm5JZCA9IHV0aWwudXVpZFY0KCk7XG4gICAgdGhpcy5zZW5kZXJJZCA9IHV0aWwudXVpZFY0KCk7XG4gICAgdGhpcy5tc2dJZCA9IDA7XG5cbiAgICB0aGlzLmxvZ0FsbENvbW11bmljYXRpb24gPSBsb2dBbGxDb21tdW5pY2F0aW9uO1xuICAgIHRoaXMubG9nQWxsQ29tbXVuaWNhdGlvbkhleER1bXAgPSBsb2dBbGxDb21tdW5pY2F0aW9uSGV4RHVtcDtcbiAgICB0aGlzLnNvY2tldENodW5rU2l6ZSA9IHNvY2tldENodW5rU2l6ZTtcbiAgICB0aGlzLndlYkluc3BlY3Rvck1heEZyYW1lTGVuZ3RoID0gd2ViSW5zcGVjdG9yTWF4RnJhbWVMZW5ndGg7XG5cbiAgICB0aGlzLmZ1bGxQYWdlSW5pdGlhbGl6YXRpb24gPSBmdWxsUGFnZUluaXRpYWxpemF0aW9uO1xuXG4gICAgdGhpcy5idW5kbGVJZCA9IGJ1bmRsZUlkO1xuICAgIHRoaXMucGxhdGZvcm1WZXJzaW9uID0gcGxhdGZvcm1WZXJzaW9uO1xuXG4gICAgdGhpcy5fY29udGV4dHMgPSBbXTtcbiAgICB0aGlzLl90YXJnZXRzID0ge307XG5cbiAgICAvLyBzdGFydCB3aXRoIGEgYmVzdCBndWVzcyBmb3IgdGhlIHByb3RvY29sXG4gICAgdGhpcy5pc1RhcmdldEJhc2VkID0gaXNUYXJnZXRCYXNlZChpc1NhZmFyaSwgdGhpcy5wbGF0Zm9ybVZlcnNpb24pO1xuICB9XG5cbiAgZ2V0IGNvbnRleHRzICgpIHtcbiAgICByZXR1cm4gdGhpcy5fY29udGV4dHM7XG4gIH1cblxuICBnZXQgbmVlZHNUYXJnZXQgKCkge1xuICAgIHJldHVybiB0aGlzLnNob3VsZENoZWNrRm9yVGFyZ2V0ICYmIHRoaXMuaXNUYXJnZXRCYXNlZDtcbiAgfVxuXG4gIGdldCB0YXJnZXRzICgpIHtcbiAgICByZXR1cm4gdGhpcy5fdGFyZ2V0cztcbiAgfVxuXG4gIGdldCBzaG91bGRDaGVja0ZvclRhcmdldCAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3Nob3VsZENoZWNrRm9yVGFyZ2V0O1xuICB9XG5cbiAgc2V0IHNob3VsZENoZWNrRm9yVGFyZ2V0IChzaG91bGRDaGVja0ZvclRhcmdldCkge1xuICAgIHRoaXMuX3Nob3VsZENoZWNrRm9yVGFyZ2V0ID0gISFzaG91bGRDaGVja0ZvclRhcmdldDtcbiAgfVxuXG4gIGdldCBpc0Nvbm5lY3RlZCAoKSB7XG4gICAgcmV0dXJuIHRoaXMuY29ubmVjdGVkO1xuICB9XG5cbiAgc2V0IGlzQ29ubmVjdGVkIChjb25uZWN0ZWQpIHtcbiAgICB0aGlzLmNvbm5lY3RlZCA9ICEhY29ubmVjdGVkO1xuICB9XG5cbiAgb24gKGV2ZW50LCBsaXN0ZW5lcikge1xuICAgIHRoaXMubWVzc2FnZUhhbmRsZXIub24oZXZlbnQsIGxpc3RlbmVyKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG9uY2UgKGV2ZW50LCBsaXN0ZW5lcikge1xuICAgIHRoaXMubWVzc2FnZUhhbmRsZXIub25jZShldmVudCwgbGlzdGVuZXIpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgb2ZmIChldmVudCwgbGlzdGVuZXIpIHtcbiAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLm9mZihldmVudCwgbGlzdGVuZXIpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgc2V0IGlzVGFyZ2V0QmFzZWQgKGlzVGFyZ2V0QmFzZWQpIHtcbiAgICBsb2cud2FybihgU2V0dGluZyBjb21tdW5pY2F0aW9uIHByb3RvY29sOiB1c2luZyAke2lzVGFyZ2V0QmFzZWQgPyAnVGFyZ2V0LWJhc2VkJyA6ICdmdWxsIFdlYiBJbnNwZWN0b3IgcHJvdG9jb2wnfSBjb21tdW5pY2F0aW9uYCk7XG4gICAgdGhpcy5faXNUYXJnZXRCYXNlZCA9IGlzVGFyZ2V0QmFzZWQ7XG5cbiAgICBpZiAoIXRoaXMucmVtb3RlTWVzc2FnZXMpIHtcbiAgICAgIHRoaXMucmVtb3RlTWVzc2FnZXMgPSBuZXcgUmVtb3RlTWVzc2FnZXMoaXNUYXJnZXRCYXNlZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucmVtb3RlTWVzc2FnZXMuaXNUYXJnZXRCYXNlZCA9IGlzVGFyZ2V0QmFzZWQ7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLm1lc3NhZ2VIYW5kbGVyKSB7XG4gICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyID0gbmV3IFJwY01lc3NhZ2VIYW5kbGVyKGlzVGFyZ2V0QmFzZWQpO1xuXG4gICAgICAvLyBhZGQgaGFuZGxlcnMgZm9yIGludGVybmFsIGV2ZW50c1xuICAgICAgdGhpcy5tZXNzYWdlSGFuZGxlci5vbignVGFyZ2V0LnRhcmdldENyZWF0ZWQnLCB0aGlzLmFkZFRhcmdldC5iaW5kKHRoaXMpKTtcbiAgICAgIHRoaXMubWVzc2FnZUhhbmRsZXIub24oJ1RhcmdldC5kaWRDb21taXRQcm92aXNpb25hbFRhcmdldCcsIHRoaXMudXBkYXRlVGFyZ2V0LmJpbmQodGhpcykpO1xuICAgICAgdGhpcy5tZXNzYWdlSGFuZGxlci5vbignVGFyZ2V0LnRhcmdldERlc3Ryb3llZCcsIHRoaXMucmVtb3ZlVGFyZ2V0LmJpbmQodGhpcykpO1xuICAgICAgdGhpcy5tZXNzYWdlSGFuZGxlci5vbignUnVudGltZS5leGVjdXRpb25Db250ZXh0Q3JlYXRlZCcsIHRoaXMub25FeGVjdXRpb25Db250ZXh0Q3JlYXRlZC5iaW5kKHRoaXMpKTtcbiAgICAgIHRoaXMubWVzc2FnZUhhbmRsZXIub24oJ0hlYXAuZ2FyYmFnZUNvbGxlY3RlZCcsIHRoaXMub25HYXJiYWdlQ29sbGVjdGVkLmJpbmQodGhpcykpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLmlzVGFyZ2V0QmFzZWQgPSBpc1RhcmdldEJhc2VkO1xuICAgIH1cbiAgfVxuXG4gIGdldCBpc1RhcmdldEJhc2VkICgpIHtcbiAgICByZXR1cm4gdGhpcy5faXNUYXJnZXRCYXNlZDtcbiAgfVxuXG4gIGFzeW5jIHdhaXRGb3JUYXJnZXQgKGFwcElkS2V5LCBwYWdlSWRLZXksIGZvcmNlID0gZmFsc2UpIHtcbiAgICBpZiAoIWZvcmNlICYmICF0aGlzLm5lZWRzVGFyZ2V0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZ2V0VGFyZ2V0KGFwcElkS2V5LCBwYWdlSWRLZXkpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gb3RoZXJ3aXNlIHdhaXRpbmcgaXMgbmVjZXNzYXJ5IHRvIHNlZSB3aGF0IHRoZSB0YXJnZXQgaXNcbiAgICB0cnkge1xuICAgICAgYXdhaXQgd2FpdEZvckNvbmRpdGlvbigoKSA9PiAhXy5pc0VtcHR5KHRoaXMuZ2V0VGFyZ2V0KGFwcElkS2V5LCBwYWdlSWRLZXkpKSwge1xuICAgICAgICB3YWl0TXM6IFdBSVRfRk9SX1RBUkdFVF9USU1FT1VULFxuICAgICAgICBpbnRlcnZhbE1zOiBXQUlUX0ZPUl9UQVJHRVRfSU5URVJWQUwsXG4gICAgICAgIGVycm9yOiAnTm8gdGFyZ2V0cyBmb3VuZCwgdW5hYmxlIHRvIGNvbW11bmljYXRlIHdpdGggZGV2aWNlJyxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKCFlcnIubWVzc2FnZS5pbmNsdWRlcygnQ29uZGl0aW9uIHVubWV0JykpIHtcbiAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyB0YXJnZXRzIGZvdW5kLCB1bmFibGUgdG8gY29tbXVuaWNhdGUgd2l0aCBkZXZpY2UnKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBzZW5kIChjb21tYW5kLCBvcHRzID0ge30sIHdhaXRGb3JSZXNwb25zZSA9IHRydWUpIHtcbiAgICBjb25zdCB0aW1lciA9IG5ldyB0aW1pbmcuVGltZXIoKS5zdGFydCgpO1xuICAgIGNvbnN0IHtcbiAgICAgIGFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5XG4gICAgfSA9IG9wdHM7XG4gICAgdHJ5IHtcbiAgICAgIGlmICghXy5pc0VtcHR5KGFwcElkS2V5KSAmJiAhXy5pc0VtcHR5KHBhZ2VJZEtleSkpIHtcbiAgICAgICAgYXdhaXQgdGhpcy53YWl0Rm9yVGFyZ2V0KGFwcElkS2V5LCBwYWdlSWRLZXkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuc2VuZFRvRGV2aWNlKGNvbW1hbmQsIG9wdHMsIHdhaXRGb3JSZXNwb25zZSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsZXQgeyBtZXNzYWdlID0gJycgfSA9IGVycjtcbiAgICAgIG1lc3NhZ2UgPSBtZXNzYWdlLnRvTG93ZXJDYXNlKCk7XG4gICAgICBpZiAobWVzc2FnZS5pbmNsdWRlcyhgJ3RhcmdldCcgZG9tYWluIHdhcyBub3QgZm91bmRgKSkge1xuICAgICAgICBsb2cuaW5mbygnVGhlIHRhcmdldCBkZXZpY2UgZG9lcyBub3Qgc3VwcG9ydCBUYXJnZXQgYmFzZWQgY29tbXVuaWNhdGlvbi4gJyArXG4gICAgICAgICAgJ1dpbGwgZm9sbG93IG5vbi10YXJnZXQgYmFzZWQgY29tbXVuaWNhdGlvbi4nKTtcbiAgICAgICAgdGhpcy5pc1RhcmdldEJhc2VkID0gZmFsc2U7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLnNlbmRUb0RldmljZShjb21tYW5kLCBvcHRzLCB3YWl0Rm9yUmVzcG9uc2UpO1xuICAgICAgfSBlbHNlIGlmIChtZXNzYWdlLmluY2x1ZGVzKGBkb21haW4gd2FzIG5vdCBmb3VuZGApIHx8XG4gICAgICAgICAgbWVzc2FnZS5pbmNsdWRlcyhgc29tZSBhcmd1bWVudHMgb2YgbWV0aG9kYCkgfHxcbiAgICAgICAgICBtZXNzYWdlLmluY2x1ZGVzKGBtaXNzaW5nIHRhcmdldGApKSB7XG4gICAgICAgIHRoaXMuaXNUYXJnZXRCYXNlZCA9IHRydWU7XG4gICAgICAgIGF3YWl0IHRoaXMud2FpdEZvclRhcmdldChhcHBJZEtleSwgcGFnZUlkS2V5KTtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuc2VuZFRvRGV2aWNlKGNvbW1hbmQsIG9wdHMsIHdhaXRGb3JSZXNwb25zZSk7XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGxvZy5kZWJ1ZyhgU2VuZGluZyB0byBXZWIgSW5zcGVjdG9yIHRvb2sgJHt0aW1lci5nZXREdXJhdGlvbigpLmFzTWlsbGlTZWNvbmRzLnRvRml4ZWQoMCl9bXNgKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBzZW5kVG9EZXZpY2UgKGNvbW1hbmQsIG9wdHMgPSB7fSwgd2FpdEZvclJlc3BvbnNlID0gdHJ1ZSkge1xuICAgIHJldHVybiBhd2FpdCBuZXcgQihhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAvLyBwcm9taXNlIHRvIGJlIHJlc29sdmVkIHdoZW5ldmVyIHJlbW90ZSBkZWJ1Z2dlclxuICAgICAgLy8gcmVwbGllcyB0byBvdXIgcmVxdWVzdFxuXG4gICAgICAvLyBrZWVwIHRyYWNrIG9mIHRoZSBtZXNzYWdlcyBjb21pbmcgYW5kIGdvaW5nIHVzaW5nIGEgc2ltcGxlIHNlcXVlbnRpYWwgaWRcbiAgICAgIGNvbnN0IG1zZ0lkID0gdGhpcy5tc2dJZCsrO1xuICAgICAgbGV0IHdyYXBwZXJNc2dJZCA9IG1zZ0lkO1xuICAgICAgaWYgKHRoaXMuaXNUYXJnZXRCYXNlZCkge1xuICAgICAgICAvLyBmb3IgdGFyZ2V0LWJhc2UgY29tbXVuaWNhdGlvbiwgZXZlcnl0aGluZyBpcyB3cmFwcGVkIHVwXG4gICAgICAgIHdyYXBwZXJNc2dJZCA9IHRoaXMubXNnSWQrKztcbiAgICAgICAgLy8gYWNrbm93bGVkZ2Ugd3JhcHBlciBtZXNzYWdlXG4gICAgICAgIHRoaXMubWVzc2FnZUhhbmRsZXIub24od3JhcHBlck1zZ0lkLnRvU3RyaW5nKCksIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBhcHBJZEtleSA9IG9wdHMuYXBwSWRLZXk7XG4gICAgICBjb25zdCBwYWdlSWRLZXkgPSBvcHRzLnBhZ2VJZEtleTtcbiAgICAgIGNvbnN0IHRhcmdldElkID0gdGhpcy5nZXRUYXJnZXQoYXBwSWRLZXksIHBhZ2VJZEtleSk7XG5cbiAgICAgIC8vIHJldHJpZXZlIHRoZSBjb3JyZWN0IGNvbW1hbmQgdG8gc2VuZFxuICAgICAgY29uc3QgZnVsbE9wdHMgPSBfLmRlZmF1bHRzKHtcbiAgICAgICAgY29ubklkOiB0aGlzLmNvbm5JZCxcbiAgICAgICAgc2VuZGVySWQ6IHRoaXMuc2VuZGVySWQsXG4gICAgICAgIHRhcmdldElkLFxuICAgICAgICBpZDogbXNnSWQsXG4gICAgICB9LCBvcHRzKTtcbiAgICAgIGNvbnN0IGNtZCA9IHRoaXMucmVtb3RlTWVzc2FnZXMuZ2V0UmVtb3RlQ29tbWFuZChjb21tYW5kLCBmdWxsT3B0cyk7XG5cbiAgICAgIGlmIChjbWQ/Ll9fYXJndW1lbnQ/LldJUlNvY2tldERhdGFLZXkpIHtcbiAgICAgICAgLy8gbWFrZSBzdXJlIHRoZSBtZXNzYWdlIGJlaW5nIHNlbnQgaGFzIGFsbCB0aGUgaW5mb3JtYXRpb24gdGhhdCBpcyBuZWVkZWRcbiAgICAgICAgaWYgKF8uaXNOaWwoY21kLl9fYXJndW1lbnQuV0lSU29ja2V0RGF0YUtleS5pZCkpIHtcbiAgICAgICAgICBjbWQuX19hcmd1bWVudC5XSVJTb2NrZXREYXRhS2V5LmlkID0gd3JhcHBlck1zZ0lkO1xuICAgICAgICB9XG4gICAgICAgIGNtZC5fX2FyZ3VtZW50LldJUlNvY2tldERhdGFLZXkgPVxuICAgICAgICAgIEJ1ZmZlci5mcm9tKEpTT04uc3RyaW5naWZ5KGNtZC5fX2FyZ3VtZW50LldJUlNvY2tldERhdGFLZXkpKTtcbiAgICAgIH1cblxuICAgICAgbGV0IG1lc3NhZ2VIYW5kbGVkID0gdHJ1ZTtcbiAgICAgIGlmICghd2FpdEZvclJlc3BvbnNlKSB7XG4gICAgICAgIC8vIHRoZSBwcm9taXNlIHdpbGwgYmUgcmVzb2x2ZWQgYXMgc29vbiBhcyB0aGUgc29ja2V0IGhhcyBiZWVuIHNlbnRcbiAgICAgICAgbWVzc2FnZUhhbmRsZWQgPSBmYWxzZTtcbiAgICAgICAgLy8gZG8gbm90IGxvZyByZWNlaXB0c1xuICAgICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLm9uY2UobXNnSWQudG9TdHJpbmcoKSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgIC8vIHdlIGFyZSBub3Qgd2FpdGluZyBmb3IgdGhpcywgYW5kIGlmIGl0IGVycm9ycyBpdCBpcyBtb3N0IGxpa2VseVxuICAgICAgICAgICAgLy8gYSBwcm90b2NvbCBjaGFuZ2UuIExvZyBhbmQgY2hlY2sgZHVyaW5nIHRlc3RpbmdcbiAgICAgICAgICAgIGxvZy5lcnJvcihgUmVjZWl2ZWQgZXJyb3IgZnJvbSBzZW5kIHRoYXQgaXMgbm90IGJlaW5nIHdhaXRlZCBmb3IgKGlkOiAke21zZ0lkfSk6ICcke18udHJ1bmNhdGUoSlNPTi5zdHJpbmdpZnkoZXJyKSwgREFUQV9MT0dfTEVOR1RIKX0nYCk7XG4gICAgICAgICAgICAvLyByZWplY3QsIHRob3VnaCBpdCBpcyB2ZXJ5IHJhcmUgdGhhdCB0aGlzIHdpbGwgYmUgdHJpZ2dlcmVkLCBzaW5jZVxuICAgICAgICAgICAgLy8gdGhlIHByb21pc2UgaXMgcmVzb2x2ZWQgZGlyZWN0bHR5IGFmdGVyIHNlbmQuIE9uIHRoZSBvZmYgY2hhbmNlLFxuICAgICAgICAgICAgLy8gdGhvdWdoLCBpdCB3aWxsIGFsZXJ0IG9mIGEgcHJvdG9jb2wgY2hhbmdlLlxuICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5tZXNzYWdlSGFuZGxlci5saXN0ZW5lcnMoY21kLl9fc2VsZWN0b3IpLmxlbmd0aCkge1xuICAgICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLnByZXBlbmRPbmNlTGlzdGVuZXIoY21kLl9fc2VsZWN0b3IsIGZ1bmN0aW9uIChlcnIsIC4uLmFyZ3MpIHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVqZWN0KGVycik7XG4gICAgICAgICAgfVxuICAgICAgICAgIGxvZy5kZWJ1ZyhgUmVjZWl2ZWQgcmVzcG9uc2UgZnJvbSBzZW5kIChpZDogJHttc2dJZH0pOiAnJHtfLnRydW5jYXRlKEpTT04uc3RyaW5naWZ5KGFyZ3MpLCBEQVRBX0xPR19MRU5HVEgpfSdgKTtcbiAgICAgICAgICByZXNvbHZlKGFyZ3MpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSBpZiAoY21kPy5fX2FyZ3VtZW50Py5XSVJTb2NrZXREYXRhS2V5KSB7XG4gICAgICAgIHRoaXMubWVzc2FnZUhhbmRsZXIub25jZShtc2dJZC50b1N0cmluZygpLCBmdW5jdGlvbiAoZXJyLCB2YWx1ZSkge1xuICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgIHJldHVybiByZWplY3QobmV3IEVycm9yKGBSZW1vdGUgZGVidWdnZXIgZXJyb3Igd2l0aCBjb2RlICcke2Vyci5jb2RlfSc6ICR7ZXJyLm1lc3NhZ2V9YCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBsb2cuZGVidWcoYFJlY2VpdmVkIGRhdGEgcmVzcG9uc2UgZnJvbSBzZW5kIChpZDogJHttc2dJZH0pOiAnJHtfLnRydW5jYXRlKEpTT04uc3RyaW5naWZ5KHZhbHVlKSwgREFUQV9MT0dfTEVOR1RIKX0nYCk7XG4gICAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gbm90aGluZyBlbHNlIGlzIGhhbmRsaW5nIHRoaW5ncywgc28ganVzdCByZXNvbHZlIHdoZW4gdGhlIG1lc3NhZ2UgaXMgc2VudFxuICAgICAgICBtZXNzYWdlSGFuZGxlZCA9IGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBtc2cgPSBgU2VuZGluZyAnJHtjbWQuX19zZWxlY3Rvcn0nIG1lc3NhZ2VgICtcbiAgICAgICAgKGZ1bGxPcHRzLmFwcElkS2V5ID8gYCB0byBhcHAgJyR7ZnVsbE9wdHMuYXBwSWRLZXl9J2AgOiAnJykgK1xuICAgICAgICAoZnVsbE9wdHMucGFnZUlkS2V5ID8gYCwgcGFnZSAnJHtmdWxsT3B0cy5wYWdlSWRLZXl9J2AgOiAnJykgK1xuICAgICAgICAodGhpcy5uZWVkc1RhcmdldCAmJiB0YXJnZXRJZCA/IGAsIHRhcmdldCAnJHt0YXJnZXRJZH0nYCA6ICcnKSArXG4gICAgICAgIGAgKGlkOiAke21zZ0lkfSk6ICcke2NvbW1hbmR9J2A7XG4gICAgICBsb2cuZGVidWcobXNnKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuc2VuZE1lc3NhZ2UoY21kKTtcbiAgICAgICAgaWYgKCFtZXNzYWdlSGFuZGxlZCkge1xuICAgICAgICAgIC8vIFRoZXJlIGFyZSBubyBoYW5kbGVycyB3YWl0aW5nIGZvciBhIHJlc3BvbnNlIGJlZm9yZSByZXNvbHZpbmcsXG4gICAgICAgICAgLy8gYW5kIG5vIGVycm9ycyBzZW5kaW5nIHRoZSBtZXNzYWdlIG92ZXIgdGhlIHNvY2tldCwgc28gcmVzb2x2ZVxuICAgICAgICAgIHJlc29sdmUocmVzKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIHJldHVybiByZWplY3QoZXJyKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGNvbm5lY3QgKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFN1Yi1jbGFzc2VzIG5lZWQgdG8gaW1wbGVtZW50IGEgJ2Nvbm5lY3QnIGZ1bmN0aW9uYCk7XG4gIH1cblxuICBhc3luYyBkaXNjb25uZWN0ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgdGhpcy5tZXNzYWdlSGFuZGxlci5yZW1vdmVBbGxMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIGFzeW5jIHNlbmRNZXNzYWdlICgvKiBjb21tYW5kICovKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIHRocm93IG5ldyBFcnJvcihgU3ViLWNsYXNzZXMgbmVlZCB0byBpbXBsZW1lbnQgYSAnc2VuZE1lc3NhZ2UnIGZ1bmN0aW9uYCk7XG4gIH1cblxuICBhc3luYyByZWNlaXZlICgvKiBkYXRhICovKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIHRocm93IG5ldyBFcnJvcihgU3ViLWNsYXNzZXMgbmVlZCB0byBpbXBsZW1lbnQgYSAncmVjZWl2ZScgZnVuY3Rpb25gKTtcbiAgfVxuXG4gIGFkZFRhcmdldCAoZXJyLCBhcHAsIHRhcmdldEluZm8pIHtcbiAgICBpZiAoXy5pc05pbCh0YXJnZXRJbmZvPy50YXJnZXRJZCkpIHtcbiAgICAgIGxvZy53YXJuKGBSZWNlaXZlZCAnVGFyZ2V0LnRhcmdldENyZWF0ZWQnIGV2ZW50IGZvciBhcHAgJyR7YXBwfScgd2l0aCBubyB0YXJnZXQuIFNraXBwaW5nYCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChfLmlzRW1wdHkodGhpcy5wZW5kaW5nVGFyZ2V0Tm90aWZpY2F0aW9uKSAmJiAhdGFyZ2V0SW5mby5pc1Byb3Zpc2lvbmFsKSB7XG4gICAgICBsb2cud2FybihgUmVjZWl2ZWQgJ1RhcmdldC50YXJnZXRDcmVhdGVkJyBldmVudCBmb3IgYXBwICcke2FwcH0nIHdpdGggbm8gcGVuZGluZyByZXF1ZXN0OiAke0pTT04uc3RyaW5naWZ5KHRhcmdldEluZm8pfWApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0YXJnZXRJbmZvLmlzUHJvdmlzaW9uYWwpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgUHJvdmlzaW9uYWwgdGFyZ2V0IGNyZWF0ZWQgZm9yIGFwcCAnJHthcHB9JywgJyR7dGFyZ2V0SW5mby50YXJnZXRJZH0nLiBJZ25vcmluZyB1bnRpbCB0YXJnZXQgdXBkYXRlIGV2ZW50YCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgW2FwcElkS2V5LCBwYWdlSWRLZXldID0gdGhpcy5wZW5kaW5nVGFyZ2V0Tm90aWZpY2F0aW9uO1xuXG4gICAgbG9nLmRlYnVnKGBUYXJnZXQgY3JlYXRlZCBmb3IgYXBwICcke2FwcElkS2V5fScgYW5kIHBhZ2UgJyR7cGFnZUlkS2V5fSc6ICR7SlNPTi5zdHJpbmdpZnkodGFyZ2V0SW5mbyl9YCk7XG4gICAgaWYgKF8uaGFzKHRoaXMudGFyZ2V0c1thcHBJZEtleV0sIHBhZ2VJZEtleSkpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgVGhlcmUgaXMgYWxyZWFkeSBhIHRhcmdldCBmb3IgdGhpcyBhcHAgYW5kIHBhZ2UgKCcke3RoaXMudGFyZ2V0c1thcHBJZEtleV1bcGFnZUlkS2V5XX0nKS4gVGhpcyBtaWdodCBjYXVzZSBwcm9ibGVtc2ApO1xuICAgIH1cbiAgICB0aGlzLnRhcmdldHNbYXBwXSA9IHRoaXMudGFyZ2V0c1thcHBdIHx8IHt9O1xuICAgIHRoaXMudGFyZ2V0c1thcHBJZEtleV1bcGFnZUlkS2V5XSA9IHRhcmdldEluZm8udGFyZ2V0SWQ7XG4gIH1cblxuICB1cGRhdGVUYXJnZXQgKGVyciwgYXBwLCBvbGRUYXJnZXRJZCwgbmV3VGFyZ2V0SWQpIHtcbiAgICBsb2cuZGVidWcoYFRhcmdldCB1cGRhdGVkIGZvciBhcHAgJyR7YXBwfScuIE9sZCB0YXJnZXQ6ICcke29sZFRhcmdldElkfScsIG5ldyB0YXJnZXQ6ICcke25ld1RhcmdldElkfSdgKTtcbiAgICBpZiAoIXRoaXMudGFyZ2V0c1thcHBdKSB7XG4gICAgICBsb2cud2FybihgTm8gZXhpc3RpbmcgdGFyZ2V0IGZvciBhcHAgJyR7YXBwfScuIE5vdCBzdXJlIHdoYXQgdG8gZG9gKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gc2F2ZSB0aGlzLCB0byBiZSB1c2VkIGlmL3doZW4gdGhlIGV4aXN0aW5nIHRhcmdldCBpcyBkZXN0cm95ZWRcbiAgICB0aGlzLnRhcmdldHNbYXBwXS5wcm92aXNpb25hbCA9IHtcbiAgICAgIG9sZFRhcmdldElkLFxuICAgICAgbmV3VGFyZ2V0SWQsXG4gICAgfTtcbiAgfVxuXG4gIHJlbW92ZVRhcmdldCAoZXJyLCBhcHAsIHRhcmdldEluZm8pIHtcbiAgICBpZiAoXy5pc05pbCh0YXJnZXRJbmZvPy50YXJnZXRJZCkpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgUmVjZWl2ZWQgJ1RhcmdldC50YXJnZXREZXN0cm95ZWQnIGV2ZW50IHdpdGggbm8gdGFyZ2V0LiBTa2lwcGluZ2ApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxvZy5kZWJ1ZyhgVGFyZ2V0IGRlc3Ryb3llZCBmb3IgYXBwICcke2FwcH0nOiAke3RhcmdldEluZm8udGFyZ2V0SWR9YCk7XG5cbiAgICAvLyBnbyB0aHJvdWdoIHRoZSB0YXJnZXRzIGFuZCBmaW5kIHRoZSBvbmUgdGhhdCBoYXMgYSB3YWl0aW5nIHByb3Zpc2lvbmFsIHRhcmdldFxuICAgIGlmICh0aGlzLnRhcmdldHNbYXBwXT8ucHJvdmlzaW9uYWw/Lm9sZFRhcmdldElkID09PSB0YXJnZXRJbmZvLnRhcmdldElkKSB7XG4gICAgICBjb25zdCB7b2xkVGFyZ2V0SWQsIG5ld1RhcmdldElkfSA9IHRoaXMudGFyZ2V0c1thcHBdLnByb3Zpc2lvbmFsO1xuICAgICAgZGVsZXRlIHRoaXMudGFyZ2V0c1thcHBdLnByb3Zpc2lvbmFsO1xuXG4gICAgICAvLyB3ZSBkbyBub3Qga25vdyB0aGUgcGFnZSwgc28gZ28gdGhyb3VnaCBhbmQgZmluZCB0aGUgZXhpc3RpbmcgdGFyZ2V0XG4gICAgICBjb25zdCB0YXJnZXRzID0gdGhpcy50YXJnZXRzW2FwcF07XG4gICAgICBmb3IgKGNvbnN0IFtwYWdlLCB0YXJnZXRJZF0gb2YgXy50b1BhaXJzKHRhcmdldHMpKSB7XG4gICAgICAgIGlmICh0YXJnZXRJZCA9PT0gb2xkVGFyZ2V0SWQpIHtcbiAgICAgICAgICBsb2cuZGVidWcoYEZvdW5kIHByb3Zpc2lvbmFsIHRhcmdldCBmb3IgYXBwICcke2FwcH0nLiBPbGQgdGFyZ2V0OiAnJHtvbGRUYXJnZXRJZH0nLCBuZXcgdGFyZ2V0OiAnJHtuZXdUYXJnZXRJZH0nLiBVcGRhdGluZ2ApO1xuICAgICAgICAgIHRhcmdldHNbcGFnZV0gPSBuZXdUYXJnZXRJZDtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGxvZy53YXJuKGBQcm92aXNpb25hbCB0YXJnZXQgZm9yIGFwcCAnJHthcHB9JyBmb3VuZCwgYnV0IG5vIHN1aXRhYmxlIGV4aXN0aW5nIHRhcmdldCBmb3VuZC4gVGhpcyBtYXkgY2F1c2UgcHJvYmxlbXNgKTtcbiAgICAgIGxvZy53YXJuKGBPbGQgdGFyZ2V0OiAnJHtvbGRUYXJnZXRJZH0nLCBuZXcgdGFyZ2V0OiAnJHtuZXdUYXJnZXRJZH0nLiBFeGlzdGluZyB0YXJnZXRzOiAke0pTT04uc3RyaW5naWZ5KHRhcmdldHMpfWApO1xuICAgIH1cblxuICAgIC8vIGlmIHRoZXJlIGlzIG5vIHdhaXRpbmcgcHJvdmlzaW9uYWwgdGFyZ2V0LCBqdXN0IGdldCByaWQgb2YgdGhlIGV4aXN0aW5nIG9uZVxuICAgIGNvbnN0IHRhcmdldHMgPSB0aGlzLnRhcmdldHNbYXBwXTtcbiAgICBmb3IgKGNvbnN0IFtwYWdlLCB0YXJnZXRJZF0gb2YgXy50b1BhaXJzKHRhcmdldHMpKSB7XG4gICAgICBpZiAodGFyZ2V0SWQgPT09IHRhcmdldEluZm8udGFyZ2V0SWQpIHtcbiAgICAgICAgZGVsZXRlIHRhcmdldHNbcGFnZV07XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG4gICAgbG9nLmRlYnVnKGBUYXJnZXQgJyR7dGFyZ2V0SW5mby50YXJnZXRJZH0nIGRlbGV0ZWQgZm9yIGFwcCAnJHthcHB9JywgYnV0IG5vIHN1Y2ggdGFyZ2V0IGV4aXN0c2ApO1xuICB9XG5cbiAgZ2V0VGFyZ2V0IChhcHBJZEtleSwgcGFnZUlkS2V5KSB7XG4gICAgcmV0dXJuICh0aGlzLnRhcmdldHNbYXBwSWRLZXldIHx8IHt9KVtwYWdlSWRLZXldO1xuICB9XG5cbiAgYXN5bmMgc2VsZWN0UGFnZSAoYXBwSWRLZXksIHBhZ2VJZEtleSkge1xuICAgIHRoaXMucGVuZGluZ1RhcmdldE5vdGlmaWNhdGlvbiA9IFthcHBJZEtleSwgcGFnZUlkS2V5XTtcbiAgICB0aGlzLnNob3VsZENoZWNrRm9yVGFyZ2V0ID0gZmFsc2U7XG5cbiAgICAvLyBnbyB0aHJvdWdoIHRoZSBzdGVwcyB0aGF0IHRoZSBEZXNrdG9wIFNhZmFyaSBzeXN0ZW1cbiAgICAvLyBnb2VzIHRocm91Z2ggdG8gaW5pdGlhbGl6ZSB0aGUgV2ViIEluc3BlY3RvciBzZXNzaW9uXG5cbiAgICBjb25zdCBzZW5kT3B0cyA9IHtcbiAgICAgIGFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5LFxuICAgIH07XG5cbiAgICAvLyBoaWdobGlnaHQgYW5kIHRoZW4gdW4taGlnaGxpZ2h0IHRoZSB3ZWJ2aWV3XG4gICAgZm9yIChjb25zdCBlbmFibGVkIG9mIFt0cnVlLCBmYWxzZV0pIHtcbiAgICAgIGF3YWl0IHRoaXMuc2VuZCgnaW5kaWNhdGVXZWJWaWV3JywgT2JqZWN0LmFzc2lnbih7XG4gICAgICAgIGVuYWJsZWQsXG4gICAgICB9LCBzZW5kT3B0cyksIGZhbHNlKTtcbiAgICB9XG5cbiAgICBhd2FpdCB0aGlzLnNlbmQoJ3NldFNlbmRlcktleScsIHNlbmRPcHRzKTtcbiAgICBsb2cuZGVidWcoJ1NlbmRlciBrZXkgc2V0Jyk7XG5cbiAgICBpZiAodGhpcy5pc1RhcmdldEJhc2VkICYmIHV0aWwuY29tcGFyZVZlcnNpb25zKHRoaXMucGxhdGZvcm1WZXJzaW9uLCAnPCcsIE1JTl9QTEFURk9STV9OT19UQVJHRVRfRVhJU1RTKSkge1xuICAgICAgYXdhaXQgdGhpcy5zZW5kKCdUYXJnZXQuZXhpc3RzJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICB9XG5cbiAgICB0aGlzLnNob3VsZENoZWNrRm9yVGFyZ2V0ID0gdHJ1ZTtcblxuICAgIGlmICh0aGlzLmZ1bGxQYWdlSW5pdGlhbGl6YXRpb24pIHtcbiAgICAgIGF3YWl0IHRoaXMuaW5pdGlhbGl6ZVBhZ2VGdWxsKGFwcElkS2V5LCBwYWdlSWRLZXkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCB0aGlzLmluaXRpYWxpemVQYWdlKGFwcElkS2V5LCBwYWdlSWRLZXkpO1xuICAgIH1cbiAgfVxuXG4gIC8qXG4gICAqIFBlcmZvcm0gdGhlIG1pbmltYWwgaW5pdGlhbGl6YXRpb24gdG8gZ2V0IHRoZSBXZWIgSW5zcGVjdG9yIHdvcmtpbmdcbiAgICovXG4gIGFzeW5jIGluaXRpYWxpemVQYWdlIChhcHBJZEtleSwgcGFnZUlkS2V5KSB7XG4gICAgY29uc3Qgc2VuZE9wdHMgPSB7XG4gICAgICBhcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleSxcbiAgICB9O1xuXG4gICAgYXdhaXQgdGhpcy5zZW5kKCdJbnNwZWN0b3IuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ1BhZ2UuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcblxuICAgIC8vIGdvIHRocm91Z2ggdGhlIHRhc2tzIHRvIGluaXRpYWxpemVcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ05ldHdvcmsuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ1J1bnRpbWUuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0hlYXAuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0RlYnVnZ2VyLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdDb25zb2xlLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdJbnNwZWN0b3IuaW5pdGlhbGl6ZWQnLCBzZW5kT3B0cywgZmFsc2UpO1xuICB9XG5cbiAgLypcbiAgICogTWltaWMgZXZlcnkgc3RlcCB0aGF0IERlc2t0b3AgU2FmYXJpIERldmVsb3AgdG9vbHMgdXNlcyB0byBpbml0aWFsaXplIGFcbiAgICogV2ViIEluc3BlY3RvciBzZXNzaW9uXG4gICAqL1xuICBhc3luYyBpbml0aWFsaXplUGFnZUZ1bGwgKGFwcElkS2V5LCBwYWdlSWRLZXkpIHtcbiAgICBjb25zdCBzZW5kT3B0cyA9IHtcbiAgICAgIGFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5LFxuICAgIH07XG5cbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0luc3BlY3Rvci5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnUGFnZS5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuXG4gICAgLy8gZ28gdGhyb3VnaCB0aGUgdGFza3MgdG8gaW5pdGlhbGl6ZVxuICAgIGF3YWl0IHRoaXMuc2VuZCgnUGFnZS5nZXRSZXNvdXJjZVRyZWUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnTmV0d29yay5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnTmV0d29yay5zZXRSZXNvdXJjZUNhY2hpbmdEaXNhYmxlZCcsIE9iamVjdC5hc3NpZ24oe1xuICAgICAgZGlzYWJsZWQ6IGZhbHNlLFxuICAgIH0sIHNlbmRPcHRzKSwgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnRE9NU3RvcmFnZS5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnRGF0YWJhc2UuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0luZGV4ZWREQi5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnQ1NTLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdSdW50aW1lLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdIZWFwLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdNZW1vcnkuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0FwcGxpY2F0aW9uQ2FjaGUuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0FwcGxpY2F0aW9uQ2FjaGUuZ2V0RnJhbWVzV2l0aE1hbmlmZXN0cycsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdUaW1lbGluZS5zZXRJbnN0cnVtZW50cycsIE9iamVjdC5hc3NpZ24oe1xuICAgICAgaW5zdHJ1bWVudHM6IFsnVGltZWxpbmUnLCAnU2NyaXB0UHJvZmlsZXInLCAnQ1BVJ10sXG4gICAgfSwgc2VuZE9wdHMpLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdUaW1lbGluZS5zZXRBdXRvQ2FwdHVyZUVuYWJsZWQnLCBPYmplY3QuYXNzaWduKHtcbiAgICAgIGVuYWJsZWQ6IGZhbHNlLFxuICAgIH0sIHNlbmRPcHRzKSwgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnRGVidWdnZXIuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0RlYnVnZ2VyLnNldEJyZWFrcG9pbnRzQWN0aXZlJywgT2JqZWN0LmFzc2lnbih7XG4gICAgICBhY3RpdmU6IHRydWUsXG4gICAgfSwgc2VuZE9wdHMpLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdEZWJ1Z2dlci5zZXRQYXVzZU9uRXhjZXB0aW9ucycsIE9iamVjdC5hc3NpZ24oe1xuICAgICAgc3RhdGU6ICdub25lJyxcbiAgICB9LCBzZW5kT3B0cyksIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0RlYnVnZ2VyLnNldFBhdXNlT25Bc3NlcnRpb25zJywgT2JqZWN0LmFzc2lnbih7XG4gICAgICBlbmFibGVkOiBmYWxzZSxcbiAgICB9LCBzZW5kT3B0cyksIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0RlYnVnZ2VyLnNldEFzeW5jU3RhY2tUcmFjZURlcHRoJywgT2JqZWN0LmFzc2lnbih7XG4gICAgICBkZXB0aDogMjAwLFxuICAgIH0sIHNlbmRPcHRzKSwgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnRGVidWdnZXIuc2V0UGF1c2VGb3JJbnRlcm5hbFNjcmlwdHMnLCBPYmplY3QuYXNzaWduKHtcbiAgICAgIHNob3VsZFBhdXNlOiBmYWxzZSxcbiAgICB9LCBzZW5kT3B0cyksIGZhbHNlKTtcblxuICAgIGF3YWl0IHRoaXMuc2VuZCgnTGF5ZXJUcmVlLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdXb3JrZXIuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0NhbnZhcy5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnQ29uc29sZS5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnRE9NLmdldERvY3VtZW50Jywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBjb25zdCBsb2dnaW5nQ2hhbm5lbHMgPSBhd2FpdCB0aGlzLnNlbmQoJ0NvbnNvbGUuZ2V0TG9nZ2luZ0NoYW5uZWxzJywgc2VuZE9wdHMpO1xuICAgIGZvciAoY29uc3Qgc291cmNlIG9mIChsb2dnaW5nQ2hhbm5lbHMuY2hhbm5lbHMgfHwgW10pLm1hcCgoZW50cnkpID0+IGVudHJ5LnNvdXJjZSkpIHtcbiAgICAgIGF3YWl0IHRoaXMuc2VuZCgnQ29uc29sZS5zZXRMb2dnaW5nQ2hhbm5lbExldmVsJywgT2JqZWN0LmFzc2lnbih7XG4gICAgICAgIHNvdXJjZSxcbiAgICAgICAgbGV2ZWw6ICd2ZXJib3NlJyxcbiAgICAgIH0sIHNlbmRPcHRzKSwgZmFsc2UpO1xuICAgIH1cblxuICAgIGF3YWl0IHRoaXMuc2VuZCgnSW5zcGVjdG9yLmluaXRpYWxpemVkJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgfVxuXG4gIGFzeW5jIHNlbGVjdEFwcCAoYXBwSWRLZXkpIHtcbiAgICByZXR1cm4gYXdhaXQgbmV3IEIoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgLy8gbG9jYWwgY2FsbGJhY2ssIHRlbXBvcmFyaWx5IGFkZGVkIGFzIGNhbGxiYWNrIHRvXG4gICAgICAvLyBgX3JwY19hcHBsaWNhdGlvbkNvbm5lY3RlZDpgIHJlbW90ZSBkZWJ1Z2dlciByZXNwb25zZVxuICAgICAgLy8gdG8gaGFuZGxlIHRoZSBpbml0aWFsIGNvbm5lY3Rpb25cbiAgICAgIGNvbnN0IG9uQXBwQ2hhbmdlID0gKGVyciwgZGljdCkgPT4ge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgcmV0dXJuIHJlamVjdChlcnIpO1xuICAgICAgICB9XG4gICAgICAgIC8vIGZyb20gdGhlIGRpY3Rpb25hcnkgcmV0dXJuZWQsIGdldCB0aGUgaWRzXG4gICAgICAgIGNvbnN0IG9sZEFwcElkS2V5ID0gZGljdC5XSVJIb3N0QXBwbGljYXRpb25JZGVudGlmaWVyS2V5O1xuICAgICAgICBjb25zdCBjb3JyZWN0QXBwSWRLZXkgPSBkaWN0LldJUkFwcGxpY2F0aW9uSWRlbnRpZmllcktleTtcblxuICAgICAgICAvLyBpZiB0aGlzIGlzIGEgcmVwb3J0IG9mIGEgcHJveHkgcmVkaXJlY3QgZnJvbSB0aGUgcmVtb3RlIGRlYnVnZ2VyXG4gICAgICAgIC8vIHdlIHdhbnQgdG8gdXBkYXRlIG91ciBkaWN0aW9uYXJ5IGFuZCBnZXQgYSBuZXcgYXBwIGlkXG4gICAgICAgIGlmIChvbGRBcHBJZEtleSAmJiBjb3JyZWN0QXBwSWRLZXkgIT09IG9sZEFwcElkS2V5KSB7XG4gICAgICAgICAgbG9nLmRlYnVnKGBXZSB3ZXJlIG5vdGlmaWVkIHdlIG1pZ2h0IGhhdmUgY29ubmVjdGVkIHRvIHRoZSB3cm9uZyBhcHAuIGAgK1xuICAgICAgICAgICAgICAgICAgICBgVXNpbmcgaWQgJHtjb3JyZWN0QXBwSWRLZXl9IGluc3RlYWQgb2YgJHtvbGRBcHBJZEtleX1gKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ05ldyBhcHBsaWNhdGlvbiBoYXMgY29ubmVjdGVkJykpO1xuICAgICAgfTtcbiAgICAgIHRoaXMubWVzc2FnZUhhbmRsZXIucHJlcGVuZE9uY2VMaXN0ZW5lcignX3JwY19hcHBsaWNhdGlvbkNvbm5lY3RlZDonLCBvbkFwcENoYW5nZSk7XG5cbiAgICAgIC8vIGRvIHRoZSBhY3R1YWwgY29ubmVjdGluZyB0byB0aGUgYXBwXG4gICAgICByZXR1cm4gKGFzeW5jICgpID0+IHtcbiAgICAgICAgbGV0IHBhZ2VEaWN0LCBjb25uZWN0ZWRBcHBJZEtleTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAoW2Nvbm5lY3RlZEFwcElkS2V5LCBwYWdlRGljdF0gPSBhd2FpdCB0aGlzLnNlbmQoJ2Nvbm5lY3RUb0FwcCcsIHtcbiAgICAgICAgICAgIGFwcElkS2V5XG4gICAgICAgICAgfSkpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICBsb2cud2FybihgVW5hYmxlIHRvIGNvbm5lY3QgdG8gYXBwOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gc29tZXRpbWVzIHRoZSBjb25uZWN0IGxvZ2ljIGhhcHBlbnMsIGJ1dCB3aXRoIGFuIGVtcHR5IGRpY3Rpb25hcnlcbiAgICAgICAgLy8gd2hpY2ggbGVhZHMgdG8gdGhlIHJlbW90ZSBkZWJ1Z2dlciBnZXR0aW5nIGRpc2Nvbm5lY3RlZCwgYW5kIGludG8gYSBsb29wXG4gICAgICAgIGlmIChfLmlzRW1wdHkocGFnZURpY3QpKSB7XG4gICAgICAgICAgbGV0IG1zZyA9ICdFbXB0eSBwYWdlIGRpY3Rpb25hcnkgcmVjZWl2ZWQnO1xuICAgICAgICAgIGxvZy5kZWJ1Zyhtc2cpO1xuICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IobXNnKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzb2x2ZShbY29ubmVjdGVkQXBwSWRLZXksIHBhZ2VEaWN0XSk7XG4gICAgICAgIH1cbiAgICAgIH0pKCk7XG4gICAgfSk7XG4gIH1cblxuICBvbkV4ZWN1dGlvbkNvbnRleHRDcmVhdGVkIChlcnIsIGNvbnRleHQpIHtcbiAgICAvLyB7IGlkOiAyLCBpc1BhZ2VDb250ZXh0OiB0cnVlLCBuYW1lOiAnJywgZnJhbWVJZDogJzAuMScgfVxuICAgIC8vIHJpZ2h0IG5vdyB3ZSBoYXZlIG5vIHdheSB0byBtYXAgY29udGV4dHMgdG8gYXBwcy9wYWdlc1xuICAgIC8vIHNvIGp1c3Qgc3RvcmVcbiAgICB0aGlzLmNvbnRleHRzLnB1c2goY29udGV4dC5pZCk7XG4gIH1cblxuICBvbkdhcmJhZ2VDb2xsZWN0ZWQgKCkge1xuICAgIC8vIGp1c3Qgd2FudCB0byBsb2cgdGhhdCB0aGlzIGlzIGhhcHBlbmluZywgYXMgaXQgY2FuIGFmZmVjdCBvcGVydGlvblxuICAgIGxvZy5kZWJ1ZyhgV2ViIEluc3BlY3RvciBnYXJiYWdlIGNvbGxlY3RlZGApO1xuICB9XG5cbiAgb25TY3JpcHRQYXJzZWQgKGVyciwgc2NyaXB0SW5mbykge1xuICAgIC8vIHsgc2NyaXB0SWQ6ICcxMycsIHVybDogJycsIHN0YXJ0TGluZTogMCwgc3RhcnRDb2x1bW46IDAsIGVuZExpbmU6IDgyLCBlbmRDb2x1bW46IDMgfVxuICAgIGxvZy5kZWJ1ZyhgU2NyaXB0IHBhcnNlZDogJHtKU09OLnN0cmluZ2lmeShzY3JpcHRJbmZvKX1gKTtcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0EsTUFBTUEsZUFBZSxHQUFHO0VBQUNDLE1BQU0sRUFBRTtBQUFHLENBQUM7QUFFckMsTUFBTUMsdUJBQXVCLEdBQUcsS0FBSztBQUNyQyxNQUFNQyx3QkFBd0IsR0FBRyxJQUFJO0FBRXJDLE1BQU1DLDZCQUE2QixHQUFHLE1BQU07QUFHNUMsTUFBTUMsNkJBQTZCLEdBQUcsTUFBTTtBQUU1QyxTQUFTQyxhQUFhLENBQUVDLFFBQVEsRUFBRUMsZUFBZSxFQUFFO0VBSWpELE1BQU1DLGFBQWEsR0FBR0MsYUFBSSxDQUFDQyxlQUFlLENBQUNILGVBQWUsRUFBRSxJQUFJLEVBQUVKLDZCQUE2QixDQUFDO0VBQ2hHUSxlQUFHLENBQUNDLEtBQUssQ0FBRSw4Q0FBNkNOLFFBQVEsR0FBRyxFQUFFLEdBQUcsTUFBTywrQkFBOEJDLGVBQWdCLElBQUcsQ0FBQztFQUNqSUksZUFBRyxDQUFDQyxLQUFLLENBQUUsMENBQXlDVCw2QkFBOEIsTUFBS0ssYUFBYyxFQUFDLENBQUM7RUFDdkcsT0FBT0EsYUFBYTtBQUN0QjtBQUVlLE1BQU1LLFNBQVMsQ0FBQztFQUM3QkMsV0FBVyxDQUFFQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLEVBQUU7SUFDdEIsSUFBSSxDQUFDQyxRQUFRLEdBQUcsRUFBRTtJQUNsQixJQUFJLENBQUNDLHFCQUFxQixHQUFHLENBQUMsQ0FBQ0YsSUFBSSxDQUFDRyxvQkFBb0I7SUFFeEQsTUFBTTtNQUNKQyxRQUFRO01BQ1JaLGVBQWUsR0FBRyxDQUFDLENBQUM7TUFDcEJELFFBQVEsR0FBRyxJQUFJO01BQ2ZjLG1CQUFtQixHQUFHLEtBQUs7TUFDM0JDLDBCQUEwQixHQUFH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