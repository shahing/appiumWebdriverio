{"version":3,"file":"simulator-xcode-9.3.js","names":["WEBINSPECTOR_SOCKET_REGEXP","SimulatorXcode93","SimulatorXcode9","constructor","udid","xcodeVersion","webInspectorSocket","getWebInspectorSocket","stdout","exec","record","split","includes","match"],"sources":["../../lib/simulator-xcode-9.3.js"],"sourcesContent":["import SimulatorXcode9 from './simulator-xcode-9';\nimport { exec } from 'teen_process';\n\n\n// https://regex101.com/r/MEL55t/1\nconst WEBINSPECTOR_SOCKET_REGEXP = /\\s+(\\S+com\\.apple\\.webinspectord_sim\\.socket)/;\n\nclass SimulatorXcode93 extends SimulatorXcode9 {\n  constructor (udid, xcodeVersion) {\n    super(udid, xcodeVersion);\n\n    this.webInspectorSocket = null;\n  }\n\n  /*\n   * @override\n   */\n  async getWebInspectorSocket () {\n    if (this.webInspectorSocket) {\n      return this.webInspectorSocket;\n    }\n\n    // lsof -aUc launchd_sim\n    // gives a set of records like:\n    //   launchd_s 69760 isaac    3u  unix 0x57aa4fceea3937f3      0t0      /private/tmp/com.apple.CoreSimulator.SimDevice.D7082A5C-34B5-475C-994E-A21534423B9E/syslogsock\n    //   launchd_s 69760 isaac    5u  unix 0x57aa4fceea395f03      0t0      /private/tmp/com.apple.launchd.2B2u8CkN8S/Listeners\n    //   launchd_s 69760 isaac    6u  unix 0x57aa4fceea39372b      0t0      ->0x57aa4fceea3937f3\n    //   launchd_s 69760 isaac    8u  unix 0x57aa4fceea39598b      0t0      /private/tmp/com.apple.launchd.2j5k1TMh6i/com.apple.webinspectord_sim.socket\n    //   launchd_s 69760 isaac    9u  unix 0x57aa4fceea394c43      0t0      /private/tmp/com.apple.launchd.4zm9JO9KEs/com.apple.testmanagerd.unix-domain.socket\n    //   launchd_s 69760 isaac   10u  unix 0x57aa4fceea395f03      0t0      /private/tmp/com.apple.launchd.2B2u8CkN8S/Listeners\n    //   launchd_s 69760 isaac   11u  unix 0x57aa4fceea39598b      0t0      /private/tmp/com.apple.launchd.2j5k1TMh6i/com.apple.webinspectord_sim.socket\n    //   launchd_s 69760 isaac   12u  unix 0x57aa4fceea394c43      0t0      /private/tmp/com.apple.launchd.4zm9JO9KEs/com.apple.testmanagerd.unix-domain.socket\n    // these _appear_ to always be grouped together (so, the records for the particular sim are all in a group, before the next sim, etc.)\n    // so starting from the correct UDID, we ought to be able to pull the next record with `com.apple.webinspectord_sim.socket` to get the correct socket\n    let {stdout} = await exec('lsof', ['-aUc', 'launchd_sim']);\n    for (let record of stdout.split('com.apple.CoreSimulator.SimDevice.')) {\n      if (!record.includes(this.udid)) {\n        continue;\n      }\n      const match = WEBINSPECTOR_SOCKET_REGEXP.exec(record);\n      if (!match) {\n        return null;\n      }\n      this.webInspectorSocket = match[1];\n      return this.webInspectorSocket;\n    }\n\n    return null;\n  }\n}\n\nexport default SimulatorXcode93;\n"],"mappings":";;;;;;;;AAAA;AACA;AAIA,MAAMA,0BAA0B,GAAG,+CAA+C;AAElF,MAAMC,gBAAgB,SAASC,uBAAe,CAAC;EAC7CC,WAAW,CAAEC,IAAI,EAAEC,YAAY,EAAE;IAC/B,KAAK,CAACD,IAAI,EAAEC,YAAY,CAAC;IAEzB,IAAI,CAACC,kBAAkB,GAAG,IAAI;EAChC;EAKA,MAAMC,qBAAqB,GAAI;IAC7B,IAAI,IAAI,CAACD,kBAAkB,EAAE;MAC3B,OAAO,IAAI,CAACA,kBAAkB;IAChC;IAcA,IAAI;MAACE;IAAM,CAAC,GAAG,MAAM,IAAAC,kBAAI,EAAC,MAAM,EAAE,CAAC,MAAM,EAAE,aAAa,CAAC,CAAC;IAC1D,KAAK,IAAIC,MAAM,IAAIF,MAAM,CAACG,KAAK,CAAC,oCAAoC,CAAC,EAAE;MACrE,IAAI,CAACD,MAAM,CAACE,QAAQ,CAAC,IAAI,CAACR,IAAI,CAAC,EAAE;QAC/B;MACF;MACA,MAAMS,KAAK,GAAGb,0BAA0B,CAACS,IAAI,CAACC,MAAM,CAAC;MACrD,IAAI,CAACG,KAAK,EAAE;QACV,OAAO,IAAI;MACb;MACA,IAAI,CAACP,kBAAkB,GAAGO,KAAK,CAAC,CAAC,CAAC;MAClC,OAAO,IAAI,CAACP,kBAAkB;IAChC;IAEA,OAAO,IAAI;EACb;AACF;AAAC,eAEcL,gBAAgB;AAAA"}