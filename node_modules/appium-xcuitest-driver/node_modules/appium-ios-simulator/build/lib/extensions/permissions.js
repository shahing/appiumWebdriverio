"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
require("source-map-support/register");
var _logger = _interopRequireDefault(require("../logger"));
var _lodash = _interopRequireDefault(require("lodash"));
var _support = require("@appium/support");
var _teen_process = require("teen_process");
var _path = _interopRequireDefault(require("path"));
const STATUS_UNSET = 'unset';
const STATUS_NO = 'no';
const STATUS_YES = 'yes';
const WIX_SIM_UTILS = 'applesimutils';
const SERVICES = Object.freeze({
  calendar: 'kTCCServiceCalendar',
  camera: 'kTCCServiceCamera',
  contacts: 'kTCCServiceAddressBook',
  homekit: 'kTCCServiceWillow',
  microphone: 'kTCCServiceMicrophone',
  photos: 'kTCCServicePhotos',
  reminders: 'kTCCServiceReminders',
  medialibrary: 'kTCCServiceMediaLibrary',
  motion: 'kTCCServiceMotion',
  health: 'kTCCServiceMSO',
  siri: 'kTCCServiceSiri',
  speech: 'kTCCServiceSpeechRecognition'
});
function toInternalServiceName(serviceName) {
  if (_lodash.default.has(SERVICES, _lodash.default.toLower(serviceName))) {
    return SERVICES[_lodash.default.toLower(serviceName)];
  }
  throw new Error(`'${serviceName}' is unknown. Only the following service names are supported: ${JSON.stringify(_lodash.default.keys(SERVICES))}`);
}
function formatStatus(status) {
  return [STATUS_UNSET, STATUS_NO].includes(status) ? _lodash.default.toUpper(status) : status;
}
async function execSQLiteQuery(db, query) {
  _logger.default.debug(`Executing SQL query "${query}" on '${db}'`);
  try {
    return (await (0, _teen_process.exec)('sqlite3', ['-line', db, query])).stdout;
  } catch (err) {
    throw new Error(`Cannot execute SQLite query "${query}" to '${db}'. Original error: ${err.stderr}`);
  }
}
async function execWix(args) {
  try {
    await _support.fs.which(WIX_SIM_UTILS);
  } catch (e) {
    throw new Error(`${WIX_SIM_UTILS} binary has not been found in your PATH. ` + `Please install it ('brew tap wix/brew && brew install wix/brew/applesimutils') to ` + `be able to change application permissions`);
  }
  _logger.default.debug(`Executing: ${WIX_SIM_UTILS} ${_support.util.quote(args)}`);
  try {
    const {
      stdout
    } = await (0, _teen_process.exec)(WIX_SIM_UTILS, args);
    _logger.default.debug(`Command output: ${stdout}`);
    return stdout;
  } catch (e) {
    throw new Error(`Cannot execute "${WIX_SIM_UTILS} ${_support.util.quote(args)}". Original error: ${e.stderr || e.message}`);
  }
}
async function setAccess(bundleId, permissionsMapping) {
  const permissionsArg = _lodash.default.toPairs(permissionsMapping).map(x => `${x[0]}=${formatStatus(x[1])}`).join(',');
  return await execWix(['--byId', this.udid, '--bundle', bundleId, '--setPermissions', permissionsArg]);
}
async function getAccess(bundleId, serviceName, simDataRoot) {
  const internalServiceName = toInternalServiceName(serviceName);
  const dbPath = _path.default.resolve(simDataRoot, 'Library', 'TCC', 'TCC.db');
  for (const [sqlValue, status] of [['0', STATUS_NO], ['1', STATUS_YES]]) {
    const sql = `SELECT count(*) FROM 'access' ` + `WHERE client='${bundleId}' AND allowed=${sqlValue} AND service='${internalServiceName}'`;
    const count = await execSQLiteQuery(dbPath, sql);
    if (parseInt(count.split('=')[1], 10) > 0) {
      return status;
    }
  }
  return STATUS_UNSET;
}
const extensions = {};
extensions.setPermission = async function setPermission(bundleId, permission, value) {
  await this.setPermissions(bundleId, {
    [permission]: value
  });
};
extensions.setPermissions = async function setPermissions(bundleId, permissionsMapping) {
  _logger.default.debug(`Setting access for '${bundleId}': ${JSON.stringify(permissionsMapping, null, 2)}`);
  await setAccess(bundleId, permissionsMapping);
};
extensions.getPermission = async function getPermission(bundleId, serviceName) {
  const result = await getAccess(bundleId, serviceName, this.getDir());
  _logger.default.debug(`Got ${serviceName} access status for '${bundleId}': ${result}`);
  return result;
};
var _default = extensions;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTVEFUVVNfVU5TRVQiLCJTVEFUVVNfTk8iLCJTVEFUVVNfWUVTIiwiV0lYX1NJTV9VVElMUyIsIlNFUlZJQ0VTIiwiT2JqZWN0IiwiZnJlZXplIiwiY2FsZW5kYXIiLCJjYW1lcmEiLCJjb250YWN0cyIsImhvbWVraXQiLCJtaWNyb3Bob25lIiwicGhvdG9zIiwicmVtaW5kZXJzIiwibWVkaWFsaWJyYXJ5IiwibW90aW9uIiwiaGVhbHRoIiwic2lyaSIsInNwZWVjaCIsInRvSW50ZXJuYWxTZXJ2aWNlTmFtZSIsInNlcnZpY2VOYW1lIiwiXyIsImhhcyIsInRvTG93ZXIiLCJFcnJvciIsIkpTT04iLCJzdHJpbmdpZnkiLCJrZXlzIiwiZm9ybWF0U3RhdHVzIiwic3RhdHVzIiwiaW5jbHVkZXMiLCJ0b1VwcGVyIiwiZXhlY1NRTGl0ZVF1ZXJ5IiwiZGIiLCJxdWVyeSIsImxvZyIsImRlYnVnIiwiZXhlYyIsInN0ZG91dCIsImVyciIsInN0ZGVyciIsImV4ZWNXaXgiLCJhcmdzIiwiZnMiLCJ3aGljaCIsImUiLCJ1dGlsIiwicXVvdGUiLCJtZXNzYWdlIiwic2V0QWNjZXNzIiwiYnVuZGxlSWQiLCJwZXJtaXNzaW9uc01hcHBpbmciLCJwZXJtaXNzaW9uc0FyZyIsInRvUGFpcnMiLCJtYXAiLCJ4Iiwiam9pbiIsInVkaWQiLCJnZXRBY2Nlc3MiLCJzaW1EYXRhUm9vdCIsImludGVybmFsU2VydmljZU5hbWUiLCJkYlBhdGgiLCJwYXRoIiwicmVzb2x2ZSIsInNxbFZhbHVlIiwic3FsIiwiY291bnQiLCJwYXJzZUludCIsInNwbGl0IiwiZXh0ZW5zaW9ucyIsInNldFBlcm1pc3Npb24iLCJwZXJtaXNzaW9uIiwidmFsdWUiLCJzZXRQZXJtaXNzaW9ucyIsImdldFBlcm1pc3Npb24iLCJyZXN1bHQiLCJnZXREaXIiXSwic291cmNlcyI6WyIuLi8uLi8uLi9saWIvZXh0ZW5zaW9ucy9wZXJtaXNzaW9ucy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlcic7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgZnMsIHV0aWwgfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcblxuY29uc3QgU1RBVFVTX1VOU0VUID0gJ3Vuc2V0JztcbmNvbnN0IFNUQVRVU19OTyA9ICdubyc7XG5jb25zdCBTVEFUVVNfWUVTID0gJ3llcyc7XG5jb25zdCBXSVhfU0lNX1VUSUxTID0gJ2FwcGxlc2ltdXRpbHMnO1xuY29uc3QgU0VSVklDRVMgPSBPYmplY3QuZnJlZXplKHtcbiAgY2FsZW5kYXI6ICdrVENDU2VydmljZUNhbGVuZGFyJyxcbiAgY2FtZXJhOiAna1RDQ1NlcnZpY2VDYW1lcmEnLFxuICBjb250YWN0czogJ2tUQ0NTZXJ2aWNlQWRkcmVzc0Jvb2snLFxuICBob21la2l0OiAna1RDQ1NlcnZpY2VXaWxsb3cnLFxuICBtaWNyb3Bob25lOiAna1RDQ1NlcnZpY2VNaWNyb3Bob25lJyxcbiAgcGhvdG9zOiAna1RDQ1NlcnZpY2VQaG90b3MnLFxuICByZW1pbmRlcnM6ICdrVENDU2VydmljZVJlbWluZGVycycsXG4gIG1lZGlhbGlicmFyeTogJ2tUQ0NTZXJ2aWNlTWVkaWFMaWJyYXJ5JyxcbiAgbW90aW9uOiAna1RDQ1NlcnZpY2VNb3Rpb24nLFxuICBoZWFsdGg6ICdrVENDU2VydmljZU1TTycsXG4gIHNpcmk6ICdrVENDU2VydmljZVNpcmknLFxuICBzcGVlY2g6ICdrVENDU2VydmljZVNwZWVjaFJlY29nbml0aW9uJyxcbn0pO1xuXG5mdW5jdGlvbiB0b0ludGVybmFsU2VydmljZU5hbWUgKHNlcnZpY2VOYW1lKSB7XG4gIGlmIChfLmhhcyhTRVJWSUNFUywgXy50b0xvd2VyKHNlcnZpY2VOYW1lKSkpIHtcbiAgICByZXR1cm4gU0VSVklDRVNbXy50b0xvd2VyKHNlcnZpY2VOYW1lKV07XG4gIH1cbiAgdGhyb3cgbmV3IEVycm9yKFxuICAgIGAnJHtzZXJ2aWNlTmFtZX0nIGlzIHVua25vd24uIE9ubHkgdGhlIGZvbGxvd2luZyBzZXJ2aWNlIG5hbWVzIGFyZSBzdXBwb3J0ZWQ6ICR7SlNPTi5zdHJpbmdpZnkoXy5rZXlzKFNFUlZJQ0VTKSl9YFxuICApO1xufVxuXG5mdW5jdGlvbiBmb3JtYXRTdGF0dXMgKHN0YXR1cykge1xuICByZXR1cm4gW1NUQVRVU19VTlNFVCwgU1RBVFVTX05PXS5pbmNsdWRlcyhzdGF0dXMpID8gXy50b1VwcGVyKHN0YXR1cykgOiBzdGF0dXM7XG59XG5cbi8qKlxuICogUnVucyBhIGNvbW1hbmQgbGluZSBzcWxpdGUzIHF1ZXJ5XG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGRiIC0gRnVsbCBwYXRoIHRvIHNxbGl0ZSBkYXRhYmFzZVxuICogQHBhcmFtIHtzdHJpbmd9IHF1ZXJ5IC0gVGhlIGFjdHVhbCBxdWVyeSBzdHJpbmdcbiAqIEByZXR1cm5zIHtzdHJpbmd9IHNxbGl0ZSBjb21tYW5kIHN0ZG91dFxuICovXG5hc3luYyBmdW5jdGlvbiBleGVjU1FMaXRlUXVlcnkgKGRiLCBxdWVyeSkge1xuICBsb2cuZGVidWcoYEV4ZWN1dGluZyBTUUwgcXVlcnkgXCIke3F1ZXJ5fVwiIG9uICcke2RifSdgKTtcbiAgdHJ5IHtcbiAgICByZXR1cm4gKGF3YWl0IGV4ZWMoJ3NxbGl0ZTMnLCBbJy1saW5lJywgZGIsIHF1ZXJ5XSkpLnN0ZG91dDtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgYENhbm5vdCBleGVjdXRlIFNRTGl0ZSBxdWVyeSBcIiR7cXVlcnl9XCIgdG8gJyR7ZGJ9Jy4gT3JpZ2luYWwgZXJyb3I6ICR7ZXJyLnN0ZGVycn1gXG4gICAgKTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBleGVjV2l4IChhcmdzKSB7XG4gIHRyeSB7XG4gICAgYXdhaXQgZnMud2hpY2goV0lYX1NJTV9VVElMUyk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBgJHtXSVhfU0lNX1VUSUxTfSBiaW5hcnkgaGFzIG5vdCBiZWVuIGZvdW5kIGluIHlvdXIgUEFUSC4gYCArXG4gICAgICBgUGxlYXNlIGluc3RhbGwgaXQgKCdicmV3IHRhcCB3aXgvYnJldyAmJiBicmV3IGluc3RhbGwgd2l4L2JyZXcvYXBwbGVzaW11dGlscycpIHRvIGAgK1xuICAgICAgYGJlIGFibGUgdG8gY2hhbmdlIGFwcGxpY2F0aW9uIHBlcm1pc3Npb25zYFxuICAgICk7XG4gIH1cblxuICBsb2cuZGVidWcoYEV4ZWN1dGluZzogJHtXSVhfU0lNX1VUSUxTfSAke3V0aWwucXVvdGUoYXJncyl9YCk7XG4gIHRyeSB7XG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKFdJWF9TSU1fVVRJTFMsIGFyZ3MpO1xuICAgIGxvZy5kZWJ1ZyhgQ29tbWFuZCBvdXRwdXQ6ICR7c3Rkb3V0fWApO1xuICAgIHJldHVybiBzdGRvdXQ7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBleGVjdXRlIFwiJHtXSVhfU0lNX1VUSUxTfSAke3V0aWwucXVvdGUoYXJncyl9XCIuIE9yaWdpbmFsIGVycm9yOiAke2Uuc3RkZXJyIHx8IGUubWVzc2FnZX1gKTtcbiAgfVxufVxuXG4vKipcbiAqIFNldHMgcGVybWlzc2lvbnMgZm9yIHRoZSBnaXZlbiBhcHBsaWNhdGlvblxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIGJ1bmRsZSBpZGVudGlmaWVyIG9mIHRoZSB0YXJnZXQgYXBwbGljYXRpb24uXG4gKiBAcGFyYW0ge09iamVjdH0gcGVybWlzc2lvbnNNYXBwaW5nIC0gQW4gb2JqZWN0LCB3aGVyZSBrZXlzIGFyICBzZXJ2aWNlIG5hbWVzXG4gKiBhbmQgdmFsdWVzIGFyZSBjb3JyZXNwb25kaW5nIHN0YXRlIHZhbHVlcy4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS93aXgvQXBwbGVTaW11bGF0b3JVdGlsc1xuICogZm9yIG1vcmUgZGV0YWlscyBvbiBhdmFpbGFibGUgc2VydmljZSBuYW1lcyBhbmQgc3RhdHVzZXMuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgd2FzIGFuIGVycm9yIHdoaWxlIGNoYW5naW5nIHBlcm1pc3Npb25zLlxuICovXG5hc3luYyBmdW5jdGlvbiBzZXRBY2Nlc3MgKGJ1bmRsZUlkLCBwZXJtaXNzaW9uc01hcHBpbmcpIHtcbiAgY29uc3QgcGVybWlzc2lvbnNBcmcgPSBfLnRvUGFpcnMocGVybWlzc2lvbnNNYXBwaW5nKVxuICAgIC5tYXAoKHgpID0+IGAke3hbMF19PSR7Zm9ybWF0U3RhdHVzKHhbMV0pfWApXG4gICAgLmpvaW4oJywnKTtcbiAgcmV0dXJuIGF3YWl0IGV4ZWNXaXgoW1xuICAgICctLWJ5SWQnLCB0aGlzLnVkaWQsXG4gICAgJy0tYnVuZGxlJywgYnVuZGxlSWQsXG4gICAgJy0tc2V0UGVybWlzc2lvbnMnLCBwZXJtaXNzaW9uc0FyZyxcbiAgXSk7XG59XG5cbi8qKlxuICogUmV0cmlldmVzIHRoZSBjdXJyZW50IHBlcm1pc3Npb24gc3RhdHVzIGZvciB0aGUgZ2l2ZW4gc2VydmljZSBhbmQgYXBwbGljYXRpb24uXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gYnVuZGxlIGlkZW50aWZpZXIgb2YgdGhlIHRhcmdldCBhcHBsaWNhdGlvbi5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzZXJ2aWNlTmFtZSAtIHRoZSBuYW1lIG9mIHRoZSBzZXJ2aWNlLiBTaG91bGQgYmUgb25lIG9mXG4gKiBgU0VSVklDRVNgIGtleXMuXG4gKiBAcGFyYW0ge3N0cmluZ30gc2ltRGF0YVJvb3QgLSB0aGUgcGF0aCB0byBTaW11bGF0b3IgYGRhdGFgIHJvb3RcbiAqIEByZXR1cm5zIHtzdHJpbmd9IC0gVGhlIGN1cnJlbnQgc3RhdHVzOiB5ZXMvbm8vdW5zZXRcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgcmV0cmlldmluZyBwZXJtaXNzaW9ucy5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0QWNjZXNzIChidW5kbGVJZCwgc2VydmljZU5hbWUsIHNpbURhdGFSb290KSB7XG4gIGNvbnN0IGludGVybmFsU2VydmljZU5hbWUgPSB0b0ludGVybmFsU2VydmljZU5hbWUoc2VydmljZU5hbWUpO1xuICBjb25zdCBkYlBhdGggPSBwYXRoLnJlc29sdmUoc2ltRGF0YVJvb3QsICdMaWJyYXJ5JywgJ1RDQycsICdUQ0MuZGInKTtcbiAgZm9yIChjb25zdCBbc3FsVmFsdWUsIHN0YXR1c10gb2YgW1snMCcsIFNUQVRVU19OT10sIFsnMScsIFNUQVRVU19ZRVNdXSkge1xuICAgIGNvbnN0IHNxbCA9IGBTRUxFQ1QgY291bnQoKikgRlJPTSAnYWNjZXNzJyBgICtcbiAgICAgIGBXSEVSRSBjbGllbnQ9JyR7YnVuZGxlSWR9JyBBTkQgYWxsb3dlZD0ke3NxbFZhbHVlfSBBTkQgc2VydmljZT0nJHtpbnRlcm5hbFNlcnZpY2VOYW1lfSdgO1xuICAgIGNvbnN0IGNvdW50ID0gYXdhaXQgZXhlY1NRTGl0ZVF1ZXJ5KGRiUGF0aCwgc3FsKTtcbiAgICBpZiAocGFyc2VJbnQoY291bnQuc3BsaXQoJz0nKVsxXSwgMTApID4gMCkge1xuICAgICAgcmV0dXJuIHN0YXR1cztcbiAgICB9XG4gIH1cbiAgcmV0dXJuIFNUQVRVU19VTlNFVDtcbn1cblxuXG5jb25zdCBleHRlbnNpb25zID0ge307XG5cbi8qKlxuICogU2V0cyB0aGUgcGFydGljdWxhciBwZXJtaXNzaW9uIHRvIHRoZSBhcHBsaWNhdGlvbiBidW5kbGUuIFNlZVxuICogaHR0cHM6Ly9naXRodWIuY29tL3dpeC9BcHBsZVNpbXVsYXRvclV0aWxzIGZvciBtb3JlIGRldGFpbHMgb25cbiAqIHRoZSBhdmFpbGFibGUgc2VydmljZSBuYW1lcyBhbmQgc3RhdHVzZXMuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gQXBwbGljYXRpb24gYnVuZGxlIGlkZW50aWZpZXIuXG4gKiBAcGFyYW0ge3N0cmluZ30gcGVybWlzc2lvbiAtIFNlcnZpY2UgbmFtZSB0byBiZSBzZXQuXG4gKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUgLSBUaGUgZGVzaXJlZCBzdGF0dXMgZm9yIHRoZSBzZXJ2aWNlLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSBjaGFuZ2luZyBwZXJtaXNzaW9uLlxuICovXG5leHRlbnNpb25zLnNldFBlcm1pc3Npb24gPSBhc3luYyBmdW5jdGlvbiBzZXRQZXJtaXNzaW9uIChidW5kbGVJZCwgcGVybWlzc2lvbiwgdmFsdWUpIHtcbiAgYXdhaXQgdGhpcy5zZXRQZXJtaXNzaW9ucyhidW5kbGVJZCwge1twZXJtaXNzaW9uXTogdmFsdWV9KTtcbn07XG5cbi8qKlxuICogU2V0cyB0aGUgcGVybWlzc2lvbnMgZm9yIHRoZSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uIGJ1bmRsZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSWQgLSBBcHBsaWNhdGlvbiBidW5kbGUgaWRlbnRpZmllci5cbiAqIEBwYXJhbSB7T2JqZWN0fSBwZXJtaXNzaW9uc01hcHBpbmcgLSBBIG1hcHBpbmcgd2hlcmUga2F5c1xuICogYXJlIHNlcnZpY2UgbmFtZXMgYW5kIHZhbHVlcyBhcmUgdGhlaXIgY29ycmVzcG9uZGluZyBzdGF0dXMgdmFsdWVzLlxuICogU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS93aXgvQXBwbGVTaW11bGF0b3JVdGlsc1xuICogZm9yIG1vcmUgZGV0YWlscyBvbiBhdmFpbGFibGUgc2VydmljZSBuYW1lcyBhbmQgc3RhdHVzZXMuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgd2FzIGFuIGVycm9yIHdoaWxlIGNoYW5naW5nIHBlcm1pc3Npb25zLlxuICovXG5leHRlbnNpb25zLnNldFBlcm1pc3Npb25zID0gYXN5bmMgZnVuY3Rpb24gc2V0UGVybWlzc2lvbnMgKGJ1bmRsZUlkLCBwZXJtaXNzaW9uc01hcHBpbmcpIHtcbiAgbG9nLmRlYnVnKGBTZXR0aW5nIGFjY2VzcyBmb3IgJyR7YnVuZGxlSWR9JzogJHtKU09OLnN0cmluZ2lmeShwZXJtaXNzaW9uc01hcHBpbmcsIG51bGwsIDIpfWApO1xuICBhd2FpdCBzZXRBY2Nlc3MoYnVuZGxlSWQsIHBlcm1pc3Npb25zTWFwcGluZyk7XG59O1xuXG4vKipcbiAqIFJldHJpZXZlcyBjdXJyZW50IHBlcm1pc3Npb24gc3RhdHVzIGZvciB0aGUgZ2l2ZW4gYXBwbGljYXRpb24gYnVuZGxlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIEFwcGxpY2F0aW9uIGJ1bmRsZSBpZGVudGlmaWVyLlxuICogQHBhcmFtIHtzdHJpbmd9IHNlcnZpY2VOYW1lIC0gT25lIG9mIGF2YWlsYWJsZSBzZXJ2aWNlIG5hbWVzLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSByZXRyaWV2aW5nIHBlcm1pc3Npb25zLlxuICovXG5leHRlbnNpb25zLmdldFBlcm1pc3Npb24gPSBhc3luYyBmdW5jdGlvbiBnZXRQZXJtaXNzaW9uIChidW5kbGVJZCwgc2VydmljZU5hbWUpIHtcbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0QWNjZXNzKGJ1bmRsZUlkLCBzZXJ2aWNlTmFtZSwgdGhpcy5nZXREaXIoKSk7XG4gIGxvZy5kZWJ1ZyhgR290ICR7c2VydmljZU5hbWV9IGFjY2VzcyBzdGF0dXMgZm9yICcke2J1bmRsZUlkfSc6ICR7cmVzdWx0fWApO1xuICByZXR1cm4gcmVzdWx0O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgZXh0ZW5zaW9ucztcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUEsTUFBTUEsWUFBWSxHQUFHLE9BQU87QUFDNUIsTUFBTUMsU0FBUyxHQUFHLElBQUk7QUFDdEIsTUFBTUMsVUFBVSxHQUFHLEtBQUs7QUFDeEIsTUFBTUMsYUFBYSxHQUFHLGVBQWU7QUFDckMsTUFBTUMsUUFBUSxH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