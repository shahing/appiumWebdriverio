"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.WebInspectorEncoder = void 0;
require("source-map-support/register");
var _stream = _interopRequireDefault(require("stream"));
var _support = require("@appium/support");
const WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE = 8096;
class WebInspectorEncoder extends _stream.default.Transform {
  constructor() {
    super({
      objectMode: true
    });
  }
  _transform(data, encoding, onData) {
    let payloadBuffer = _support.plist.createPlist(data, true);
    for (let i = 0; i < payloadBuffer.length; i += this._encode(payloadBuffer, i)) {}
    onData();
  }
  _encode(data, pos) {
    const messageLength = Math.min(data.length - pos, WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE);
    if (messageLength < WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE) {
      this.push({
        WIRFinalMessageKey: data.slice(pos, messageLength + pos)
      });
    } else {
      this.push({
        WIRPartialMessageKey: data.slice(pos, messageLength + pos)
      });
    }
    return messageLength;
  }
}
exports.WebInspectorEncoder = WebInspectorEncoder;
var _default = WebInspectorEncoder;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJXRUJJTlNQRUNUT1JfUEFSVElBTF9QQUNLRVRfQ0hVTktfU0laRSIsIldlYkluc3BlY3RvckVuY29kZXIiLCJTdHJlYW0iLCJUcmFuc2Zvcm0iLCJjb25zdHJ1Y3RvciIsIm9iamVjdE1vZGUiLCJfdHJhbnNmb3JtIiwiZGF0YSIsImVuY29kaW5nIiwib25EYXRhIiwicGF5bG9hZEJ1ZmZlciIsInBsaXN0IiwiY3JlYXRlUGxpc3QiLCJpIiwibGVuZ3RoIiwiX2VuY29kZSIsInBvcyIsIm1lc3NhZ2VMZW5ndGgiLCJNYXRoIiwibWluIiwicHVzaCIsIldJUkZpbmFsTWVzc2FnZUtleSIsInNsaWNlIiwiV0lSUGFydGlhbE1lc3NhZ2VLZXkiXSwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9saWIvd2ViaW5zcGVjdG9yL3RyYW5zZm9ybWVyL3dlYmluc3BlY3Rvci1lbmNvZGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBTdHJlYW0gZnJvbSAnc3RyZWFtJztcbmltcG9ydCB7IHBsaXN0IH0gZnJvbSAnQGFwcGl1bS9zdXBwb3J0JztcblxuY29uc3QgV0VCSU5TUEVDVE9SX1BBUlRJQUxfUEFDS0VUX0NIVU5LX1NJWkUgPSA4MDk2O1xuXG5jbGFzcyBXZWJJbnNwZWN0b3JFbmNvZGVyIGV4dGVuZHMgU3RyZWFtLlRyYW5zZm9ybSB7XG5cbiAgY29uc3RydWN0b3IgKCkge1xuICAgIHN1cGVyKHsgb2JqZWN0TW9kZTogdHJ1ZSB9KTtcbiAgfVxuXG4gIF90cmFuc2Zvcm0gKGRhdGEsIGVuY29kaW5nLCBvbkRhdGEpIHtcbiAgICBsZXQgcGF5bG9hZEJ1ZmZlciA9IHBsaXN0LmNyZWF0ZVBsaXN0KGRhdGEsIHRydWUpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGF5bG9hZEJ1ZmZlci5sZW5ndGg7IGkgKz0gdGhpcy5fZW5jb2RlKHBheWxvYWRCdWZmZXIsIGkpKSB7fVxuICAgIG9uRGF0YSgpO1xuICB9XG5cbiAgX2VuY29kZSAoZGF0YSwgcG9zKSB7XG4gICAgY29uc3QgbWVzc2FnZUxlbmd0aCA9IE1hdGgubWluKGRhdGEubGVuZ3RoIC0gcG9zLCBXRUJJTlNQRUNUT1JfUEFSVElBTF9QQUNLRVRfQ0hVTktfU0laRSk7XG4gICAgaWYgKG1lc3NhZ2VMZW5ndGggPCBXRUJJTlNQRUNUT1JfUEFSVElBTF9QQUNLRVRfQ0hVTktfU0laRSkge1xuICAgICAgdGhpcy5wdXNoKHtXSVJGaW5hbE1lc3NhZ2VLZXk6IGRhdGEuc2xpY2UocG9zLCBtZXNzYWdlTGVuZ3RoICsgcG9zKX0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnB1c2goe1dJUlBhcnRpYWxNZXNzYWdlS2V5OiBkYXRhLnNsaWNlKHBvcywgbWVzc2FnZUxlbmd0aCArIHBvcyl9KTtcbiAgICB9XG4gICAgcmV0dXJuIG1lc3NhZ2VMZW5ndGg7XG4gIH1cblxufVxuXG5leHBvcnQgeyBXZWJJbnNwZWN0b3JFbmNvZGVyIH07XG5leHBvcnQgZGVmYXVsdCBXZWJJbnNwZWN0b3JFbmNvZGVyO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7QUFFQSxNQUFNQSxzQ0FBc0MsR0FBRyxJQUFJO0FBRW5ELE1BQU1DLG1CQUFtQixTQUFTQyxlQUFNLENBQUNDLFNBQVMsQ0FBQztFQUVqREMsV0FBVyxHQUFJO0lBQ2IsS0FBSyxDQUFDO01BQUVDLFVBQVUsRUFBRTtJQUFLLENBQUMsQ0FBQztFQUM3QjtFQUVBQyxVQUFVLENBQUVDLElBQUksRUFBRUMsUUFBUSxFQUFFQyxNQUFNLEVBQUU7SUFDbEMsSUFBSUMsYUFBYSxHQUFHQyxjQUFLLENBQUNDLFdBQVcsQ0FBQ0wsSUFBSSxFQUFFLElBQUksQ0FBQztJQUNqRCxLQUFLLElBQUlNLENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsR0FBR0gsYUFBYSxDQUFDSSxNQUFNLEVBQUVELENBQUMsSUFBSSxJQUFJLENBQUNFLE9BQU8sQ0FBQ0wsYUFBYSxFQUFFRyxDQUFDLENBQUMsRUFBRSxDQUFDO0lBQ2hGSixNQUFNLEVBQUU7RUFDVjtFQUVBTSxPQUFPLENBQUVSLElBQUksRUFBRVMsR0FBRyxFQUFFO0lBQ2xCLE1BQU1DLGFBQWEsR0FBR0MsSUFBSSxDQUFDQyxHQUFHLENBQUNaLElBQUksQ0FBQ08sTUFBTSxHQUFHRSxHQUFHLEVBQUVoQixzQ0FBc0MsQ0FBQztJQUN6RixJQUFJaUIsYUFBYSxHQUFHakIsc0NBQXNDLEVBQUU7TUFDMUQsSUFBSSxDQUFDb0IsSUFBSSxDQUFDO1FBQUNDLGtCQUFrQixFQUFFZCxJQUFJLENBQUNlLEtBQUssQ0FBQ04sR0FBRyxFQUFFQyxhQUFhLEdBQUdELEdBQUc7TUFBQyxDQUFDLENBQUM7SUFDdkUsQ0FBQyxNQUFNO01BQ0wsSUFBSSxDQUFDSSxJQUFJLENBQUM7UUFBQ0csb0JBQW9CLEVBQUVoQixJQUFJLENBQUNlLEtBQUssQ0FBQ04sR0FBRyxFQUFFQyxhQUFhLEdBQUdELEdBQUc7TUFBQyxDQUFDLENBQUM7SUFDekU7SUFDQSxPQUFPQyxhQUFhO0VBQ3RCO0FBRUY7QUFBQztBQUFBLGVBR2NoQixtQkFBbUI7QUFBQSJ9