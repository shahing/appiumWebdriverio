{"version":3,"file":"webinspector-encoder.js","names":["WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE","WebInspectorEncoder","Stream","Transform","constructor","objectMode","_transform","data","encoding","onData","payloadBuffer","plist","createPlist","i","length","_encode","pos","messageLength","Math","min","push","WIRFinalMessageKey","slice","WIRPartialMessageKey"],"sources":["../../../../lib/webinspector/transformer/webinspector-encoder.js"],"sourcesContent":["import Stream from 'stream';\nimport { plist } from '@appium/support';\n\nconst WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE = 8096;\n\nclass WebInspectorEncoder extends Stream.Transform {\n\n  constructor () {\n    super({ objectMode: true });\n  }\n\n  _transform (data, encoding, onData) {\n    let payloadBuffer = plist.createPlist(data, true);\n    for (let i = 0; i < payloadBuffer.length; i += this._encode(payloadBuffer, i)) {}\n    onData();\n  }\n\n  _encode (data, pos) {\n    const messageLength = Math.min(data.length - pos, WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE);\n    if (messageLength < WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE) {\n      this.push({WIRFinalMessageKey: data.slice(pos, messageLength + pos)});\n    } else {\n      this.push({WIRPartialMessageKey: data.slice(pos, messageLength + pos)});\n    }\n    return messageLength;\n  }\n\n}\n\nexport { WebInspectorEncoder };\nexport default WebInspectorEncoder;\n"],"mappings":";;;;;;;;AAAA;AACA;AAEA,MAAMA,sCAAsC,GAAG,IAAI;AAEnD,MAAMC,mBAAmB,SAASC,eAAM,CAACC,SAAS,CAAC;EAEjDC,WAAW,GAAI;IACb,KAAK,CAAC;MAAEC,UAAU,EAAE;IAAK,CAAC,CAAC;EAC7B;EAEAC,UAAU,CAAEC,IAAI,EAAEC,QAAQ,EAAEC,MAAM,EAAE;IAClC,IAAIC,aAAa,GAAGC,cAAK,CAACC,WAAW,CAACL,IAAI,EAAE,IAAI,CAAC;IACjD,KAAK,IAAIM,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,aAAa,CAACI,MAAM,EAAED,CAAC,IAAI,IAAI,CAACE,OAAO,CAACL,aAAa,EAAEG,CAAC,CAAC,EAAE,CAAC;IAChFJ,MAAM,EAAE;EACV;EAEAM,OAAO,CAAER,IAAI,EAAES,GAAG,EAAE;IAClB,MAAMC,aAAa,GAAGC,IAAI,CAACC,GAAG,CAACZ,IAAI,CAACO,MAAM,GAAGE,GAAG,EAAEhB,sCAAsC,CAAC;IACzF,IAAIiB,aAAa,GAAGjB,sCAAsC,EAAE;MAC1D,IAAI,CAACoB,IAAI,CAAC;QAACC,kBAAkB,EAAEd,IAAI,CAACe,KAAK,CAACN,GAAG,EAAEC,aAAa,GAAGD,GAAG;MAAC,CAAC,CAAC;IACvE,CAAC,MAAM;MACL,IAAI,CAACI,IAAI,CAAC;QAACG,oBAAoB,EAAEhB,IAAI,CAACe,KAAK,CAACN,GAAG,EAAEC,aAAa,GAAGD,GAAG;MAAC,CAAC,CAAC;IACzE;IACA,OAAOC,aAAa;EACtB;AAEF;AAAC;AAAA,eAGchB,mBAAmB;AAAA"}