"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.Usbmux = void 0;
exports.getDefaultSocket = getDefaultSocket;
require("source-map-support/register");
var _net = _interopRequireDefault(require("net"));
var _os = _interopRequireDefault(require("os"));
var _lodash = _interopRequireDefault(require("lodash"));
var _bluebird = _interopRequireDefault(require("bluebird"));
var _support = require("@appium/support");
var _lengthBasedSplitter = _interopRequireDefault(require("../util/transformer/length-based-splitter"));
var _usbmuxDecoder = _interopRequireDefault(require("./transformer/usbmux-decoder.js"));
var _usbmuxEncoder = _interopRequireDefault(require("./transformer/usbmux-encoder.js"));
var _path = _interopRequireDefault(require("path"));
var _plistService = _interopRequireDefault(require("../plist-service"));
var _lockdown = require("../lockdown");
var _baseService = require("../base-service");
var _constants = require("../constants");
const MAX_FRAME_SIZE = 1 * _constants.MB;
const USBMUX_RESULT = {
  OK: 0,
  BADCOMMAND: 1,
  BADDEV: 2,
  CONNREFUSED: 3
};
let name, version;
try {
  ({
    name,
    version
  } = require(_path.default.resolve(__dirname, '..', '..', '..', 'package.json')));
} catch (err) {
  ({
    name,
    version
  } = require(_path.default.resolve(__dirname, '..', '..', 'package.json')));
}
const DEFAULT_USBMUXD_SOCKET = '/var/run/usbmuxd';
const DEFAULT_USBMUXD_PORT = 27015;
const DEFAULT_USBMUXD_HOST = '127.0.0.1';
const PROG_NAME = name;
const CLIENT_VERSION_STRING = `${name}-${version}`;
function swap16(val) {
  return (val & 0xFF) << 8 | val >> 8 & 0xFF;
}
async function getDefaultSocket(opts = {}) {
  const {
    socketPath = DEFAULT_USBMUXD_SOCKET,
    socketPort = DEFAULT_USBMUXD_PORT,
    socketHost = DEFAULT_USBMUXD_HOST,
    timeout = 5000
  } = opts;
  let socket;
  if (await _support.fs.exists(socketPath)) {
    socket = _net.default.createConnection(socketPath);
  } else if (process.platform === 'win32' || process.platform === 'linux' && /microsoft/i.test(_os.default.release())) {
    socket = _net.default.createConnection(socketPort, socketHost);
  } else {
    throw new Error(`The usbmuxd socket at '${socketPath}' does not exist or is not accessible`);
  }
  return await new _bluebird.default((resolve, reject) => {
    socket.once('error', reject);
    socket.once('connect', () => resolve(socket));
  }).timeout(timeout);
}
class Usbmux extends _baseService.BaseServiceSocket {
  constructor(socketClient) {
    super(socketClient);
    this._decoder = new _usbmuxDecoder.default();
    this._splitter = new _lengthBasedSplitter.default({
      readableStream: socketClient,
      littleEndian: true,
      maxFrameLength: MAX_FRAME_SIZE,
      lengthFieldOffset: 0,
      lengthFieldLength: 4,
      lengthAdjustment: 0
    });
    this._socketClient.pipe(this._splitter).pipe(this._decoder);
    this._encoder = new _usbmuxEncoder.default();
    this._encoder.pipe(this._socketClient);
    this._assignClientFailureHandlers(this._encoder);
    this._tag = 0;
    this._responseCallbacks = {};
    this._decoder.on('data', this._handleData.bind(this));
  }
  _handleData(data) {
    const cb = this._responseCallbacks[data.header.tag] || _lodash.default.noop;
    cb(data);
  }
  async readBUID(timeout = 5000) {
    const {
      tag,
      receivePromise
    } = this._receivePlistPromise(timeout, data => {
      if (data.payload.BUID) {
        return data.payload.BUID;
      }
      throw new Error(`Unexpected data: ${JSON.stringify(data)}`);
    });
    this._sendPlist({
      tag,
      payload: {
        MessageType: 'ReadBUID',
        ProgName: PROG_NAME,
        ClientVersionString: CLIENT_VERSION_STRING
      }
    });
    return await receivePromise;
  }
  async readPairRecord(udid, timeout = 5000) {
    const {
      tag,
      receivePromise
    } = this._receivePlistPromise(timeout, data => {
      if (!data.payload.PairRecordData) {
        return null;
      }
      try {
        return _support.plist.parsePlist(data.payload.PairRecordData);
      } catch (err) {
        throw new Error(`Unexpected data: ${JSON.stringify(data)}`);
      }
    });
    this._sendPlist({
      tag,
      payload: {
        MessageType: 'ReadPairRecord',
        PairRecordID: udid,
        ProgName: PROG_NAME,
        ClientVersionString: CLIENT_VERSION_STRING
      }
    });
    return await receivePromise;
  }
  _sendPlist(json) {
    this._encoder.write(json);
  }
  _receivePlistPromise(timeout = 5000, responseCallback) {
    const tag = this._tag++;
    const receivePromise = new _bluebird.default((resolve, reject) => {
      this._responseCallbacks[tag] = data => {
        try {
          resolve(responseCallback(data));
        } catch (e) {
          reject(e);
        }
      };
      setTimeout(() => reject(new Error(`Failed to receive any data within the timeout: ${timeout}`)), timeout);
    });
    return {
      tag,
      receivePromise
    };
  }
  async listDevices(timeout = 5000) {
    const {
      tag,
      receivePromise
    } = this._receivePlistPromise(timeout, data => {
      if (data.payload.DeviceList) {
        return data.payload.DeviceList;
      }
      throw new Error(`Unexpected data: ${JSON.stringify(data)}`);
    });
    this._sendPlist({
      tag,
      payload: {
        MessageType: 'ListDevices',
        ProgName: PROG_NAME,
        ClientVersionString: CLIENT_VERSION_STRING
      }
    });
    return await receivePromise;
  }
  async findDevice(udid, timeout = 5000) {
    const devices = await this.listDevices(timeout);
    return _lodash.default.find(devices, device => device.Properties.SerialNumber === udid);
  }
  async connectLockdown(udid, timeout = 5000) {
    const device = await this.findDevice(udid, timeout);
    if (!device) {
      throw new Error(`Could not find the expected device '${udid}'`);
    }
    const socket = await this.connect(device.Properties.DeviceID, _lockdown.LOCKDOWN_PORT, timeout);
    return new _lockdown.Lockdown(new _plistService.default(socket));
  }
  async connect(deviceID, port, timeout = 5000) {
    const {
      tag,
      receivePromise
    } = this._receivePlistPromise(timeout, data => {
      if (data.payload.MessageType !== 'Result') {
        throw new Error(`Unexpected data: ${JSON.stringify(data)}`);
      }
      if (data.payload.Number === USBMUX_RESULT.OK) {
        this._splitter.shutdown();
        this._socketClient.unpipe(this._splitter);
        this._splitter.unpipe(this._decoder);
        return this._socketClient;
      } else if (data.payload.Number === USBMUX_RESULT.CONNREFUSED) {
        throw new Error(`Connection was refused to port ${port}`);
      } else {
        throw new Error(`Unexpected data: ${JSON.stringify(data)}`);
      }
    });
    this._sendPlist({
      tag,
      payload: {
        MessageType: 'Connect',
        ProgName: PROG_NAME,
        ClientVersionString: CLIENT_VERSION_STRING,
        DeviceID: deviceID,
        PortNumber: swap16(port)
      }
    });
    return await receivePromise;
  }
}
exports.Usbmux = Usbmux;
var _default = Usbmux;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNQVhfRlJBTUVfU0laRSIsIk1CIiwiVVNCTVVYX1JFU1VMVCIsIk9LIiwiQkFEQ09NTUFORCIsIkJBRERFViIsIkNPTk5SRUZVU0VEIiwibmFtZSIsInZlcnNpb24iLCJyZXF1aXJlIiwicGF0aCIsInJlc29sdmUiLCJfX2Rpcm5hbWUiLCJlcnIiLCJERUZBVUxUX1VTQk1VWERfU09DS0VUIiwiREVGQVVMVF9VU0JNVVhEX1BPUlQiLCJERUZBVUxUX1VTQk1VWERfSE9TVCIsIlBST0dfTkFNRSIsIkNMSUVOVF9WRVJTSU9OX1NUUklORyIsInN3YXAxNiIsInZhbCIsImdldERlZmF1bHRTb2NrZXQiLCJvcHRzIiwic29ja2V0UGF0aCIsInNvY2tldFBvcnQiLCJzb2NrZXRIb3N0IiwidGltZW91dCIsInNvY2tldCIsImZzIiwiZXhpc3RzIiwibmV0IiwiY3JlYXRlQ29ubmVjdGlvbiIsInByb2Nlc3MiLCJwbGF0Zm9ybSIsInRlc3QiLCJvcyIsInJlbGVhc2UiLCJFcnJvciIsIkIiLCJyZWplY3QiLCJvbmNlIiwiVXNibXV4IiwiQmFzZVNlcnZpY2VTb2NrZXQiLCJjb25zdHJ1Y3RvciIsInNvY2tldENsaWVudCIsIl9kZWNvZGVyIiwiVXNibXV4RGVjb2RlciIsIl9zcGxpdHRlciIsIkxlbmd0aEJhc2VkU3BsaXR0ZXIiLCJyZWFkYWJsZVN0cmVhbSIsImxpdHRsZUVuZGlhbiIsIm1heEZyYW1lTGVuZ3RoIiwibGVuZ3RoRmllbGRPZmZzZXQiLCJsZW5ndGhGaWVsZExlbmd0aCIsImxlbmd0aEFkanVzdG1lbnQiLCJfc29ja2V0Q2xpZW50IiwicGlwZSIsIl9lbmNvZGVyIiwiVXNibXV4RW5jb2RlciIsIl9hc3NpZ25DbGllbnRGYWlsdXJlSGFuZGxlcnMiLCJfdGFnIiwiX3Jlc3BvbnNlQ2FsbGJhY2tzIiwib24iLCJfaGFuZGxlRGF0YSIsImJpbmQiLCJkYXRhIiwiY2IiLCJoZWFkZXIiLCJ0YWciLCJfIiwibm9vcCIsInJlYWRCVUlEIiwicmVjZWl2ZVByb21pc2UiLCJfcmVjZWl2ZVBsaXN0UHJvbWlzZSIsInBheWxvYWQiLCJCVUlEIiwiSlNPTiIsInN0cmluZ2lmeSIsIl9zZW5kUGxpc3QiLCJNZXNzYWdlVHlwZSIsIlByb2dOYW1lIiwiQ2xpZW50VmVyc2lvblN0cmluZyIsInJlYWRQYWlyUmVjb3JkIiwidWRpZCIsIlBhaXJSZWNvcmREYXRhIiwicGxpc3QiLCJwYXJzZVBsaXN0IiwiUGFpclJlY29yZElEIiwianNvbiIsIndyaXRlIiwicmVzcG9uc2VDYWxsYmFjayIsImUiLCJzZXRUaW1lb3V0IiwibGlzdERldmljZXMiLCJEZXZpY2VMaXN0IiwiZmluZERldmljZSIsImRldmljZXMiLCJmaW5kIiwiZGV2aWNlIiwiUHJvcGVydGllcyIsIlNlcmlhbE51bWJlciIsImNvbm5lY3RMb2NrZG93biIsImNvbm5lY3QiLCJEZXZpY2VJRCIsIkxPQ0tET1dOX1BPUlQiLCJMb2NrZG93biIsIlBsaXN0U2VydmljZSIsImRldmljZUlEIiwicG9ydCIsIk51bWJlciIsInNodXRkb3duIiwidW5waXBlIiwiUG9ydE51bWJlciJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi91c2JtdXgvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG5ldCBmcm9tICduZXQnO1xuaW1wb3J0IG9zIGZyb20gJ29zJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyBwbGlzdCwgZnMgfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IExlbmd0aEJhc2VkU3BsaXR0ZXIgZnJvbSAnLi4vdXRpbC90cmFuc2Zvcm1lci9sZW5ndGgtYmFzZWQtc3BsaXR0ZXInO1xuaW1wb3J0IFVzYm11eERlY29kZXIgZnJvbSAnLi90cmFuc2Zvcm1lci91c2JtdXgtZGVjb2Rlci5qcyc7XG5pbXBvcnQgVXNibXV4RW5jb2RlciBmcm9tICcuL3RyYW5zZm9ybWVyL3VzYm11eC1lbmNvZGVyLmpzJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IFBsaXN0U2VydmljZSBmcm9tICcuLi9wbGlzdC1zZXJ2aWNlJztcbmltcG9ydCB7IExvY2tkb3duLCBMT0NLRE9XTl9QT1JUIH0gZnJvbSAnLi4vbG9ja2Rvd24nO1xuaW1wb3J0IHsgQmFzZVNlcnZpY2VTb2NrZXQgfSBmcm9tICcuLi9iYXNlLXNlcnZpY2UnO1xuaW1wb3J0IHsgTUIgfSBmcm9tICcuLi9jb25zdGFudHMnO1xuXG5cbmNvbnN0IE1BWF9GUkFNRV9TSVpFID0gMSAqIE1CO1xuXG5jb25zdCBVU0JNVVhfUkVTVUxUID0ge1xuICBPSzogMCxcbiAgQkFEQ09NTUFORDogMSxcbiAgQkFEREVWOiAyLFxuICBDT05OUkVGVVNFRDogMyxcbn07XG5cbmxldCBuYW1lLCB2ZXJzaW9uO1xudHJ5IHtcbiAgLy8gZmlyc3QgdHJ5IGFzc3VtaW5nIHRoaXMgaXMgaW4gdGhlIGBidWlsZGAgZm9sZGVyXG4gICh7IG5hbWUsIHZlcnNpb24gfSA9IHJlcXVpcmUocGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uJywgJy4uJywgJy4uJywgJ3BhY2thZ2UuanNvbicpKSk7XG59IGNhdGNoIChlcnIpIHtcbiAgLy8gdGhlbiB0cnkgYXNzdW1pbmcgaXQgaXMgbm90XG4gICh7IG5hbWUsIHZlcnNpb24gfSA9IHJlcXVpcmUocGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uJywgJy4uJywgJ3BhY2thZ2UuanNvbicpKSk7XG59XG5cbmNvbnN0IERFRkFVTFRfVVNCTVVYRF9TT0NLRVQgPSAnL3Zhci9ydW4vdXNibXV4ZCc7XG5jb25zdCBERUZBVUxUX1VTQk1VWERfUE9SVCA9IDI3MDE1O1xuY29uc3QgREVGQVVMVF9VU0JNVVhEX0hPU1QgPSAnMTI3LjAuMC4xJztcbmNvbnN0IFBST0dfTkFNRSA9IG5hbWU7XG5jb25zdCBDTElFTlRfVkVSU0lPTl9TVFJJTkcgPSBgJHtuYW1lfS0ke3ZlcnNpb259YDtcblxuZnVuY3Rpb24gc3dhcDE2ICh2YWwpIHtcbiAgcmV0dXJuICgodmFsICYgMHhGRikgPDwgOCkgfCAoKHZhbCA+PiA4KSAmIDB4RkYpO1xufVxuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFNvY2tldE9wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gc29ja2V0UGF0aCBbL3Zhci9ydW4vdXNibXV4ZF0gVGhlIGZ1bGwgcGF0aCB0byB0aGUgdXNibXV4ZCBVbml4IHNvY2tldFxuICogQHByb3BlcnR5IHs/bnVtYmVyfSBzb2NrZXRQb3J0IFsyNzAxNV0gVGhlIHBvcnQgbnVtYmVyIHRvIGNvbm5lY3QgdG8gaWYgcnVubmluZyBvbiBXaW5kb3dzXG4gKiBvciBpbiBXU0wxIG1vZGVcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gc29ja2V0SG9zdCBbMTI3LjAuMC4xXSBUaGUgaG9zdCBuYW1lIHRvIGNvbm5lY3QgdG8gaWYgcnVubmluZyBvbiBXaW5kb3dzXG4gKiBvciBpbiBXU0wxIG1vZGVcbiAqIEBwcm9wZXJ0eSB7P251bWJlcn0gdGltZW91dCBbNTAwMF0gVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCB1bnRpbFxuICogdGhlIHNvY2tldCBpcyBjb25uZWN0ZWRcbiAqL1xuXG4vKipcbiAqIENvbm5lY3RzIGEgc29ja2V0IHRvIHVzYm11eGQgc2VydmljZVxuICpcbiAqIEBwYXJhbSB7P1NvY2tldE9wdGlvbnN9IG9wdHNcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgYWNjZXNzaW5nIHRoZSBzb2NrZXQgb3JcbiAqIGEgY29ubmVjdGlvbiBlcnJvciBoYXBwZW5lZFxuICogQHRocm93cyB7Qi5UaW1lb3V0RXJyb3J9IGlmIGNvbm5lY3Rpb24gdGltZW91dCBoYXBwZW5lZFxuICogQHJldHVybnMge25ldC5Tb2NrZXR9IENvbm5lY3RlZCBzb2NrZXQgaW5zdGFuY2VcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0RGVmYXVsdFNvY2tldCAob3B0cyA9IHt9KSB7XG4gIGNvbnN0IHtcbiAgICBzb2NrZXRQYXRoID0gREVGQVVMVF9VU0JNVVhEX1NPQ0tFVCxcbiAgICBzb2NrZXRQb3J0ID0gREVGQVVMVF9VU0JNVVhEX1BPUlQsXG4gICAgc29ja2V0SG9zdCA9IERFRkFVTFRfVVNCTVVYRF9IT1NULFxuICAgIHRpbWVvdXQgPSA1MDAwLFxuICB9ID0gb3B0cztcblxuICBsZXQgc29ja2V0O1xuICBpZiAoYXdhaXQgZnMuZXhpc3RzKHNvY2tldFBhdGgpKSB7XG4gICAgc29ja2V0ID0gbmV0LmNyZWF0ZUNvbm5lY3Rpb24oc29ja2V0UGF0aCk7XG4gIH0gZWxzZSBpZiAocHJvY2Vzcy5wbGF0Zm9ybSA9PT0gJ3dpbjMyJ1xuICAgICAgfHwgKHByb2Nlc3MucGxhdGZvcm0gPT09ICdsaW51eCcgJiYgL21pY3Jvc29mdC9pLnRlc3Qob3MucmVsZWFzZSgpKSkpIHtcbiAgICAvLyBDb25uZWN0IHRvIHVzYm11eGQgd2hlbiBydW5uaW5nIG9uIFdTTDFcbiAgICBzb2NrZXQgPSBuZXQuY3JlYXRlQ29ubmVjdGlvbihzb2NrZXRQb3J0LCBzb2NrZXRIb3N0KTtcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSB1c2JtdXhkIHNvY2tldCBhdCAnJHtzb2NrZXRQYXRofScgZG9lcyBub3QgZXhpc3Qgb3IgaXMgbm90IGFjY2Vzc2libGVgKTtcbiAgfVxuXG4gIHJldHVybiBhd2FpdCBuZXcgQigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgc29ja2V0Lm9uY2UoJ2Vycm9yJywgcmVqZWN0KTtcbiAgICBzb2NrZXQub25jZSgnY29ubmVjdCcsICgpID0+IHJlc29sdmUoc29ja2V0KSk7XG4gIH0pLnRpbWVvdXQodGltZW91dCk7XG59XG5cblxuY2xhc3MgVXNibXV4IGV4dGVuZHMgQmFzZVNlcnZpY2VTb2NrZXQge1xuICBjb25zdHJ1Y3RvciAoc29ja2V0Q2xpZW50KSB7XG4gICAgc3VwZXIoc29ja2V0Q2xpZW50KTtcblxuICAgIHRoaXMuX2RlY29kZXIgPSBuZXcgVXNibXV4RGVjb2RlcigpO1xuICAgIHRoaXMuX3NwbGl0dGVyID0gbmV3IExlbmd0aEJhc2VkU3BsaXR0ZXIoe1xuICAgICAgcmVhZGFibGVTdHJlYW06IHNvY2tldENsaWVudCxcbiAgICAgIGxpdHRsZUVuZGlhbjogdHJ1ZSxcbiAgICAgIG1heEZyYW1lTGVuZ3RoOiBNQVhfRlJBTUVfU0laRSxcbiAgICAgIGxlbmd0aEZpZWxkT2Zmc2V0OiAwLFxuICAgICAgbGVuZ3RoRmllbGRMZW5ndGg6IDQsXG4gICAgICBsZW5ndGhBZGp1c3RtZW50OiAwLFxuICAgIH0pO1xuICAgIHRoaXMuX3NvY2tldENsaWVudC5waXBlKHRoaXMuX3NwbGl0dGVyKS5waXBlKHRoaXMuX2RlY29kZXIpO1xuXG4gICAgdGhpcy5fZW5jb2RlciA9IG5ldyBVc2JtdXhFbmNvZGVyKCk7XG4gICAgdGhpcy5fZW5jb2Rlci5waXBlKHRoaXMuX3NvY2tldENsaWVudCk7XG4gICAgdGhpcy5fYXNzaWduQ2xpZW50RmFpbHVyZUhhbmRsZXJzKHRoaXMuX2VuY29kZXIpO1xuXG4gICAgdGhpcy5fdGFnID0gMDtcbiAgICB0aGlzLl9yZXNwb25zZUNhbGxiYWNrcyA9IHt9O1xuICAgIHRoaXMuX2RlY29kZXIub24oJ2RhdGEnLCB0aGlzLl9oYW5kbGVEYXRhLmJpbmQodGhpcykpO1xuICB9XG5cbiAgX2hhbmRsZURhdGEgKGRhdGEpIHtcbiAgICBjb25zdCBjYiA9IHRoaXMuX3Jlc3BvbnNlQ2FsbGJhY2tzW2RhdGEuaGVhZGVyLnRhZ10gfHwgXy5ub29wO1xuICAgIGNiKGRhdGEpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHByb21pc2UvcHJlZmVyLWF3YWl0LXRvLWNhbGxiYWNrc1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIEJVSUQgb2YgdGhlIGhvc3QgY29tcHV0ZXIgZnJvbSB1c2JtdXhkXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBbdGltZW91dD01MDAwXSB0aGUgdGltZW91dCBvZiByZWNlaXZpbmcgYSByZXNwb25zZSBmcm9tIHVzYm11eGRcbiAgICogQHJldHVybnMge3N0cmluZ31cbiAgICovXG4gIGFzeW5jIHJlYWRCVUlEICh0aW1lb3V0ID0gNTAwMCkge1xuICAgIGNvbnN0IHt0YWcsIHJlY2VpdmVQcm9taXNlfSA9IHRoaXMuX3JlY2VpdmVQbGlzdFByb21pc2UodGltZW91dCwgKGRhdGEpID0+IHtcbiAgICAgIGlmIChkYXRhLnBheWxvYWQuQlVJRCkge1xuICAgICAgICByZXR1cm4gZGF0YS5wYXlsb2FkLkJVSUQ7XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuZXhwZWN0ZWQgZGF0YTogJHtKU09OLnN0cmluZ2lmeShkYXRhKX1gKTtcbiAgICB9KTtcblxuICAgIHRoaXMuX3NlbmRQbGlzdCh7XG4gICAgICB0YWcsXG4gICAgICBwYXlsb2FkOiB7XG4gICAgICAgIE1lc3NhZ2VUeXBlOiAnUmVhZEJVSUQnLFxuICAgICAgICBQcm9nTmFtZTogUFJPR19OQU1FLFxuICAgICAgICBDbGllbnRWZXJzaW9uU3RyaW5nOiBDTElFTlRfVkVSU0lPTl9TVFJJTkdcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBhd2FpdCByZWNlaXZlUHJvbWlzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWFkcyB0aGUgcGFpciByZWNvcmQgb2YgYSBkZXZpY2UuIEl0IHdpbGwgcmV0dXJuIG51bGwgaWYgaXQgZG9lc24ndCBleGlzdHNcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgdGhlIHVkaWQgb2YgdGhlIGRldmljZVxuICAgKiBAcGFyYW0ge251bWJlcn0gW3RpbWVvdXQ9NTAwMF0gdGhlIHRpbWVvdXQgb2YgcmVjZWl2aW5nIGEgcmVzcG9uc2UgZnJvbSB1c2JtdXhkXG4gICAqIEByZXR1cm5zIHs/T2JqZWN0fVxuICAgKi9cbiAgYXN5bmMgcmVhZFBhaXJSZWNvcmQgKHVkaWQsIHRpbWVvdXQgPSA1MDAwKSB7XG4gICAgY29uc3Qge3RhZywgcmVjZWl2ZVByb21pc2V9ID0gdGhpcy5fcmVjZWl2ZVBsaXN0UHJvbWlzZSh0aW1lb3V0LCAoZGF0YSkgPT4ge1xuICAgICAgaWYgKCFkYXRhLnBheWxvYWQuUGFpclJlY29yZERhdGEpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gcGxpc3QucGFyc2VQbGlzdChkYXRhLnBheWxvYWQuUGFpclJlY29yZERhdGEpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5leHBlY3RlZCBkYXRhOiAke0pTT04uc3RyaW5naWZ5KGRhdGEpfWApO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5fc2VuZFBsaXN0KHtcbiAgICAgIHRhZyxcbiAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgTWVzc2FnZVR5cGU6ICdSZWFkUGFpclJlY29yZCcsXG4gICAgICAgIFBhaXJSZWNvcmRJRDogdWRpZCxcbiAgICAgICAgUHJvZ05hbWU6IFBST0dfTkFNRSxcbiAgICAgICAgQ2xpZW50VmVyc2lvblN0cmluZzogQ0xJRU5UX1ZFUlNJT05fU1RSSU5HXG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGF3YWl0IHJlY2VpdmVQcm9taXNlO1xuICB9XG5cbiAgX3NlbmRQbGlzdCAoanNvbikge1xuICAgIHRoaXMuX2VuY29kZXIud3JpdGUoanNvbik7XG4gIH1cblxuICBfcmVjZWl2ZVBsaXN0UHJvbWlzZSAodGltZW91dCA9IDUwMDAsIHJlc3BvbnNlQ2FsbGJhY2spIHtcbiAgICBjb25zdCB0YWcgPSB0aGlzLl90YWcrKztcbiAgICBjb25zdCByZWNlaXZlUHJvbWlzZSA9IG5ldyBCKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRoaXMuX3Jlc3BvbnNlQ2FsbGJhY2tzW3RhZ10gPSAoZGF0YSkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHJlc29sdmUocmVzcG9uc2VDYWxsYmFjayhkYXRhKSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHJlamVjdChuZXcgRXJyb3IoYEZhaWxlZCB0byByZWNlaXZlIGFueSBkYXRhIHdpdGhpbiB0aGUgdGltZW91dDogJHt0aW1lb3V0fWApKSwgdGltZW91dCk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHt0YWcsIHJlY2VpdmVQcm9taXNlfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMaXN0cyBhbGwgZGV2aWNlcyBjb25uZWN0ZWQgdG8gdGhlIGhvc3RcbiAgICogQHBhcmFtIHtudW1iZXJ9IFt0aW1lb3V0PTUwMDBdIHRoZSB0aW1lb3V0IG9mIHJlY2VpdmluZyBhIHJlc3BvbnNlIGZyb20gdXNibXV4ZFxuICAgKiBAcmV0dXJucyB7QXJyYXl9XG4gICAqL1xuICBhc3luYyBsaXN0RGV2aWNlcyAodGltZW91dCA9IDUwMDApIHtcbiAgICBjb25zdCB7dGFnLCByZWNlaXZlUHJvbWlzZX0gPSB0aGlzLl9yZWNlaXZlUGxpc3RQcm9taXNlKHRpbWVvdXQsIChkYXRhKSA9PiB7XG4gICAgICBpZiAoZGF0YS5wYXlsb2FkLkRldmljZUxpc3QpIHtcbiAgICAgICAgcmV0dXJuIGRhdGEucGF5bG9hZC5EZXZpY2VMaXN0O1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmV4cGVjdGVkIGRhdGE6ICR7SlNPTi5zdHJpbmdpZnkoZGF0YSl9YCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLl9zZW5kUGxpc3Qoe1xuICAgICAgdGFnLFxuICAgICAgcGF5bG9hZDoge1xuICAgICAgICBNZXNzYWdlVHlwZTogJ0xpc3REZXZpY2VzJyxcbiAgICAgICAgUHJvZ05hbWU6IFBST0dfTkFNRSxcbiAgICAgICAgQ2xpZW50VmVyc2lvblN0cmluZzogQ0xJRU5UX1ZFUlNJT05fU1RSSU5HXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gYXdhaXQgcmVjZWl2ZVByb21pc2U7XG4gIH1cblxuICAvKipcbiAgICogTG9va3MgZm9yIGEgZGV2aWNlIHdpdGggdGhlIHBhc3NlZCB1ZGlkLiBJdCB3aWxsIHJldHVybiB1bmRlZmluZWQgaWYgdGhlIGRldmljZSBpcyBub3QgZm91bmRcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgdGhlIHVkaWQgb2YgdGhlIGRldmljZVxuICAgKiBAcGFyYW0ge251bWJlcn0gW3RpbWVvdXQ9NTAwMF0gdGhlIHRpbWVvdXQgb2YgcmVjZWl2aW5nIGEgcmVzcG9uc2UgZnJvbSB1c2JtdXhkXG4gICAqIEByZXR1cm5zIHs/T2JqZWN0fVxuICAgKi9cbiAgYXN5bmMgZmluZERldmljZSAodWRpZCwgdGltZW91dCA9IDUwMDApIHtcbiAgICBjb25zdCBkZXZpY2VzID0gYXdhaXQgdGhpcy5saXN0RGV2aWNlcyh0aW1lb3V0KTtcbiAgICByZXR1cm4gXy5maW5kKGRldmljZXMsIChkZXZpY2UpID0+IGRldmljZS5Qcm9wZXJ0aWVzLlNlcmlhbE51bWJlciA9PT0gdWRpZCk7XG4gIH1cblxuICAvKipcbiAgICogQ29ubmVjdHMgdG8gdGhlIGxvY2tkb3duZCBvbiB0aGUgZGV2aWNlIGFuZCByZXR1cm5zIGEgTG9ja2Rvd24gY2xpZW50XG4gICAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIHRoZSB1ZGlkIG9mIHRoZSBkZXZpY2VcbiAgICogQHBhcmFtIHtudW1iZXJ9IFt0aW1lb3V0PTUwMDBdIHRoZSB0aW1lb3V0IG9mIHJlY2VpdmluZyBhIHJlc3BvbnNlIGZyb20gdXNibXV4ZFxuICAgKiBAcmV0dXJucyB7TG9ja2Rvd259XG4gICAqL1xuICBhc3luYyBjb25uZWN0TG9ja2Rvd24gKHVkaWQsIHRpbWVvdXQgPSA1MDAwKSB7XG4gICAgY29uc3QgZGV2aWNlID0gYXdhaXQgdGhpcy5maW5kRGV2aWNlKHVkaWQsIHRpbWVvdXQpO1xuICAgIGlmICghZGV2aWNlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYENvdWxkIG5vdCBmaW5kIHRoZSBleHBlY3RlZCBkZXZpY2UgJyR7dWRpZH0nYCk7XG4gICAgfVxuICAgIGNvbnN0IHNvY2tldCA9IGF3YWl0IHRoaXMuY29ubmVjdChkZXZpY2UuUHJvcGVydGllcy5EZXZpY2VJRCwgTE9DS0RPV05fUE9SVCwgdGltZW91dCk7XG4gICAgcmV0dXJuIG5ldyBMb2NrZG93bihuZXcgUGxpc3RTZXJ2aWNlKHNvY2tldCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbm5lY3RzIHRvIGEgY2VydGFpbiBwb3J0IG9uIHRoZSBkZXZpY2VcbiAgICogQHBhcmFtIHtzdHJpbmd9IGRldmljZUlEIHRoZSBkZXZpY2UgaWQgd2hpY2ggY2FuIGJlIHJldHJpZXZlZCBmcm9tIHRoZSBwcm9wZXJ0aWVzIG9mIGEgZGV2aWNlXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBwb3J0IHRoZSBwb3J0IG51bWJlciB0aGF0IHdhbnRzIHRvIGJlIGNvbm5lY3RlZFxuICAgKiBAcGFyYW0ge251bWJlcn0gW3RpbWVvdXQ9NTAwMF0gdGhlIHRpbWVvdXQgb2YgcmVjZWl2aW5nIGEgcmVzcG9uc2UgZnJvbSB1c2JtdXhkXG4gICAqIEByZXR1cm5zIHtuZXQuU29ja2V0fE9iamVjdH0gVGhlIHNvY2tldCBvciB0aGUgb2JqZWN0IHJldHVybmVkIGluIHRoZSBjYWxsYmFjayBpZiB0aGUgY2FsbGJhY2sgZnVuY3Rpb24gZXhpc3RzXG4gICAqL1xuICBhc3luYyBjb25uZWN0IChkZXZpY2VJRCwgcG9ydCwgdGltZW91dCA9IDUwMDApIHtcbiAgICBjb25zdCB7dGFnLCByZWNlaXZlUHJvbWlzZX0gPSB0aGlzLl9yZWNlaXZlUGxpc3RQcm9taXNlKHRpbWVvdXQsIChkYXRhKSA9PiB7XG4gICAgICBpZiAoZGF0YS5wYXlsb2FkLk1lc3NhZ2VUeXBlICE9PSAnUmVzdWx0Jykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuZXhwZWN0ZWQgZGF0YTogJHtKU09OLnN0cmluZ2lmeShkYXRhKX1gKTtcbiAgICAgIH1cbiAgICAgIGlmIChkYXRhLnBheWxvYWQuTnVtYmVyID09PSBVU0JNVVhfUkVTVUxULk9LKSB7XG4gICAgICAgIHRoaXMuX3NwbGl0dGVyLnNodXRkb3duKCk7XG4gICAgICAgIHRoaXMuX3NvY2tldENsaWVudC51bnBpcGUodGhpcy5fc3BsaXR0ZXIpO1xuICAgICAgICB0aGlzLl9zcGxpdHRlci51bnBpcGUodGhpcy5fZGVjb2Rlcik7XG4gICAgICAgIHJldHVybiB0aGlzLl9zb2NrZXRDbGllbnQ7XG4gICAgICB9IGVsc2UgaWYgKGRhdGEucGF5bG9hZC5OdW1iZXIgPT09IFVTQk1VWF9SRVNVTFQuQ09OTlJFRlVTRUQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb25uZWN0aW9uIHdhcyByZWZ1c2VkIHRvIHBvcnQgJHtwb3J0fWApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmV4cGVjdGVkIGRhdGE6ICR7SlNPTi5zdHJpbmdpZnkoZGF0YSl9YCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLl9zZW5kUGxpc3Qoe1xuICAgICAgdGFnLFxuICAgICAgcGF5bG9hZDoge1xuICAgICAgICBNZXNzYWdlVHlwZTogJ0Nvbm5lY3QnLFxuICAgICAgICBQcm9nTmFtZTogUFJPR19OQU1FLFxuICAgICAgICBDbGllbnRWZXJzaW9uU3RyaW5nOiBDTElFTlRfVkVSU0lPTl9TVFJJTkcsXG4gICAgICAgIERldmljZUlEOiBkZXZpY2VJRCxcbiAgICAgICAgUG9ydE51bWJlcjogc3dhcDE2KHBvcnQpXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gYXdhaXQgcmVjZWl2ZVByb21pc2U7XG4gIH1cbn1cblxuZXhwb3J0IHsgVXNibXV4LCBnZXREZWZhdWx0U29ja2V0IH07XG5leHBvcnQgZGVmYXVsdCBVc2JtdXg7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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