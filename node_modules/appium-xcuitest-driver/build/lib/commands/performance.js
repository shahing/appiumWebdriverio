"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.commands = void 0;
require("source-map-support/register");
var _lodash = _interopRequireDefault(require("lodash"));
var _path = _interopRequireDefault(require("path"));
var _support = require("appium/support");
var _teen_process = require("teen_process");
var _utils = require("../utils");
var _asyncbox = require("asyncbox");
var _bluebird = _interopRequireDefault(require("bluebird"));
const commands = {};
exports.commands = commands;
const PERF_RECORD_FEAT_NAME = 'perf_record';
const PERF_RECORD_SECURITY_MESSAGE = 'Performance measurement requires relaxing security for simulator. ' + `Please set '--relaxed-security' or '--allow-insecure' with '${PERF_RECORD_FEAT_NAME}' ` + 'referencing https://github.com/appium/appium/blob/master/docs/en/writing-running-appium/security.md for more details.';
const DEFAULT_TIMEOUT_MS = 5 * 60 * 1000;
const STOP_TIMEOUT_MS = 3 * 60 * 1000;
const STARTUP_TIMEOUT_MS = 60 * 1000;
const DEFAULT_PROFILE_NAME = 'Activity Monitor';
const DEFAULT_EXT = '.trace';
const DEFAULT_PID = 'current';
const INSTRUMENTS = 'instruments';
const XCRUN = 'xcrun';
const XCTRACE = 'xctrace';
async function requireXctrace() {
  let xcrunPath;
  try {
    xcrunPath = await _support.fs.which(XCRUN);
  } catch (e) {
    throw new Error(`${XCRUN} has not been found in PATH. ` + `Please make sure XCode development tools are installed`);
  }
  try {
    await (0, _teen_process.exec)(xcrunPath, [XCTRACE, 'help']);
  } catch (e) {
    throw new Error(`${XCTRACE} is not available for the active Xcode version. ` + `Please make sure XCode is up to date. Original error: ${e.stderr || e.message}`);
  }
  return xcrunPath;
}
async function requireInstruments() {
  try {
    return await _support.fs.which(INSTRUMENTS);
  } catch (e) {
    throw new Error(`${INSTRUMENTS} has not been found in PATH. ` + `Please make sure XCode development tools are installed`);
  }
}
class PerfRecorder {
  constructor(reportRoot, udid, opts = {}) {
    this._process = null;
    this._zippedReportPath = '';
    this._timeout = opts.timeout && opts.timeout > 0 ? opts.timeout : DEFAULT_TIMEOUT_MS;
    this._profileName = opts.profileName || DEFAULT_PROFILE_NAME;
    this._reportPath = _path.default.resolve(reportRoot, `appium_perf__${this._profileName.replace(/\W/g, '_')}__${Date.now()}${DEFAULT_EXT}`);
    this._pid = opts.pid;
    this._udid = udid;
    this._logger = _support.logger.getLogger(`${_lodash.default.truncate(this._profileName, {
      length: 10
    })}@${this._udid.substring(0, 8)}`);
    this._archivePromise = null;
  }
  get profileName() {
    return this._profileName;
  }
  async getOriginalReportPath() {
    return (await _support.fs.exists(this._reportPath)) ? this._reportPath : '';
  }
  async getZippedReportPath() {
    if (!this._archivePromise) {
      this._archivePromise = (async () => {
        const originalReportPath = await this.getOriginalReportPath();
        if (!originalReportPath) {
          return '';
        }
        const zippedReportPath = await _support.tempDir.path({
          prefix: _path.default.parse(originalReportPath).name,
          suffix: '.zip'
        });
        await _support.zip.toArchive(zippedReportPath, {
          cwd: _path.default.dirname(this._reportPath)
        });
        await _support.fs.rimraf(_path.default.dirname(this._reportPath));
        this._zippedReportPath = zippedReportPath;
        return this._zippedReportPath;
      })();
    }
    return await this._archivePromise;
  }
  isRunning() {
    var _this$_process;
    return !!((_this$_process = this._process) !== null && _this$_process !== void 0 && _this$_process.isRunning);
  }
  async _enforceTermination() {
    if (this._process && this.isRunning()) {
      this._logger.debug('Force-stopping the currently running perf recording');
      try {
        await this._process.stop('SIGKILL');
      } catch (ign) {}
    }
    this._process = null;
    const performCleanup = async () => {
      try {
        await _bluebird.default.all([this._zippedReportPath, _path.default.dirname(this._reportPath)].filter(Boolean).map(x => _support.fs.rimraf(x)));
      } catch (e) {
        this._logger.warn(e.message);
      }
    };
    if (this._archivePromise) {
      this._archivePromise.finally(async () => {
        await performCleanup();
        this._archivePromise = null;
      }).catch(() => {});
    }
    await performCleanup();
    return '';
  }
  async start() {
    let binaryPath;
    try {
      binaryPath = await requireXctrace();
    } catch (e) {
      this._logger.debug(e.message);
      this._logger.warn(`Defaulting to ${INSTRUMENTS} usage`);
      binaryPath = await requireInstruments();
    }
    const args = [];
    const toolName = _path.default.basename(binaryPath) === XCRUN ? XCTRACE : INSTRUMENTS;
    if (toolName === XCTRACE) {
      args.push(XCTRACE, 'record', '--device', this._udid, '--template', this._profileName, '--output', this._reportPath, '--time-limit', `${this._timeout}ms`);
      if (this._pid) {
        args.push('--attach', `${this._pid}`);
      } else {
        args.push('--all-processes');
      }
    } else {
      args.push('-w', this._udid, '-t', this._profileName, '-D', this._reportPath, '-l', `${this._timeout}`);
      if (this._pid) {
        args.push('-p', `${this._pid}`);
      }
    }
    const fullCmd = [binaryPath, ...args];
    this._process = new _teen_process.SubProcess(fullCmd[0], fullCmd.slice(1));
    this._archivePromise = null;
    this._logger.debug(`Starting performance recording: ${_support.util.quote(fullCmd)}`);
    this._process.on('output', (stdout, stderr) => {
      if (_lodash.default.trim(stdout || stderr)) {
        this._logger.debug(`[${toolName}] ${stdout || stderr}`);
      }
    });
    this._process.once('exit', async (code, signal) => {
      this._process = null;
      if (code === 0) {
        this._logger.debug('Performance recording exited without errors');
        try {
          await this.getZippedReportPath();
        } catch (e) {
          this._logger.warn(e);
        }
      } else {
        await this._enforceTermination();
        this._logger.warn(`Performance recording exited with error code ${code}, signal ${signal}`);
      }
    });
    await this._process.start(0);
    try {
      await (0, _asyncbox.waitForCondition)(async () => {
        if (await this.getOriginalReportPath()) {
          return true;
        }
        if (!this._process) {
          throw new Error(`${toolName} process died unexpectedly`);
        }
        return false;
      }, {
        waitMs: STARTUP_TIMEOUT_MS,
        intervalMs: 500
      });
    } catch (e) {
      await this._enforceTermination();
      const listProfilesCommand = toolName === XCTRACE ? `${XCRUN} ${XCTRACE} list templates` : `${INSTRUMENTS} -s`;
      this._logger.errorAndThrow(`There is no ${DEFAULT_EXT} file found for performance profile ` + `'${this._profileName}'. Make sure the profile is supported on this device. ` + `You could use '${listProfilesCommand}' command to see the list of all available profiles. ` + `Check the server log for more details`);
    }
    this._logger.info(`The performance recording has started. Will timeout in ${this._timeout}ms`);
  }
  async stop(force = false) {
    if (force) {
      return await this._enforceTermination();
    }
    if (!this.isRunning()) {
      this._logger.debug('Performance recording is not running. Returning the recent result');
      return await this.getZippedReportPath();
    }
    try {
      await this._process.stop('SIGINT', STOP_TIMEOUT_MS);
    } catch (e) {
      this._logger.errorAndThrow(`Performance recording has failed to exit after ${STOP_TIMEOUT_MS}ms`);
    }
    return await this.getZippedReportPath();
  }
}
commands.mobileStartPerfRecord = async function mobileStartPerfRecord(opts = {}) {
  if (!this.isFeatureEnabled(PERF_RECORD_FEAT_NAME) && !this.isRealDevice()) {
    this.log.errorAndThrow(PERF_RECORD_SECURITY_MESSAGE);
  }
  const {
    timeout = DEFAULT_TIMEOUT_MS,
    profileName = DEFAULT_PROFILE_NAME,
    pid
  } = opts;
  if (!_lodash.default.isEmpty(this._perfRecorders)) {
    for (const recorder of this._perfRecorders.filter(x => x.profileName === profileName)) {
      if (recorder.isRunning()) {
        this.log.debug(`Performance recorder for '${profileName}' on device '${this.opts.device.udid}' ` + ` is already running. Doing nothing`);
        return;
      }
      _lodash.default.pull(this._perfRecorders, recorder);
      await recorder.stop(true);
    }
  }
  let realPid;
  if (pid) {
    if (_lodash.default.toLower(pid) === DEFAULT_PID) {
      const appInfo = await this.proxyCommand('/wda/activeAppInfo', 'GET');
      realPid = appInfo.pid;
    } else {
      realPid = pid;
    }
  }
  const recorder = new PerfRecorder(await _support.tempDir.openDir(), this.opts.device.udid, {
    timeout: parseInt(timeout, 10),
    profileName,
    pid: parseInt(realPid, 10)
  });
  await recorder.start();
  this._perfRecorders = [...(this._perfRecorders || []), recorder];
};
commands.mobileStopPerfRecord = async function mobileStopPerfRecord(opts = {}) {
  if (!this.isFeatureEnabled(PERF_RECORD_FEAT_NAME) && !this.isRealDevice()) {
    this.log.errorAndThrow(PERF_RECORD_SECURITY_MESSAGE);
  }
  if (_lodash.default.isEmpty(this._perfRecorders)) {
    this.log.info('No performance recorders have been started. Doing nothing');
    return '';
  }
  const {
    profileName = DEFAULT_PROFILE_NAME,
    remotePath
  } = opts;
  const recorders = this._perfRecorders.filter(x => x.profileName === profileName);
  if (_lodash.default.isEmpty(recorders)) {
    this.log.errorAndThrow(`There are no records for performance profile '${profileName}' ` + `and device ${this.opts.device.udid}. Have you started the profiling before?`);
  }
  const recorder = _lodash.default.first(recorders);
  const resultPath = await recorder.stop();
  if (!(await _support.fs.exists(resultPath))) {
    this.log.errorAndThrow(`There is no ${DEFAULT_EXT} file found for performance profile '${profileName}' ` + `and device ${this.opts.device.udid}. Make sure the selected profile is supported on this device`);
  }
  const result = await (0, _utils.encodeBase64OrUpload)(resultPath, remotePath, opts);
  _lodash.default.pull(this._perfRecorders, recorder);
  await _support.fs.rimraf(resultPath);
  return result;
};
var _default = commands;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb21tYW5kcyIsIlBFUkZfUkVDT1JEX0ZFQVRfTkFNRSIsIlBFUkZfUkVDT1JEX1NFQ1VSSVRZX01FU1NBR0UiLCJERUZBVUxUX1RJTUVPVVRfTVMiLCJTVE9QX1RJTUVPVVRfTVMiLCJTVEFSVFVQX1RJTUVPVVRfTVMiLCJERUZBVUxUX1BST0ZJTEVfTkFNRSIsIkRFRkFVTFRfRVhUIiwiREVGQVVMVF9QSUQiLCJJTlNUUlVNRU5UUyIsIlhDUlVOIiwiWENUUkFDRSIsInJlcXVpcmVYY3RyYWNlIiwieGNydW5QYXRoIiwiZnMiLCJ3aGljaCIsImUiLCJFcnJvciIsImV4ZWMiLCJzdGRlcnIiLCJtZXNzYWdlIiwicmVxdWlyZUluc3RydW1lbnRzIiwiUGVyZlJlY29yZGVyIiwiY29uc3RydWN0b3IiLCJyZXBvcnRSb290IiwidWRpZCIsIm9wdHMiLCJfcHJvY2VzcyIsIl96aXBwZWRSZXBvcnRQYXRoIiwiX3RpbWVvdXQiLCJ0aW1lb3V0IiwiX3Byb2ZpbGVOYW1lIiwicHJvZmlsZU5hbWUiLCJfcmVwb3J0UGF0aCIsInBhdGgiLCJyZXNvbHZlIiwicmVwbGFjZSIsIkRhdGUiLCJub3ciLCJfcGlkIiwicGlkIiwiX3VkaWQiLCJfbG9nZ2VyIiwibG9nZ2VyIiwiZ2V0TG9nZ2VyIiwiXyIsInRydW5jYXRlIiwibGVuZ3RoIiwic3Vic3RyaW5nIiwiX2FyY2hpdmVQcm9taXNlIiwiZ2V0T3JpZ2luYWxSZXBvcnRQYXRoIiwiZXhpc3RzIiwiZ2V0WmlwcGVkUmVwb3J0UGF0aCIsIm9yaWdpbmFsUmVwb3J0UGF0aCIsInppcHBlZFJlcG9ydFBhdGgiLCJ0ZW1wRGlyIiwicHJlZml4IiwicGFyc2UiLCJuYW1lIiwic3VmZml4IiwiemlwIiwidG9BcmNoaXZlIiwiY3dkIiwiZGlybmFtZSIsInJpbXJhZiIsImlzUnVubmluZyIsIl9lbmZvcmNlVGVybWluYXRpb24iLCJkZWJ1ZyIsInN0b3AiLCJpZ24iLCJwZXJmb3JtQ2xlYW51cCIsIkIiLCJhbGwiLCJmaWx0ZXIiLCJCb29sZWFuIiwibWFwIiwieCIsIndhcm4iLCJmaW5hbGx5IiwiY2F0Y2giLCJzdGFydCIsImJpbmFyeVBhdGgiLCJhcmdzIiwidG9vbE5hbWUiLCJiYXNlbmFtZSIsInB1c2giLCJmdWxsQ21kIiwiU3ViUHJvY2VzcyIsInNsaWNlIiwidXRpbCIsInF1b3RlIiwib24iLCJzdGRvdXQiLCJ0cmltIiwib25jZSIsImNvZGUiLCJzaWduYWwiLCJ3YWl0Rm9yQ29uZGl0aW9uIiwid2FpdE1zIiwiaW50ZXJ2YWxNcyIsImxpc3RQcm9maWxlc0NvbW1hbmQiLCJlcnJvckFuZFRocm93IiwiaW5mbyIsImZvcmNlIiwibW9iaWxlU3RhcnRQZXJmUmVjb3JkIiwiaXNGZWF0dXJlRW5hYmxlZCIsImlzUmVhbERldmljZSIsImxvZyIsImlzRW1wdHkiLCJfcGVyZlJlY29yZGVycyIsInJlY29yZGVyIiwiZGV2aWNlIiwicHVsbCIsInJlYWxQaWQiLCJ0b0xvd2VyIiwiYXBwSW5mbyIsInByb3h5Q29tbWFuZCIsIm9wZW5EaXIiLCJwYXJzZUludCIsIm1vYmlsZVN0b3BQZXJmUmVjb3JkIiwicmVtb3RlUGF0aCIsInJlY29yZGVycyIsImZpcnN0IiwicmVzdWx0UGF0aCIsInJlc3VsdCIsImVuY29kZUJhc2U2NE9yVXBsb2FkIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL2NvbW1hbmRzL3BlcmZvcm1hbmNlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IGZzLCB6aXAsIGxvZ2dlciwgdXRpbCwgdGVtcERpciB9IGZyb20gJ2FwcGl1bS9zdXBwb3J0JztcbmltcG9ydCB7IFN1YlByb2Nlc3MsIGV4ZWMgfSBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuaW1wb3J0IHsgZW5jb2RlQmFzZTY0T3JVcGxvYWQgfSBmcm9tICcuLi91dGlscyc7XG5pbXBvcnQgeyB3YWl0Rm9yQ29uZGl0aW9uIH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuXG5jb25zdCBjb21tYW5kcyA9IHt9O1xuXG5jb25zdCBQRVJGX1JFQ09SRF9GRUFUX05BTUUgPSAncGVyZl9yZWNvcmQnO1xuY29uc3QgUEVSRl9SRUNPUkRfU0VDVVJJVFlfTUVTU0FHRSA9ICdQZXJmb3JtYW5jZSBtZWFzdXJlbWVudCByZXF1aXJlcyByZWxheGluZyBzZWN1cml0eSBmb3Igc2ltdWxhdG9yLiAnICtcbiAgYFBsZWFzZSBzZXQgJy0tcmVsYXhlZC1zZWN1cml0eScgb3IgJy0tYWxsb3ctaW5zZWN1cmUnIHdpdGggJyR7UEVSRl9SRUNPUkRfRkVBVF9OQU1FfScgYCArXG4gICdyZWZlcmVuY2luZyBodHRwczovL2dpdGh1Yi5jb20vYXBwaXVtL2FwcGl1bS9ibG9iL21hc3Rlci9kb2NzL2VuL3dyaXRpbmctcnVubmluZy1hcHBpdW0vc2VjdXJpdHkubWQgZm9yIG1vcmUgZGV0YWlscy4nO1xuY29uc3QgREVGQVVMVF9USU1FT1VUX01TID0gNSAqIDYwICogMTAwMDtcbmNvbnN0IFNUT1BfVElNRU9VVF9NUyA9IDMgKiA2MCAqIDEwMDA7XG5jb25zdCBTVEFSVFVQX1RJTUVPVVRfTVMgPSA2MCAqIDEwMDA7XG5jb25zdCBERUZBVUxUX1BST0ZJTEVfTkFNRSA9ICdBY3Rpdml0eSBNb25pdG9yJztcbmNvbnN0IERFRkFVTFRfRVhUID0gJy50cmFjZSc7XG5jb25zdCBERUZBVUxUX1BJRCA9ICdjdXJyZW50JztcbmNvbnN0IElOU1RSVU1FTlRTID0gJ2luc3RydW1lbnRzJztcbmNvbnN0IFhDUlVOID0gJ3hjcnVuJztcbmNvbnN0IFhDVFJBQ0UgPSAneGN0cmFjZSc7XG5cblxuYXN5bmMgZnVuY3Rpb24gcmVxdWlyZVhjdHJhY2UgKCkge1xuICBsZXQgeGNydW5QYXRoO1xuICB0cnkge1xuICAgIHhjcnVuUGF0aCA9IGF3YWl0IGZzLndoaWNoKFhDUlVOKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgJHtYQ1JVTn0gaGFzIG5vdCBiZWVuIGZvdW5kIGluIFBBVEguIGAgK1xuICAgICAgYFBsZWFzZSBtYWtlIHN1cmUgWENvZGUgZGV2ZWxvcG1lbnQgdG9vbHMgYXJlIGluc3RhbGxlZGApO1xuICB9XG4gIHRyeSB7XG4gICAgYXdhaXQgZXhlYyh4Y3J1blBhdGgsIFtYQ1RSQUNFLCAnaGVscCddKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgJHtYQ1RSQUNFfSBpcyBub3QgYXZhaWxhYmxlIGZvciB0aGUgYWN0aXZlIFhjb2RlIHZlcnNpb24uIGAgK1xuICAgICAgYFBsZWFzZSBtYWtlIHN1cmUgWENvZGUgaXMgdXAgdG8gZGF0ZS4gT3JpZ2luYWwgZXJyb3I6ICR7ZS5zdGRlcnIgfHwgZS5tZXNzYWdlfWApO1xuICB9XG4gIHJldHVybiB4Y3J1blBhdGg7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHJlcXVpcmVJbnN0cnVtZW50cyAoKSB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIGF3YWl0IGZzLndoaWNoKElOU1RSVU1FTlRTKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgJHtJTlNUUlVNRU5UU30gaGFzIG5vdCBiZWVuIGZvdW5kIGluIFBBVEguIGAgK1xuICAgICAgYFBsZWFzZSBtYWtlIHN1cmUgWENvZGUgZGV2ZWxvcG1lbnQgdG9vbHMgYXJlIGluc3RhbGxlZGApO1xuICB9XG59XG5cblxuY2xhc3MgUGVyZlJlY29yZGVyIHtcbiAgY29uc3RydWN0b3IgKHJlcG9ydFJvb3QsIHVkaWQsIG9wdHMgPSB7fSkge1xuICAgIHRoaXMuX3Byb2Nlc3MgPSBudWxsO1xuICAgIHRoaXMuX3ppcHBlZFJlcG9ydFBhdGggPSAnJztcbiAgICB0aGlzLl90aW1lb3V0ID0gKG9wdHMudGltZW91dCAmJiBvcHRzLnRpbWVvdXQgPiAwKSA/IG9wdHMudGltZW91dCA6IERFRkFVTFRfVElNRU9VVF9NUztcbiAgICB0aGlzLl9wcm9maWxlTmFtZSA9IG9wdHMucHJvZmlsZU5hbWUgfHwgREVGQVVMVF9QUk9GSUxFX05BTUU7XG4gICAgdGhpcy5fcmVwb3J0UGF0aCA9IHBhdGgucmVzb2x2ZShyZXBvcnRSb290LFxuICAgICAgYGFwcGl1bV9wZXJmX18ke3RoaXMuX3Byb2ZpbGVOYW1lLnJlcGxhY2UoL1xcVy9nLCAnXycpfV9fJHtEYXRlLm5vdygpfSR7REVGQVVMVF9FWFR9YCk7XG4gICAgdGhpcy5fcGlkID0gb3B0cy5waWQ7XG4gICAgdGhpcy5fdWRpZCA9IHVkaWQ7XG4gICAgdGhpcy5fbG9nZ2VyID0gbG9nZ2VyLmdldExvZ2dlcihcbiAgICAgIGAke18udHJ1bmNhdGUodGhpcy5fcHJvZmlsZU5hbWUsIHtsZW5ndGg6IDEwfSl9QCR7dGhpcy5fdWRpZC5zdWJzdHJpbmcoMCwgOCl9YCk7XG4gICAgdGhpcy5fYXJjaGl2ZVByb21pc2UgPSBudWxsO1xuICB9XG5cbiAgZ2V0IHByb2ZpbGVOYW1lICgpIHtcbiAgICByZXR1cm4gdGhpcy5fcHJvZmlsZU5hbWU7XG4gIH1cblxuICBhc3luYyBnZXRPcmlnaW5hbFJlcG9ydFBhdGggKCkge1xuICAgIHJldHVybiAoYXdhaXQgZnMuZXhpc3RzKHRoaXMuX3JlcG9ydFBhdGgpKSA/IHRoaXMuX3JlcG9ydFBhdGggOiAnJztcbiAgfVxuXG4gIGFzeW5jIGdldFppcHBlZFJlcG9ydFBhdGggKCkge1xuICAgIC8vIFRoaXMgaXMgdG8gcHJldmVudCBwb3NzaWJsZSByYWNlIGNvbmRpdGlvbnMsIGJlY2F1c2UgdGhlIGFyY2hpdmUgb3BlcmF0aW9uXG4gICAgLy8gY291bGQgYmUgcHJldHR5IHRpbWUtaW50ZW5zaXZlXG4gICAgaWYgKCF0aGlzLl9hcmNoaXZlUHJvbWlzZSkge1xuICAgICAgdGhpcy5fYXJjaGl2ZVByb21pc2UgPSAoYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBvcmlnaW5hbFJlcG9ydFBhdGggPSBhd2FpdCB0aGlzLmdldE9yaWdpbmFsUmVwb3J0UGF0aCgpO1xuICAgICAgICBpZiAoIW9yaWdpbmFsUmVwb3J0UGF0aCkge1xuICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB6aXBwZWRSZXBvcnRQYXRoID0gYXdhaXQgdGVtcERpci5wYXRoKHtcbiAgICAgICAgICBwcmVmaXg6IHBhdGgucGFyc2Uob3JpZ2luYWxSZXBvcnRQYXRoKS5uYW1lLFxuICAgICAgICAgIHN1ZmZpeDogJy56aXAnXG4gICAgICAgIH0pO1xuICAgICAgICBhd2FpdCB6aXAudG9BcmNoaXZlKHppcHBlZFJlcG9ydFBhdGgsIHtcbiAgICAgICAgICBjd2Q6IHBhdGguZGlybmFtZSh0aGlzLl9yZXBvcnRQYXRoKSxcbiAgICAgICAgfSk7XG4gICAgICAgIGF3YWl0IGZzLnJpbXJhZihwYXRoLmRpcm5hbWUodGhpcy5fcmVwb3J0UGF0aCkpO1xuICAgICAgICB0aGlzLl96aXBwZWRSZXBvcnRQYXRoID0gemlwcGVkUmVwb3J0UGF0aDtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ppcHBlZFJlcG9ydFBhdGg7XG4gICAgICB9KSgpO1xuICAgIH1cbiAgICByZXR1cm4gYXdhaXQgdGhpcy5fYXJjaGl2ZVByb21pc2U7XG4gIH1cblxuICBpc1J1bm5pbmcgKCkge1xuICAgIHJldHVybiAhISh0aGlzLl9wcm9jZXNzPy5pc1J1bm5pbmcpO1xuICB9XG5cbiAgYXN5bmMgX2VuZm9yY2VUZXJtaW5hdGlvbiAoKSB7XG4gICAgaWYgKHRoaXMuX3Byb2Nlc3MgJiYgdGhpcy5pc1J1bm5pbmcoKSkge1xuICAgICAgdGhpcy5fbG9nZ2VyLmRlYnVnKCdGb3JjZS1zdG9wcGluZyB0aGUgY3VycmVudGx5IHJ1bm5pbmcgcGVyZiByZWNvcmRpbmcnKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMuX3Byb2Nlc3Muc3RvcCgnU0lHS0lMTCcpO1xuICAgICAgfSBjYXRjaCAoaWduKSB7fVxuICAgIH1cbiAgICB0aGlzLl9wcm9jZXNzID0gbnVsbDtcbiAgICBjb25zdCBwZXJmb3JtQ2xlYW51cCA9IGFzeW5jICgpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IEIuYWxsKFt0aGlzLl96aXBwZWRSZXBvcnRQYXRoLCBwYXRoLmRpcm5hbWUodGhpcy5fcmVwb3J0UGF0aCldXG4gICAgICAgICAgLmZpbHRlcihCb29sZWFuKS5tYXAoKHgpID0+IGZzLnJpbXJhZih4KSkpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB0aGlzLl9sb2dnZXIud2FybihlLm1lc3NhZ2UpO1xuICAgICAgfVxuICAgIH07XG4gICAgaWYgKHRoaXMuX2FyY2hpdmVQcm9taXNlKSB7XG4gICAgICB0aGlzLl9hcmNoaXZlUHJvbWlzZVxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJvbWlzZS9wcmVmZXItYXdhaXQtdG8tdGhlblxuICAgICAgICAuZmluYWxseShhc3luYyAoKSA9PiB7XG4gICAgICAgICAgYXdhaXQgcGVyZm9ybUNsZWFudXAoKTtcbiAgICAgICAgICB0aGlzLl9hcmNoaXZlUHJvbWlzZSA9IG51bGw7XG4gICAgICAgIH0pXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcm9taXNlL3ByZWZlci1hd2FpdC10by10aGVuXG4gICAgICAgIC5jYXRjaCgoKSA9PiB7fSk7XG4gICAgfVxuICAgIGF3YWl0IHBlcmZvcm1DbGVhbnVwKCk7XG4gICAgcmV0dXJuICcnO1xuICB9XG5cbiAgYXN5bmMgc3RhcnQgKCkge1xuICAgIGxldCBiaW5hcnlQYXRoO1xuICAgIHRyeSB7XG4gICAgICBiaW5hcnlQYXRoID0gYXdhaXQgcmVxdWlyZVhjdHJhY2UoKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aGlzLl9sb2dnZXIuZGVidWcoZS5tZXNzYWdlKTtcbiAgICAgIHRoaXMuX2xvZ2dlci53YXJuKGBEZWZhdWx0aW5nIHRvICR7SU5TVFJVTUVOVFN9IHVzYWdlYCk7XG4gICAgICBiaW5hcnlQYXRoID0gYXdhaXQgcmVxdWlyZUluc3RydW1lbnRzKCk7XG4gICAgfVxuXG4gICAgY29uc3QgYXJncyA9IFtdO1xuICAgIGNvbnN0IHRvb2xOYW1lID0gcGF0aC5iYXNlbmFtZShiaW5hcnlQYXRoKSA9PT0gWENSVU4gPyBYQ1RSQUNFIDogSU5TVFJVTUVOVFM7XG4gICAgaWYgKHRvb2xOYW1lID09PSBYQ1RSQUNFKSB7XG4gICAgICBhcmdzLnB1c2goXG4gICAgICAgIFhDVFJBQ0UsICdyZWNvcmQnLFxuICAgICAgICAnLS1kZXZpY2UnLCB0aGlzLl91ZGlkLFxuICAgICAgICAnLS10ZW1wbGF0ZScsIHRoaXMuX3Byb2ZpbGVOYW1lLFxuICAgICAgICAnLS1vdXRwdXQnLCB0aGlzLl9yZXBvcnRQYXRoLFxuICAgICAgICAnLS10aW1lLWxpbWl0JywgYCR7dGhpcy5fdGltZW91dH1tc2AsXG4gICAgICApO1xuICAgICAgaWYgKHRoaXMuX3BpZCkge1xuICAgICAgICBhcmdzLnB1c2goJy0tYXR0YWNoJywgYCR7dGhpcy5fcGlkfWApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXJncy5wdXNoKCctLWFsbC1wcm9jZXNzZXMnKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gaHR0cHM6Ly9oZWxwLmFwcGxlLmNvbS9pbnN0cnVtZW50cy9tYWMvY3VycmVudC8jL2RldmIxNGZmYWE1XG4gICAgICBhcmdzLnB1c2goXG4gICAgICAgICctdycsIHRoaXMuX3VkaWQsXG4gICAgICAgICctdCcsIHRoaXMuX3Byb2ZpbGVOYW1lLFxuICAgICAgICAnLUQnLCB0aGlzLl9yZXBvcnRQYXRoLFxuICAgICAgICAnLWwnLCBgJHt0aGlzLl90aW1lb3V0fWAsXG4gICAgICApO1xuICAgICAgaWYgKHRoaXMuX3BpZCkge1xuICAgICAgICBhcmdzLnB1c2goJy1wJywgYCR7dGhpcy5fcGlkfWApO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBmdWxsQ21kID0gW2JpbmFyeVBhdGgsIC4uLmFyZ3NdO1xuICAgIHRoaXMuX3Byb2Nlc3MgPSBuZXcgU3ViUHJvY2VzcyhmdWxsQ21kWzBdLCBmdWxsQ21kLnNsaWNlKDEpKTtcbiAgICB0aGlzLl9hcmNoaXZlUHJvbWlzZSA9IG51bGw7XG4gICAgdGhpcy5fbG9nZ2VyLmRlYnVnKGBTdGFydGluZyBwZXJmb3JtYW5jZSByZWNvcmRpbmc6ICR7dXRpbC5xdW90ZShmdWxsQ21kKX1gKTtcbiAgICB0aGlzLl9wcm9jZXNzLm9uKCdvdXRwdXQnLCAoc3Rkb3V0LCBzdGRlcnIpID0+IHtcbiAgICAgIGlmIChfLnRyaW0oc3Rkb3V0IHx8IHN0ZGVycikpIHtcbiAgICAgICAgdGhpcy5fbG9nZ2VyLmRlYnVnKGBbJHt0b29sTmFtZX1dICR7c3Rkb3V0IHx8IHN0ZGVycn1gKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLl9wcm9jZXNzLm9uY2UoJ2V4aXQnLCBhc3luYyAoY29kZSwgc2lnbmFsKSA9PiB7XG4gICAgICB0aGlzLl9wcm9jZXNzID0gbnVsbDtcbiAgICAgIGlmIChjb2RlID09PSAwKSB7XG4gICAgICAgIHRoaXMuX2xvZ2dlci5kZWJ1ZygnUGVyZm9ybWFuY2UgcmVjb3JkaW5nIGV4aXRlZCB3aXRob3V0IGVycm9ycycpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIC8vIGNhY2hlIHppcHBlZCByZXBvcnRcbiAgICAgICAgICBhd2FpdCB0aGlzLmdldFppcHBlZFJlcG9ydFBhdGgoKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIHRoaXMuX2xvZ2dlci53YXJuKGUpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhd2FpdCB0aGlzLl9lbmZvcmNlVGVybWluYXRpb24oKTtcbiAgICAgICAgdGhpcy5fbG9nZ2VyLndhcm4oYFBlcmZvcm1hbmNlIHJlY29yZGluZyBleGl0ZWQgd2l0aCBlcnJvciBjb2RlICR7Y29kZX0sIHNpZ25hbCAke3NpZ25hbH1gKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBhd2FpdCB0aGlzLl9wcm9jZXNzLnN0YXJ0KDApO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB3YWl0Rm9yQ29uZGl0aW9uKGFzeW5jICgpID0+IHtcbiAgICAgICAgaWYgKGF3YWl0IHRoaXMuZ2V0T3JpZ2luYWxSZXBvcnRQYXRoKCkpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuX3Byb2Nlc3MpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7dG9vbE5hbWV9IHByb2Nlc3MgZGllZCB1bmV4cGVjdGVkbHlgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9LCB7XG4gICAgICAgIHdhaXRNczogU1RBUlRVUF9USU1FT1VUX01TLFxuICAgICAgICBpbnRlcnZhbE1zOiA1MDAsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBhd2FpdCB0aGlzLl9lbmZvcmNlVGVybWluYXRpb24oKTtcbiAgICAgIGNvbnN0IGxpc3RQcm9maWxlc0NvbW1hbmQgPSB0b29sTmFtZSA9PT0gWENUUkFDRVxuICAgICAgICA/IGAke1hDUlVOfSAke1hDVFJBQ0V9IGxpc3QgdGVtcGxhdGVzYFxuICAgICAgICA6IGAke0lOU1RSVU1FTlRTfSAtc2A7XG4gICAgICB0aGlzLl9sb2dnZXIuZXJyb3JBbmRUaHJvdyhgVGhlcmUgaXMgbm8gJHtERUZBVUxUX0VYVH0gZmlsZSBmb3VuZCBmb3IgcGVyZm9ybWFuY2UgcHJvZmlsZSBgICtcbiAgICAgICAgYCcke3RoaXMuX3Byb2ZpbGVOYW1lfScuIE1ha2Ugc3VyZSB0aGUgcHJvZmlsZSBpcyBzdXBwb3J0ZWQgb24gdGhpcyBkZXZpY2UuIGAgK1xuICAgICAgICBgWW91IGNvdWxkIHVzZSAnJHtsaXN0UHJvZmlsZXNDb21tYW5kfScgY29tbWFuZCB0byBzZWUgdGhlIGxpc3Qgb2YgYWxsIGF2YWlsYWJsZSBwcm9maWxlcy4gYCArXG4gICAgICAgIGBDaGVjayB0aGUgc2VydmVyIGxvZyBmb3IgbW9yZSBkZXRhaWxzYCk7XG4gICAgfVxuICAgIHRoaXMuX2xvZ2dlci5pbmZvKGBUaGUgcGVyZm9ybWFuY2UgcmVjb3JkaW5nIGhhcyBzdGFydGVkLiBXaWxsIHRpbWVvdXQgaW4gJHt0aGlzLl90aW1lb3V0fW1zYCk7XG4gIH1cblxuICBhc3luYyBzdG9wIChmb3JjZSA9IGZhbHNlKSB7XG4gICAgaWYgKGZvcmNlKSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5fZW5mb3JjZVRlcm1pbmF0aW9uKCk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLmlzUnVubmluZygpKSB7XG4gICAgICB0aGlzLl9sb2dnZXIuZGVidWcoJ1BlcmZvcm1hbmNlIHJlY29yZGluZyBpcyBub3QgcnVubmluZy4gUmV0dXJuaW5nIHRoZSByZWNlbnQgcmVzdWx0Jyk7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZXRaaXBwZWRSZXBvcnRQYXRoKCk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuX3Byb2Nlc3Muc3RvcCgnU0lHSU5UJywgU1RPUF9USU1FT1VUX01TKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aGlzLl9sb2dnZXIuZXJyb3JBbmRUaHJvdyhgUGVyZm9ybWFuY2UgcmVjb3JkaW5nIGhhcyBmYWlsZWQgdG8gZXhpdCBhZnRlciAke1NUT1BfVElNRU9VVF9NU31tc2ApO1xuICAgIH1cbiAgICByZXR1cm4gYXdhaXQgdGhpcy5nZXRaaXBwZWRSZXBvcnRQYXRoKCk7XG4gIH1cbn1cblxuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFN0YXJ0UGVyZlJlY29yZE9wdGlvbnNcbiAqXG4gKiBAcHJvcGVydHkgez9udW1iZXJ8c3RyaW5nfSB0aW1lb3V0IFszMDAwMDBdIC0gVGhlIG1heGltdW0gY291bnQgb2YgbWlsbGlzZWNvbmRzIHRvIHJlY29yZCB0aGUgcHJvZmlsaW5nIGluZm9ybWF0aW9uLlxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBwcm9maWxlTmFtZSBbQWN0aXZpdHkgTW9uaXRvcl0gLSBUaGUgbmFtZSBvZiBleGlzdGluZyBwZXJmb3JtYW5jZSBwcm9maWxlIHRvIGFwcGx5LlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYW4gYWxzbyBjb250YWluIHRoZSBmdWxsIHBhdGggdG8gdGhlIGNob3NlbiB0ZW1wbGF0ZSBvbiB0aGUgc2VydmVyIGZpbGUgc3lzdGVtLlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOb3RlLCB0aGF0IG5vdCBhbGwgcHJvZmlsZXMgYXJlIHN1cHBvcnRlZCBvbiBtb2JpbGUgZGV2aWNlcy5cbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ3xudW1iZXJ9IHBpZCAtIFRoZSBJRCBvZiB0aGUgcHJvY2VzcyB0byBtZWFzdXJlIHRoZSBwZXJmb3JtYW5jZSBmb3IuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZXQgaXQgdG8gYGN1cnJlbnRgIGluIG9yZGVyIHRvIG1lYXN1cmUgdGhlIHBlcmZvcm1hbmNlIG9mXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgcHJvY2Vzcywgd2hpY2ggYmVsb25ncyB0byB0aGUgY3VycmVudGx5IGFjdGl2ZSBhcHBsaWNhdGlvbi5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFsbCBwcm9jZXNzZXMgcnVubmluZyBvbiB0aGUgZGV2aWNlIGFyZSBtZWFzdXJlZCBpZlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGlkIGlzIHVuc2V0ICh0aGUgZGVmYXVsdCBzZXR0aW5nKS5cbiAqL1xuXG4vKipcbiAqIFN0YXJ0cyBwZXJmb3JtYW5jZSBwcm9maWxpbmcgZm9yIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqIFJlbGF4aW5nIHNlY3VyaXR5IGlzIG1hbmRhdG9yeSBmb3Igc2ltdWxhdG9ycy4gSXQgY2FuIGFsd2F5cyB3b3JrIGZvciByZWFsIGRldmljZXMuXG4gKlxuICogU2luY2UgWENvZGUgMTQgdGhlIG1ldGhvZCB0cmllcyB0byB1c2UgYHhjdHJhY2VgIHRvb2wgdG8gcmVjb3JkIHBlcmZvcm1hbmNlIHN0YXRzLlxuICogVGhlIGBpbnN0cnVtZW50c2AgZGV2ZWxvcGVyIHV0aWxpdHkgaXMgdXNlZCBhcyBhIGZhbGxiYWNrIGZvciB0aGlzIHB1cnBvc2UgaWYgYHhjdHJhY2VgXG4gKiBpcyBub3QgYXZhaWxhYmxlLlxuICogSXQgaXMgcG9zc2libGUgdG8gcmVjb3JkIG11bHRpcGxlIHByb2ZpbGVzIGF0IHRoZSBzYW1lIHRpbWUuXG4gKiBSZWFkIGh0dHBzOi8vZGV2ZWxvcGVyLmFwcGxlLmNvbS9saWJyYXJ5L2NvbnRlbnQvZG9jdW1lbnRhdGlvbi9EZXZlbG9wZXJUb29scy9Db25jZXB0dWFsL0luc3RydW1lbnRzVXNlckd1aWRlL1JlY29yZGluZyxQYXVzaW5nLGFuZFN0b3BwaW5nVHJhY2VzLmh0bWxcbiAqIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogQHBhcmFtIHs/U3RhcnRQZXJmUmVjb3JkT3B0aW9uc30gb3B0cyAtIFRoZSBzZXQgb2YgcG9zc2libGUgc3RhcnQgcmVjb3JkIG9wdGlvbnNcbiAqL1xuY29tbWFuZHMubW9iaWxlU3RhcnRQZXJmUmVjb3JkID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlU3RhcnRQZXJmUmVjb3JkIChvcHRzID0ge30pIHtcbiAgaWYgKCF0aGlzLmlzRmVhdHVyZUVuYWJsZWQoUEVSRl9SRUNPUkRfRkVBVF9OQU1FKSAmJiAhdGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgIHRoaXMubG9nLmVycm9yQW5kVGhyb3coUEVSRl9SRUNPUkRfU0VDVVJJVFlfTUVTU0FHRSk7XG4gIH1cblxuICBjb25zdCB7XG4gICAgdGltZW91dCA9IERFRkFVTFRfVElNRU9VVF9NUyxcbiAgICBwcm9maWxlTmFtZSA9IERFRkFVTFRfUFJPRklMRV9OQU1FLFxuICAgIHBpZCxcbiAgfSA9IG9wdHM7XG5cbiAgaWYgKCFfLmlzRW1wdHkodGhpcy5fcGVyZlJlY29yZGVycykpIHtcbiAgICBmb3IgKGNvbnN0IHJlY29yZGVyIG9mIHRoaXMuX3BlcmZSZWNvcmRlcnMuZmlsdGVyKCh4KSA9PiB4LnByb2ZpbGVOYW1lID09PSBwcm9maWxlTmFtZSkpIHtcbiAgICAgIGlmIChyZWNvcmRlci5pc1J1bm5pbmcoKSkge1xuICAgICAgICB0aGlzLmxvZy5kZWJ1ZyhgUGVyZm9ybWFuY2UgcmVjb3JkZXIgZm9yICcke3Byb2ZpbGVOYW1lfScgb24gZGV2aWNlICcke3RoaXMub3B0cy5kZXZpY2UudWRpZH0nIGAgK1xuICAgICAgICAgIGAgaXMgYWxyZWFkeSBydW5uaW5nLiBEb2luZyBub3RoaW5nYCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIF8ucHVsbCh0aGlzLl9wZXJmUmVjb3JkZXJzLCByZWNvcmRlcik7XG4gICAgICBhd2FpdCByZWNvcmRlci5zdG9wKHRydWUpO1xuICAgIH1cbiAgfVxuXG4gIGxldCByZWFsUGlkO1xuICBpZiAocGlkKSB7XG4gICAgaWYgKF8udG9Mb3dlcihwaWQpID09PSBERUZBVUxUX1BJRCkge1xuICAgICAgY29uc3QgYXBwSW5mbyA9IGF3YWl0IHRoaXMucHJveHlDb21tYW5kKCcvd2RhL2FjdGl2ZUFwcEluZm8nLCAnR0VUJyk7XG4gICAgICByZWFsUGlkID0gYXBwSW5mby5waWQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlYWxQaWQgPSBwaWQ7XG4gICAgfVxuICB9XG4gIGNvbnN0IHJlY29yZGVyID0gbmV3IFBlcmZSZWNvcmRlcihhd2FpdCB0ZW1wRGlyLm9wZW5EaXIoKSwgdGhpcy5vcHRzLmRldmljZS51ZGlkLCB7XG4gICAgdGltZW91dDogcGFyc2VJbnQodGltZW91dCwgMTApLFxuICAgIHByb2ZpbGVOYW1lLFxuICAgIHBpZDogcGFyc2VJbnQocmVhbFBpZCwgMTApLFxuICB9KTtcbiAgYXdhaXQgcmVjb3JkZXIuc3RhcnQoKTtcbiAgdGhpcy5fcGVyZlJlY29yZGVycyA9IFsuLi4odGhpcy5fcGVyZlJlY29yZGVycyB8fCBbXSksIHJlY29yZGVyXTtcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gU3RvcFJlY29yZGluZ09wdGlvbnNcbiAqXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHJlbW90ZVBhdGggLSBUaGUgcGF0aCB0byB0aGUgcmVtb3RlIGxvY2F0aW9uLCB3aGVyZSB0aGUgcmVzdWx0aW5nIHppcHBlZCAudHJhY2UgZmlsZSBzaG91bGQgYmUgdXBsb2FkZWQuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaGUgZm9sbG93aW5nIHByb3RvY29scyBhcmUgc3VwcG9ydGVkOiBodHRwL2h0dHBzLCBmdHAuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOdWxsIG9yIGVtcHR5IHN0cmluZyB2YWx1ZSAodGhlIGRlZmF1bHQgc2V0dGluZykgbWVhbnMgdGhlIGNvbnRlbnQgb2YgcmVzdWx0aW5nXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlIHNob3VsZCBiZSB6aXBwZWQsIGVuY29kZWQgYXMgQmFzZTY0IGFuZCBwYXNzZWQgYXMgdGhlIGVuZHBvaW50IHJlc3BvbnNlIHZhbHVlLlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQW4gZXhjZXB0aW9uIHdpbGwgYmUgdGhyb3duIGlmIHRoZSBnZW5lcmF0ZWQgZmlsZSBpcyB0b28gYmlnIHRvXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXQgaW50byB0aGUgYXZhaWxhYmxlIHByb2Nlc3MgbWVtb3J5LlxuICogQHByb3BlcnR5IHs/c3RyaW5nfSB1c2VyIC0gVGhlIG5hbWUgb2YgdGhlIHVzZXIgZm9yIHRoZSByZW1vdGUgYXV0aGVudGljYXRpb24uIE9ubHkgd29ya3MgaWYgYHJlbW90ZVBhdGhgIGlzIHByb3ZpZGVkLlxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBwYXNzIC0gVGhlIHBhc3N3b3JkIGZvciB0aGUgcmVtb3RlIGF1dGhlbnRpY2F0aW9uLiBPbmx5IHdvcmtzIGlmIGByZW1vdGVQYXRoYCBpcyBwcm92aWRlZC5cbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gbWV0aG9kIFtQVVRdIC0gVGhlIGh0dHAgbXVsdGlwYXJ0IHVwbG9hZCBtZXRob2QgbmFtZS4gT25seSB3b3JrcyBpZiBgcmVtb3RlUGF0aGAgaXMgcHJvdmlkZWQuXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHByb2ZpbGVOYW1lIFtBY3Rpdml0eSBNb25pdG9yXSAtIFRoZSBuYW1lIG9mIGFuIGV4aXN0aW5nIHBlcmZvcm1hbmNlIHByb2ZpbGUgZm9yIHdoaWNoIHRoZSByZWNvcmRpbmcgaGFzIGJlZW4gbWFkZS5cbiAqIEBwcm9wZXJ0eSB7P09iamVjdH0gaGVhZGVycyAtIEFkZGl0aW9uYWwgaGVhZGVycyBtYXBwaW5nIGZvciBtdWx0aXBhcnQgaHR0cChzKSB1cGxvYWRzXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IGZpbGVGaWVsZE5hbWUgW2ZpbGVdIC0gVGhlIG5hbWUgb2YgdGhlIGZvcm0gZmllbGQsIHdoZXJlIHRoZSBmaWxlIGNvbnRlbnQgQkxPQiBzaG91bGQgYmUgc3RvcmVkIGZvclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh0dHAocykgdXBsb2Fkc1xuICogQHByb3BlcnR5IHs/T2JqZWN0fEFycmF5PFBhaXI+fSBmb3JtRmllbGRzIC0gQWRkaXRpb25hbCBmb3JtIGZpZWxkcyBmb3IgbXVsdGlwYXJ0IGh0dHAocykgdXBsb2Fkc1xuICovXG5cbi8qKlxuICogU3RvcHMgcGVyZm9ybWFuY2UgcHJvZmlsaW5nIGZvciB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKiBUaGUgcmVzdWx0aW5nIGZpbGUgaW4gLnRyYWNlIGZvcm1hdCBjYW4gYmUgZWl0aGVyIHJldHVybmVkXG4gKiBkaXJlY3RseSBhcyBiYXNlNjQtZW5jb2RlZCB6aXAgYXJjaGl2ZSBvciB1cGxvYWRlZCB0byBhIHJlbW90ZSBsb2NhdGlvblxuICogKHN1Y2ggZmlsZXMgY2FuIGJlIHByZXR0eSBsYXJnZSkuIEFmdGVyd2FyZHMgaXQgaXMgcG9zc2libGUgdG8gdW5hcmNoaXZlIGFuZFxuICogb3BlbiBzdWNoIGZpbGUgd2l0aCBYY29kZSBEZXYgVG9vbHMuXG4gKlxuICogQHBhcmFtIHs/U3RvcFJlY29yZGluZ09wdGlvbnN9IG9wdHMgLSBUaGUgc2V0IG9mIHBvc3NpYmxlIHN0b3AgcmVjb3JkIG9wdGlvbnNcbiAqIEByZXR1cm4ge3N0cmluZ30gRWl0aGVyIGFuIGVtcHR5IHN0cmluZyBpZiB0aGUgdXBsb2FkIHdhcyBzdWNjZXNzZnVsIG9yIGJhc2UtNjQgZW5jb2RlZFxuICogY29udGVudCBvZiB6aXBwZWQgLnRyYWNlIGZpbGUuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgbm8gcGVyZm9ybWFuY2UgcmVjb3JkaW5nIHdpdGggZ2l2ZW4gcHJvZmlsZSBuYW1lL2RldmljZSB1ZGlkIGNvbWJpbmF0aW9uXG4gKiBoYXMgYmVlbiBzdGFydGVkIGJlZm9yZSBvciB0aGUgcmVzdWx0aW5nIC50cmFjZSBmaWxlIGhhcyBub3QgYmVlbiBnZW5lcmF0ZWQgcHJvcGVybHkuXG4gKi9cbmNvbW1hbmRzLm1vYmlsZVN0b3BQZXJmUmVjb3JkID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlU3RvcFBlcmZSZWNvcmQgKG9wdHMgPSB7fSkge1xuICBpZiAoIXRoaXMuaXNGZWF0dXJlRW5hYmxlZChQRVJGX1JFQ09SRF9GRUFUX05BTUUpICYmICF0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgdGhpcy5sb2cuZXJyb3JBbmRUaHJvdyhQRVJGX1JFQ09SRF9TRUNVUklUWV9NRVNTQUdFKTtcbiAgfVxuXG4gIGlmIChfLmlzRW1wdHkodGhpcy5fcGVyZlJlY29yZGVycykpIHtcbiAgICB0aGlzLmxvZy5pbmZvKCdObyBwZXJmb3JtYW5jZSByZWNvcmRlcnMgaGF2ZSBiZWVuIHN0YXJ0ZWQuIERvaW5nIG5vdGhpbmcnKTtcbiAgICByZXR1cm4gJyc7XG4gIH1cblxuICBjb25zdCB7XG4gICAgcHJvZmlsZU5hbWUgPSBERUZBVUxUX1BST0ZJTEVfTkFNRSxcbiAgICByZW1vdGVQYXRoLFxuICB9ID0gb3B0cztcblxuICBjb25zdCByZWNvcmRlcnMgPSB0aGlzLl9wZXJmUmVjb3JkZXJzLmZpbHRlcigoeCkgPT4geC5wcm9maWxlTmFtZSA9PT0gcHJvZmlsZU5hbWUpO1xuICBpZiAoXy5pc0VtcHR5KHJlY29yZGVycykpIHtcbiAgICB0aGlzLmxvZy5lcnJvckFuZFRocm93KGBUaGVyZSBhcmUgbm8gcmVjb3JkcyBmb3IgcGVyZm9ybWFuY2UgcHJvZmlsZSAnJHtwcm9maWxlTmFtZX0nIGAgK1xuICAgICAgYGFuZCBkZXZpY2UgJHt0aGlzLm9wdHMuZGV2aWNlLnVkaWR9LiBIYXZlIHlvdSBzdGFydGVkIHRoZSBwcm9maWxpbmcgYmVmb3JlP2ApO1xuICB9XG5cbiAgY29uc3QgcmVjb3JkZXIgPSBfLmZpcnN0KHJlY29yZGVycyk7XG4gIGNvbnN0IHJlc3VsdFBhdGggPSBhd2FpdCByZWNvcmRlci5zdG9wKCk7XG4gIGlmICghYXdhaXQgZnMuZXhpc3RzKHJlc3VsdFBhdGgpKSB7XG4gICAgdGhpcy5sb2cuZXJyb3JBbmRUaHJvdyhgVGhlcmUgaXMgbm8gJHtERUZBVUxUX0VYVH0gZmlsZSBmb3VuZCBmb3IgcGVyZm9ybWFuY2UgcHJvZmlsZSAnJHtwcm9maWxlTmFtZX0nIGAgK1xuICAgICAgYGFuZCBkZXZpY2UgJHt0aGlzLm9wdHMuZGV2aWNlLnVkaWR9LiBNYWtlIHN1cmUgdGhlIHNlbGVjdGVkIHByb2ZpbGUgaXMgc3VwcG9ydGVkIG9uIHRoaXMgZGV2aWNlYCk7XG4gIH1cblxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBlbmNvZGVCYXNlNjRPclVwbG9hZChyZXN1bHRQYXRoLCByZW1vdGVQYXRoLCBvcHRzKTtcbiAgXy5wdWxsKHRoaXMuX3BlcmZSZWNvcmRlcnMsIHJlY29yZGVyKTtcbiAgYXdhaXQgZnMucmltcmFmKHJlc3VsdFBhdGgpO1xuICByZXR1cm4gcmVzdWx0O1xufTtcblxuXG5leHBvcnQgeyBjb21tYW5kcyB9O1xuZXhwb3J0IGRlZmF1bHQgY29tbWFuZHM7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQSxNQUFNQSxRQUFRLEdBQUcsQ0FBQyxDQUFDO0FBQUM7QUFFcEIsTUFBTUMscUJBQXFCLEdBQUcsYUFBYTtBQUMzQyxNQUFNQyw0QkFBNEIsR0FBRyxvRUFBb0UsR0FDdEcsK0RBQThERCxxQkFBc0IsSUFBRyxHQUN4Rix1SEFBdUg7QUFDekgsTUFBTUUsa0JBQWtCLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxJQUFJO0FBQ3hDLE1BQU1DLGVBQWUsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLElBQUk7QUFDckMsTUFBTUMsa0JBQWtCLEdBQUcsRUFBRSxHQUFHLElBQUk7QUFDcEMsTUFBTUMsb0JBQW9CLEdBQUcsa0JBQWtCO0FBQy9DLE1BQU1DLFdBQVcsR0FBRyxRQUFRO0FBQzVCLE1BQU1DLFdBQVcsR0FBRyxTQUFTO0FBQzdCLE1BQU1DLFdBQVcsR0FBRyxhQUFhO0FBQ2pDLE1BQU1DLEtBQUssR0FBRyxPQUFPO0FBQ3JCLE1BQU1DLE9BQU8sR0FBRyxTQUFTO0FBR3pCLGVBQWVDLGNBQWMsR0FBSTtFQUMvQixJQUFJQyxTQUFTO0VBQ2IsSUFBSTtJQUNGQSxTQUFTLEdBQUcsTUFBTUMsV0FBRSxDQUFDQyxLQUFLLENBQUNMLEtBQUssQ0FBQztFQUNuQyxDQUFDLENBQUMsT0FBT00sQ0FBQyxFQUFFO0lBQ1YsTUFBTSxJQUFJQyxLQUFLLENBQUUsR0FBRVAsS0FBTSwrQkFBOEIsR0FDcEQsd0RBQXVELENBQUM7RUFDN0Q7RUFDQSxJQUFJO0lBQ0YsTUFBTSxJQUFBUSxrQkFBSSxFQUFDTCxTQUFTLEVBQUUsQ0FBQ0YsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0VBQzFDLENBQUMsQ0FBQyxPQUFPSyxDQUFD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