"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.commands = void 0;
require("source-map-support/register");
var _support = require("appium/support");
var _teen_process = require("teen_process");
var _utils = require("../utils");
var _asyncbox = require("asyncbox");
const commands = {};
exports.commands = commands;
const AUDIO_RECORD_FEAT_NAME = 'audio_record';
const MAX_RECORDING_TIME_SEC = 60 * 60 * 12;
const DEFAULT_RECORDING_TIME_SEC = 60 * 3;
const PROCESS_STARTUP_TIMEOUT_MS = 5000;
const DEFAULT_SOURCE = 'avfoundation';
const DEFAULT_BITRATE = '128k';
const DEFAULT_CODEC = 'aac';
const DEFAULT_CHANNELS = 2;
const DEFAULT_RATE = 44100;
const DEFAULT_EXT = '.mp4';
const FFMPEG_BINARY = 'ffmpeg';
const ffmpegLogger = _support.logger.getLogger(FFMPEG_BINARY);
class AudioRecorder {
  constructor(input, log, audioPath, opts = {}) {
    this.input = input;
    this.log = log;
    this.audioPath = audioPath;
    this.opts = opts;
    this.mainProcess = null;
  }
  async start(timeoutSeconds) {
    try {
      await _support.fs.which(FFMPEG_BINARY);
    } catch (err) {
      throw new Error(`'${FFMPEG_BINARY}' binary is not found in PATH. Install it using 'brew install ffmpeg'. ` + `Check https://www.ffmpeg.org/download.html for more details.`);
    }
    const {
      audioSource = DEFAULT_SOURCE,
      audioCodec,
      audioBitrate,
      audioChannels,
      audioRate
    } = this.opts;
    const args = ['-t', `${timeoutSeconds}`, '-f', audioSource, '-i', this.input, '-c:a', audioCodec, '-b:a', audioBitrate, '-ac', `${audioChannels}`, '-ar', `${audioRate}`, this.audioPath];
    this.mainProcess = new _teen_process.SubProcess(FFMPEG_BINARY, args);
    let isCaptureStarted = false;
    this.mainProcess.on('output', (stdout, stderr) => {
      if (stderr) {
        if (stderr.trim().startsWith('size=')) {
          if (!isCaptureStarted) {
            isCaptureStarted = true;
          }
        } else {
          ffmpegLogger.info(`${stderr}`);
        }
      }
    });
    await this.mainProcess.start(0);
    try {
      await (0, _asyncbox.waitForCondition)(() => isCaptureStarted, {
        waitMs: PROCESS_STARTUP_TIMEOUT_MS,
        intervalMs: 300
      });
    } catch (e) {
      this.log.warn(`Audio recording process did not start within ${PROCESS_STARTUP_TIMEOUT_MS}ms. Continuing anyway`);
    }
    if (!this.mainProcess.isRunning) {
      this.mainProcess = null;
      throw new Error(`The audio recording process '${FFMPEG_BINARY}' died unexpectedly. ` + `Check server logs for more details`);
    }
    this.log.info(`Starting capture on audio input '${this.input}' with command: '${_support.util.quote([FFMPEG_BINARY, ...args])}'. ` + `Will timeout in ${timeoutSeconds}s`);
    this.mainProcess.once('exit', (code, signal) => {
      if ([0, 255].includes(code)) {
        this.log.info(`The recording session on audio input '${this.input}' has been finished`);
      } else {
        this.log.debug(`The recording session on audio input '${this.input}' has exited ` + `with code ${code}, signal ${signal}`);
      }
    });
  }
  isRecording() {
    var _this$mainProcess;
    return !!((_this$mainProcess = this.mainProcess) !== null && _this$mainProcess !== void 0 && _this$mainProcess.isRunning);
  }
  async interrupt(force = false) {
    if (this.isRecording()) {
      const interruptPromise = this.mainProcess.stop(force ? 'SIGTERM' : 'SIGINT');
      this.mainProcess = null;
      try {
        await interruptPromise;
      } catch (e) {
        this.log.warn(`Cannot ${force ? 'terminate' : 'interrupt'} ${FFMPEG_BINARY}. ` + `Original error: ${e.message}`);
        return false;
      }
    }
    return true;
  }
  async finish() {
    await this.interrupt();
    return this.audioPath;
  }
  async cleanup() {
    if (await _support.fs.exists(this.audioPath)) {
      await _support.fs.rimraf(this.audioPath);
    }
  }
}
commands.startAudioRecording = async function startAudioRecording(options = {}) {
  var _this$_audioRecorder;
  if (!this.isFeatureEnabled(AUDIO_RECORD_FEAT_NAME)) {
    this.log.errorAndThrow(`Audio capture feature must be enabled on the server side. ` + `Please set '--relaxed-security' or '--allow-insecure' with '${AUDIO_RECORD_FEAT_NAME}' option. ` + `Read https://github.com/appium/appium/blob/master/docs/en/writing-running-appium/security.md for more details.`);
  }
  const {
    timeLimit = DEFAULT_RECORDING_TIME_SEC,
    audioInput,
    audioSource,
    audioCodec = DEFAULT_CODEC,
    audioBitrate = DEFAULT_BITRATE,
    audioChannels = DEFAULT_CHANNELS,
    audioRate = DEFAULT_RATE,
    forceRestart
  } = options;
  if (!audioInput) {
    this.log.errorAndThrow(`The mandatory audioInput option is not provided. Please set it ` + `to a correct value (e. g. ':1'). Use 'ffmpeg -f avfoundation -list_devices true -i ""' ` + `command to list available input sources`);
  }
  if ((_this$_audioRecorder = this._audioRecorder) !== null && _this$_audioRecorder !== void 0 && _this$_audioRecorder.isRecording()) {
    this.log.info(`There is an active audio recording process`);
    if (forceRestart) {
      this.log.info(`Stopping it because 'forceRestart' option is set to true`);
      await this._audioRecorder.interrupt(true);
    } else {
      this.log.info(`Doing nothing. ` + `Set 'forceRestart' option to true if you'd like to start a new audio recording session`);
      return;
    }
  }
  if (this._audioRecorder) {
    await this._audioRecorder.cleanup();
    this._audioRecorder = null;
  }
  const audioPath = await _support.tempDir.path({
    prefix: `appium_${_support.util.uuidV4().substring(0, 8)}`,
    suffix: DEFAULT_EXT
  });
  const audioRecorder = new AudioRecorder(audioInput, this.log, audioPath, {
    audioSource,
    audioCodec,
    audioBitrate,
    audioChannels,
    audioRate
  });
  const timeoutSeconds = parseInt(timeLimit, 10);
  if (isNaN(timeoutSeconds) || timeoutSeconds > MAX_RECORDING_TIME_SEC || timeoutSeconds <= 0) {
    this.log.errorAndThrow(`The timeLimit value must be in range [1, ${MAX_RECORDING_TIME_SEC}] seconds. ` + `The value of '${timeLimit}' has been passed instead.`);
  }
  try {
    await audioRecorder.start(timeoutSeconds);
  } catch (e) {
    await audioRecorder.interrupt(true);
    await audioRecorder.cleanup();
    throw e;
  }
  this._audioRecorder = audioRecorder;
};
commands.stopAudioRecording = async function stopAudioRecording() {
  if (!this._audioRecorder) {
    this.log.info('Audio recording has not been started. There is nothing to stop');
    return '';
  }
  let resultPath;
  try {
    resultPath = await this._audioRecorder.finish();
    if (!(await _support.fs.exists(resultPath))) {
      this.log.errorAndThrow(`${FFMPEG_BINARY} has failed ` + `to store the actual audio recording at '${resultPath}'`);
    }
  } catch (e) {
    await this._audioRecorder.interrupt(true);
    await this._audioRecorder.cleanup();
    this._audioRecorder = null;
    throw e;
  }
  return await (0, _utils.encodeBase64OrUpload)(resultPath);
};
var _default = commands;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb21tYW5kcyIsIkFVRElPX1JFQ09SRF9GRUFUX05BTUUiLCJNQVhfUkVDT1JESU5HX1RJTUVfU0VDIiwiREVGQVVMVF9SRUNPUkRJTkdfVElNRV9TRUMiLCJQUk9DRVNTX1NUQVJUVVBfVElNRU9VVF9NUyIsIkRFRkFVTFRfU09VUkNFIiwiREVGQVVMVF9CSVRSQVRFIiwiREVGQVVMVF9DT0RFQyIsIkRFRkFVTFRfQ0hBTk5FTFMiLCJERUZBVUxUX1JBVEUiLCJERUZBVUxUX0VYVCIsIkZGTVBFR19CSU5BUlkiLCJmZm1wZWdMb2dnZXIiLCJsb2dnZXIiLCJnZXRMb2dnZXIiLCJBdWRpb1JlY29yZGVyIiwiY29uc3RydWN0b3IiLCJpbnB1dCIsImxvZyIsImF1ZGlvUGF0aCIsIm9wdHMiLCJtYWluUHJvY2VzcyIsInN0YXJ0IiwidGltZW91dFNlY29uZHMiLCJmcyIsIndoaWNoIiwiZXJyIiwiRXJyb3IiLCJhdWRpb1NvdXJjZSIsImF1ZGlvQ29kZWMiLCJhdWRpb0JpdHJhdGUiLCJhdWRpb0NoYW5uZWxzIiwiYXVkaW9SYXRlIiwiYXJncyIsIlN1YlByb2Nlc3MiLCJpc0NhcHR1cmVTdGFydGVkIiwib24iLCJzdGRvdXQiLCJzdGRlcnIiLCJ0cmltIiwic3RhcnRzV2l0aCIsImluZm8iLCJ3YWl0Rm9yQ29uZGl0aW9uIiwid2FpdE1zIiwiaW50ZXJ2YWxNcyIsImUiLCJ3YXJuIiwiaXNSdW5uaW5nIiwidXRpbCIsInF1b3RlIiwib25jZSIsImNvZGUiLCJzaWduYWwiLCJpbmNsdWRlcyIsImRlYnVnIiwiaXNSZWNvcmRpbmciLCJpbnRlcnJ1cHQiLCJmb3JjZSIsImludGVycnVwdFByb21pc2UiLCJzdG9wIiwibWVzc2FnZSIsImZpbmlzaCIsImNsZWFudXAiLCJleGlzdHMiLCJyaW1yYWYiLCJzdGFydEF1ZGlvUmVjb3JkaW5nIiwib3B0aW9ucyIsImlzRmVhdHVyZUVuYWJsZWQiLCJlcnJvckFuZFRocm93IiwidGltZUxpbWl0IiwiYXVkaW9JbnB1dCIsImZvcmNlUmVzdGFydCIsIl9hdWRpb1JlY29yZGVyIiwidGVtcERpciIsInBhdGgiLCJwcmVmaXgiLCJ1dWlkVjQiLCJzdWJzdHJpbmciLCJzdWZmaXgiLCJhdWRpb1JlY29yZGVyIiwicGFyc2VJbnQiLCJpc05hTiIsInN0b3BBdWRpb1JlY29yZGluZyIsInJlc3VsdFBhdGgiLCJlbmNvZGVCYXNlNjRPclVwbG9hZCJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9jb21tYW5kcy9yZWNvcmQtYXVkaW8uanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZnMsIHRlbXBEaXIsIGxvZ2dlciwgdXRpbCB9IGZyb20gJ2FwcGl1bS9zdXBwb3J0JztcbmltcG9ydCB7IFN1YlByb2Nlc3MgfSBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuaW1wb3J0IHsgZW5jb2RlQmFzZTY0T3JVcGxvYWQgfSBmcm9tICcuLi91dGlscyc7XG5pbXBvcnQgeyB3YWl0Rm9yQ29uZGl0aW9uIH0gZnJvbSAnYXN5bmNib3gnO1xuXG5cbmNvbnN0IGNvbW1hbmRzID0ge307XG5cbmNvbnN0IEFVRElPX1JFQ09SRF9GRUFUX05BTUUgPSAnYXVkaW9fcmVjb3JkJztcbmNvbnN0IE1BWF9SRUNPUkRJTkdfVElNRV9TRUMgPSA2MCAqIDYwICogMTI7XG5jb25zdCBERUZBVUxUX1JFQ09SRElOR19USU1FX1NFQyA9IDYwICogMztcbmNvbnN0IFBST0NFU1NfU1RBUlRVUF9USU1FT1VUX01TID0gNTAwMDtcbmNvbnN0IERFRkFVTFRfU09VUkNFID0gJ2F2Zm91bmRhdGlvbic7XG5jb25zdCBERUZBVUxUX0JJVFJBVEUgPSAnMTI4ayc7XG5jb25zdCBERUZBVUxUX0NPREVDID0gJ2FhYyc7XG5jb25zdCBERUZBVUxUX0NIQU5ORUxTID0gMjtcbmNvbnN0IERFRkFVTFRfUkFURSA9IDQ0MTAwO1xuY29uc3QgREVGQVVMVF9FWFQgPSAnLm1wNCc7XG5jb25zdCBGRk1QRUdfQklOQVJZID0gJ2ZmbXBlZyc7XG5jb25zdCBmZm1wZWdMb2dnZXIgPSBsb2dnZXIuZ2V0TG9nZ2VyKEZGTVBFR19CSU5BUlkpO1xuXG5cbmNsYXNzIEF1ZGlvUmVjb3JkZXIge1xuICBjb25zdHJ1Y3RvciAoaW5wdXQsIGxvZywgYXVkaW9QYXRoLCBvcHRzID0ge30pIHtcbiAgICB0aGlzLmlucHV0ID0gaW5wdXQ7XG4gICAgdGhpcy5sb2cgPSBsb2c7XG4gICAgdGhpcy5hdWRpb1BhdGggPSBhdWRpb1BhdGg7XG4gICAgdGhpcy5vcHRzID0gb3B0cztcbiAgICB0aGlzLm1haW5Qcm9jZXNzID0gbnVsbDtcbiAgfVxuXG4gIGFzeW5jIHN0YXJ0ICh0aW1lb3V0U2Vjb25kcykge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBmcy53aGljaChGRk1QRUdfQklOQVJZKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgJyR7RkZNUEVHX0JJTkFSWX0nIGJpbmFyeSBpcyBub3QgZm91bmQgaW4gUEFUSC4gSW5zdGFsbCBpdCB1c2luZyAnYnJldyBpbnN0YWxsIGZmbXBlZycuIGAgK1xuICAgICAgICBgQ2hlY2sgaHR0cHM6Ly93d3cuZmZtcGVnLm9yZy9kb3dubG9hZC5odG1sIGZvciBtb3JlIGRldGFpbHMuYCk7XG4gICAgfVxuXG4gICAgY29uc3Qge1xuICAgICAgYXVkaW9Tb3VyY2UgPSBERUZBVUxUX1NPVVJDRSxcbiAgICAgIGF1ZGlvQ29kZWMsXG4gICAgICBhdWRpb0JpdHJhdGUsXG4gICAgICBhdWRpb0NoYW5uZWxzLFxuICAgICAgYXVkaW9SYXRlLFxuICAgIH0gPSB0aGlzLm9wdHM7XG5cbiAgICBjb25zdCBhcmdzID0gW1xuICAgICAgJy10JywgYCR7dGltZW91dFNlY29uZHN9YCxcbiAgICAgICctZicsIGF1ZGlvU291cmNlLFxuICAgICAgJy1pJywgdGhpcy5pbnB1dCxcbiAgICAgICctYzphJywgYXVkaW9Db2RlYyxcbiAgICAgICctYjphJywgYXVkaW9CaXRyYXRlLFxuICAgICAgJy1hYycsIGAke2F1ZGlvQ2hhbm5lbHN9YCxcbiAgICAgICctYXInLCBgJHthdWRpb1JhdGV9YCxcbiAgICAgIHRoaXMuYXVkaW9QYXRoLFxuICAgIF07XG5cbiAgICB0aGlzLm1haW5Qcm9jZXNzID0gbmV3IFN1YlByb2Nlc3MoRkZNUEVHX0JJTkFSWSwgYXJncyk7XG4gICAgbGV0IGlzQ2FwdHVyZVN0YXJ0ZWQgPSBmYWxzZTtcbiAgICB0aGlzLm1haW5Qcm9jZXNzLm9uKCdvdXRwdXQnLCAoc3Rkb3V0LCBzdGRlcnIpID0+IHtcbiAgICAgIGlmIChzdGRlcnIpIHtcbiAgICAgICAgaWYgKHN0ZGVyci50cmltKCkuc3RhcnRzV2l0aCgnc2l6ZT0nKSkge1xuICAgICAgICAgIGlmICghaXNDYXB0dXJlU3RhcnRlZCkge1xuICAgICAgICAgICAgaXNDYXB0dXJlU3RhcnRlZCA9IHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGZmbXBlZ0xvZ2dlci5pbmZvKGAke3N0ZGVycn1gKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIGF3YWl0IHRoaXMubWFpblByb2Nlc3Muc3RhcnQoMCk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHdhaXRGb3JDb25kaXRpb24oKCkgPT4gaXNDYXB0dXJlU3RhcnRlZCwge1xuICAgICAgICB3YWl0TXM6IFBST0NFU1NfU1RBUlRVUF9USU1FT1VUX01TLFxuICAgICAgICBpbnRlcnZhbE1zOiAzMDAsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aGlzLmxvZy53YXJuKGBBdWRpbyByZWNvcmRpbmcgcHJvY2VzcyBkaWQgbm90IHN0YXJ0IHdpdGhpbiAke1BST0NFU1NfU1RBUlRVUF9USU1FT1VUX01TfW1zLiBDb250aW51aW5nIGFueXdheWApO1xuICAgIH1cbiAgICBpZiAoIXRoaXMubWFpblByb2Nlc3MuaXNSdW5uaW5nKSB7XG4gICAgICB0aGlzLm1haW5Qcm9jZXNzID0gbnVsbDtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGF1ZGlvIHJlY29yZGluZyBwcm9jZXNzICcke0ZGTVBFR19CSU5BUll9JyBkaWVkIHVuZXhwZWN0ZWRseS4gYCArXG4gICAgICAgIGBDaGVjayBzZXJ2ZXIgbG9ncyBmb3IgbW9yZSBkZXRhaWxzYCk7XG4gICAgfVxuICAgIHRoaXMubG9nLmluZm8oYFN0YXJ0aW5nIGNhcHR1cmUgb24gYXVkaW8gaW5wdXQgJyR7dGhpcy5pbnB1dH0nIHdpdGggY29tbWFuZDogJyR7dXRpbC5xdW90ZShbRkZNUEVHX0JJTkFSWSwgLi4uYXJnc10pfScuIGAgK1xuICAgICAgYFdpbGwgdGltZW91dCBpbiAke3RpbWVvdXRTZWNvbmRzfXNgKTtcbiAgICB0aGlzLm1haW5Qcm9jZXNzLm9uY2UoJ2V4aXQnLCAoY29kZSwgc2lnbmFsKSA9PiB7XG4gICAgICAvLyBmZm1wZWcgcmV0dXJucyBjb2RlIDI1NSBpZiBTSUdJTlQgYXJyaXZlc1xuICAgICAgaWYgKFswLCAyNTVdLmluY2x1ZGVzKGNvZGUpKSB7XG4gICAgICAgIHRoaXMubG9nLmluZm8oYFRoZSByZWNvcmRpbmcgc2Vzc2lvbiBvbiBhdWRpbyBpbnB1dCAnJHt0aGlzLmlucHV0fScgaGFzIGJlZW4gZmluaXNoZWRgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubG9nLmRlYnVnKGBUaGUgcmVjb3JkaW5nIHNlc3Npb24gb24gYXVkaW8gaW5wdXQgJyR7dGhpcy5pbnB1dH0nIGhhcyBleGl0ZWQgYCArXG4gICAgICAgICAgYHdpdGggY29kZSAke2NvZGV9LCBzaWduYWwgJHtzaWduYWx9YCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBpc1JlY29yZGluZyAoKSB7XG4gICAgcmV0dXJuICEhKHRoaXMubWFpblByb2Nlc3M/LmlzUnVubmluZyk7XG4gIH1cblxuICBhc3luYyBpbnRlcnJ1cHQgKGZvcmNlID0gZmFsc2UpIHtcbiAgICBpZiAodGhpcy5pc1JlY29yZGluZygpKSB7XG4gICAgICBjb25zdCBpbnRlcnJ1cHRQcm9taXNlID0gdGhpcy5tYWluUHJvY2Vzcy5zdG9wKGZvcmNlID8gJ1NJR1RFUk0nIDogJ1NJR0lOVCcpO1xuICAgICAgdGhpcy5tYWluUHJvY2VzcyA9IG51bGw7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBpbnRlcnJ1cHRQcm9taXNlO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB0aGlzLmxvZy53YXJuKGBDYW5ub3QgJHtmb3JjZSA/ICd0ZXJtaW5hdGUnIDogJ2ludGVycnVwdCd9ICR7RkZNUEVHX0JJTkFSWX0uIGAgK1xuICAgICAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGFzeW5jIGZpbmlzaCAoKSB7XG4gICAgYXdhaXQgdGhpcy5pbnRlcnJ1cHQoKTtcbiAgICByZXR1cm4gdGhpcy5hdWRpb1BhdGg7XG4gIH1cblxuICBhc3luYyBjbGVhbnVwICgpIHtcbiAgICBpZiAoYXdhaXQgZnMuZXhpc3RzKHRoaXMuYXVkaW9QYXRoKSkge1xuICAgICAgYXdhaXQgZnMucmltcmFmKHRoaXMuYXVkaW9QYXRoKTtcbiAgICB9XG4gIH1cbn1cblxuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFN0YXJ0UmVjb3JkaW5nT3B0aW9uc1xuICpcbiAqIEBwcm9wZXJ0eSB7IXN0cmluZ30gYXVkaW9JbnB1dCAtIFRoZSBuYW1lIG9mIHRoZSBjb3JyZXNwb25kaW5nIGF1ZGlvIGlucHV0IGRldmljZSB0byB1c2UgZm9yIHRoZVxuICogY2FwdHVyZS4gVGhlIGZ1bGwgbGlzdCBvZiBjYXB0dXJlIGRldmljZXMgY291bGQgYmUgc2hvd24gdXNpbmcgYGZmbXBlZyAtZiBhdmZvdW5kYXRpb24gLWxpc3RfZGV2aWNlcyB0cnVlIC1pIFwiXCJgXG4gKiBUZXJtaW5hbCBjb21tYW5kLlxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBhdWRpb0NvZGVjIFthYWNdIC0gVGhlIG5hbWUgb2YgdGhlIGF1ZGlvIGNvZGVjLiBUaGUgQWR2YW5jZWQgQXVkaW8gQ29kZWMgaXMgdXNlZCBieSBkZWZhdWx0LlxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBhdWRpb0JpdHJhdGUgWzEyOGtdIC0gVGhlIGJpdHJhdGUgb2YgdGhlIHJlc3VsdGluZyBhdWRpbyBzdHJlYW0uIDEyOGsgYnkgZGVmYXVsdC5cbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ3xudW1iZXJ9IGF1ZGlvQ2hhbm5lbHMgWzJdIC0gVGhlIGNvdW50IG9mIGF1ZGlvIGNoYW5uZWxzIGluIHRoZSByZXN1bHRpbmcgc3RyZWFtLiBTZXR0aW5nIGl0IHRvIGAxYFxuICogd2lsbCBjcmVhdGUgYSBzaW5nbGUgY2hhbm5lbCAobW9ubykgYXVkaW8gc3RyZWFtLlxuICogQHByb3BlcnR5IHs/c3RyaW5nfG51bWJlcn0gYXVkaW9SYXRlIFs0NDEwMF0gLSBUaGUgc2FtcGxpbmcgcmF0ZSBvZiB0aGUgcmVzdWx0aW5nIGF1ZGlvIHN0cmVhbS5cbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ3xudW1iZXJ9IHRpbWVMaW1pdCBbMTgwXSAtIFRoZSBtYXhpbXVtIHJlY29yZGluZyB0aW1lLCBpbiBzZWNvbmRzLlxuICogVGhlIGRlZmF1bHQgdmFsdWUgaXMgMTgwLCB0aGUgbWF4aW11bSB2YWx1ZSBpcyA0MzIwMCAoMTIgaG91cnMpLlxuICogQHByb3BlcnR5IHs/Ym9vbGVhbn0gZm9yY2VSZXN0YXJ0IFtmYWxzZV0gLSBXaGV0aGVyIHRvIHJlc3RhcnQgYXVkaW8gY2FwdHVyZSBwcm9jZXNzIGZvcmNlZnVsbHkgd2hlblxuICogc3RhcnRSZWNvcmRpbmdBdWRpbyBpcyBjYWxsZWQgKGB0cnVlYCkgb3IgaWdub3JlIHRoZSBjYWxsIHVudGlsIHRoZSBjdXJyZW50IGF1ZGlvIHJlY29yZGluZyBpcyBjb21wbGV0ZWQuXG4gKi9cblxuLyoqXG4gKiBSZWNvcmRzIHRoZSBnaXZlbiBoYXJkd2FyZSBhdWRpbyBpbnB1dCBpbnRvIGFuIC5tcDQgZmlsZS5cbiAqXG4gKiBAcGFyYW0gez9TdGFydFJlY29yZGluZ09wdGlvbnN9IG9wdGlvbnMgLSBUaGUgYXZhaWxhYmxlIG9wdGlvbnMuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgYXVkaW8gcmVjb3JkaW5nIGhhcyBmYWlsZWQgdG8gc3RhcnQuXG4gKi9cbmNvbW1hbmRzLnN0YXJ0QXVkaW9SZWNvcmRpbmcgPSBhc3luYyBmdW5jdGlvbiBzdGFydEF1ZGlvUmVjb3JkaW5nIChvcHRpb25zID0ge30pIHtcbiAgaWYgKCF0aGlzLmlzRmVhdHVyZUVuYWJsZWQoQVVESU9fUkVDT1JEX0ZFQVRfTkFNRSkpIHtcbiAgICB0aGlzLmxvZy5lcnJvckFuZFRocm93KGBBdWRpbyBjYXB0dXJlIGZlYXR1cmUgbXVzdCBiZSBlbmFibGVkIG9uIHRoZSBzZXJ2ZXIgc2lkZS4gYCArXG4gICAgICBgUGxlYXNlIHNldCAnLS1yZWxheGVkLXNlY3VyaXR5JyBvciAnLS1hbGxvdy1pbnNlY3VyZScgd2l0aCAnJHtBVURJT19SRUNPUkRfRkVBVF9OQU1FfScgb3B0aW9uLiBgICtcbiAgICAgIGBSZWFkIGh0dHBzOi8vZ2l0aHViLmNvbS9hcHBpdW0vYXBwaXVtL2Jsb2IvbWFzdGVyL2RvY3MvZW4vd3JpdGluZy1ydW5uaW5nLWFwcGl1bS9zZWN1cml0eS5tZCBmb3IgbW9yZSBkZXRhaWxzLmApO1xuICB9XG5cbiAgY29uc3Qge1xuICAgIHRpbWVMaW1pdCA9IERFRkFVTFRfUkVDT1JESU5HX1RJTUVfU0VDLFxuICAgIGF1ZGlvSW5wdXQsXG4gICAgLy8gVW5kb2N1bWVudGVkIGZlYXR1cmVcbiAgICBhdWRpb1NvdXJjZSxcbiAgICBhdWRpb0NvZGVjID0gREVGQVVMVF9DT0RFQyxcbiAgICBhdWRpb0JpdHJhdGUgPSBERUZBVUxUX0JJVFJBVEUsXG4gICAgYXVkaW9DaGFubmVscyA9IERFRkFVTFRfQ0hBTk5FTFMsXG4gICAgYXVkaW9SYXRlID0gREVGQVVMVF9SQVRFLFxuICAgIGZvcmNlUmVzdGFydCxcbiAgfSA9IG9wdGlvbnM7XG5cbiAgaWYgKCFhdWRpb0lucHV0KSB7XG4gICAgdGhpcy5sb2cuZXJyb3JBbmRUaHJvdyhgVGhlIG1hbmRhdG9yeSBhdWRpb0lucHV0IG9wdGlvbiBpcyBub3QgcHJvdmlkZWQuIFBsZWFzZSBzZXQgaXQgYCArXG4gICAgICBgdG8gYSBjb3JyZWN0IHZhbHVlIChlLiBnLiAnOjEnKS4gVXNlICdmZm1wZWcgLWYgYXZmb3VuZGF0aW9uIC1saXN0X2RldmljZXMgdHJ1ZSAtaSBcIlwiJyBgICtcbiAgICAgIGBjb21tYW5kIHRvIGxpc3QgYXZhaWxhYmxlIGlucHV0IHNvdXJjZXNgKTtcbiAgfVxuXG4gIGlmICh0aGlzLl9hdWRpb1JlY29yZGVyPy5pc1JlY29yZGluZygpKSB7XG4gICAgdGhpcy5sb2cuaW5mbyhgVGhlcmUgaXMgYW4gYWN0aXZlIGF1ZGlvIHJlY29yZGluZyBwcm9jZXNzYCk7XG4gICAgaWYgKGZvcmNlUmVzdGFydCkge1xuICAgICAgdGhpcy5sb2cuaW5mbyhgU3RvcHBpbmcgaXQgYmVjYXVzZSAnZm9yY2VSZXN0YXJ0JyBvcHRpb24gaXMgc2V0IHRvIHRydWVgKTtcbiAgICAgIGF3YWl0IHRoaXMuX2F1ZGlvUmVjb3JkZXIuaW50ZXJydXB0KHRydWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmxvZy5pbmZvKGBEb2luZyBub3RoaW5nLiBgICtcbiAgICAgICAgYFNldCAnZm9yY2VSZXN0YXJ0JyBvcHRpb24gdG8gdHJ1ZSBpZiB5b3UnZCBsaWtlIHRvIHN0YXJ0IGEgbmV3IGF1ZGlvIHJlY29yZGluZyBzZXNzaW9uYCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG4gIGlmICh0aGlzLl9hdWRpb1JlY29yZGVyKSB7XG4gICAgYXdhaXQgdGhpcy5fYXVkaW9SZWNvcmRlci5jbGVhbnVwKCk7XG4gICAgdGhpcy5fYXVkaW9SZWNvcmRlciA9IG51bGw7XG4gIH1cblxuICBjb25zdCBhdWRpb1BhdGggPSBhd2FpdCB0ZW1wRGlyLnBhdGgoe1xuICAgIHByZWZpeDogYGFwcGl1bV8ke3V0aWwudXVpZFY0KCkuc3Vic3RyaW5nKDAsIDgpfWAsXG4gICAgc3VmZml4OiBERUZBVUxUX0VYVCxcbiAgfSk7XG5cbiAgY29uc3QgYXVkaW9SZWNvcmRlciA9IG5ldyBBdWRpb1JlY29yZGVyKGF1ZGlvSW5wdXQsIHRoaXMubG9nLCBhdWRpb1BhdGgsIHtcbiAgICBhdWRpb1NvdXJjZSxcbiAgICBhdWRpb0NvZGVjLFxuICAgIGF1ZGlvQml0cmF0ZSxcbiAgICBhdWRpb0NoYW5uZWxzLFxuICAgIGF1ZGlvUmF0ZSxcbiAgfSk7XG5cbiAgY29uc3QgdGltZW91dFNlY29uZHMgPSBwYXJzZUludCh0aW1lTGltaXQsIDEwKTtcbiAgaWYgKGlzTmFOKHRpbWVvdXRTZWNvbmRzKSB8fCB0aW1lb3V0U2Vjb25kcyA+IE1BWF9SRUNPUkRJTkdfVElNRV9TRUMgfHwgdGltZW91dFNlY29uZHMgPD0gMCkge1xuICAgIHRoaXMubG9nLmVycm9yQW5kVGhyb3coYFRoZSB0aW1lTGltaXQgdmFsdWUgbXVzdCBiZSBpbiByYW5nZSBbMSwgJHtNQVhfUkVDT1JESU5HX1RJTUVfU0VDfV0gc2Vjb25kcy4gYCArXG4gICAgICBgVGhlIHZhbHVlIG9mICcke3RpbWVMaW1pdH0nIGhhcyBiZWVuIHBhc3NlZCBpbnN0ZWFkLmApO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBhd2FpdCBhdWRpb1JlY29yZGVyLnN0YXJ0KHRpbWVvdXRTZWNvbmRzKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGF3YWl0IGF1ZGlvUmVjb3JkZXIuaW50ZXJydXB0KHRydWUpO1xuICAgIGF3YWl0IGF1ZGlvUmVjb3JkZXIuY2xlYW51cCgpO1xuICAgIHRocm93IGU7XG4gIH1cbiAgdGhpcy5fYXVkaW9SZWNvcmRlciA9IGF1ZGlvUmVjb3JkZXI7XG59O1xuXG4vKipcbiAqIFN0b3AgcmVjb3JkaW5nIG9mIHRoZSBhdWRpbyBpbnB1dC4gSWYgbm8gYXVkaW8gcmVjb3JkaW5nIHByb2Nlc3MgaXMgcnVubmluZyB0aGVuXG4gKiB0aGUgZW5kcG9pbnQgd2lsbCB0cnkgdG8gZ2V0IHRoZSByZWNlbnRseSByZWNvcmRlZCBmaWxlLlxuICogSWYgbm8gcHJldmlvdXNseSByZWNvcmRlZCBmaWxlIGlzIGZvdW5kIGFuZCBubyBhY3RpdmUgYXVkaW8gcmVjb3JkaW5nXG4gKiBwcm9jZXNzZXMgYXJlIHJ1bm5pbmcgdGhlbiB0aGUgbWV0aG9kIHJldHVybnMgYW4gZW1wdHkgc3RyaW5nLlxuICpcbiAqIEByZXR1cm5zIHtzdHJpbmd9IEJhc2U2NC1lbmNvZGVkIGNvbnRlbnQgb2YgdGhlIHJlY29yZGVkIG1lZGlhIGZpbGUgb3IgYW5cbiAqIGVtcHR5IHN0cmluZyBpZiBubyBhdWRpbyByZWNvcmRpbmcgaGFzIGJlZW4gc3RhcnRlZCBiZWZvcmUuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgd2FzIGFuIGVycm9yIHdoaWxlIGdldHRpbmcgdGhlIHJlY29yZGVkIGZpbGUuXG4gKi9cbmNvbW1hbmRzLnN0b3BBdWRpb1JlY29yZGluZyA9IGFzeW5jIGZ1bmN0aW9uIHN0b3BBdWRpb1JlY29yZGluZyAoKSB7XG4gIGlmICghdGhpcy5fYXVkaW9SZWNvcmRlcikge1xuICAgIHRoaXMubG9nLmluZm8oJ0F1ZGlvIHJlY29yZGluZyBoYXMgbm90IGJlZW4gc3RhcnRlZC4gVGhlcmUgaXMgbm90aGluZyB0byBzdG9wJyk7XG4gICAgcmV0dXJuICcnO1xuICB9XG5cbiAgbGV0IHJlc3VsdFBhdGg7XG4gIHRyeSB7XG4gICAgcmVzdWx0UGF0aCA9IGF3YWl0IHRoaXMuX2F1ZGlvUmVjb3JkZXIuZmluaXNoKCk7XG4gICAgaWYgKCFhd2FpdCBmcy5leGlzdHMocmVzdWx0UGF0aCkpIHtcbiAgICAgIHRoaXMubG9nLmVycm9yQW5kVGhyb3coYCR7RkZNUEVHX0JJTkFSWX0gaGFzIGZhaWxlZCBgICtcbiAgICAgICAgYHRvIHN0b3JlIHRoZSBhY3R1YWwgYXVkaW8gcmVjb3JkaW5nIGF0ICcke3Jlc3VsdFBhdGh9J2ApO1xuICAgIH1cbiAgfSBjYXRjaCAoZSkge1xuICAgIGF3YWl0IHRoaXMuX2F1ZGlvUmVjb3JkZXIuaW50ZXJydXB0KHRydWUpO1xuICAgIGF3YWl0IHRoaXMuX2F1ZGlvUmVjb3JkZXIuY2xlYW51cCgpO1xuICAgIHRoaXMuX2F1ZGlvUmVjb3JkZXIgPSBudWxsO1xuICAgIHRocm93IGU7XG4gIH1cbiAgcmV0dXJuIGF3YWl0IGVuY29kZUJhc2U2NE9yVXBsb2FkKHJlc3VsdFBhdGgpO1xufTtcblxuXG5leHBvcnQgeyBjb21tYW5kcyB9O1xuZXhwb3J0IGRlZmF1bHQgY29tbWFuZHM7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUdBLE1BQU1BLFFBQVEsR0FBRyxDQUFDLENBQUM7QUFBQztBQUVwQixNQUFNQyxzQkFBc0IsR0FBRyxjQUFjO0FBQzdDLE1BQU1DLHNCQUFzQixHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRTtBQUMzQyxNQUFNQywwQkFBMEIsR0FBRyxFQUFFLEdBQUcsQ0FBQztBQUN6QyxNQUFNQywwQkFBMEIsR0FBRyxJQUFJO0FBQ3ZDLE1BQU1DLGNBQWMsR0FBRyxjQUFjO0FBQ3JDLE1BQU1DLGVBQWUsR0FBRyxNQUFNO0FBQzlCLE1BQU1DLGFBQWEsR0FBRyxLQUFLO0FBQzNCLE1BQU1DLGdCQUFnQixHQUFHLENBQUM7QUFDMUIsTUFBTUMsWUFBWSxHQUFHLEtBQUs7QUFDMUIsTUFBTUMsV0FBVyxHQUFHLE1BQU07QUFDMUIsTUFBTUMsYUFBYSxHQUFHLFFBQVE7QUFDOUIsTUFBTUMsWUFBWSxHQUFHQyxlQUFNLENBQUNDLFNBQVMsQ0FBQ0gsYUFBYSxDQUFDO0FBR3BELE1BQU1JLGFBQWEsQ0FBQztFQUNsQkMsV0FBVyxDQUFFQyxLQUFLLEVBQUVDLEdBQUcsRUFBRUMsU0FBUyxFQUFFQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLEVBQUU7SUFDN0MsSUFBSSxDQUFDSCxLQUFLLEdBQUdBLEtBQUs7SUFDbEIsSUFBSSxDQUFDQyxHQUFHLEdBQUdBLEdBQUc7SUFDZCxJQUFJLENBQUNDLFNBQVMsR0FBR0EsU0FBUztJQUMxQixJQUFJLENBQUNDLElBQUksR0FBR0EsSUFBSTtJQUNoQixJQUFJLENBQUNDLFdBQVcsR0FBRyxJQUFJO0VBQ3pCO0VBRUEsTUFBTUMsS0FBSyxDQUFFQyxjQUFjLEVBQUU7SUFDM0IsSUFBSTtNQUNGLE1BQU1DLFdBQUUsQ0FBQ0MsS0FBSyxDQUFDZCxhQUFhLENBQUM7SUFDL0IsQ0FBQyxDQUFDLE9BQU9lLEdBQUcsRUFBRTtNQUNaLE1BQU0sSUFBSUMsS0FBSyxDQUFFLElBQUdoQixhQUFjLHlFQUF3RSxHQUN2Ryw4REFBNkQsQ0FBQztJQUNuRTtJQUVBLE1BQU07TUFDSmlCLFdBQVcsR0FBR3ZCLGNBQWM7TUFDNUJ3QixVQUFVO01BQ1ZDLFlBQVk7TUFDWkMsYUFBYTtNQUNiQztJQUNGLENBQUMsR0FBRyxJQUFJLENBQUNaLElBQUk7SUFFYixNQUFNYSxJQUFJLEdBQUcsQ0FDWCxJQUFJLEVBQUcsR0FBRVYsY0FBZSxFQUFDLEVBQ3pCLElBQUksRUFBRUssV0FBVyxFQUNqQixJQUFJLEVBQUUsSUFBSSxDQUFDWCxLQUFLLEVBQ2hCLE1BQU0sRUFBRVksVUFBVSxFQUNsQixNQUFNLEVBQUVDLFlBQVksRUFDcEIsS0FBSyxFQUFHLEdBQUVDLGFBQWMsRUFBQyxFQUN6QixLQUFLLEVBQUcsR0FBRUMsU0FBVSxFQUFDLEVBQ3JCLElBQUksQ0FBQ2IsU0FBUyxDQUNmO0lBRUQsSUFBSSxDQUFDRSxXQUFXLEdBQUcsSUFBSWEsd0JBQVUsQ0FBQ3ZCLGFBQWEsRUFBRXNCLElBQUksQ0FBQztJQUN0RCxJQUFJRSxnQkFBZ0IsR0FBRyxLQUFLO0lBQzVCLElBQUksQ0FBQ2QsV0FBVyxDQUFDZSxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUNDLE1BQU0sRUFBRUMsTUFBTSxLQUFLO01BQ2hELElBQUlBLE1BQU0sRUFBRTtRQUNWLElBQUlBLE1BQU0sQ0FBQ0MsSUFBSSxFQUFFLENBQUNDLFVBQVUsQ0FBQyxPQUFPLENBQUMsRUFBRTtVQUNyQyxJQUFJLENBQUNMLGdCQUFnQixFQUFFO1lBQ3JCQSxnQkFBZ0IsR0FBRyxJQUFJO1VBQ3pCO1FBQ0YsQ0FBQyxNQUFNO1VBQ0x2QixZQUFZLENBQUM2QixJQUFJLENBQUUsR0FBRUgsTUFBTyxFQUFDLENBQUM7UUFDaEM7TUFDRjtJQUNGLENBQUMsQ0FBQztJQUNGLE1BQU0sSUFBSSxDQUFDakIsV0FBVyxDQUFDQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQy9CLElBQUk7TUFDRixNQUFNLElBQUFvQiwwQkFBZ0IsRUFBQyxNQUFNUCxnQkFBZ0IsRUFBRTtRQUM3Q1EsTUFBTSxFQUFFdkMsMEJBQTBCO1FBQ2xDd0MsVUFBVSxFQUFFO01BQ2QsQ0FBQyxDQUFDO0lBQ0osQ0FBQyxDQUFDLE9BQU9DLENBQUMsRUFBRTtNQUNWLElBQUksQ0FBQzNCLEdBQUcsQ0FBQzRCLElBQUksQ0FBRSxnREFBK0MxQywwQkFBMkIsdUJBQXNCLENBQUM7SUFDbEg7SUFDQSxJQUFJLENBQUMsSUFBSSxDQUFDaUIsV0FBVyxDQUFDMEIsU0FBUyxFQUFFO01BQy9CLElBQUksQ0FBQzFCLFdBQVcsR0FBRyxJQUFJO01BQ3ZCLE1BQU0sSUFBSU0sS0FBSyxDQUFFLGdDQUErQmhCLGFBQWMsdUJBQXNCLEdBQ2pGLG9DQUFtQyxDQUFDO0lBQ3pDO0lBQ0EsSUFBSSxDQUFDTyxHQUFHLENBQUN1QixJQUFJLENBQUUsb0NBQW1DLElBQUksQ0FBQ3hCLEtBQU0sb0JBQW1CK0IsYUFBSSxDQUFDQyxLQUFLLENBQUMsQ0FBQ3RDLGFBQWEsRUFBRSxHQUFHc0IsSUFBSSxDQUFDLENBQUUsS0FBSSxHQUN0SCxtQkFBa0JWLGNBQWUsR0FBRSxDQUFDO0lBQ3ZDLElBQUksQ0FBQ0YsV0FBVyxDQUFDNkIsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDQyxJQUFJLEVBQUVDLE1BQU0sS0FBSztNQUU5QyxJQUFJLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDQyxRQUFRLENBQUNGLElBQUksQ0FBQyxFQUFFO1FBQzNCLElBQUksQ0FBQ2pDLEdBQUcsQ0FBQ3VCLElBQUksQ0FBRSx5Q0FBd0MsSUFBSSxDQUFDeEIsS0FBTSxxQkFBb0IsQ0FBQztNQUN6RixDQUFDLE1BQU07UUFDTCxJQUFJLENBQUNDLEdBQUcsQ0FBQ29DLEtBQUssQ0FBRSx5Q0FBd0MsSUFBSSxDQUFDckMsS0FBTSxlQUFjLEdBQzlFLGFBQVlrQyxJQUFLLFlBQVdDLE1BQU8sRUFBQyxDQUFDO01BQzFDO0lBQ0YsQ0FBQyxDQUFDO0VBQ0o7RUFFQUcsV0FBVyxHQUFJO0lBQUE7SUFDYixPQUFPLENBQUMsdUJBQUUsSUFBSSxDQUFDbEMsV0FBVyw4Q0FBaEIsa0JBQWtCMEIsU0FBUyxDQUFDO0VBQ3hDO0VBRUEsTUFBTVMsU0FBUyxDQUFFQyxLQUFLLEdBQUcsS0FBSyxFQUFFO0lBQzlCLElBQUksSUFBSSxDQUFDRixXQUFXLEVBQUUsRUFBRTtNQUN0QixNQUFNRyxnQkFBZ0IsR0FBRyxJQUFJLENBQUNyQyxXQUFXLENBQUNzQyxJQUFJLENBQUNGLEtBQUssR0FBRyxTQUFTLEdBQUcsUUFBUSxDQUFDO01BQzVFLElBQUksQ0FBQ3BDLFdBQVcsR0FBRyxJQUFJO01BQ3ZCLElBQUk7UUFDRixNQUFNcUMsZ0JBQWdCO01BQ3hCLENBQUMsQ0FBQyxPQUFPYixDQUFDLEVBQUU7UUFDVixJQUFJLENBQUMzQixHQUFHLENBQUM0QixJQUFJLENBQUUsVUFBU1csS0FBSyxHQUFHLFdBQVcsR0FBRyxXQUFZLElBQUc5QyxhQUFjLElBQUcsR0FDM0UsbUJBQWtCa0MsQ0FBQyxDQUFDZSxPQUFRLEVBQUMsQ0FBQztRQUNqQyxPQUFPLEtBQUs7TUFDZDtJQUNGO0lBRUEsT0FBTyxJQUFJO0VBQ2I7RUFFQSxNQUFNQyxNQUFNLEdBQUk7SUFDZCxNQUFNLElBQUksQ0FBQ0wsU0FBUyxFQUFFO0lBQ3RCLE9BQU8sSUFBSSxDQUFDckMsU0FBUztFQUN2QjtFQUVBLE1BQU0yQyxPQUFPLEdBQUk7SUFDZixJQUFJLE1BQU10QyxXQUFFLENBQUN1QyxNQUFNLENBQUMsSUFBSSxDQUFDNUMsU0FBUyxDQUFDLEVBQUU7TUFDbkMsTUFBTUssV0FBRSxDQUFDd0MsTUFBTSxDQUFDLElBQUksQ0FBQzdDLFNBQVMsQ0FBQztJQUNqQztFQUNGO0FBQ0Y7QUEwQkFuQixRQUFRLENBQUNpRSxtQkFBbUIsR0FBRyxlQUFlQSxtQkFBbUIsQ0FBRUMsT0FBTyxHQUFHLENBQUMsQ0FBQyxFQUFFO0VBQUE7RUFDL0UsSUFBSSxDQUFDLElBQUksQ0FBQ0MsZ0JBQWdCLENBQUNsRSxzQkFBc0IsQ0FBQyxFQUFFO0lBQ2xELElBQUksQ0FBQ2lCLEdBQUcsQ0FBQ2tELGFBQWEsQ0FBRSw0REFBMkQsR0FDaEYsK0RBQThEbkUsc0JBQXVCLFlBQVcsR0FDaEcsZ0hBQStHLENBQUM7RUFDckg7RUFFQSxNQUFNO0lBQ0pvRSxTQUFTLEdBQUdsRSwwQkFBMEI7SUFDdENtRSxVQUFVO0lBRVYxQyxXQUFXO0lBQ1hDLFVBQVUsR0FBR3RCLGFBQWE7SUFDMUJ1QixZQUFZLEdBQUd4QixlQUFlO0lBQzlCeUIsYUFBYSxHQUFHdkIsZ0JBQWdCO0lBQ2hDd0IsU0FBUyxHQUFHdkIsWUFBWTtJQUN4QjhEO0VBQ0YsQ0FBQyxHQUFHTCxPQUFPO0VBRVgsSUFBSSxDQUFDSSxVQUFVLEVBQUU7SUFDZixJQUFJLENBQUNwRCxHQUFHLENBQUNrRCxhQUFhLENBQUUsaUVBQWdFLEdBQ3JGLHlGQUF3RixHQUN4Rix5Q0FBd0MsQ0FBQztFQUM5QztFQUVBLDRCQUFJLElBQUksQ0FBQ0ksY0FBYyxpREFBbkIscUJBQXFCakIsV0FBVyxFQUFFLEVBQUU7SUFDdEMsSUFBSSxDQUFDckMsR0FBRyxDQUFDdUIsSUFBSSxDQUFFLDRDQUEyQyxDQUFDO0lBQzNELElBQUk4QixZQUFZLEVBQUU7TUFDaEIsSUFBSSxDQUFDckQsR0FBRyxDQUFDdUIsSUFBSSxDQUFFLDBEQUF5RCxDQUFDO01BQ3pFLE1BQU0sSUFBSSxDQUFDK0IsY0FBYyxDQUFDaEIsU0FBUyxDQUFDLElBQUksQ0FBQztJQUMzQyxDQUFDLE1BQU07TUFDTCxJQUFJLENBQUN0QyxHQUFHLENBQUN1QixJQUFJLENBQUUsaUJBQWdCLEdBQzVCLHdGQUF1RixDQUFDO01BQzNGO0lBQ0Y7RUFDRjtFQUNBLElBQUksSUFBSSxDQUFDK0IsY0FBYyxFQUFFO0lBQ3ZCLE1BQU0sSUFBSSxDQUFDQSxjQUFjLENBQUNWLE9BQU8sRUFBRTtJQUNuQyxJQUFJLENBQUNVLGNBQWMsR0FBRyxJQUFJO0VBQzVCO0VBRUEsTUFBTXJELFNBQVMsR0FBRyxNQUFNc0QsZ0JBQU8sQ0FBQ0MsSUFBSSxDQUFDO0lBQ25DQyxNQUFNLEVBQUcsVUFBUzNCLGFBQUksQ0FBQzRCLE1BQU0sRUFBRSxDQUFDQyxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBRSxFQUFDO0lBQ2pEQyxNQUFNLEVBQUVwRTtFQUNWLENBQUMsQ0FBQztFQUVGLE1BQU1xRSxhQUFhLEdBQUcsSUFBSWhFLGFBQWEsQ0FBQ3VELFVBQVUsRUFBRSxJQUFJLENBQUNwRCxHQUFHLEVBQUVDLFNBQVMsRUFBRTtJQUN2RVMsV0FBVztJQUNYQyxVQUFVO0lBQ1ZDLFlBQVk7SUFDWkMsYUFBYTtJQUNiQztFQUNGLENBQUMsQ0FBQztFQUVGLE1BQU1ULGNBQWMsR0FBR3lELFFBQVEsQ0FBQ1gsU0FBUyxFQUFFLEVBQUUsQ0FBQztFQUM5QyxJQUFJWSxLQUFLLENBQUMxRCxjQUFjLENBQUMsSUFBSUEsY0FBYyxHQUFHckIsc0JBQXNCLElBQUlxQixjQUFjLElBQUksQ0FBQyxFQUFFO0lBQzNGLElBQUksQ0FBQ0wsR0FBRyxDQUFDa0QsYUFBYSxDQUFFLDRDQUEyQ2xFLHNCQUF1QixhQUFZLEdBQ25HLGlCQUFnQm1FLFNBQVUsNEJBQTJCLENBQUM7RUFDM0Q7RUFFQSxJQUFJO0lBQ0YsTUFBTVUsYUFBYSxDQUFDekQsS0FBSyxDQUFDQyxjQUFjLENBQUM7RUFDM0MsQ0FBQyxDQUFDLE9BQU9zQixDQUFDLEVBQUU7SUFDVixNQUFNa0MsYUFBYSxDQUFDdkIsU0FBUyxDQUFDLElBQUksQ0FBQztJQUNuQyxNQUFNdUIsYUFBYSxDQUFDakIsT0FBTyxFQUFFO0lBQzdCLE1BQU1qQixDQUFDO0VBQ1Q7RUFDQSxJQUFJLENBQUMyQixjQUFjLEdBQUdPLGFBQWE7QUFDckMsQ0FBQztBQVlEL0UsUUFBUSxDQUFDa0Ysa0JBQWtCLEdBQUcsZUFBZUEsa0JBQWtCLEdBQUk7RUFDakUsSUFBSSxDQUFDLElBQUksQ0FBQ1YsY0FBYyxFQUFFO0lBQ3hCLElBQUksQ0FBQ3RELEdBQUcsQ0FBQ3VCLElBQUksQ0FBQyxnRUFBZ0UsQ0FBQztJQUMvRSxPQUFPLEVBQUU7RUFDWDtFQUVBLElBQUkwQyxVQUFVO0VBQ2QsSUFBSTtJQUNGQSxVQUFVLEdBQUcsTUFBTSxJQUFJLENBQUNYLGNBQWMsQ0FBQ1gsTUFBTSxFQUFFO0lBQy9DLElBQUksRUFBQyxNQUFNckMsV0FBRSxDQUFDdUMsTUFBTSxDQUFDb0IsVUFBVSxDQUFDLEdBQUU7TUFDaEMsSUFBSSxDQUFDakUsR0FBRyxDQUFDa0QsYUFBYSxDQUFFLEdBQUV6RCxhQUFjLGNBQWEsR0FDbEQsMkNBQTBDd0UsVUFBVyxHQUFFLENBQUM7SUFDN0Q7RUFDRixDQUFDLENBQUMsT0FBT3RDLENBQUMsRUFBRTtJQUNWLE1BQU0sSUFBSSxDQUFDMkIsY0FBYyxDQUFDaEIsU0FBUyxDQUFDLElBQUksQ0FBQztJQUN6QyxNQUFNLElBQUksQ0FBQ2dCLGNBQWMsQ0FBQ1YsT0FBTyxFQUFFO0lBQ25DLElBQUksQ0FBQ1UsY0FBYyxHQUFHLElBQUk7SUFDMUIsTUFBTTNCLENBQUM7RUFDVDtFQUNBLE9BQU8sTUFBTSxJQUFBdUMsMkJBQW9CLEVBQUNELFVBQVUsQ0FBQztBQUMvQyxDQUFDO0FBQUMsZUFJYW5GLFFBQVE7QUFBQSJ9