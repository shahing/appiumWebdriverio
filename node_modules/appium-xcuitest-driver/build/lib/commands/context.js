"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
require("source-map-support/register");
var _appiumRemoteDebugger = require("appium-remote-debugger");
var _driver = require("appium/driver");
var _support = require("appium/support");
var _bluebird = _interopRequireDefault(require("bluebird"));
var _iosPerformanceLog = _interopRequireDefault(require("../device-log/ios-performance-log"));
var _lodash = _interopRequireDefault(require("lodash"));
const NATIVE_WIN = 'NATIVE_APP';
const WEBVIEW_WIN = 'WEBVIEW';
const WEBVIEW_BASE = `${WEBVIEW_WIN}_`;
const RECENT_WEBVIEW_DETECTION_TIMEOUT_MS = 90000;
const commands = {},
  helpers = {},
  extensions = {};
commands.getCurrentContext = async function getCurrentContext() {
  if (this.curContext && this.curContext !== NATIVE_WIN) {
    return `${WEBVIEW_BASE}${this.curContext}`;
  }
  return NATIVE_WIN;
};
extensions.getContextsAndViews = async function getContextsAndViews(useUrl = true) {
  this.log.debug('Retrieving contexts and views');
  let webviews = await this.listWebFrames(useUrl);
  let ctxs = [{
    id: NATIVE_WIN,
    view: {}
  }];
  this.contexts = [NATIVE_WIN];
  for (let view of webviews) {
    ctxs.push({
      id: `${WEBVIEW_BASE}${view.id}`,
      view
    });
    this.contexts.push(view.id.toString());
  }
  return ctxs;
};
extensions.useNewSafari = function useNewSafari() {
  return !this.isRealDevice() && this.opts.safari;
};
extensions.activateRecentWebview = async function activateRecentWebview() {
  this.log.debug('Activating a recent webview');
  const timer = new _support.timing.Timer().start();
  const spinTimeMs = 500;
  const spinHandles = async () => {
    let contextId;
    try {
      contextId = await this.getRecentWebviewContextId(/.*/, /.*/);
    } catch (err) {
      if (!err.message.includes('Could not connect to a valid app after')) {
        const error = new Error(`Could not navigate to webview! Err: ${err.message}`);
        error.stack += `\nCaused by: ${err.stack}`;
        throw error;
      }
      this.log.debug('Could not navigate to webview. Retrying if possible.');
    }
    if (contextId) {
      this.log.debug(`Picking webview '${contextId}'`);
      await this.setContext(contextId);
      await this.remote.cancelPageLoad();
      return;
    }
    if (timer.getDuration().asMilliSeconds >= RECENT_WEBVIEW_DETECTION_TIMEOUT_MS) {
      throw new Error('Could not navigate to webview; there are none!');
    }
    this.log.warn('Could not find any webviews yet, refreshing/retrying');
    if (this.isRealDevice() || !this.opts.safari) {
      await _bluebird.default.delay(spinTimeMs);
      return await spinHandles();
    }
    let element;
    try {
      this.log.debug('Finding and tapping reload button');
      element = await this.findUIElementOrElements('accessibility id', 'ReloadButton', '', false);
      await this.nativeClick(element);
    } catch (err) {
      this.log.warn(`Error finding and tapping reload button: ${err.message}`);
      this.log.warn('Retrying.');
      await _bluebird.default.delay(spinTimeMs);
    }
    return await spinHandles();
  };
  await spinHandles();
};
helpers.stopRemote = async function stopRemote(closeWindowBeforeDisconnecting = false) {
  if (!this.remote) {
    this.log.errorAndThrow('Tried to leave a web frame but were not in one');
  }
  if (closeWindowBeforeDisconnecting) {
    await this.closeWindow();
  }
  await this.remote.disconnect();
  this.curContext = null;
  this.curWebFrames = [];
  this.curWebCoords = null;
  this.remote = null;
};
helpers.setCurrentUrl = function setCurrentUrl(url) {
  this._currentUrl = url;
};
helpers.getCurrentUrl = function getCurrentUrl() {
  return this._currentUrl;
};
extensions.getRecentWebviewContextId = async function getRecentWebviewContextId(titleRegExp, urlRegExp) {
  var _contexts$find;
  if (!_lodash.default.isRegExp(titleRegExp) && !_lodash.default.isRegExp(urlRegExp)) {
    throw new _driver.errors.InvalidArgumentError('A regular expression for either web view title or url must be provided');
  }
  const currentUrl = this.getCurrentUrl();
  const contexts = _lodash.default.filter(await this.getContextsAndViews(false), 'view');
  if (currentUrl) {
    const ctx = contexts.find(({
      view
    }) => (view.url || '') === currentUrl);
    if (ctx) {
      return ctx.id;
    }
  }
  return (_contexts$find = contexts.find(({
    view
  }) => view.title && (titleRegExp === null || titleRegExp === void 0 ? void 0 : titleRegExp.test(view.title)) || view.url && (urlRegExp === null || urlRegExp === void 0 ? void 0 : urlRegExp.test(view.url)))) === null || _contexts$find === void 0 ? void 0 : _contexts$find.id;
};
extensions.isWebContext = function isWebContext() {
  return !!this.curContext && this.curContext !== NATIVE_WIN;
};
extensions.isWebview = function isWebview() {
  return this.isWebContext();
};
extensions.getNewRemoteDebugger = async function getNewRemoteDebugger() {
  let socketPath;
  if (!this.isRealDevice()) {
    socketPath = await this.opts.device.getWebInspectorSocket();
  }
  return (0, _appiumRemoteDebugger.createRemoteDebugger)({
    bundleId: this.opts.bundleId,
    additionalBundleIds: this.opts.additionalWebviewBundleIds,
    isSafari: this.isSafari(),
    includeSafari: this.opts.includeSafariInWebviews,
    useNewSafari: this.useNewSafari(),
    pageLoadMs: this.pageLoadMs,
    platformVersion: this.opts.platformVersion,
    socketPath,
    remoteDebugProxy: this.opts.remoteDebugProxy,
    garbageCollectOnExecute: _support.util.hasValue(this.opts.safariGarbageCollect) ? !!this.opts.safariGarbageCollect : false,
    udid: this.opts.udid,
    logAllCommunication: this.opts.safariLogAllCommunication,
    logAllCommunicationHexDump: this.opts.safariLogAllCommunicationHexDump,
    socketChunkSize: this.opts.safariSocketChunkSize,
    webInspectorMaxFrameLength: this.opts.safariWebInspectorMaxFrameLength
  }, this.isRealDevice());
};
commands.setContext = async function setContext(name, callback, skipReadyCheck) {
  function alreadyInContext(desired, current) {
    return desired === current || desired === null && current === NATIVE_WIN || desired === NATIVE_WIN && current === null;
  }
  function isNativeContext(context) {
    return context === NATIVE_WIN || context === null;
  }
  if (name && name.id) {
    name = name.id;
  }
  this.log.debug(`Attempting to set context to '${name || NATIVE_WIN}' from '${this.curContext ? this.curContext : NATIVE_WIN}'`);
  if (alreadyInContext(name, this.curContext) || alreadyInContext(_lodash.default.replace(name, WEBVIEW_BASE, ''), this.curContext)) {
    this.log.debug(`Already in '${name || NATIVE_WIN}' context. Doing nothing.`);
    return;
  }
  if (isNativeContext(name)) {
    this.curContext = null;
    return;
  }
  if (_lodash.default.isUndefined(this.contexts)) {
    await this.getContexts();
  }
  let contextId = _lodash.default.replace(name, WEBVIEW_BASE, '');
  if (contextId === '') {
    contextId = this.contexts[1];
  }
  if (!_lodash.default.includes(this.contexts, contextId)) {
    throw new _driver.errors.NoSuchContextError();
  }
  const oldContext = this.curContext;
  this.curContext = this.curWindowHandle = contextId;
  const [appIdKey, pageIdKey] = _lodash.default.map(contextId.split('.'), id => parseInt(id, 10));
  try {
    this.selectingNewPage = true;
    await this.remote.selectPage(appIdKey, pageIdKey, skipReadyCheck);
  } catch (err) {
    this.curContext = this.curWindowHandle = oldContext;
    throw err;
  } finally {
    this.selectingNewPage = false;
  }
  if (this.opts.enablePerformanceLogging && this.remote) {
    this.log.debug(`Starting performance log on '${this.curContext}'`);
    this.logs.performance = new _iosPerformanceLog.default(this.remote);
    await this.logs.performance.startCapture();
  }
  if (name && name !== NATIVE_WIN && this.logs) {
    if (this.logs.safariConsole) {
      await this.remote.startConsole(this.logs.safariConsole.addLogLine.bind(this.logs.safariConsole));
    }
    if (this.logs.safariNetwork) {
      await this.remote.startNetwork(this.logs.safariNetwork.addLogLine.bind(this.logs.safariNetwork));
    }
  }
};
extensions.connectToRemoteDebugger = async function connectToRemoteDebugger() {
  this.remote = await this.getNewRemoteDebugger();
  this.remote.on(_appiumRemoteDebugger.RemoteDebugger.EVENT_PAGE_CHANGE, this.onPageChange.bind(this));
  this.remote.on(_appiumRemoteDebugger.RemoteDebugger.EVENT_FRAMES_DETACHED, () => {
    if (!_lodash.default.isEmpty(this.curWebFrames)) {
      this.log.debug(`Clearing ${_support.util.pluralize('frame', this.curWebFrames.length, true)}: ${this.curWebFrames.join(', ')}`);
    }
    this.curWebFrames = [];
  });
  await this.remote.connect(this.opts.webviewConnectTimeout);
};
extensions.listWebFrames = async function listWebFrames(useUrl = true) {
  useUrl = useUrl && !this.isRealDevice() && !!this.getCurrentUrl();
  this.log.debug(`Selecting by url: ${useUrl}${useUrl ? ` (expected url: '${this.getCurrentUrl()}')` : ''}`);
  if (!this.remote) {
    await this.connectToRemoteDebugger();
    if (!this.remote.appIdKey) {
      await this.remote.setConnectionKey();
    }
  }
  const getWebviewPages = async () => {
    try {
      return await this.remote.selectApp(useUrl ? this.getCurrentUrl() : undefined, this.opts.webviewConnectRetries, this.opts.ignoreAboutBlankUrl);
    } catch (err) {
      this.log.debug(`No available web pages: ${err.message}`);
      return [];
    }
  };
  const pageArray = await getWebviewPages();
  if (_lodash.default.isEmpty(pageArray)) {
    this.log.debug('No web frames found.');
  }
  return pageArray;
};
commands.getContexts = async function getContexts() {
  this.log.debug('Getting list of available contexts');
  const contexts = await this.getContextsAndViews(false);
  const mapFn = this.opts.fullContextList ? function (context) {
    return {
      id: context.id.toString(),
      title: context.view.title,
      url: context.view.url,
      bundleId: context.view.bundleId
    };
  } : context => context.id.toString();
  return contexts.map(mapFn);
};
extensions.mobileGetContexts = async function mobileGetContexts(opts = {}) {
  let {
    waitForWebviewMs = 0
  } = opts;
  if (!_lodash.default.isNumber(waitForWebviewMs)) {
    waitForWebviewMs = parseInt(waitForWebviewMs, 10);
    if (isNaN(waitForWebviewMs)) {
      waitForWebviewMs = 0;
    }
  }
  const curOpt = this.opts.fullContextList;
  this.opts.fullContextList = true;
  const timer = new _support.timing.Timer().start();
  try {
    let contexts;
    do {
      contexts = await this.getContexts();
      if (contexts.length >= 2) {
        this.log.debug(`Found webview context after ${timer.getDuration().asMilliSeconds.toFixed(0)}ms`);
        return contexts;
      }
      this.log.debug(`No webviews found in ${timer.getDuration().asMilliSeconds.toFixed(0)}ms`);
    } while (timer.getDuration().asMilliSeconds < waitForWebviewMs);
    return contexts;
  } finally {
    this.opts.fullContextList = curOpt;
  }
};
commands.setWindow = async function setWindow(name, skipReadyCheck) {
  try {
    await this.setContext(name, _lodash.default.noop, skipReadyCheck);
  } catch (err) {
    throw (0, _driver.isErrorType)(err, _driver.errors.NoSuchContextError) ? new _driver.errors.NoSuchWindowError() : err;
  }
};
commands.getWindowHandle = async function getWindowHandle() {
  if (!this.isWebContext()) {
    throw new _driver.errors.NotImplementedError();
  }
  this.log.debug(`Getting current window handle`);
  return this.curContext;
};
commands.getWindowHandles = async function getWindowHandles() {
  if (!this.isWebContext()) {
    throw new _driver.errors.NotImplementedError();
  }
  this.log.debug('Getting list of available window handles');
  const contexts = await this.getContextsAndViews(false);
  return contexts.filter(context => context.id !== NATIVE_WIN).map(context => context.view.id.toString());
};
extensions.onPageChange = async function onPageChange(pageChangeNotification) {
  this.log.debug(`Remote debugger notified us of a new page listing: ${JSON.stringify(pageChangeNotification)}`);
  if (this.selectingNewPage) {
    this.log.debug('We are in the middle of selecting a page, ignoring');
    return;
  }
  if (!this.remote || !this.remote.isConnected) {
    this.log.debug('We have not yet connected, ignoring');
    return;
  }
  const {
    appIdKey,
    pageArray
  } = pageChangeNotification;
  let newIds = [];
  let newPages = [];
  let keyId = null;
  function isUrlIgnored(url, safariIgnoreWebHostnames) {
    const ignoredHosts = (safariIgnoreWebHostnames || '').split(',').map(b => b.trim()).filter(b => !_lodash.default.isEmpty(b));
    for (const ignoredHost of ignoredHosts) {
      if (ignoredHost === 'about:blank' && url === 'about:blank') {
        return true;
      } else {
        try {
          const hostname = new URL(url).hostname;
          if (hostname === ignoredHost) {
            return true;
          }
        } catch (ign) {}
      }
    }
    return false;
  }
  for (const page of pageArray) {
    const id = page.id.toString();
    newIds.push(id);
    if (page.isKey) {
      keyId = id;
    }
    const contextId = `${appIdKey}.${id}`;
    if (!_lodash.default.includes(this.contexts, contextId)) {
      if (isUrlIgnored(page.url, this.opts.safariIgnoreWebHostnames)) {
        this.log.info(`Not tracking '${page.url}' page because it is blacklisted. ` + `'safariIgnoreWebHostnames'=${this.opts.safariIgnoreWebHostnames}`);
      } else {
        newPages.push(id);
        this.contexts.push(contextId);
      }
    }
  }
  if (!keyId) {
    this.log.debug('No key id found. Choosing first id from page array');
    keyId = newIds[0] || null;
  }
  if (!_support.util.hasValue(this.curContext)) {
    this.log.debug('We do not appear to have window set yet, ignoring');
    return;
  }
  const [curAppIdKey, curPageIdKey] = this.curContext.split('.');
  if (curAppIdKey !== appIdKey) {
    this.log.debug('Page change not referring to currently selected app, ignoring.');
    return;
  }
  let newPage = null;
  if (newPages.length) {
    newPage = _lodash.default.last(newPages);
    this.log.debug(`We have new pages, selecting page '${newPage}'`);
  } else if (!_lodash.default.includes(newIds, curPageIdKey)) {
    this.log.debug('New page listing from remote debugger does not contain ' + 'current window; assuming it is closed');
    if (!_support.util.hasValue(keyId)) {
      this.log.error('Do not have our current window anymore, and there ' + 'are not any more to load! Doing nothing...');
      this.setCurrentUrl(undefined);
      return;
    }
    this.log.debug(`Debugger already selected page '${keyId}', ` + `confirming that choice.`);
    this.curContext = `${appIdKey}.${keyId}`;
    newPage = keyId;
  } else {
    this.log.debug('Checking if page needs to load');
    const needsPageLoad = (() => {
      const contextArray = _lodash.default.map(pageArray, page => `${appIdKey}.${page.id}`);
      return !_lodash.default.isEqual(_lodash.default.find(this.contexts, this.curContext), _lodash.default.find(contextArray, this.curContext));
    })();
    if (needsPageLoad) {
      this.log.debug('Page load needed. Loading...');
      await this.remote.pageLoad();
    }
    this.log.debug('New page listing is same as old, doing nothing');
  }
  if (_support.util.hasValue(this.curContext)) {
    let currentPageId = parseInt(_lodash.default.last(this.curContext.split('.')), 10);
    let page = _lodash.default.find(pageArray, p => parseInt(p.id, 10) === currentPageId);
    if (page && page.url !== this.getCurrentUrl()) {
      this.log.debug(`Redirected from '${this.getCurrentUrl()}' to '${page.url}'`);
      this.setCurrentUrl(page.url);
    }
  }
  if (_support.util.hasValue(newPage)) {
    this.selectingNewPage = true;
    const oldContext = this.curContext;
    this.curContext = `${appIdKey}.${newPage}`;
    this.remote.selectPage(appIdKey, parseInt(newPage, 10)).catch(err => {
      this.log.warn(`Failed to select page: ${err.message}`);
      this.curContext = oldContext;
    });
    this.selectingNewPage = false;
  }
  this.windowHandleCache = pageArray;
};
Object.assign(commands, extensions, helpers);
var _default = commands;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJOQVRJVkVfV0lOIiwiV0VCVklFV19XSU4iLCJXRUJWSUVXX0JBU0UiLCJSRUNFTlRfV0VCVklFV19ERVRFQ1RJT05fVElNRU9VVF9NUyIsImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJnZXRDdXJyZW50Q29udGV4dCIsImN1ckNvbnRleHQiLCJnZXRDb250ZXh0c0FuZFZpZXdzIiwidXNlVXJsIiwibG9nIiwiZGVidWciLCJ3ZWJ2aWV3cyIsImxpc3RXZWJGcmFtZXMiLCJjdHhzIiwiaWQiLCJ2aWV3IiwiY29udGV4dHMiLCJwdXNoIiwidG9TdHJpbmciLCJ1c2VOZXdTYWZhcmkiLCJpc1JlYWxEZXZpY2UiLCJvcHRzIiwic2FmYXJpIiwiYWN0aXZhdGVSZWNlbnRXZWJ2aWV3IiwidGltZXIiLCJ0aW1pbmciLCJUaW1lciIsInN0YXJ0Iiwic3BpblRpbWVNcyIsInNwaW5IYW5kbGVzIiwiY29udGV4dElkIiwiZ2V0UmVjZW50V2Vidmlld0NvbnRleHRJZCIsImVyciIsIm1lc3NhZ2UiLCJpbmNsdWRlcyIsImVycm9yIiwiRXJyb3IiLCJzdGFjayIsInNldENvbnRleHQiLCJyZW1vdGUiLCJjYW5jZWxQYWdlTG9hZCIsImdldER1cmF0aW9uIiwiYXNNaWxsaVNlY29uZHMiLCJ3YXJuIiwiQiIsImRlbGF5IiwiZWxlbWVudCIsImZpbmRVSUVsZW1lbnRPckVsZW1lbnRzIiwibmF0aXZlQ2xpY2siLCJzdG9wUmVtb3RlIiwiY2xvc2VXaW5kb3dCZWZvcmVEaXNjb25uZWN0aW5nIiwiZXJyb3JBbmRUaHJvdyIsImNsb3NlV2luZG93IiwiZGlzY29ubmVjdCIsImN1cldlYkZyYW1lcyIsImN1cldlYkNvb3JkcyIsInNldEN1cnJlbnRVcmwiLCJ1cmwiLCJfY3VycmVudFVybCIsImdldEN1cnJlbnRVcmwiLCJ0aXRsZVJlZ0V4cCIsInVybFJlZ0V4cCIsIl8iLCJpc1JlZ0V4cCIsImVycm9ycyIsIkludmFsaWRBcmd1bWVudEVycm9yIiwiY3VycmVudFVybCIsImZpbHRlciIsImN0eCIsImZpbmQiLCJ0aXRsZSIsInRlc3QiLCJpc1dlYkNvbnRleHQiLCJpc1dlYnZpZXciLCJnZXROZXdSZW1vdGVEZWJ1Z2dlciIsInNvY2tldFBhdGgiLCJkZXZpY2UiLCJnZXRXZWJJbnNwZWN0b3JTb2NrZXQiLCJjcmVhdGVSZW1vdGVEZWJ1Z2dlciIsImJ1bmRsZUlkIiwiYWRkaXRpb25hbEJ1bmRsZUlkcyIsImFkZGl0aW9uYWxXZWJ2aWV3QnVuZGxlSWRzIiwiaXNTYWZhcmkiLCJpbmNsdWRlU2FmYXJpIiwiaW5jbHVkZVNhZmFyaUluV2Vidmlld3MiLCJwYWdlTG9hZE1zIiwicGxhdGZvcm1WZXJzaW9uIiwicmVtb3RlRGVidWdQcm94eSIsImdhcmJhZ2VDb2xsZWN0T25FeGVjdXRlIiwidXRpbCIsImhhc1ZhbHVlIiwic2FmYXJpR2FyYmFnZUNvbGxlY3QiLCJ1ZGlkIiwibG9nQWxsQ29tbXVuaWNhdGlvbiIsInNhZmFyaUxvZ0FsbENvbW11bmljYXRpb24iLCJsb2dBbGxDb21tdW5pY2F0aW9uSGV4RHVtcCIsInNhZmFyaUxvZ0FsbENvbW11bmljYXRpb25IZXhEdW1wIiwic29ja2V0Q2h1bmtTaXplIiwic2FmYXJpU29ja2V0Q2h1bmtTaXplIiwid2ViSW5zcGVjdG9yTWF4RnJhbWVMZW5ndGgiLCJzYWZhcmlXZWJJbnNwZWN0b3JNYXhGcmFtZUxlbmd0aCIsIm5hbWUiLCJjYWxsYmFjayIsInNraXBSZWFkeUNoZWNrIiwiYWxyZWFkeUluQ29udGV4dCIsImRlc2lyZWQiLCJjdXJyZW50IiwiaXNOYXRpdmVDb250ZXh0IiwiY29udGV4dCIsInJlcGxhY2UiLCJpc1VuZGVmaW5lZCIsImdldENvbnRleHRzIiwiTm9TdWNoQ29udGV4dEVycm9yIiwib2xkQ29udGV4dCIsImN1cldpbmRvd0hhbmRsZSIsImFwcElkS2V5IiwicGFnZUlkS2V5IiwibWFwIiwic3BsaXQiLCJwYXJzZUludCIsInNlbGVjdGluZ05ld1BhZ2UiLCJzZWxlY3RQYWdlIiwiZW5hYmxlUGVyZm9ybWFuY2VMb2dnaW5nIiwibG9ncyIsInBlcmZvcm1hbmNlIiwiSU9TUGVyZm9ybWFuY2VMb2ciLCJzdGFydENhcHR1cmUiLCJzYWZhcmlDb25zb2xlIiwic3RhcnRDb25zb2xlIiwiYWRkTG9nTGluZSIsImJpbmQiLCJzYWZhcmlOZXR3b3JrIiwic3RhcnROZXR3b3JrIiwiY29ubmVjdFRvUmVtb3RlRGVidWdnZXIiLCJvbiIsIlJlbW90ZURlYnVnZ2VyIiwiRVZFTlRfUEFHRV9DSEFOR0UiLCJvblBhZ2VDaGFuZ2UiLCJFVkVOVF9GUkFNRVNfREVUQUNIRUQiLCJpc0VtcHR5IiwicGx1cmFsaXplIiwibGVuZ3RoIiwiam9pbiIsImNvbm5lY3QiLCJ3ZWJ2aWV3Q29ubmVjdFRpbWVvdXQiLCJzZXRDb25uZWN0aW9uS2V5IiwiZ2V0V2Vidmlld1BhZ2VzIiwic2VsZWN0QXBwIiwidW5kZWZpbmVkIiwid2Vidmlld0Nvbm5lY3RSZXRyaWVzIiwiaWdub3JlQWJvdXRCbGFua1VybCIsInBhZ2VBcnJheSIsIm1hcEZuIiwiZnVsbENvbnRleHRMaXN0IiwibW9iaWxlR2V0Q29udGV4dHMiLCJ3YWl0Rm9yV2Vidmlld01zIiwiaXNOdW1iZXIiLCJpc05hTiIsImN1ck9wdCIsInRvRml4ZWQiLCJzZXRXaW5kb3ciLCJub29wIiwiaXNFcnJvclR5cGUiLCJOb1N1Y2hXaW5kb3dFcnJvciIsImdldFdpbmRvd0hhbmRsZSIsIk5vdEltcGxlbWVudGVkRXJyb3IiLCJnZXRXaW5kb3dIYW5kbGVzIiwicGFnZUNoYW5nZU5vdGlmaWNhdGlvbiIsIkpTT04iLCJzdHJpbmdpZnkiLCJpc0Nvbm5lY3RlZCIsIm5ld0lkcyIsIm5ld1BhZ2VzIiwia2V5SWQiLCJpc1VybElnbm9yZWQiLCJzYWZhcmlJZ25vcmVXZWJIb3N0bmFtZXMiLCJpZ25vcmVkSG9zdHMiLCJiIiwidHJpbSIsImlnbm9yZWRIb3N0IiwiaG9zdG5hbWUiLCJVUkwiLCJpZ24iLCJwYWdlIiwiaXNLZXkiLCJpbmZvIiwiY3VyQXBwSWRLZXkiLCJjdXJQYWdlSWRLZXkiLCJuZXdQYWdlIiwibGFzdCIsIm5lZWRzUGFnZUxvYWQiLCJjb250ZXh0QXJyYXkiLCJpc0VxdWFsIiwicGFnZUxvYWQiLCJjdXJyZW50UGFnZUlkIiwicCIsImNhdGNoIiwid2luZG93SGFuZGxlQ2FjaGUiLCJPYmplY3QiLCJhc3NpZ24iXSwic291cmNlcyI6WyIuLi8uLi8uLi9saWIvY29tbWFuZHMvY29udGV4dC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVSZW1vdGVEZWJ1Z2dlciwgUmVtb3RlRGVidWdnZXIgfSBmcm9tICdhcHBpdW0tcmVtb3RlLWRlYnVnZ2VyJztcbmltcG9ydCB7IGVycm9ycywgaXNFcnJvclR5cGUgfSBmcm9tICdhcHBpdW0vZHJpdmVyJztcbmltcG9ydCB7IHV0aWwsIHRpbWluZyB9IGZyb20gJ2FwcGl1bS9zdXBwb3J0JztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCBJT1NQZXJmb3JtYW5jZUxvZyBmcm9tICcuLi9kZXZpY2UtbG9nL2lvcy1wZXJmb3JtYW5jZS1sb2cnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcblxuY29uc3QgTkFUSVZFX1dJTiA9ICdOQVRJVkVfQVBQJztcbmNvbnN0IFdFQlZJRVdfV0lOID0gJ1dFQlZJRVcnO1xuY29uc3QgV0VCVklFV19CQVNFID0gYCR7V0VCVklFV19XSU59X2A7XG5jb25zdCBSRUNFTlRfV0VCVklFV19ERVRFQ1RJT05fVElNRU9VVF9NUyA9IDkwMDAwO1xuXG5jb25zdCBjb21tYW5kcyA9IHt9LCBoZWxwZXJzID0ge30sIGV4dGVuc2lvbnMgPSB7fTtcblxuXG5jb21tYW5kcy5nZXRDdXJyZW50Q29udGV4dCA9IGFzeW5jIGZ1bmN0aW9uIGdldEN1cnJlbnRDb250ZXh0ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gIGlmICh0aGlzLmN1ckNvbnRleHQgJiYgdGhpcy5jdXJDb250ZXh0ICE9PSBOQVRJVkVfV0lOKSB7XG4gICAgcmV0dXJuIGAke1dFQlZJRVdfQkFTRX0ke3RoaXMuY3VyQ29udGV4dH1gO1xuICB9XG4gIHJldHVybiBOQVRJVkVfV0lOO1xufTtcblxuZXh0ZW5zaW9ucy5nZXRDb250ZXh0c0FuZFZpZXdzID0gYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGV4dHNBbmRWaWV3cyAodXNlVXJsID0gdHJ1ZSkge1xuICB0aGlzLmxvZy5kZWJ1ZygnUmV0cmlldmluZyBjb250ZXh0cyBhbmQgdmlld3MnKTtcbiAgbGV0IHdlYnZpZXdzID0gYXdhaXQgdGhpcy5saXN0V2ViRnJhbWVzKHVzZVVybCk7XG5cbiAgbGV0IGN0eHMgPSBbe2lkOiBOQVRJVkVfV0lOLCB2aWV3OiB7fX1dO1xuICB0aGlzLmNvbnRleHRzID0gW05BVElWRV9XSU5dO1xuICBmb3IgKGxldCB2aWV3IG9mIHdlYnZpZXdzKSB7XG4gICAgY3R4cy5wdXNoKHtpZDogYCR7V0VCVklFV19CQVNFfSR7dmlldy5pZH1gLCB2aWV3fSk7XG4gICAgdGhpcy5jb250ZXh0cy5wdXNoKHZpZXcuaWQudG9TdHJpbmcoKSk7XG4gIH1cbiAgcmV0dXJuIGN0eHM7XG59O1xuXG4vLyBSaWdodCBub3cgd2UgZG9uJ3QgbmVjZXNzYXJpbHkgd2FpdCBmb3Igd2Vidmlld1xuLy8gYW5kIGZyYW1lIHRvIGxvYWQsIHdoaWNoIGxlYWRzIHRvIHJhY2UgY29uZGl0aW9ucyBhbmQgZmxha2luZXNzLFxuLy8gbGV0J3Mgc2VlIGlmIHdlIGNhbiB0cmFuc2l0aW9uIHRvIHNvbWV0aGluZyBiZXR0ZXJcbmV4dGVuc2lvbnMudXNlTmV3U2FmYXJpID0gZnVuY3Rpb24gdXNlTmV3U2FmYXJpICgpIHtcbiAgcmV0dXJuICF0aGlzLmlzUmVhbERldmljZSgpICYmIHRoaXMub3B0cy5zYWZhcmk7XG59O1xuXG5leHRlbnNpb25zLmFjdGl2YXRlUmVjZW50V2VidmlldyA9IGFzeW5jIGZ1bmN0aW9uIGFjdGl2YXRlUmVjZW50V2VidmlldyAoKSB7XG4gIHRoaXMubG9nLmRlYnVnKCdBY3RpdmF0aW5nIGEgcmVjZW50IHdlYnZpZXcnKTtcbiAgY29uc3QgdGltZXIgPSBuZXcgdGltaW5nLlRpbWVyKCkuc3RhcnQoKTtcbiAgY29uc3Qgc3BpblRpbWVNcyA9IDUwMDtcbiAgY29uc3Qgc3BpbkhhbmRsZXMgPSBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGNvbnRleHRJZDtcbiAgICB0cnkge1xuICAgICAgY29udGV4dElkID0gYXdhaXQgdGhpcy5nZXRSZWNlbnRXZWJ2aWV3Q29udGV4dElkKC8uKi8sIC8uKi8pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKCFlcnIubWVzc2FnZS5pbmNsdWRlcygnQ291bGQgbm90IGNvbm5lY3QgdG8gYSB2YWxpZCBhcHAgYWZ0ZXInKSkge1xuICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcihgQ291bGQgbm90IG5hdmlnYXRlIHRvIHdlYnZpZXchIEVycjogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgICAgZXJyb3Iuc3RhY2sgKz0gYFxcbkNhdXNlZCBieTogJHtlcnIuc3RhY2t9YDtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG4gICAgICB0aGlzLmxvZy5kZWJ1ZygnQ291bGQgbm90IG5hdmlnYXRlIHRvIHdlYnZpZXcuIFJldHJ5aW5nIGlmIHBvc3NpYmxlLicpO1xuICAgIH1cbiAgICBpZiAoY29udGV4dElkKSB7XG4gICAgICB0aGlzLmxvZy5kZWJ1ZyhgUGlja2luZyB3ZWJ2aWV3ICcke2NvbnRleHRJZH0nYCk7XG4gICAgICBhd2FpdCB0aGlzLnNldENvbnRleHQoY29udGV4dElkKTtcbiAgICAgIGF3YWl0IHRoaXMucmVtb3RlLmNhbmNlbFBhZ2VMb2FkKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gbm8gd2VidmlldyB3YXMgZm91bmRcbiAgICBpZiAodGltZXIuZ2V0RHVyYXRpb24oKS5hc01pbGxpU2Vjb25kcyA+PSBSRUNFTlRfV0VCVklFV19ERVRFQ1RJT05fVElNRU9VVF9NUykge1xuICAgICAgLy8gdG9vIHNsb3csIGdldCBvdXRcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ291bGQgbm90IG5hdmlnYXRlIHRvIHdlYnZpZXc7IHRoZXJlIGFyZSBub25lIScpO1xuICAgIH1cblxuICAgIHRoaXMubG9nLndhcm4oJ0NvdWxkIG5vdCBmaW5kIGFueSB3ZWJ2aWV3cyB5ZXQsIHJlZnJlc2hpbmcvcmV0cnlpbmcnKTtcbiAgICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSB8fCAhdGhpcy5vcHRzLnNhZmFyaSkge1xuICAgICAgLy8gb24gYSByZWFsIGRldmljZSwgd2hlbiBub3QgdXNpbmcgU2FmYXJpLCB3ZSBqdXN0IHdhbnQgdG8gdHJ5IGFnYWluXG4gICAgICBhd2FpdCBCLmRlbGF5KHNwaW5UaW1lTXMpO1xuICAgICAgcmV0dXJuIGF3YWl0IHNwaW5IYW5kbGVzKCk7XG4gICAgfVxuXG4gICAgLy8gZmluZCB0aGUgcmVsb2FkIGJ1dHRvbiBhbmQgdGFwIGl0LCBpZiBwb3NzaWJsZVxuICAgIGxldCBlbGVtZW50O1xuICAgIHRyeSB7XG4gICAgICB0aGlzLmxvZy5kZWJ1ZygnRmluZGluZyBhbmQgdGFwcGluZyByZWxvYWQgYnV0dG9uJyk7XG4gICAgICBlbGVtZW50ID0gYXdhaXQgdGhpcy5maW5kVUlFbGVtZW50T3JFbGVtZW50cygnYWNjZXNzaWJpbGl0eSBpZCcsICdSZWxvYWRCdXR0b24nLCAnJywgZmFsc2UpO1xuICAgICAgYXdhaXQgdGhpcy5uYXRpdmVDbGljayhlbGVtZW50KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHRoaXMubG9nLndhcm4oYEVycm9yIGZpbmRpbmcgYW5kIHRhcHBpbmcgcmVsb2FkIGJ1dHRvbjogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIHRoaXMubG9nLndhcm4oJ1JldHJ5aW5nLicpO1xuICAgICAgYXdhaXQgQi5kZWxheShzcGluVGltZU1zKTtcbiAgICB9XG5cbiAgICAvLyB0cnkgaXQgYWxsIGFnYWluXG4gICAgcmV0dXJuIGF3YWl0IHNwaW5IYW5kbGVzKCk7XG4gIH07XG4gIGF3YWl0IHNwaW5IYW5kbGVzKCk7XG59O1xuXG5oZWxwZXJzLnN0b3BSZW1vdGUgPSBhc3luYyBmdW5jdGlvbiBzdG9wUmVtb3RlIChjbG9zZVdpbmRvd0JlZm9yZURpc2Nvbm5lY3RpbmcgPSBmYWxzZSkge1xuICBpZiAoIXRoaXMucmVtb3RlKSB7XG4gICAgdGhpcy5sb2cuZXJyb3JBbmRUaHJvdygnVHJpZWQgdG8gbGVhdmUgYSB3ZWIgZnJhbWUgYnV0IHdlcmUgbm90IGluIG9uZScpO1xuICB9XG5cbiAgaWYgKGNsb3NlV2luZG93QmVmb3JlRGlzY29ubmVjdGluZykge1xuICAgIGF3YWl0IHRoaXMuY2xvc2VXaW5kb3coKTtcbiAgfVxuICBhd2FpdCB0aGlzLnJlbW90ZS5kaXNjb25uZWN0KCk7XG4gIHRoaXMuY3VyQ29udGV4dCA9IG51bGw7XG4gIHRoaXMuY3VyV2ViRnJhbWVzID0gW107XG4gIHRoaXMuY3VyV2ViQ29vcmRzID0gbnVsbDtcbiAgdGhpcy5yZW1vdGUgPSBudWxsO1xufTtcblxuaGVscGVycy5zZXRDdXJyZW50VXJsID0gZnVuY3Rpb24gc2V0Q3VycmVudFVybCAodXJsKSB7XG4gIHRoaXMuX2N1cnJlbnRVcmwgPSB1cmw7XG59O1xuXG5oZWxwZXJzLmdldEN1cnJlbnRVcmwgPSBmdW5jdGlvbiBnZXRDdXJyZW50VXJsICgpIHtcbiAgcmV0dXJuIHRoaXMuX2N1cnJlbnRVcmw7XG59O1xuXG5leHRlbnNpb25zLmdldFJlY2VudFdlYnZpZXdDb250ZXh0SWQgPSBhc3luYyBmdW5jdGlvbiBnZXRSZWNlbnRXZWJ2aWV3Q29udGV4dElkICh0aXRsZVJlZ0V4cCwgdXJsUmVnRXhwKSB7XG4gIGlmICghXy5pc1JlZ0V4cCh0aXRsZVJlZ0V4cCkgJiYgIV8uaXNSZWdFeHAodXJsUmVnRXhwKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuSW52YWxpZEFyZ3VtZW50RXJyb3IoXG4gICAgICAnQSByZWd1bGFyIGV4cHJlc3Npb24gZm9yIGVpdGhlciB3ZWIgdmlldyB0aXRsZSBvciB1cmwgbXVzdCBiZSBwcm92aWRlZCdcbiAgICApO1xuICB9XG5cbiAgY29uc3QgY3VycmVudFVybCA9IHRoaXMuZ2V0Q3VycmVudFVybCgpO1xuICBjb25zdCBjb250ZXh0cyA9IF8uZmlsdGVyKGF3YWl0IHRoaXMuZ2V0Q29udGV4dHNBbmRWaWV3cyhmYWxzZSksICd2aWV3Jyk7XG4gIC8vIGZpcnN0IHRyeSB0byBtYXRjaCBieSBjdXJyZW50IHVybFxuICBpZiAoY3VycmVudFVybCkge1xuICAgIGNvbnN0IGN0eCA9IGNvbnRleHRzLmZpbmQoKHt2aWV3fSkgPT4gKHZpZXcudXJsIHx8ICcnKSA9PT0gY3VycmVudFVybCk7XG4gICAgaWYgKGN0eCkge1xuICAgICAgcmV0dXJuIGN0eC5pZDtcbiAgICB9XG4gIH1cbiAgLy8gaWYgbm90LCB0cnkgdG8gbWF0Y2ggYnkgcmVndWxhciBleHByZXNzaW9uXG4gIHJldHVybiAoY29udGV4dHMuZmluZCgoe3ZpZXd9KSA9PlxuICAgIHZpZXcudGl0bGUgJiYgdGl0bGVSZWdFeHA/LnRlc3Qodmlldy50aXRsZSkgfHwgdmlldy51cmwgJiYgdXJsUmVnRXhwPy50ZXN0KHZpZXcudXJsKVxuICApKT8uaWQ7XG59O1xuXG5leHRlbnNpb25zLmlzV2ViQ29udGV4dCA9IGZ1bmN0aW9uIGlzV2ViQ29udGV4dCAoKSB7XG4gIHJldHVybiAhIXRoaXMuY3VyQ29udGV4dCAmJiB0aGlzLmN1ckNvbnRleHQgIT09IE5BVElWRV9XSU47XG59O1xuXG5leHRlbnNpb25zLmlzV2VidmlldyA9IGZ1bmN0aW9uIGlzV2VidmlldyAoKSB7XG4gIHJldHVybiB0aGlzLmlzV2ViQ29udGV4dCgpO1xufTtcblxuZXh0ZW5zaW9ucy5nZXROZXdSZW1vdGVEZWJ1Z2dlciA9IGFzeW5jIGZ1bmN0aW9uIGdldE5ld1JlbW90ZURlYnVnZ2VyICgpIHtcbiAgbGV0IHNvY2tldFBhdGg7XG4gIGlmICghdGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgIHNvY2tldFBhdGggPSBhd2FpdCB0aGlzLm9wdHMuZGV2aWNlLmdldFdlYkluc3BlY3RvclNvY2tldCgpO1xuICB9XG4gIHJldHVybiBjcmVhdGVSZW1vdGVEZWJ1Z2dlcih7XG4gICAgYnVuZGxlSWQ6IHRoaXMub3B0cy5idW5kbGVJZCxcbiAgICBhZGRpdGlvbmFsQnVuZGxlSWRzOiB0aGlzLm9wdHMuYWRkaXRpb25hbFdlYnZpZXdCdW5kbGVJZHMsXG4gICAgaXNTYWZhcmk6IHRoaXMuaXNTYWZhcmkoKSxcbiAgICBpbmNsdWRlU2FmYXJpOiB0aGlzLm9wdHMuaW5jbHVkZVNhZmFyaUluV2Vidmlld3MsXG4gICAgdXNlTmV3U2FmYXJpOiB0aGlzLnVzZU5ld1NhZmFyaSgpLFxuICAgIHBhZ2VMb2FkTXM6IHRoaXMucGFnZUxvYWRNcyxcbiAgICBwbGF0Zm9ybVZlcnNpb246IHRoaXMub3B0cy5wbGF0Zm9ybVZlcnNpb24sXG4gICAgc29ja2V0UGF0aCxcbiAgICByZW1vdGVEZWJ1Z1Byb3h5OiB0aGlzLm9wdHMucmVtb3RlRGVidWdQcm94eSxcbiAgICBnYXJiYWdlQ29sbGVjdE9uRXhlY3V0ZTogdXRpbC5oYXNWYWx1ZSh0aGlzLm9wdHMuc2FmYXJpR2FyYmFnZUNvbGxlY3QpXG4gICAgICA/ICEhdGhpcy5vcHRzLnNhZmFyaUdhcmJhZ2VDb2xsZWN0XG4gICAgICA6IGZhbHNlLFxuICAgIHVkaWQ6IHRoaXMub3B0cy51ZGlkLFxuICAgIGxvZ0FsbENvbW11bmljYXRpb246IHRoaXMub3B0cy5zYWZhcmlMb2dBbGxDb21tdW5pY2F0aW9uLFxuICAgIGxvZ0FsbENvbW11bmljYXRpb25IZXhEdW1wOiB0aGlzLm9wdHMuc2FmYXJpTG9nQWxsQ29tbXVuaWNhdGlvbkhleER1bXAsXG4gICAgc29ja2V0Q2h1bmtTaXplOiB0aGlzLm9wdHMuc2FmYXJpU29ja2V0Q2h1bmtTaXplLFxuICAgIHdlYkluc3BlY3Rvck1heEZyYW1lTGVuZ3RoOiB0aGlzLm9wdHMuc2FmYXJpV2ViSW5zcGVjdG9yTWF4RnJhbWVMZW5ndGhcbiAgfSwgdGhpcy5pc1JlYWxEZXZpY2UoKSk7XG59O1xuXG4vKipcbiAqIFNldCBjb250ZXh0XG4gKlxuICogQHBhcmFtIHs/c3RyaW5nfSBuYW1lIC0gVGhlIG5hbWUgb2YgY29udGV4dCB0byBzZXQuIEl0IGNvdWxkIGJlICdudWxsJyBhcyBOQVRJVkVfV0lOLlxuICogQHBhcmFtIHtjYWxsYmFja30gY2FsbGJhY2sgVGhlIGNhbGxiYWNrLiAoSXQgaXMgbm90IGNhbGxlZCBpbiB0aGlzIG1ldGhvZClcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gc2tpcFJlYWR5Q2hlY2sgLSBXaGV0aGVyIGl0IHdhaXRzIGZvciB0aGUgbmV3IGNvbnRleHQgaXMgcmVhZHlcbiAqL1xuY29tbWFuZHMuc2V0Q29udGV4dCA9IGFzeW5jIGZ1bmN0aW9uIHNldENvbnRleHQgKG5hbWUsIGNhbGxiYWNrLCBza2lwUmVhZHlDaGVjaykge1xuICBmdW5jdGlvbiBhbHJlYWR5SW5Db250ZXh0IChkZXNpcmVkLCBjdXJyZW50KSB7XG4gICAgcmV0dXJuIChkZXNpcmVkID09PSBjdXJyZW50IHx8XG4gICAgICAoZGVzaXJlZCA9PT0gbnVsbCAmJiBjdXJyZW50ID09PSBOQVRJVkVfV0lOKSB8fFxuICAgICAgKGRlc2lyZWQgPT09IE5BVElWRV9XSU4gJiYgY3VycmVudCA9PT0gbnVsbCkpO1xuICB9XG4gIGZ1bmN0aW9uIGlzTmF0aXZlQ29udGV4dCAoY29udGV4dCkge1xuICAgIHJldHVybiBjb250ZXh0ID09PSBOQVRJVkVfV0lOIHx8IGNvbnRleHQgPT09IG51bGw7XG4gIH1cblxuICAvLyBhbGxvdyB0aGUgZnVsbCBjb250ZXh0IGxpc3QgdG8gYmUgcGFzc2VkIGluXG4gIGlmIChuYW1lICYmIG5hbWUuaWQpIHtcbiAgICBuYW1lID0gbmFtZS5pZDtcbiAgfVxuXG4gIHRoaXMubG9nLmRlYnVnKGBBdHRlbXB0aW5nIHRvIHNldCBjb250ZXh0IHRvICcke25hbWUgfHwgTkFUSVZFX1dJTn0nIGZyb20gJyR7dGhpcy5jdXJDb250ZXh0ID8gdGhpcy5jdXJDb250ZXh0IDogTkFUSVZFX1dJTn0nYCk7XG5cbiAgaWYgKGFscmVhZHlJbkNvbnRleHQobmFtZSwgdGhpcy5jdXJDb250ZXh0KSB8fCBhbHJlYWR5SW5Db250ZXh0KF8ucmVwbGFjZShuYW1lLCBXRUJWSUVXX0JBU0UsICcnKSwgdGhpcy5jdXJDb250ZXh0KSkge1xuICAgIC8vIGFscmVhZHkgaW4gdGhlIG5hbWVkIGNvbnRleHQsIG5vIG5lZWQgdG8gZG8gYW55dGhpbmdcbiAgICB0aGlzLmxvZy5kZWJ1ZyhgQWxyZWFkeSBpbiAnJHtuYW1lIHx8IE5BVElWRV9XSU59JyBjb250ZXh0LiBEb2luZyBub3RoaW5nLmApO1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAoaXNOYXRpdmVDb250ZXh0KG5hbWUpKSB7XG4gICAgLy8gc3dpdGNoaW5nIGludG8gdGhlIG5hdGl2ZSBjb250ZXh0XG4gICAgdGhpcy5jdXJDb250ZXh0ID0gbnVsbDtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBzd2l0Y2hpbmcgaW50byBhIHdlYnZpZXcgY29udGV4dFxuXG4gIC8vIGlmIGNvbnRleHRzIGhhdmUgbm90IGFscmVhZHkgYmVlbiByZXRyaWV2ZWQsIGdldCB0aGVtXG4gIGlmIChfLmlzVW5kZWZpbmVkKHRoaXMuY29udGV4dHMpKSB7XG4gICAgYXdhaXQgdGhpcy5nZXRDb250ZXh0cygpO1xuICB9XG5cbiAgbGV0IGNvbnRleHRJZCA9IF8ucmVwbGFjZShuYW1lLCBXRUJWSUVXX0JBU0UsICcnKTtcbiAgaWYgKGNvbnRleHRJZCA9PT0gJycpIHtcbiAgICAvLyBhbGxvdyB1c2VyIHRvIHBhc3MgaW4gXCJXRUJWSUVXXCIgd2l0aG91dCBhbiBpbmRleFxuICAgIC8vIHRoZSBzZWNvbmQgY29udGV4dCB3aWxsIGJlIHRoZSBmaXJzdCB3ZWJ2aWV3IGFzXG4gICAgLy8gdGhlIGZpcnN0IGlzIGFsd2F5cyBOQVRJVkVfQVBQXG4gICAgY29udGV4dElkID0gdGhpcy5jb250ZXh0c1sxXTtcbiAgfVxuICBpZiAoIV8uaW5jbHVkZXModGhpcy5jb250ZXh0cywgY29udGV4dElkKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoQ29udGV4dEVycm9yKCk7XG4gIH1cblxuICBjb25zdCBvbGRDb250ZXh0ID0gdGhpcy5jdXJDb250ZXh0O1xuICB0aGlzLmN1ckNvbnRleHQgPSB0aGlzLmN1cldpbmRvd0hhbmRsZSA9IGNvbnRleHRJZDtcblxuICAvLyBgY29udGV4dElkYCB3aWxsIGJlIGluIHRoZSBmb3JtIG9mIGBhcHBJZC5wYWdlSWRgIGluIHRoaXMgY2FzZVxuICBjb25zdCBbYXBwSWRLZXksIHBhZ2VJZEtleV0gPSBfLm1hcChjb250ZXh0SWQuc3BsaXQoJy4nKSwgKGlkKSA9PiBwYXJzZUludChpZCwgMTApKTtcbiAgdHJ5IHtcbiAgICB0aGlzLnNlbGVjdGluZ05ld1BhZ2UgPSB0cnVlO1xuICAgIGF3YWl0IHRoaXMucmVtb3RlLnNlbGVjdFBhZ2UoYXBwSWRLZXksIHBhZ2VJZEtleSwgc2tpcFJlYWR5Q2hlY2spO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICB0aGlzLmN1ckNvbnRleHQgPSB0aGlzLmN1cldpbmRvd0hhbmRsZSA9IG9sZENvbnRleHQ7XG4gICAgdGhyb3cgZXJyO1xuICB9IGZpbmFsbHkge1xuICAgIHRoaXMuc2VsZWN0aW5nTmV3UGFnZSA9IGZhbHNlO1xuICB9XG5cbiAgLy8gYXR0ZW1wdCB0byBzdGFydCBwZXJmb3JtYW5jZSBsb2dnaW5nLCBpZiByZXF1ZXN0ZWRcbiAgaWYgKHRoaXMub3B0cy5lbmFibGVQZXJmb3JtYW5jZUxvZ2dpbmcgJiYgdGhpcy5yZW1vdGUpIHtcbiAgICB0aGlzLmxvZy5kZWJ1ZyhgU3RhcnRpbmcgcGVyZm9ybWFuY2UgbG9nIG9uICcke3RoaXMuY3VyQ29udGV4dH0nYCk7XG4gICAgdGhpcy5sb2dzLnBlcmZvcm1hbmNlID0gbmV3IElPU1BlcmZvcm1hbmNlTG9nKHRoaXMucmVtb3RlKTtcbiAgICBhd2FpdCB0aGlzLmxvZ3MucGVyZm9ybWFuY2Uuc3RhcnRDYXB0dXJlKCk7XG4gIH1cblxuICAvLyBzdGFydCBzYWZhcmkgbG9nZ2luZyBpZiB0aGUgbG9ncyBoYW5kbGVycyBhcmUgYWN0aXZlXG4gIGlmIChuYW1lICYmIG5hbWUgIT09IE5BVElWRV9XSU4gJiYgdGhpcy5sb2dzKSB7XG4gICAgaWYgKHRoaXMubG9ncy5zYWZhcmlDb25zb2xlKSB7XG4gICAgICBhd2FpdCB0aGlzLnJlbW90ZS5zdGFydENvbnNvbGUodGhpcy5sb2dzLnNhZmFyaUNvbnNvbGUuYWRkTG9nTGluZS5iaW5kKHRoaXMubG9ncy5zYWZhcmlDb25zb2xlKSk7XG4gICAgfVxuICAgIGlmICh0aGlzLmxvZ3Muc2FmYXJpTmV0d29yaykge1xuICAgICAgYXdhaXQgdGhpcy5yZW1vdGUuc3RhcnROZXR3b3JrKHRoaXMubG9ncy5zYWZhcmlOZXR3b3JrLmFkZExvZ0xpbmUuYmluZCh0aGlzLmxvZ3Muc2FmYXJpTmV0d29yaykpO1xuICAgIH1cbiAgfVxufTtcblxuZXh0ZW5zaW9ucy5jb25uZWN0VG9SZW1vdGVEZWJ1Z2dlciA9IGFzeW5jIGZ1bmN0aW9uIGNvbm5lY3RUb1JlbW90ZURlYnVnZ2VyICgpIHtcbiAgdGhpcy5yZW1vdGUgPSBhd2FpdCB0aGlzLmdldE5ld1JlbW90ZURlYnVnZ2VyKCk7XG5cbiAgdGhpcy5yZW1vdGUub24oUmVtb3RlRGVidWdnZXIuRVZFTlRfUEFHRV9DSEFOR0UsIHRoaXMub25QYWdlQ2hhbmdlLmJpbmQodGhpcykpO1xuICB0aGlzLnJlbW90ZS5vbihSZW1vdGVEZWJ1Z2dlci5FVkVOVF9GUkFNRVNfREVUQUNIRUQsICgpID0+IHtcbiAgICBpZiAoIV8uaXNFbXB0eSh0aGlzLmN1cldlYkZyYW1lcykpIHtcbiAgICAgIHRoaXMubG9nLmRlYnVnKGBDbGVhcmluZyAke3V0aWwucGx1cmFsaXplKCdmcmFtZScsIHRoaXMuY3VyV2ViRnJhbWVzLmxlbmd0aCwgdHJ1ZSl9OiAke3RoaXMuY3VyV2ViRnJhbWVzLmpvaW4oJywgJyl9YCk7XG4gICAgfVxuICAgIHRoaXMuY3VyV2ViRnJhbWVzID0gW107XG4gIH0pO1xuXG4gIGF3YWl0IHRoaXMucmVtb3RlLmNvbm5lY3QodGhpcy5vcHRzLndlYnZpZXdDb25uZWN0VGltZW91dCk7XG59O1xuXG5leHRlbnNpb25zLmxpc3RXZWJGcmFtZXMgPSBhc3luYyBmdW5jdGlvbiBsaXN0V2ViRnJhbWVzICh1c2VVcmwgPSB0cnVlKSB7XG4gIHVzZVVybCA9IHVzZVVybCAmJiAhdGhpcy5pc1JlYWxEZXZpY2UoKSAmJiAhIXRoaXMuZ2V0Q3VycmVudFVybCgpO1xuICB0aGlzLmxvZy5kZWJ1ZyhgU2VsZWN0aW5nIGJ5IHVybDogJHt1c2VVcmx9JHt1c2VVcmwgPyBgIChleHBlY3RlZCB1cmw6ICcke3RoaXMuZ2V0Q3VycmVudFVybCgpfScpYCA6ICcnfWApO1xuXG4gIGlmICghdGhpcy5yZW1vdGUpIHtcbiAgICBhd2FpdCB0aGlzLmNvbm5lY3RUb1JlbW90ZURlYnVnZ2VyKCk7XG4gICAgaWYgKCF0aGlzLnJlbW90ZS5hcHBJZEtleSkge1xuICAgICAgYXdhaXQgdGhpcy5yZW1vdGUuc2V0Q29ubmVjdGlvbktleSgpO1xuICAgIH1cbiAgfVxuICBjb25zdCBnZXRXZWJ2aWV3UGFnZXMgPSBhc3luYyAoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnJlbW90ZS5zZWxlY3RBcHAoXG4gICAgICAgIHVzZVVybCA/IHRoaXMuZ2V0Q3VycmVudFVybCgpIDogdW5kZWZpbmVkLFxuICAgICAgICB0aGlzLm9wdHMud2Vidmlld0Nvbm5lY3RSZXRyaWVzLFxuICAgICAgICB0aGlzLm9wdHMuaWdub3JlQWJvdXRCbGFua1VybFxuICAgICAgKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHRoaXMubG9nLmRlYnVnKGBObyBhdmFpbGFibGUgd2ViIHBhZ2VzOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgcGFnZUFycmF5ID0gYXdhaXQgZ2V0V2Vidmlld1BhZ2VzKCk7XG4gIGlmIChfLmlzRW1wdHkocGFnZUFycmF5KSkge1xuICAgIC8vIHdlIGhhdmUgbm8gd2ViIGZyYW1lcywgYnV0IGNvbnRpbnVlIGFueXdheVxuICAgIHRoaXMubG9nLmRlYnVnKCdObyB3ZWIgZnJhbWVzIGZvdW5kLicpO1xuICB9XG4gIHJldHVybiBwYWdlQXJyYXk7XG59O1xuXG5jb21tYW5kcy5nZXRDb250ZXh0cyA9IGFzeW5jIGZ1bmN0aW9uIGdldENvbnRleHRzICgpIHtcbiAgdGhpcy5sb2cuZGVidWcoJ0dldHRpbmcgbGlzdCBvZiBhdmFpbGFibGUgY29udGV4dHMnKTtcbiAgY29uc3QgY29udGV4dHMgPSBhd2FpdCB0aGlzLmdldENvbnRleHRzQW5kVmlld3MoZmFsc2UpO1xuXG4gIGNvbnN0IG1hcEZuID0gdGhpcy5vcHRzLmZ1bGxDb250ZXh0TGlzdFxuICAgID8gZnVuY3Rpb24gKGNvbnRleHQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkOiBjb250ZXh0LmlkLnRvU3RyaW5nKCksXG4gICAgICAgIHRpdGxlOiBjb250ZXh0LnZpZXcudGl0bGUsXG4gICAgICAgIHVybDogY29udGV4dC52aWV3LnVybCxcbiAgICAgICAgYnVuZGxlSWQ6IGNvbnRleHQudmlldy5idW5kbGVJZCxcbiAgICAgIH07XG4gICAgfVxuICAgIDogKGNvbnRleHQpID0+IGNvbnRleHQuaWQudG9TdHJpbmcoKTtcbiAgcmV0dXJuIGNvbnRleHRzLm1hcChtYXBGbik7XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IENvbnRleHRcbiAqXG4gKiBAcHJvcGVydHkge3N0cmluZ30gaWQgLSBUaGUgaWRlbnRpZmllciBvZiB0aGUgY29udGV4dC4gVGhlIG5hdGl2ZSBjb250ZXh0XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgd2lsbCBiZSAnTkFUSVZFX0FQUCcgYW5kIHRoZSB3ZWJ2aWV3cyB3aWxsIGJlXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgJ1dFQlZJRVdfeHh4J1xuICogQHByb3BlcnR5IHs/c3RyaW5nfSB0aXRsZSAtIFRoZSB0aXRsZSBhc3NvY2lhdGVkIHdpdGggdGhlIHdlYnZpZXcgY29udGVudFxuICogQHByb3BlcnR5IHs/c3RyaW5nfSB1cmwgLSBUaGUgdXJsIGFzc29jaWF0ZWQgd2l0aCB0aGUgd2VidmlldyBjb250ZW50XG4gKi9cblxuLyoqXG4gKiBHZXQgdGhlIGNvbnRleHRzIGF2YWlsYWJsZSwgd2l0aCBpbmZvcm1hdGlvbiBhYm91dCB0aGUgdXJsIGFuZCB0aXRsZSBvZiBlYWNoXG4gKiB3ZWJ2aWV3XG4gKlxuICogQHBhcmFtIHtPYmplY3R9IG9wdHMgLSBPcHRpb25zIHNldCwgd2hpY2ggY2FuIGluY2x1ZGUgYHdhaXRGb3JXZWJ2aWV3TXNgIHRvXG4gKiAgICAgICAgICAgICAgICAgICAgICAgIHNwZWNpZnkgdGhlIHBlcmlvZCB0byBwb2xsIGZvciBhdmFpbGFibGUgd2Vidmlld3NcbiAqIEByZXR1cm5zIHtBcnJheX0gTGlzdCBvZiBDb250ZXh0IG9iamVjdHNcbiAqL1xuZXh0ZW5zaW9ucy5tb2JpbGVHZXRDb250ZXh0cyA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZUdldENvbnRleHRzIChvcHRzID0ge30pIHtcbiAgbGV0IHtcbiAgICB3YWl0Rm9yV2Vidmlld01zID0gMCxcbiAgfSA9IG9wdHM7XG5cbiAgLy8gbWFrZSBzdXJlIGl0IGlzIGEgbnVtYmVyLCBzbyB0aGUgZHVyYXRpb24gY2hlY2sgd29ya3MgcHJvcGVybHlcbiAgaWYgKCFfLmlzTnVtYmVyKHdhaXRGb3JXZWJ2aWV3TXMpKSB7XG4gICAgd2FpdEZvcldlYnZpZXdNcyA9IHBhcnNlSW50KHdhaXRGb3JXZWJ2aWV3TXMsIDEwKTtcbiAgICBpZiAoaXNOYU4od2FpdEZvcldlYnZpZXdNcykpIHtcbiAgICAgIHdhaXRGb3JXZWJ2aWV3TXMgPSAwO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGN1ck9wdCA9IHRoaXMub3B0cy5mdWxsQ29udGV4dExpc3Q7XG4gIHRoaXMub3B0cy5mdWxsQ29udGV4dExpc3QgPSB0cnVlO1xuXG4gIGNvbnN0IHRpbWVyID0gbmV3IHRpbWluZy5UaW1lcigpLnN0YXJ0KCk7XG4gIHRyeSB7XG4gICAgbGV0IGNvbnRleHRzO1xuICAgIGRvIHtcbiAgICAgIGNvbnRleHRzID0gYXdhaXQgdGhpcy5nZXRDb250ZXh0cygpO1xuXG4gICAgICBpZiAoY29udGV4dHMubGVuZ3RoID49IDIpIHtcbiAgICAgICAgdGhpcy5sb2cuZGVidWcoYEZvdW5kIHdlYnZpZXcgY29udGV4dCBhZnRlciAke3RpbWVyLmdldER1cmF0aW9uKCkuYXNNaWxsaVNlY29uZHMudG9GaXhlZCgwKX1tc2ApO1xuICAgICAgICByZXR1cm4gY29udGV4dHM7XG4gICAgICB9XG4gICAgICB0aGlzLmxvZy5kZWJ1ZyhgTm8gd2Vidmlld3MgZm91bmQgaW4gJHt0aW1lci5nZXREdXJhdGlvbigpLmFzTWlsbGlTZWNvbmRzLnRvRml4ZWQoMCl9bXNgKTtcbiAgICB9IHdoaWxlICh0aW1lci5nZXREdXJhdGlvbigpLmFzTWlsbGlTZWNvbmRzIDwgd2FpdEZvcldlYnZpZXdNcyk7XG4gICAgcmV0dXJuIGNvbnRleHRzO1xuICB9IGZpbmFsbHkge1xuICAgIC8vIHJlc2V0IHRoZSBvcHRpb24gc28gdGhlcmUgYXJlIG5vIHNpZGUgZWZmZWN0c1xuICAgIHRoaXMub3B0cy5mdWxsQ29udGV4dExpc3QgPSBjdXJPcHQ7XG4gIH1cbn07XG5cbmNvbW1hbmRzLnNldFdpbmRvdyA9IGFzeW5jIGZ1bmN0aW9uIHNldFdpbmRvdyAobmFtZSwgc2tpcFJlYWR5Q2hlY2spIHtcbiAgdHJ5IHtcbiAgICBhd2FpdCB0aGlzLnNldENvbnRleHQobmFtZSwgXy5ub29wLCBza2lwUmVhZHlDaGVjayk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIC8vIHRyYW5zbGF0ZSB0aGUgZXJyb3IgaW4gdGVybXMgb2Ygd2luZG93c1xuICAgIHRocm93IGlzRXJyb3JUeXBlKGVyciwgZXJyb3JzLk5vU3VjaENvbnRleHRFcnJvcilcbiAgICAgID8gbmV3IGVycm9ycy5Ob1N1Y2hXaW5kb3dFcnJvcigpXG4gICAgICA6IGVycjtcbiAgfVxufTtcblxuY29tbWFuZHMuZ2V0V2luZG93SGFuZGxlID0gYXN5bmMgZnVuY3Rpb24gZ2V0V2luZG93SGFuZGxlICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gIGlmICghdGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm90SW1wbGVtZW50ZWRFcnJvcigpO1xuICB9XG4gIHRoaXMubG9nLmRlYnVnKGBHZXR0aW5nIGN1cnJlbnQgd2luZG93IGhhbmRsZWApO1xuICByZXR1cm4gdGhpcy5jdXJDb250ZXh0O1xufTtcblxuY29tbWFuZHMuZ2V0V2luZG93SGFuZGxlcyA9IGFzeW5jIGZ1bmN0aW9uIGdldFdpbmRvd0hhbmRsZXMgKCkge1xuICBpZiAoIXRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vdEltcGxlbWVudGVkRXJyb3IoKTtcbiAgfVxuICB0aGlzLmxvZy5kZWJ1ZygnR2V0dGluZyBsaXN0IG9mIGF2YWlsYWJsZSB3aW5kb3cgaGFuZGxlcycpO1xuICBjb25zdCBjb250ZXh0cyA9IGF3YWl0IHRoaXMuZ2V0Q29udGV4dHNBbmRWaWV3cyhmYWxzZSk7XG4gIHJldHVybiBjb250ZXh0c1xuICAgIC8vIGdldCByaWQgb2YgdGhlIG5hdGl2ZSBhcHAgY29udGV4dFxuICAgIC5maWx0ZXIoKGNvbnRleHQpID0+IGNvbnRleHQuaWQgIT09IE5BVElWRV9XSU4pXG4gICAgLy8gZ2V0IHRoZSBgYXBwLmlkYCBmb3JtYXQgZXhwZWN0ZWRcbiAgICAubWFwKChjb250ZXh0KSA9PiBjb250ZXh0LnZpZXcuaWQudG9TdHJpbmcoKSk7XG59O1xuXG5leHRlbnNpb25zLm9uUGFnZUNoYW5nZSA9IGFzeW5jIGZ1bmN0aW9uIG9uUGFnZUNoYW5nZSAocGFnZUNoYW5nZU5vdGlmaWNhdGlvbikge1xuICB0aGlzLmxvZy5kZWJ1ZyhgUmVtb3RlIGRlYnVnZ2VyIG5vdGlmaWVkIHVzIG9mIGEgbmV3IHBhZ2UgbGlzdGluZzogJHtKU09OLnN0cmluZ2lmeShwYWdlQ2hhbmdlTm90aWZpY2F0aW9uKX1gKTtcbiAgaWYgKHRoaXMuc2VsZWN0aW5nTmV3UGFnZSkge1xuICAgIHRoaXMubG9nLmRlYnVnKCdXZSBhcmUgaW4gdGhlIG1pZGRsZSBvZiBzZWxlY3RpbmcgYSBwYWdlLCBpZ25vcmluZycpO1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAoIXRoaXMucmVtb3RlIHx8ICF0aGlzLnJlbW90ZS5pc0Nvbm5lY3RlZCkge1xuICAgIHRoaXMubG9nLmRlYnVnKCdXZSBoYXZlIG5vdCB5ZXQgY29ubmVjdGVkLCBpZ25vcmluZycpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHthcHBJZEtleSwgcGFnZUFycmF5fSA9IHBhZ2VDaGFuZ2VOb3RpZmljYXRpb247XG5cbiAgbGV0IG5ld0lkcyA9IFtdO1xuICBsZXQgbmV3UGFnZXMgPSBbXTtcbiAgbGV0IGtleUlkID0gbnVsbDtcblxuICAvLyBDaGVja3MgaWYgYSBVUkwgaXMgYmxhY2tsaXN0ZWQgaW4gdGhlICdzYWZhcmlJZ25vcmVXZWJIb3N0bmFtZXMnIGNhcGFiaWxpdHlcbiAgZnVuY3Rpb24gaXNVcmxJZ25vcmVkICh1cmwsIHNhZmFyaUlnbm9yZVdlYkhvc3RuYW1lcykge1xuICAgIGNvbnN0IGlnbm9yZWRIb3N0cyA9IChzYWZhcmlJZ25vcmVXZWJIb3N0bmFtZXMgfHwgJycpXG4gICAgICAuc3BsaXQoJywnKVxuICAgICAgLm1hcCgoYikgPT4gYi50cmltKCkpXG4gICAgICAuZmlsdGVyKChiKSA9PiAhXy5pc0VtcHR5KGIpKTtcbiAgICBmb3IgKGNvbnN0IGlnbm9yZWRIb3N0IG9mIGlnbm9yZWRIb3N0cykge1xuICAgICAgaWYgKGlnbm9yZWRIb3N0ID09PSAnYWJvdXQ6YmxhbmsnICYmIHVybCA9PT0gJ2Fib3V0OmJsYW5rJykge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgaG9zdG5hbWUgPSBuZXcgVVJMKHVybCkuaG9zdG5hbWU7XG4gICAgICAgICAgaWYgKGhvc3RuYW1lID09PSBpZ25vcmVkSG9zdCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChpZ24pIHtcbiAgICAgICAgICAvLyBkbyBub3RoaW5nIGlmIGludmFsaWQgVVJMXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgZm9yIChjb25zdCBwYWdlIG9mIHBhZ2VBcnJheSkge1xuICAgIGNvbnN0IGlkID0gcGFnZS5pZC50b1N0cmluZygpO1xuICAgIG5ld0lkcy5wdXNoKGlkKTtcbiAgICBpZiAocGFnZS5pc0tleSkge1xuICAgICAga2V5SWQgPSBpZDtcbiAgICB9XG4gICAgY29uc3QgY29udGV4dElkID0gYCR7YXBwSWRLZXl9LiR7aWR9YDtcblxuICAgIC8vIGFkZCBpZiB0aGlzIGlzIGEgbmV3IHBhZ2VcbiAgICBpZiAoIV8uaW5jbHVkZXModGhpcy5jb250ZXh0cywgY29udGV4dElkKSkge1xuICAgICAgaWYgKGlzVXJsSWdub3JlZChwYWdlLnVybCwgdGhpcy5vcHRzLnNhZmFyaUlnbm9yZVdlYkhvc3RuYW1lcykpIHtcbiAgICAgICAgdGhpcy5sb2cuaW5mbyhgTm90IHRyYWNraW5nICcke3BhZ2UudXJsfScgcGFnZSBiZWNhdXNlIGl0IGlzIGJsYWNrbGlzdGVkLiBgICtcbiAgICAgICAgICBgJ3NhZmFyaUlnbm9yZVdlYkhvc3RuYW1lcyc9JHt0aGlzLm9wdHMuc2FmYXJpSWdub3JlV2ViSG9zdG5hbWVzfWApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV3UGFnZXMucHVzaChpZCk7XG4gICAgICAgIHRoaXMuY29udGV4dHMucHVzaChjb250ZXh0SWQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGlmICgha2V5SWQpIHtcbiAgICAvLyBpZiB0aGVyZSBpcyBubyBrZXkgaWQsIHB1bGwgdGhlIGZpcnN0IGlkIGZyb20gdGhlIHBhZ2UgYXJyYXkgYW5kIHVzZSB0aGF0XG4gICAgLy8gYXMgYSBzdGFuZCBpblxuICAgIHRoaXMubG9nLmRlYnVnKCdObyBrZXkgaWQgZm91bmQuIENob29zaW5nIGZpcnN0IGlkIGZyb20gcGFnZSBhcnJheScpO1xuICAgIGtleUlkID0gbmV3SWRzWzBdIHx8IG51bGw7XG4gIH1cblxuICBpZiAoIXV0aWwuaGFzVmFsdWUodGhpcy5jdXJDb250ZXh0KSkge1xuICAgIHRoaXMubG9nLmRlYnVnKCdXZSBkbyBub3QgYXBwZWFyIHRvIGhhdmUgd2luZG93IHNldCB5ZXQsIGlnbm9yaW5nJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgW2N1ckFwcElkS2V5LCBjdXJQYWdlSWRLZXldID0gdGhpcy5jdXJDb250ZXh0LnNwbGl0KCcuJyk7XG5cbiAgaWYgKGN1ckFwcElkS2V5ICE9PSBhcHBJZEtleSkge1xuICAgIHRoaXMubG9nLmRlYnVnKCdQYWdlIGNoYW5nZSBub3QgcmVmZXJyaW5nIHRvIGN1cnJlbnRseSBzZWxlY3RlZCBhcHAsIGlnbm9yaW5nLicpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxldCBuZXdQYWdlID0gbnVsbDtcbiAgaWYgKG5ld1BhZ2VzLmxlbmd0aCkge1xuICAgIG5ld1BhZ2UgPSBfLmxhc3QobmV3UGFnZXMpO1xuICAgIHRoaXMubG9nLmRlYnVnKGBXZSBoYXZlIG5ldyBwYWdlcywgc2VsZWN0aW5nIHBhZ2UgJyR7bmV3UGFnZX0nYCk7XG4gIH0gZWxzZSBpZiAoIV8uaW5jbHVkZXMobmV3SWRzLCBjdXJQYWdlSWRLZXkpKSB7XG4gICAgdGhpcy5sb2cuZGVidWcoJ05ldyBwYWdlIGxpc3RpbmcgZnJvbSByZW1vdGUgZGVidWdnZXIgZG9lcyBub3QgY29udGFpbiAnICtcbiAgICAgICAgICAgICAgICAgJ2N1cnJlbnQgd2luZG93OyBhc3N1bWluZyBpdCBpcyBjbG9zZWQnKTtcbiAgICBpZiAoIXV0aWwuaGFzVmFsdWUoa2V5SWQpKSB7XG4gICAgICB0aGlzLmxvZy5lcnJvcignRG8gbm90IGhhdmUgb3VyIGN1cnJlbnQgd2luZG93IGFueW1vcmUsIGFuZCB0aGVyZSAnICtcbiAgICAgICAgICAgICAgICAgICAnYXJlIG5vdCBhbnkgbW9yZSB0byBsb2FkISBEb2luZyBub3RoaW5nLi4uJyk7XG4gICAgICB0aGlzLnNldEN1cnJlbnRVcmwodW5kZWZpbmVkKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmxvZy5kZWJ1ZyhgRGVidWdnZXIgYWxyZWFkeSBzZWxlY3RlZCBwYWdlICcke2tleUlkfScsIGAgK1xuICAgICAgICAgICAgICAgICBgY29uZmlybWluZyB0aGF0IGNob2ljZS5gKTtcbiAgICB0aGlzLmN1ckNvbnRleHQgPSBgJHthcHBJZEtleX0uJHtrZXlJZH1gO1xuICAgIG5ld1BhZ2UgPSBrZXlJZDtcbiAgfSBlbHNlIHtcbiAgICAvLyBhdCB0aGlzIHBvaW50LCB0aGVyZSBhcmUgbm8gbmV3IHBhZ2VzLCBhbmQgdGhlIGN1cnJlbnQgcGFnZSBzdGlsbCBleGlzdHNcbiAgICB0aGlzLmxvZy5kZWJ1ZygnQ2hlY2tpbmcgaWYgcGFnZSBuZWVkcyB0byBsb2FkJyk7XG4gICAgLy8gSWYgYSB3aW5kb3cgbmF2aWdhdGVzIHRvIGFuIGFuY2hvciBpdCBkb2Vzbid0IGFsd2F5cyBmaXJlIGEgcGFnZVxuICAgIC8vIGNhbGxiYWNrIGV2ZW50LiBMZXQncyBjaGVjayBpZiB3ZSB3b3VuZCB1cCBpbiBzdWNoIGEgc2l0dWF0aW9uLlxuICAgIGNvbnN0IG5lZWRzUGFnZUxvYWQgPSAoKCkgPT4ge1xuICAgICAgLy8gbmVlZCB0byBtYXAgdGhlIHBhZ2UgaWRzIHRvIGNvbnRleHQgaWRzXG4gICAgICBjb25zdCBjb250ZXh0QXJyYXkgPSBfLm1hcChwYWdlQXJyYXksIChwYWdlKSA9PiBgJHthcHBJZEtleX0uJHtwYWdlLmlkfWApO1xuICAgICAgLy8gY2hlY2sgaWYgdGhlIGN1cnJlbnQgY29udGV4dCBleGlzdHMgaW4gYm90aCBvdXIgcmVjb3JkZWQgY29udGV4dHMsXG4gICAgICAvLyBhbmQgdGhlIHBhZ2UgYXJyYXlcbiAgICAgIHJldHVybiAhXy5pc0VxdWFsKF8uZmluZCh0aGlzLmNvbnRleHRzLCB0aGlzLmN1ckNvbnRleHQpLCBfLmZpbmQoY29udGV4dEFycmF5LCB0aGlzLmN1ckNvbnRleHQpKTtcbiAgICB9KSgpO1xuXG4gICAgaWYgKG5lZWRzUGFnZUxvYWQpIHtcbiAgICAgIHRoaXMubG9nLmRlYnVnKCdQYWdlIGxvYWQgbmVlZGVkLiBMb2FkaW5nLi4uJyk7XG4gICAgICBhd2FpdCB0aGlzLnJlbW90ZS5wYWdlTG9hZCgpO1xuICAgIH1cblxuICAgIHRoaXMubG9nLmRlYnVnKCdOZXcgcGFnZSBsaXN0aW5nIGlzIHNhbWUgYXMgb2xkLCBkb2luZyBub3RoaW5nJyk7XG4gIH1cblxuICAvLyBtYWtlIHN1cmUgdGhhdCB0aGUgcGFnZSBsaXN0aW5nIGlzbid0IGluZGljYXRpbmcgYSByZWRpcmVjdFxuICBpZiAodXRpbC5oYXNWYWx1ZSh0aGlzLmN1ckNvbnRleHQpKSB7XG4gICAgbGV0IGN1cnJlbnRQYWdlSWQgPSBwYXJzZUludChfLmxhc3QodGhpcy5jdXJDb250ZXh0LnNwbGl0KCcuJykpLCAxMCk7XG4gICAgbGV0IHBhZ2UgPSBfLmZpbmQocGFnZUFycmF5LCAocCkgPT4gcGFyc2VJbnQocC5pZCwgMTApID09PSBjdXJyZW50UGFnZUlkKTtcbiAgICBpZiAocGFnZSAmJiBwYWdlLnVybCAhPT0gdGhpcy5nZXRDdXJyZW50VXJsKCkpIHtcbiAgICAgIHRoaXMubG9nLmRlYnVnKGBSZWRpcmVjdGVkIGZyb20gJyR7dGhpcy5nZXRDdXJyZW50VXJsKCl9JyB0byAnJHtwYWdlLnVybH0nYCk7XG4gICAgICB0aGlzLnNldEN1cnJlbnRVcmwocGFnZS51cmwpO1xuICAgIH1cbiAgfVxuXG4gIGlmICh1dGlsLmhhc1ZhbHVlKG5ld1BhZ2UpKSB7XG4gICAgdGhpcy5zZWxlY3RpbmdOZXdQYWdlID0gdHJ1ZTtcbiAgICBjb25zdCBvbGRDb250ZXh0ID0gdGhpcy5jdXJDb250ZXh0O1xuICAgIHRoaXMuY3VyQ29udGV4dCA9IGAke2FwcElkS2V5fS4ke25ld1BhZ2V9YDtcbiAgICAvLyBkbyBub3Qgd2FpdCwgYXMgdGhpcyBjYW4gdGFrZSBhIGxvbmcgdGltZSwgYW5kIHRoZSByZXNwb25zZSBpcyBub3QgbmVjZXNzYXJ5XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHByb21pc2UvcHJlZmVyLWF3YWl0LXRvLWNhbGxiYWNrcywgcHJvbWlzZS9wcmVmZXItYXdhaXQtdG8tdGhlblxuICAgIHRoaXMucmVtb3RlLnNlbGVjdFBhZ2UoYXBwSWRLZXksIHBhcnNlSW50KG5ld1BhZ2UsIDEwKSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgdGhpcy5sb2cud2FybihgRmFpbGVkIHRvIHNlbGVjdCBwYWdlOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgdGhpcy5jdXJDb250ZXh0ID0gb2xkQ29udGV4dDtcbiAgICB9KTtcbiAgICB0aGlzLnNlbGVjdGluZ05ld1BhZ2UgPSBmYWxzZTtcbiAgfVxuICB0aGlzLndpbmRvd0hhbmRsZUNhY2hlID0gcGFnZUFycmF5O1xufTtcblxuXG5PYmplY3QuYXNzaWduKGNvbW1hbmRzLCBleHRlbnNpb25zLCBoZWxwZXJzKTtcbmV4cG9ydCBkZWZhdWx0IGNvbW1hbmRzO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBLE1BQU1BLFVBQVUsR0FBRyxZQUFZO0FBQy9CLE1BQU1DLFdBQVcsR0FBRyxTQUFTO0FBQzdCLE1BQU1DLFlBQVksR0FBSSxHQUFFRCxXQUFZLEdBQUU7QUFDdEMsTUFBTUUsbUNBQW1DLEdBQUcsS0FBSztBQUVqRCxNQUFNQyxRQUFRLEdBQUcsQ0FBQyxDQUFDO0VBQUVDLE9BQU8sR0FBRyxDQUFDLENBQUM7RUFBRUMsVUFBVSxHQUFHLENBQUMsQ0FBQztBQUdsREYsUUFBUSxDQUFDRyxpQkFBaUIsR0FBRyxlQUFlQSxpQkFBaUIsR0FBSTtFQUMvRCxJQUFJLElBQUksQ0FBQ0MsVUFBVSxJQUFJLElBQUksQ0FBQ0EsVUFBVSxLQUFLUixVQUFVLEVBQUU7SUFDckQsT0FBUSxHQUFFRSxZQUFhLEdBQUUsSUFBSSxDQUFDTSxVQUFXLEVBQUM7RUFDNUM7RUFDQSxPQUFPUixVQUFVO0FBQ25CLENBQUM7QUFFRE0sVUFBVSxDQUFDRyxtQkFBbUIsR0FBRyxlQUFlQSxtQkFBbUIsQ0FBRUMsTUFBTSxHQUFHLElBQUksRUFBRTtFQUNsRixJQUFJLENBQUNDLEdBQUcsQ0FBQ0MsS0FBSyxDQUFDLCtCQUErQixDQUFDO0VBQy9DLElBQUlDLFFBQVEsR0FBRyxNQUFNLElBQUksQ0FBQ0MsYUFBYSxDQUFDSixNQUFNLENBQUM7RUFFL0MsSUFBSUssSUFBSSxHQUFHLENBQUM7SUFBQ0MsRUFBRSxFQUFFaEIsVUFBVTtJQUFFaUIsSUFBSSxFQUFFLENBQUM7RUFBQyxDQUFDLENBQUM7RUFDdkMsSUFBSSxDQUFDQyxRQUFRLEdBQUcsQ0FBQ2xCLFVBQVUsQ0FBQztFQUM1QixLQUFLLElBQUlpQixJQUFJLElBQUlKLFFBQVEsRUFBRTtJQUN6QkUsSUFBSSxDQUFDSSxJQUFJLENBQUM7TUFBQ0gsRUFBRSxFQUFHLEdBQUVkLFlBQWEsR0FBRWUsSUFBSSxDQUFDRCxFQUFHLEVBQUM7TUFBRUM7SUFBSSxDQUFDLENBQUM7SUFDbEQsSUFBSSxDQUFDQyxRQUFRLENBQUNDLElBQUksQ0FBQ0YsSUFBSSxDQUFDRCxFQUFFLENBQUNJLFFBQVEsRUFBRSxDQUFDO0VBQ3hDO0VBQ0EsT0FBT0wsSUFBSTtBQUNiLENBQUM7QUFLRFQsVUFBVSxDQUFDZSxZQUFZLEdBQUcsU0FBU0EsWUFBWSxHQUFJO0VBQ2pELE9BQU8sQ0FBQyxJQUFJLENBQUNDLFlBQVksRUFBRSxJQUFJLElBQUksQ0FBQ0MsSUFBSSxDQUFDQyxNQUFNO0FBQ2pELENBQUM7QUFFRGxCLFVBQVUsQ0FBQ21CLHFCQUFxQixHQUFHLGVBQWVBLHFCQUFxQixHQUFJO0VBQ3pFLElBQUksQ0FBQ2QsR0FBRyxDQUFDQyxLQUFLLENBQUMsNkJBQTZCLENBQUM7RUFDN0MsTUFBTWMsS0FBSyxHQUFHLElBQUlDLGVBQU0sQ0FBQ0MsS0FBSyxFQUFFLENBQUNDLEtBQUssRUFBRTtFQUN4QyxNQUFNQyxVQUFVLEdBQUcsR0FBRztFQUN0QixNQUFNQyxXQUFXLEdBQUcsWUFBWTtJQUM5QixJQUFJQyxTQUFTO0lBQ2IsSUFBSTtNQUNGQSxTQUFTLEdBQUcsTUFBTSxJQUFJLENBQUNDLHlCQUF5QixDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7SUFDOUQsQ0FBQyxDQUFDLE9BQU9DLEdBQUcsRUFBRTtNQUNaLElBQUksQ0FBQ0EsR0FBRyxDQUFDQyxPQUFPLENBQUNDLFFBQVEsQ0FBQyx3Q0FBd0MsQ0FBQyxFQUFFO1FBQ25FLE1BQU1DLEtBQUssR0FBRyxJQUFJQyxLQUFLLENBQUUsdUNBQXNDSixHQUFHLENBQUNDLE9BQVEsRUFBQyxDQUFDO1FBQzdFRSxLQUFLLENBQUNFLEtBQUssSUFBSyxnQkFBZUwsR0FBRyxDQUFDSyxLQUFNLEVBQUM7UUFDMUMsTUFBTUYsS0FBSztNQUNiO01BQ0EsSUFBSSxDQUFDMUIsR0FBRyxDQUFDQyxLQUFLLENBQUMsc0RBQXNELENBQUM7SUFDeEU7SUFDQSxJQUFJb0IsU0FBUyxFQUFFO01BQ2IsSUFBSSxDQUFDckIsR0FBRyxDQUFDQyxLQUFLLENBQUUsb0JBQW1Cb0IsU0FBVSxHQUFFLENBQUM7TUFDaEQsTUFBTSxJQUFJLENBQUNRLFVBQVUsQ0FBQ1IsU0FBUyxDQUFDO01BQ2hDLE1BQU0sSUFBSSxDQUFDUyxNQUFNLENBQUNDLGNBQWMsRUFBRTtNQUNsQztJQUNGO0lBR0EsSUFBSWhCLEtBQUssQ0FBQ2lCLFdBQVcsRUFBRSxDQUFDQyxjQUFjLElBQUl6QyxtQ0FBbUMsRUFBRTtNQUU3RSxNQUFNLElBQUltQyxLQUFLLENBQUMsZ0RBQWdELENBQUM7SUFDbkU7SUFFQSxJQUFJLENBQUMzQixHQUFHLENBQUNrQyxJQUFJLENBQUMsc0RBQXNELENBQUM7SUFDckUsSUFBSSxJQUFJLENBQUN2QixZQUFZLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQ0MsSUFBSSxDQUFDQyxNQUFNLEVBQUU7TUFFNUMsTUFBTXNCLGlCQUFDLENBQUNDLEtBQUssQ0FBQ2pCLFVBQVUsQ0FBQztNQUN6QixPQUFPLE1BQU1DLFdBQVcsRUFBRTtJQUM1QjtJQUdBLElBQUlpQixPQUFPO0lBQ1gsSUFBSTtNQUNGLElBQUksQ0FBQ3JDLEdBQUcsQ0FBQ0MsS0FBSyxDQUFDLG1DQUFtQyxDQUFDO01BQ25Eb0MsT0FBTyxHQUFHLE1BQU0sSUFBSSxDQUFDQyx1QkFBdUIsQ0FBQyxrQkFBa0IsRUFBRSxjQUFjLEVBQUUsRUFBRSxFQUFFLEtBQUssQ0FBQztNQUMzRixNQUFNLElBQUksQ0FBQ0MsV0FBVyxDQUFDRixPQUFPLENBQUM7SUFDakMsQ0FBQyxDQUFDLE9BQU9kLEdBQUcsRUFBRTtNQUNaLElBQUksQ0FBQ3ZCLEdBQUcsQ0FBQ2tDLElBQUksQ0FBRSw0Q0FBMkNYLEdBQUcsQ0FBQ0MsT0FBUSxFQUFDLENBQUM7TUFDeEUsSUFBSSxDQUFDeEIsR0FBRyxDQUFDa0MsSUFBSSxDQUFDLFdBQVcsQ0FBQztNQUMxQixNQUFNQyxpQkFBQyxDQUFDQyxLQUFLLENBQUNqQixVQUFVLENBQUM7SUFDM0I7SUFHQSxPQUFPLE1BQU1DLFdBQVcsRUFBRTtFQUM1QixDQUFDO0VBQ0QsTUFBTUEsV0FBVyxFQUFFO0FBQ3JCLENBQUM7QUFFRDFCLE9BQU8sQ0FBQzhDLFVBQVUsR0FBRyxlQUFlQSxVQUFVLENBQUVDLDhCQUE4QixHQUFHLEtBQUssRUFBRTtFQUN0RixJQUFJLENBQUMsSUFBSSxDQUFDWCxNQUFNLEVBQUU7SUFDaEIsSUFBSSxDQUFDOUIsR0FBRyxDQUFDMEMsYUFBYSxDQUFDLGdEQUFnRCxDQUFDO0VBQzFFO0VBRUEsSUFBSUQsOEJBQThCLEVBQUU7SUFDbEMsTUFBTSxJQUFJLENBQUNFLFdBQVcsRUFBRTtFQUMxQjtFQUNBLE1BQU0sSUFBSSxDQUFDYixNQUFNLENBQUNjLFVBQVUsRUFBRTtFQUM5QixJQUFJLENBQUMvQyxVQUFVLEdBQUcsSUFBSTtFQUN0QixJQUFJLENBQUNnRCxZQUFZLEdBQUcsRUFBRTtFQUN0QixJQUFJLENBQUNDLFlBQVksR0FBRyxJQUFJO0VBQ3hCLElBQUksQ0FBQ2hCLE1BQU0sR0FBRyxJQUFJO0FBQ3BCLENBQUM7QUFFRHBDLE9BQU8sQ0FBQ3FELGFBQWEsR0FBRyxTQUFTQSxhQUFhLENBQUVDLEdBQUcsRUFBRTtFQUNuRCxJQUFJLENBQUNDLFdBQVcsR0FBR0QsR0FBRztBQUN4QixDQUFDO0FBRUR0RCxPQUFPLENBQUN3RCxhQUFhLEdBQUcsU0FBU0EsYUFBYSxHQUFJO0VBQ2hELE9BQU8sSUFBSSxDQUFDRCxXQUFXO0FBQ3pCLENBQUM7QUFFRHRELFVBQVUsQ0FBQzJCLHlCQUF5QixHQUFHLGVBQWVBLHlCQUF5QixDQUFFNkIsV0FBVyxFQUFFQyxTQUFTLEVBQUU7RUFBQTtFQUN2RyxJQUFJLENBQUNDLGVBQUMsQ0FBQ0MsUUFBUSxDQUFDSCxXQUFXLENBQUMsSUFBSSxDQUFDRSxlQUFDLENBQUNDLFFBQVEsQ0FBQ0YsU0FBUyxDQUFDLEVBQUU7SUFDdEQsTUFBTSxJQUFJRyxjQUFNLENBQUNDLG9CQUFvQixDQUNuQyx3RUFBd0UsQ0FDekU7RUFDSDtFQUVBLE1BQU1DLFVBQVUsR0FBRyxJQUFJLENBQUNQLGFBQWEsRUFBRTtFQUN2QyxNQUFNM0MsUUFBUSxHQUFHOEMsZUFBQyxDQUFDSyxNQUFNLENBQUMsTUFBTSxJQUFJLENBQUM1RCxtQkFBbUIsQ0FBQyxLQUFLLENBQUMsRUFBRSxNQUFNLENBQUM7RUFFeEUsSUFBSTJELFVBQVUsRUFBRTtJQUNkLE1BQU1FLEdBQUcsR0FBR3BELFFBQVEsQ0FBQ3FELElBQUksQ0FBQyxDQUFDO01BQUN0RDtJQUFJLENBQUMsS0FBSyxDQUFDQSxJQUFJLENBQUMwQyxHQUFHLElBQUksRUFBRSxNQUFNUyxVQUFVLENBQUM7SUFDdEUsSUFBSUUsR0FBRyxFQUFFO01BQ1AsT0FBT0EsR0FBRyxDQUFDdEQsRUFBRTtJQUNmO0VBQ0Y7RUFFQSx5QkFBUUUsUUFBUSxDQUFDcUQsSUFBSSxDQUFDLENBQUM7SUFBQ3REO0VBQUksQ0FBQyxLQUMzQkEsSUFBSSxDQUFDdUQsS0FBSyxLQUFJVixXQUFXLGFBQVhBLFdBQVcsdUJBQVhBLFdBQVcsQ0FBRVcsSUFBSSxDQUFDeEQsSUFBSSxDQUFDdUQsS0FBSyxDQUFDLEtBQUl2RCxJQUFJLENBQUMwQyxHQUFHLEtBQUlJLFNBQVMsYUFBVEEsU0FBUyx1QkFBVEEsU0FBUyxDQUFFVSxJQUFJLENBQUN4RCxJQUFJLENBQUMwQyxHQUFHLENBQUMsRUFDckYsbURBRk0sZUFFSDNDLEVBQUU7QUFDUixDQUFDO0FBRURWLFVBQVUsQ0FBQ29FLFlBQVksR0FBRyxTQUFTQSxZQUFZLEdBQUk7RUFDakQsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDbEUsVUFBVSxJQUFJLElBQUksQ0FBQ0EsVUFBVSxLQUFLUixVQUFVO0FBQzVELENBQUM7QUFFRE0sVUFBVSxDQUFDcUUsU0FBUyxHQUFHLFNBQVNBLFNBQVMsR0FBSTtFQUMzQyxPQUFPLElBQUksQ0FBQ0QsWUFBWSxFQUFFO0FBQzVCLENBQUM7QUFFRHBFLFVBQVUsQ0FBQ3NFLG9CQUFvQixHQUFHLGVBQWVBLG9CQUFvQixHQUFJO0VBQ3ZFLElBQUlDLFVBQVU7RUFDZCxJQUFJLENBQUMsSUFBSSxDQUFDdkQsWUFBWSxFQUFFLEVBQUU7SUFDeEJ1RCxVQUFVLEdBQUcsTUFBTSxJQUFJLENBQUN0RCxJQUFJLENBQUN1RCxNQUFNLENBQUNDLHFCQUFxQixFQUFFO0VBQzdEO0VBQ0EsT0FBTyxJQUFBQywwQ0FBb0IsRUFBQztJQUMxQkMsUUFBUSxFQUFFLElBQUksQ0FBQzFELElBQUksQ0FBQzBELFFBQVE7SUFDNUJDLG1CQUFtQixFQUFFLElBQUksQ0FBQzNELElBQUksQ0FBQzRELDBCQUEwQjtJQUN6REMsUUFBUSxFQUFFLElBQUksQ0FBQ0EsUUFBUSxFQUFFO0lBQ3pCQyxhQUFhLEVBQUUsSUFBSSxDQUFDOUQsSUFBSSxDQUFDK0QsdUJBQXVCO0lBQ2hEakUsWUFBWSxFQUFFLElBQUksQ0FBQ0EsWUFBWSxFQUFFO0lBQ2pDa0UsVUFBVSxFQUFFLElBQUksQ0FBQ0EsVUFBVTtJQUMzQkMsZUFBZSxFQUFFLElBQUksQ0FBQ2pFLElBQUksQ0FBQ2lFLGVBQWU7SUFDMUNYLFVBQVU7SUFDVlksZ0JBQWdCLEVBQUUsSUFBSSxDQUFDbEUsSUFBSSxDQUFDa0UsZ0JBQWdCO0lBQzVDQyx1QkFBdUIsRUFBRUMsYUFBSSxDQUFDQyxRQUFRLENBQUMsSUFBSSxDQUFDckUsSUFBSSxDQUFDc0Usb0JBQW9CLENBQUMsR0FDbEUsQ0FBQyxDQUFDLElBQUksQ0FBQ3RFLElBQUksQ0FBQ3NFLG9CQUFvQixHQUNoQyxLQUFLO0lBQ1RDLElBQUksRUFBRSxJQUFJLENBQUN2RSxJQUFJLENBQUN1RSxJQUFJO0lBQ3BCQyxtQkFBbUIsRUFBRSxJQUFJLENBQUN4RSxJQUFJLENBQUN5RSx5QkFBeUI7SUFDeERDLDBCQUEwQixFQUFFLElBQUksQ0FBQzFFLElBQUksQ0FBQzJFLGdDQUFnQztJQUN0RUMsZUFBZSxFQUFFLElBQUksQ0FBQzVFLElBQUksQ0FBQzZFLHFCQUFxQjtJQUNoREMsMEJBQTBCLEVBQUUsSUFBSSxDQUFDOUUsSUFBSSxDQUFDK0U7RUFDeEMsQ0FBQyxFQUFFLElBQUksQ0FBQ2hGLFlBQVksRUFBRSxDQUFDO0FBQ3pCLENBQUM7QUFTRGxCLFFBQVEsQ0FBQ29DLFVBQVUsR0FBRyxlQUFlQSxVQUFVLENBQUUrRCxJQUFJLEVBQUVDLFFBQVEsRUFBRUMsY0FBYyxFQUFFO0VBQy9FLFNBQVNDLGdCQUFnQixDQUFFQyxPQUFPLEVBQUVDLE9BQU8sRUFBRTtJQUMzQyxPQUFRRCxPQUFPLEtBQUtDLE9BQU8sSUFDeEJELE9BQU8sS0FBSyxJQUFJLElBQUlDLE9BQU8sS0FBSzVHLFVBQVcsSUFDM0MyRyxPQUFPLEtBQUszRyxVQUFVLElBQUk0RyxPQUFPLEtBQUssSUFBSztFQUNoRDtFQUNBLFNBQVNDLGVBQWUsQ0FBRUMsT0FBTyxFQUFFO0lBQ2pDLE9BQU9BLE9BQU8sS0FBSzlHLFVBQVUsSUFBSThHLE9BQU8sS0FBSyxJQUFJO0VBQ25EO0VBR0EsSUFBSVAsSUFBSSxJQUFJQSxJQUFJLENBQUN2RixFQUFFLEVBQUU7SUFDbkJ1RixJQUFJLEdBQUdBLElBQUksQ0FBQ3ZGLEVBQUU7RUFDaEI7RUFFQSxJQUFJLENBQUNMLEdBQUcsQ0FBQ0MsS0FBSyxDQUFFLGlDQUFnQzJGLElBQUksSUFBSXZHLFVBQVcsV0FBVSxJQUFJLENBQUNRLFVBQVUsR0FBRyxJQUFJLENBQUNBLFVBQVUsR0FBR1IsVUFBVyxHQUFFLENBQUM7RUFFL0gsSUFBSTBHLGdCQUFnQixDQUFDSCxJQUFJLEVBQUUsSUFBSSxDQUFDL0YsVUFBVSxDQUFDLElBQUlrRyxnQkFBZ0IsQ0FBQzFDLGVBQUMsQ0FBQytDLE9BQU8sQ0FBQ1IsSUFBSSxFQUFFckcsWUFBWSxFQUFFLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQ00sVUFBVSxDQUFDLEVBQUU7SUFFbkgsSUFBSSxDQUFDRyxHQUFHLENBQUNDLEtBQUssQ0FBRSxlQUFjMkYsSUFBSSxJQUFJdkcsVUFBVywyQkFBMEIsQ0FBQztJQUM1RTtFQUNGO0VBQ0EsSUFBSTZHLGVBQWUsQ0FBQ04sSUFBSSxDQUFDLEVBQUU7SUFFekIsSUFBSSxDQUFDL0YsVUFBVSxHQUFHLElBQUk7SUFDdEI7RUFDRjtFQUtBLElBQUl3RCxlQUFDLENBQUNnRCxXQUFXLENBQUMsSUFBSSxDQUFDOUYsUUFBUSxDQUFDLEVBQUU7SUFDaEMsTUFBTSxJQUFJLENBQUMrRixXQUFXLEVBQUU7RUFDMUI7RUFFQSxJQUFJakYsU0FBUyxHQUFHZ0MsZUFBQyxDQUFDK0MsT0FBTyxDQUFDUixJQUFJLEVBQUVyRyxZQUFZLEVBQUUsRUFBRSxDQUFDO0VBQ2pELElBQUk4QixTQUFTLEtBQUssRUFBRSxFQUFFO0lBSXBCQSxTQUFTLEdBQUcsSUFBSSxDQUFDZCxRQUFRLENBQUMsQ0FBQyxDQUFDO0VBQzlCO0VBQ0EsSUFBSSxDQUFDOEMsZUFBQyxDQUFDNUIsUUFBUSxDQUFDLElBQUksQ0FBQ2xCLFFBQVEsRUFBRWMsU0FBUyxDQUFDLEVBQUU7SUFDekMsTUFBTSxJQUFJa0MsY0FBTSxDQUFDZ0Qsa0JBQWtCLEVBQUU7RUFDdkM7RUFFQSxNQUFNQyxVQUFVLEdBQUcsSUFBSSxDQUFDM0csVUFBVTtFQUNsQyxJQUFJLENBQUNBLFVBQVUsR0FBRyxJQUFJLENBQUM0RyxlQUFlLEdBQUdwRixTQUFTO0VBR2xELE1BQU0sQ0FBQ3FGLFFBQVEsRUFBRUMsU0FBUyxDQUFDLEdBQUd0RCxlQUFDLENBQUN1RCxHQUFHLENBQUN2RixTQUFTLENBQUN3RixLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUd4RyxFQUFFLElBQUt5RyxRQUFRLENBQUN6RyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7RUFDbkYsSUFBSTtJQUNGLElBQUksQ0FBQzBHLGdCQUFnQixHQUFHLElBQUk7SUFDNUIsTUFBTSxJQUFJLENBQUNqRixNQUFNLENBQUNrRixVQUFVLENBQUNOLFFBQVEsRUFBRUMsU0FBUyxFQUFFYixjQUFjLENBQUM7RUFDbkUsQ0FBQyxDQUFDLE9BQU92RSxHQUFHLEVBQUU7SUFDWixJQUFJLENBQUMxQixVQUFVLEdBQUcsSUFBSSxDQUFDNEcsZUFBZSxHQUFHRCxVQUFVO0lBQ25ELE1BQU1qRixHQUFHO0VBQ1gsQ0FBQyxTQUFTO0lBQ1IsSUFBSSxDQUFDd0YsZ0JBQWdCLEdBQUcsS0FBSztFQUMvQjtFQUdBLElBQUksSUFBSSxDQUFDbkcsSUFBSSxDQUFDcUcsd0JBQXdCLElBQUksSUFBSSxDQUFDbkYsTUFBTSxFQUFFO0lBQ3JELElBQUksQ0FBQzlCLEdBQUcsQ0FBQ0MsS0FBSyxDQUFFLGdDQUErQixJQUFJLENBQUNKLFVBQVcsR0FBRSxDQUFDO0lBQ2xFLElBQUksQ0FBQ3FILElBQUksQ0FBQ0MsV0FBVyxHQUFHLElBQUlDLDBCQUFpQixDQUFDLElBQUksQ0FBQ3RGLE1BQU0sQ0FBQztJQUMxRCxNQUFNLElBQUksQ0FBQ29GLElBQUksQ0FBQ0MsV0FBVyxDQUFDRSxZQUFZLEVBQUU7RUFDNUM7RUFHQSxJQUFJekIsSUFBSSxJQUFJQSxJQUFJLEtBQUt2RyxVQUFVLElBQUksSUFBSSxDQUFDNkgsSUFBSSxFQUFFO0lBQzVDLElBQUksSUFBSSxDQUFDQSxJQUFJLENBQUNJLGFBQWEsRUFBRTtNQUMzQixNQUFNLElBQUksQ0FBQ3hGLE1BQU0sQ0FBQ3lGLFlBQVksQ0FBQyxJQUFJLENBQUNMLElBQUksQ0FBQ0ksYUFBYSxDQUFDRSxVQUFVLENBQUNDLElBQUksQ0FBQyxJQUFJLENBQUNQLElBQUksQ0FBQ0ksYUFBYSxDQUFDLENBQUM7SUFDbEc7SUFDQSxJQUFJLElBQUksQ0FBQ0osSUFBSSxDQUFDUSxhQUFhLEVBQUU7TUFDM0IsTUFBTSxJQUFJLENBQUM1RixNQUFNLENBQUM2RixZQUFZLENBQUMsSUFBSSxDQUFDVCxJQUFJLENBQUNRLGFBQWEsQ0FBQ0YsVUFBVSxDQUFDQyxJQUFJLENBQUMsSUFBSSxDQUFDUCxJQUFJLENBQUNRLGFBQWEsQ0FBQyxDQUFDO0lBQ2xHO0VBQ0Y7QUFDRixDQUFDO0FBRUQvSCxVQUFVLENBQUNpSSx1QkFBdUIsR0FBRyxlQUFlQSx1QkFBdUIsR0FBSTtFQUM3RSxJQUFJLENBQUM5RixNQUFNLEdBQUcsTUFBTSxJQUFJLENBQUNtQyxvQkFBb0IsRUFBRTtFQUUvQyxJQUFJLENBQUNuQyxNQUFNLENBQUMrRixFQUFFLENBQUNDLG9DQUFjLENBQUNDLGlCQUFpQixFQUFFLElBQUksQ0FBQ0MsWUFBWSxDQUFDUCxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7RUFDOUUsSUFBSSxDQUFDM0YsTUFBTSxDQUFDK0YsRUFBRSxDQUFDQyxvQ0FBYyxDQUFDRyxxQkFBcUIsRUFBRSxNQUFNO0lBQ3pELElBQUksQ0FBQzVFLGVBQUMsQ0FBQzZFLE9BQU8sQ0FBQyxJQUFJLENBQUNyRixZQUFZLENBQUMsRUFBRTtNQUNqQyxJQUFJLENBQUM3QyxHQUFHLENBQUNDLEtBQUssQ0FBRSxZQUFXK0UsYUFBSSxDQUFDbUQsU0FBUyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUN0RixZQUFZLENBQUN1RixNQUFNLEVBQUUsSUFBSSxDQUFFLEtBQUksSUFBSSxDQUFDdkYsWUFBWSxDQUFDd0YsSUFBSSxDQUFDLElBQUksQ0FBRSxFQUFDLENBQUM7SUFDeEg7SUFDQSxJQUFJLENBQUN4RixZQUFZLEdBQUcsRUFBRTtFQUN4QixDQUFDLENBQUM7RUFFRixNQUFNLElBQUksQ0FBQ2YsTUFBTSxDQUFDd0csT0FBTyxDQUFDLElBQUksQ0FBQzFILElBQUksQ0FBQzJILHFCQUFxQixDQUFDO0FBQzVELENBQUM7QUFFRDVJLFVBQVUsQ0FBQ1EsYUFBYSxHQUFHLGVBQWVBLGFBQWEsQ0FBRUosTUFBTSxHQUFHLElBQUksRUFBRTtFQUN0RUEsTUFBTSxHQUFHQSxNQUFNLElBQUksQ0FBQyxJQUFJLENBQUNZLFlBQVksRUFBRSxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUN1QyxhQUFhLEVBQUU7RUFDakUsSUFBSSxDQUFDbEQsR0FBRyxDQUFDQyxLQUFLLENBQUUscUJBQW9CRixNQUFPLEdBQUVBLE1BQU0sR0FBSSxvQkFBbUIsSUFBSSxDQUFDbUQsYUFBYSxFQUFHLElBQUcsR0FBRyxFQUFHLEVBQUMsQ0FBQztFQUUxRyxJQUFJLENBQUMsSUFBSSxDQUFDcEIsTUFBTSxFQUFFO0lBQ2hCLE1BQU0sSUFBSSxDQUFDOEYsdUJBQXVCLEVBQUU7SUFDcEMsSUFBSSxDQUFDLElBQUksQ0FBQzlGLE1BQU0sQ0FBQzRFLFFBQVEsRUFBRTtNQUN6QixNQUFNLElBQUksQ0FBQzVFLE1BQU0sQ0FBQzBHLGdCQUFnQixFQUFFO0lBQ3RDO0VBQ0Y7RUFDQSxNQUFNQyxlQUFlLEdBQUcsWUFBWTtJQUNsQyxJQUFJO01BQ0YsT0FBTyxNQUFNLElBQUksQ0FBQzNHLE1BQU0sQ0FBQzRHLFNBQVMsQ0FDaEMzSSxNQUFNLEdBQUcsSUFBSSxDQUFDbUQsYUFBYSxFQUFFLEdBQUd5RixTQUFTLEVBQ3pDLElBQUksQ0FBQy9ILElBQUksQ0FBQ2dJLHFCQUFxQixFQUMvQixJQUFJLENBQUNoSSxJQUFJLENBQUNpSSxtQkFBbUIsQ0FDOUI7SUFDSCxDQUFDLENBQUMsT0FBT3RILEdBQUcsRUFBRTtNQUNaLElBQUksQ0FBQ3ZCLEdBQUcsQ0FBQ0MsS0FBSyxDQUFFLDJCQUEwQnNCLEdBQUcsQ0FBQ0MsT0FBUSxFQUFDLENBQUM7TUFDeEQsT0FBTyxFQUFFO0lBQ1g7RUFDRixDQUFDO0VBQ0QsTUFBTXNILFNBQVMsR0FBRyxNQUFNTCxlQUFlLEVBQUU7RUFDekMsSUFBSXBGLGVBQUMsQ0FBQzZFLE9BQU8sQ0FBQ1ksU0FBUyxDQUFDLEVBQUU7SUFFeEIsSUFBSSxDQUFDOUksR0FBRyxDQUFDQyxLQUFLLENBQUMsc0JBQXNCLENBQUM7RUFDeEM7RUFDQSxPQUFPNkksU0FBUztBQUNsQixDQUFDO0FBRURySixRQUFRLENBQUM2RyxXQUFXLEdBQUcsZUFBZUEsV0FBVyxHQUFJO0VBQ25ELElBQUksQ0FBQ3RHLEdBQUcsQ0FBQ0MsS0FBSyxDQUFDLG9DQUFvQyxDQUFDO0VBQ3BELE1BQU1NLFFBQVEsR0FBRyxNQUFNLElBQUksQ0FBQ1QsbUJBQW1CLENBQUMsS0FBSyxDQUFDO0VBRXRELE1BQU1pSixLQUFLLEdBQUcsSUFBSSxDQUFDbkksSUFBSSxDQUFDb0ksZUFBZSxHQUNuQyxVQUFVN0MsT0FBTyxFQUFFO0lBQ25CLE9BQU87TUFDTDlGLEVBQUUsRUFBRThGLE9BQU8sQ0FBQzlGLEVBQUUsQ0FBQ0ksUUFBUSxFQUFFO01BQ3pCb0QsS0FBSyxFQUFFc0MsT0FBTyxDQUFDN0YsSUFBSSxDQUFDdUQsS0FBSztNQUN6QmIsR0FBRyxFQUFFbUQsT0FBTyxDQUFDN0YsSUFBSSxDQUFDMEMsR0FBRztNQUNyQnNCLFFBQVEsRUFBRTZCLE9BQU8sQ0FBQzdGLElBQUksQ0FBQ2dFO0lBQ3pCLENBQUM7RUFDSCxDQUFDLEdBQ0U2QixPQUFPLElBQUtBLE9BQU8sQ0FBQzlGLEVBQUUsQ0FBQ0ksUUFBUSxFQUFFO0VBQ3RDLE9BQU9GLFFBQVEsQ0FBQ3FHLEdBQUcsQ0FBQ21DLEtBQUssQ0FBQztBQUM1QixDQUFDO0FBb0JEcEosVUFBVSxDQUFDc0osaUJBQWlCLEdBQUcsZUFBZUEsaUJBQWlCLENBQUVySSxJQUFJLEdBQUcsQ0FBQyxDQUFDLEVBQUU7RUFDMUUsSUFBSTtJQUNGc0ksZ0JBQWdCLEdBQUc7RUFDckIsQ0FBQyxHQUFHdEksSUFBSTtFQUdSLElBQUksQ0FBQ3lDLGVBQUMsQ0FBQzhGLFFBQVEsQ0FBQ0QsZ0JBQWdCLENBQUMsRUFBRTtJQUNqQ0EsZ0JBQWdCLEdBQUdwQyxRQUFRLENBQUNvQyxnQkFBZ0IsRUFBRSxFQUFFLENBQUM7SUFDakQsSUFBSUUsS0FBSyxDQUFDRixnQkFBZ0IsQ0FBQyxFQUFFO01BQzNCQSxnQkFBZ0IsR0FBRyxDQUFDO0lBQ3RCO0VBQ0Y7RUFFQSxNQUFNRyxNQUFNLEdBQUcsSUFBSSxDQUFDekksSUFBSSxDQUFDb0ksZUFBZTtFQUN4QyxJQUFJLENBQUNwSSxJQUFJLENBQUNvSSxlQUFlLEdBQUcsSUFBSTtFQUVoQyxNQUFNakksS0FBSyxHQUFHLElBQUlDLGVBQU0sQ0FBQ0MsS0FBSyxFQUFFLENBQUNDLEtBQUssRUFBRTtFQUN4QyxJQUFJO0lBQ0YsSUFBSVgsUUFBUTtJQUNaLEdBQUc7TUFDREEsUUFBUSxHQUFHLE1BQU0sSUFBSSxDQUFDK0YsV0FBVyxFQUFFO01BRW5DLElBQUkvRixRQUFRLENBQUM2SCxNQUFNLElBQUksQ0FBQyxFQUFFO1FBQ3hCLElBQUksQ0FBQ3BJLEdBQUcsQ0FBQ0MsS0FBSyxDQUFFLCtCQUE4QmMsS0FBSyxDQUFDaUIsV0FBVyxFQUFFLENBQUNDLGNBQWMsQ0FBQ3FILE9BQU8sQ0FBQyxDQUFDLENBQUUsSUFBRyxDQUFDO1FBQ2hHLE9BQU8vSSxRQUFRO01BQ2pCO01BQ0EsSUFBSSxDQUFDUCxHQUFHLENBQUNDLEtBQUssQ0FBRSx3QkFBdUJjLEtBQUssQ0FBQ2lCLFdBQVcsRUFBRSxDQUFDQyxjQUFjLENBQUNxSCxPQUFPLENBQUMsQ0FBQyxDQUFFLElBQUcsQ0FBQztJQUMzRixDQUFDLFFBQVF2SSxLQUFLLENBQUNpQixXQUFXLEVBQUUsQ0FBQ0MsY0FBYyxHQUFHaUgsZ0JBQWdCO0lBQzlELE9BQU8zSSxRQUFRO0VBQ2pCLENBQUMsU0FBUztJQUVSLElBQUksQ0FBQ0ssSUFBSSxDQUFDb0ksZUFBZSxHQUFHSyxNQUFNO0VBQ3BDO0FBQ0YsQ0FBQztBQUVENUosUUFBUSxDQUFDOEosU0FBUyxHQUFHLGVBQWVBLFNBQVMsQ0FBRTNELElBQUksRUFBRUUsY0FBYyxFQUFFO0VBQ25FLElBQUk7SUFDRixNQUFNLElBQUksQ0FBQ2pFLFVBQVUsQ0FBQytELElBQUksRUFBRXZDLGVBQUMsQ0FBQ21HLElBQUksRUFBRTFELGNBQWMsQ0FBQztFQUNyRCxDQUFDLENBQUMsT0FBT3ZFLEdBQUcsRUFBRTtJQUVaLE1BQU0sSUFBQWtJLG1CQUFXLEVBQUNsSSxHQUFHLEVBQUVnQyxjQUFNLENBQUNnRCxrQkFBa0IsQ0FBQyxHQUM3QyxJQUFJaEQsY0FBTSxDQUFDbUcsaUJBQWlCLEVBQUUsR0FDOUJuSSxHQUFHO0VBQ1Q7QUFDRixDQUFDO0FBRUQ5QixRQUFRLENBQUNrSyxlQUFlLEdBQUcsZUFBZUEsZUFBZSxHQUFJO0VBQzNELElBQUksQ0FBQyxJQUFJLENBQUM1RixZQUFZLEVBQUUsRUFBRTtJQUN4QixNQUFNLElBQUlSLGNBQU0sQ0FBQ3FHLG1CQUFtQixFQUFFO0VBQ3hDO0VBQ0EsSUFBSSxDQUFDNUosR0FBRyxDQUFDQyxLQUFLLENBQUUsK0JBQThCLENBQUM7RUFDL0MsT0FBTyxJQUFJLENBQUNKLFVBQVU7QUFDeEIsQ0FBQztBQUVESixRQUFRLENBQUNvSyxnQkFBZ0IsR0FBRyxlQUFlQSxnQkFBZ0IsR0FBSTtFQUM3RCxJQUFJLENBQUMsSUFBSSxDQUFDOUYsWUFBWSxFQUFFLEVBQUU7SUFDeEIsTUFBTSxJQUFJUixjQUFNLENBQUNxRyxtQkFBbUIsRUFBRTtFQUN4QztFQUNBLElBQUksQ0FBQzVKLEdBQUcsQ0FBQ0MsS0FBSyxDQUFDLDBDQUEwQyxDQUFDO0VBQzFELE1BQU1NLFFBQVEsR0FBRyxNQUFNLElBQUksQ0FBQ1QsbUJBQW1CLENBQUMsS0FBSyxDQUFDO0VBQ3RELE9BQU9TLFFBQVEsQ0FFWm1ELE1BQU0sQ0FBRXlDLE9BQU8sSUFBS0EsT0FBTyxDQUFDOUYsRUFBRSxLQUFLaEIsVUFBVSxDQUFDLENBRTlDdUgsR0FBRyxDQUFFVCxPQUFPLElBQUtBLE9BQU8sQ0FBQzdGLElBQUksQ0FBQ0QsRUFBRSxDQUFDSSxRQUFRLEVBQUUsQ0FBQztBQUNqRCxDQUFDO0FBRURkLFVBQVUsQ0FBQ3FJLFlBQVksR0FBRyxlQUFlQSxZQUFZLENBQUU4QixzQkFBc0IsRUFBRTtFQUM3RSxJQUFJLENBQUM5SixHQUFHLENBQUNDLEtBQUssQ0FBRSxzREFBcUQ4SixJQUFJLENBQUNDLFNBQVMsQ0FBQ0Ysc0JBQXNCLENBQUUsRUFBQyxDQUFDO0VBQzlHLElBQUksSUFBSSxDQUFDL0MsZ0JBQWdCLEVBQUU7SUFDekIsSUFBSSxDQUFDL0csR0FBRyxDQUFDQyxLQUFLLENBQUMsb0RBQW9ELENBQUM7SUFDcEU7RUFDRjtFQUNBLElBQUksQ0FBQyxJQUFJLENBQUM2QixNQUFNLElBQUksQ0FBQyxJQUFJLENBQUNBLE1BQU0sQ0FBQ21JLFdBQVcsRUFBRTtJQUM1QyxJQUFJLENBQUNqSyxHQUFHLENBQUNDLEtBQUssQ0FBQyxxQ0FBcUMsQ0FBQztJQUNyRDtFQUNGO0VBRUEsTUFBTTtJQUFDeUcsUUFBUTtJQUFFb0M7RUFBUyxDQUFDLEdBQUdnQixzQkFBc0I7RUFFcEQsSUFBSUksTUFBTSxHQUFHLEVBQUU7RUFDZixJQUFJQyxRQUFRLEdBQUcsRUFBRTtFQUNqQixJQUFJQyxLQUFLLEdBQUcsSUFBSTtFQUdoQixTQUFTQyxZQUFZLENBQUVySCxHQUFHLEVBQUVzSCx3QkFBd0IsRUFBRTtJQUNwRCxNQUFNQyxZQUFZLEdBQUcsQ0FBQ0Qsd0JBQXdCLElBQUksRUFBRSxFQUNqRHpELEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FDVkQsR0FBRyxDQUFFNEQsQ0FBQyxJQUFLQSxDQUFDLENBQUNDLElBQUksRUFBRSxDQUFDLENBQ3BCL0csTUFBTSxDQUFFOEcsQ0FBQyxJQUFLLENBQUNuSCxlQUFDLENBQUM2RSxPQUFPLENBQUNzQyxDQUFDLENBQUMsQ0FBQztJQUMvQixLQUFLLE1BQU1FLFdBQVcsSUFBSUgsWUFBWSxFQUFFO01BQ3RDLElBQUlHLFdBQVcsS0FBSyxhQUFhLElBQUkxSCxHQUFHLEtBQUssYUFBYSxFQUFFO1FBQzFELE9BQU8sSUFBSTtNQUNiLENBQUMsTUFBTTtRQUNMLElBQUk7VUFDRixNQUFNMkgsUUFBUSxHQUFHLElBQUlDLEdBQUcsQ0FBQzVILEdBQUcsQ0FBQyxDQUFDMkgsUUFBUTtVQUN0QyxJQUFJQSxRQUFRLEtBQUtELFdBQVcsRUFBRTtZQUM1QixPQUFPLElBQUk7VUFDYjtRQUNGLENBQUMsQ0FBQyxPQUFPRyxHQUFHLEVBQUUsQ0FFZDtNQUNGO0lBQ0Y7SUFDQSxPQUFPLEtBQUs7RUFDZDtFQUVBLEtBQUssTUFBTUMsSUFBSSxJQUFJaEMsU0FBUyxFQUFFO0lBQzVCLE1BQU16SSxFQUFFLEdBQUd5SyxJQUFJLENBQUN6SyxFQUFFLENBQUNJLFFBQVEsRUFBRTtJQUM3QnlKLE1BQU0sQ0FBQzFKLElBQUksQ0FBQ0gsRUFBRSxDQUFDO0lBQ2YsSUFBSXlLLElBQUksQ0FBQ0MsS0FBSyxFQUFFO01BQ2RYLEtBQUssR0FBRy9KLEVBQUU7SUFDWjtJQUNBLE1BQU1nQixTQUFTLEdBQUksR0FBRXFGLFFBQVMsSUFBR3JHLEVBQUcsRUFBQztJQUdyQyxJQUFJLENBQUNnRCxlQUFDLENBQUM1QixRQUFRLENBQUMsSUFBSSxDQUFDbEIsUUFBUSxFQUFFYyxTQUFTLENBQUMsRUFBRTtNQUN6QyxJQUFJZ0osWUFBWSxDQUFDUyxJQUFJLENBQUM5SCxHQUFHLEVBQUUsSUFBSSxDQUFDcEMsSUFBSSxDQUFDMEosd0JBQXdCLENBQUMsRUFBRTtRQUM5RCxJQUFJLENBQUN0SyxHQUFHLENBQUNnTCxJQUFJLENBQUUsaUJBQWdCRixJQUFJLENBQUM5SCxHQUFJLG9DQUFtQyxHQUN4RSw4QkFBNkIsSUFBSSxDQUFDcEMsSUFBSSxDQUFDMEosd0JBQXlCLEVBQUMsQ0FBQztNQUN2RSxDQUFDLE1BQU07UUFDTEgsUUFBUSxDQUFDM0osSUFBSSxDQUFDSCxFQUFFLENBQUM7UUFDakIsSUFBSSxDQUFDRSxRQUFRLENBQUNDLElBQUksQ0FBQ2EsU0FBUyxDQUFDO01BQy9CO0lBQ0Y7RUFDRjtFQUVBLElBQUksQ0FBQytJLEtBQUssRUFBRTtJQUdWLElBQUksQ0FBQ3BLLEdBQUcsQ0FBQ0MsS0FBSyxDQUFDLG9EQUFvRCxDQUFDO0lBQ3BFbUssS0FBSyxHQUFHRixNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSTtFQUMzQjtFQUVBLElBQUksQ0FBQ2xGLGFBQUksQ0FBQ0MsUUFBUSxDQUFDLElBQUksQ0FBQ3BGLFVBQVUsQ0FBQyxFQUFFO0lBQ25DLElBQUksQ0FBQ0csR0FBRyxDQUFDQyxLQUFLLENBQUMsbURBQW1ELENBQUM7SUFDbkU7RUFDRjtFQUVBLE1BQU0sQ0FBQ2dMLFdBQVcsRUFBRUMsWUFBWSxDQUFDLEdBQUcsSUFBSSxDQUFDckwsVUFBVSxDQUFDZ0gsS0FBSyxDQUFDLEdBQUcsQ0FBQztFQUU5RCxJQUFJb0UsV0FBVyxLQUFLdkUsUUFBUSxFQUFFO0lBQzVCLElBQUksQ0FBQzFHLEdBQUcsQ0FBQ0MsS0FBSyxDQUFDLGdFQUFnRSxDQUFDO0lBQ2hGO0VBQ0Y7RUFFQSxJQUFJa0wsT0FBTyxHQUFHLElBQUk7RUFDbEIsSUFBSWhCLFFBQVEsQ0FBQy9CLE1BQU0sRUFBRTtJQUNuQitDLE9BQU8sR0FBRzlILGVBQUMsQ0FBQytILElBQUksQ0FBQ2pCLFFBQVEsQ0FBQztJQUMxQixJQUFJLENBQUNuSyxHQUFHLENBQUNDLEtBQUssQ0FBRSxzQ0FBcUNrTCxPQUFRLEdBQUUsQ0FBQztFQUNsRSxDQUFDLE1BQU0sSUFBSSxDQUFDOUgsZUFBQyxDQUFDNUIsUUFBUSxDQUFDeUksTUFBTSxFQUFFZ0IsWUFBWSxDQUFDLEVBQUU7SUFDNUMsSUFBSSxDQUFDbEwsR0FBRyxDQUFDQyxLQUFLLENBQUMseURBQXlELEdBQzNELHVDQUF1QyxDQUFDO0lBQ3JELElBQUksQ0FBQytFLGFBQUksQ0FBQ0MsUUFBUSxDQUFDbUYsS0FBSyxDQUFDLEVBQUU7TUFDekIsSUFBSSxDQUFDcEssR0FBRyxDQUFDMEIsS0FBSyxDQUFDLG9EQUFvRCxHQUN0RCw0Q0FBNEMsQ0FBQztNQUMxRCxJQUFJLENBQUNxQixhQUFhLENBQUM0RixTQUFTLENBQUM7TUFDN0I7SUFDRjtJQUVBLElBQUksQ0FBQzNJLEdBQUcsQ0FBQ0MsS0FBSyxDQUFFLG1DQUFrQ21LLEtBQU0sS0FBSSxHQUM5Qyx5QkFBd0IsQ0FBQztJQUN2QyxJQUFJLENBQUN2SyxVQUFVLEdBQUksR0FBRTZHLFFBQVMsSUFBRzBELEtBQU0sRUFBQztJQUN4Q2UsT0FBTyxHQUFHZixLQUFLO0VBQ2pCLENBQUMsTUFBTTtJQUVMLElBQUksQ0FBQ3BLLEdBQUcsQ0FBQ0MsS0FBSyxDQUFDLGdDQUFnQyxDQUFDO0lBR2hELE1BQU1vTCxhQUFhLEdBQUcsQ0FBQyxNQUFNO01BRTNCLE1BQU1DLFlBQVksR0FBR2pJLGVBQUMsQ0FBQ3VELEdBQUcsQ0FBQ2tDLFNBQVMsRUFBR2dDLElBQUksSUFBTSxHQUFFcEUsUUFBUyxJQUFHb0UsSUFBSSxDQUFDekssRUFBRyxFQUFDLENBQUM7TUFHekUsT0FBTyxDQUFDZ0QsZUFBQyxDQUFDa0ksT0FBTyxDQUFDbEksZUFBQyxDQUFDTyxJQUFJLENBQUMsSUFBSSxDQUFDckQsUUFBUSxFQUFFLElBQUksQ0FBQ1YsVUFBVSxDQUFDLEVBQUV3RCxlQUFDLENBQUNPLElBQUksQ0FBQzBILFlBQVksRUFBRSxJQUFJLENBQUN6TCxVQUFVLENBQUMsQ0FBQztJQUNsRyxDQUFDLEdBQUc7SUFFSixJQUFJd0wsYUFBYSxFQUFFO01BQ2pCLElBQUksQ0FBQ3JMLEdBQUcsQ0FBQ0MsS0FBSyxDQUFDLDhCQUE4QixDQUFDO01BQzlDLE1BQU0sSUFBSSxDQUFDNkIsTUFBTSxDQUFDMEosUUFBUSxFQUFFO0lBQzlCO0lBRUEsSUFBSSxDQUFDeEwsR0FBRyxDQUFDQyxLQUFLLENBQUMsZ0RBQWdELENBQUM7RUFDbEU7RUFHQSxJQUFJK0UsYUFBSSxDQUFDQyxRQUFRLENBQUMsSUFBSSxDQUFDcEYsVUFBVSxDQUFDLEVBQUU7SUFDbEMsSUFBSTRMLGFBQWEsR0FBRzNFLFFBQVEsQ0FBQ3pELGVBQUMsQ0FBQytILElBQUksQ0FBQyxJQUFJLENBQUN2TCxVQUFVLENBQUNnSCxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUM7SUFDcEUsSUFBSWlFLElBQUksR0FBR3pILGVBQUMsQ0FBQ08sSUFBSSxDQUFDa0YsU0FBUyxFQUFHNEMsQ0FBQyxJQUFLNUUsUUFBUSxDQUFDNEUsQ0FBQyxDQUFDckwsRUFBRSxFQUFFLEVBQUUsQ0FBQyxLQUFLb0wsYUFBYSxDQUFDO0lBQ3pFLElBQUlYLElBQUksSUFBSUEsSUFBSSxDQUFDOUgsR0FBRyxLQUFLLElBQUksQ0FBQ0UsYUFBYSxFQUFFLEVBQUU7TUFDN0MsSUFBSSxDQUFDbEQsR0FBRyxDQUFDQyxLQUFLLENBQUUsb0JBQW1CLElBQUksQ0FBQ2lELGFBQWEsRUFBRyxTQUFRNEgsSUFBSSxDQUFDOUgsR0FBSSxHQUFFLENBQUM7TUFDNUUsSUFBSSxDQUFDRCxhQUFhLENBQUMrSCxJQUFJLENBQUM5SCxHQUFHLENBQUM7SUFDOUI7RUFDRjtFQUVBLElBQUlnQyxhQUFJLENBQUNDLFFBQVEsQ0FBQ2tHLE9BQU8sQ0FBQyxFQUFFO0lBQzFCLElBQUksQ0FBQ3BFLGdCQUFnQixHQUFHLElBQUk7SUFDNUIsTUFBTVAsVUFBVSxHQUFHLElBQUksQ0FBQzNHLFVBQVU7SUFDbEMsSUFBSSxDQUFDQSxVQUFVLEdBQUksR0FBRTZHLFFBQVMsSUFBR3lFLE9BQVEsRUFBQztJQUcxQyxJQUFJLENBQUNySixNQUFNLENBQUNrRixVQUFVLENBQUNOLFFBQVEsRUFBRUksUUFBUSxDQUFDcUUsT0FBTyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUNRLEtBQUssQ0FBRXBLLEdBQUcsSUFBSztNQUNyRSxJQUFJLENBQUN2QixHQUFHLENBQUNrQyxJQUFJLENBQUUsMEJBQXlCWCxHQUFHLENBQUNDLE9BQVEsRUFBQyxDQUFDO01BQ3RELElBQUksQ0FBQzNCLFVBQVUsR0FBRzJHLFVBQVU7SUFDOUIsQ0FBQyxDQUFDO0lBQ0YsSUFBSSxDQUFDTyxnQkFBZ0IsR0FBRyxLQUFLO0VBQy9CO0VBQ0EsSUFBSSxDQUFDNkUsaUJBQWlCLEdBQUc5QyxTQUFTO0FBQ3BDLENBQUM7QUFHRCtDLE1BQU0sQ0FBQ0MsTUFBTSxDQUFDck0sUUFBUSxFQUFFRSxVQUFVLEVBQUVELE9BQU8sQ0FBQztBQUFDLGVBQzlCRCxRQUFRO0FBQUEifQ==