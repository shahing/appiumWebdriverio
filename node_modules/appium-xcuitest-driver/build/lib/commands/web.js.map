{"version":3,"file":"web.js","names":["IPHONE_TOP_BAR_HEIGHT","IPHONE_SCROLLED_TOP_BAR_HEIGHT","IPHONE_X_SCROLLED_OFFSET","IPHONE_X_NOTCH_OFFSET_IOS","IPHONE_X_NOTCH_OFFSET_IOS_13","IPHONE_LANDSCAPE_TOP_BAR_HEIGHT","IPHONE_BOTTOM_BAR_OFFSET","TAB_BAR_OFFSET","IPHONE_WEB_COORD_SMART_APP_BANNER_OFFSET","IPAD_WEB_COORD_SMART_APP_BANNER_OFFSET","NOTCHED_DEVICE_SIZES","w","h","W3C_WEB_ELEMENT_IDENTIFIER","util","ATOM_WAIT_TIMEOUT_MS","ATOM_INITIAL_WAIT_MS","ON_OBSTRUCTING_ALERT_EVENT","VISIBLE","INVISIBLE","DETECT","VISIBILITIES","TAB_BAR_POSITION_TOP","TAB_BAR_POSITION_BOTTOM","TAB_BAR_POSSITIONS","commands","helpers","extensions","isValidElementIdentifier","id","_","isString","isNumber","isEmpty","isNaN","setFrame","frame","isWebContext","errors","NotImplementedError","isNull","curWebFrames","log","debug","hasElementId","atomsElement","getAtomsElement","value","executeAtom","WINDOW","unshift","atom","isUndefined","NoSuchFrameError","getCssProperty","propertyName","el","submit","refresh","getUrl","remote","execute","title","getCookies","script","jsCookies","cookies","name","toPairs","cookieUtils","createJWPCookie","undefined","push","err","error","UnknownError","setCookie","cookie","clone","path","jsCookie","createJSCookie","expires","expiry","Date","toUTCString","domain","httpOnly","secure","JSON","stringify","deleteCookie","cookieName","indexOf","map","_deleteCookie","deleteCookies","length","webCookie","expireCookie","cacheWebElement","isPlainObject","elId","unwrapElement","cacheId","includes","uuidV4","webElementsCache","set","wrapElement","cacheWebElements","response","toCached","v","isArray","result","reduce","acc","key","findWebElementOrElements","strategy","selector","many","ctx","contextElement","isNil","element","doFind","implicitWaitForCondition","message","isFunction","match","NoSuchElementError","clickWebCoords","coords","translateWebCoords","curWebCoords","clickCoords","args","alwaysDefaultFrame","frames","promise","waitForAtom","executeAtomAsync","responseUrl","B","resolve","reject","asyncPromise","elOrId","has","StaleElementReferenceError","ELEMENT","get","convertElementsForAtoms","arg","isErrorType","getElementId","hasValue","getSafariIsIphone","isBoolean","_isSafariIphone","userAgent","toLowerCase","warn","getSafariDeviceSize","width","height","normHeight","normWidth","getSafariIsNotched","_isSafariNotched","device","getExtraTranslateWebCoordsOffset","wvPos","realDims","topOffset","bottomOffset","isIphone","nativeWebTapTabBarVisibility","nativeWebTapSmartAppBannerVisibility","safariTabBarPosition","compareVersions","opts","platformVersion","settings","getSettings","tabBarVisibility","lowerCase","bannerVisibility","tabBarPosition","InvalidArgumentError","isNotched","orientation","notchOffset","isScrolled","contextsAndViews","getContextsAndViews","tabs","filter","startsWith","getExtraNativeWebTapOffset","y","offset","banners","findNativeElementOrElements","tapWebElementNatively","driver","text","els","rect","proxyCommand","el2","rect2","x","Math","round","nativeWebTap","nativeWebTapStrict","Promise","all","size","coordinates","performTouch","action","options","webview","retryInterval","ign","Error","cmd","wvDims","implicitWaitMs","setImplicitWait","xRatio","yRatio","newCoords","checkForAlert","getAlertText","timer","timing","Timer","start","timedAtomPromise","timeout","handlePromiseError","p","originalError","AggregateError","TimeoutError","getDuration","asMilliSeconds","toFixed","any","delay","isFulfilled","_waitingAtoms","count","alertNotifier","EventEmitter","alertMonitor","onAlertCallback","isResolved","emit","UnexpectedAlertOpenError","once","then","catch","removeListener","mobileWebNav","navType","allowNavigationWithoutReload","mobileUpdateSafariPreferences","isSimulator","preferences","updateSafariSettings","Object","assign"],"sources":["../../../lib/commands/web.js"],"sourcesContent":["import { retryInterval } from 'asyncbox';\nimport { util, timing } from 'appium/support';\nimport _ from 'lodash';\nimport B from 'bluebird';\nimport { errors, isErrorType } from 'appium/driver';\nimport cookieUtils from '../cookies';\nimport { EventEmitter } from 'events';\n\nconst IPHONE_TOP_BAR_HEIGHT = 71;\nconst IPHONE_SCROLLED_TOP_BAR_HEIGHT = 41;\nconst IPHONE_X_SCROLLED_OFFSET = 55;\nconst IPHONE_X_NOTCH_OFFSET_IOS = 24;\nconst IPHONE_X_NOTCH_OFFSET_IOS_13 = 20;\n\nconst IPHONE_LANDSCAPE_TOP_BAR_HEIGHT = 51;\nconst IPHONE_BOTTOM_BAR_OFFSET = 49;\nconst TAB_BAR_OFFSET = 33;\nconst IPHONE_WEB_COORD_SMART_APP_BANNER_OFFSET = 84;\nconst IPAD_WEB_COORD_SMART_APP_BANNER_OFFSET = 95;\n\nconst NOTCHED_DEVICE_SIZES = [\n  {w: 1125, h: 2436}, // 11 Pro, X, Xs\n  {w: 828, h: 1792}, // 11, Xr\n  {w: 1242, h: 2688}, // 11 Pro Max, Xs Max\n];\n\nconst { W3C_WEB_ELEMENT_IDENTIFIER } = util;\n\nconst ATOM_WAIT_TIMEOUT_MS = 2 * 60000;\nconst ATOM_INITIAL_WAIT_MS = 1000;\n\nconst ON_OBSTRUCTING_ALERT_EVENT = 'alert';\n\nconst VISIBLE = 'visible';\nconst INVISIBLE = 'invisible';\nconst DETECT = 'detect';\nconst VISIBILITIES = [VISIBLE, INVISIBLE, DETECT];\n\n// The position of Safari's tab (search bar).\n// Since iOS 15, the bar is the bottom by default.\nconst TAB_BAR_POSITION_TOP = 'top';\nconst TAB_BAR_POSITION_BOTTOM = 'bottom';\nconst TAB_BAR_POSSITIONS = [TAB_BAR_POSITION_TOP, TAB_BAR_POSITION_BOTTOM];\n\nconst commands = {}, helpers = {}, extensions = {};\n\nfunction isValidElementIdentifier (id) {\n  if (!_.isString(id) && !_.isNumber(id)) {\n    return false;\n  }\n  if (_.isString(id) && _.isEmpty(id)) {\n    return false;\n  }\n  if (_.isNumber(id) && isNaN(id)) {\n    return false;\n  }\n  return true;\n}\n\ncommands.setFrame = async function setFrame (frame) {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  if (_.isNull(frame)) {\n    this.curWebFrames = [];\n    this.log.debug('Leaving web frame and going back to default content');\n    return;\n  }\n\n  if (helpers.hasElementId(frame)) {\n    const atomsElement = this.getAtomsElement(frame);\n    const value = await this.executeAtom('get_frame_window', [atomsElement]);\n    this.log.debug(`Entering new web frame: '${value.WINDOW}'`);\n    this.curWebFrames.unshift(value.WINDOW);\n  } else {\n    const atom = _.isNumber(frame) ? 'frame_by_index' : 'frame_by_id_or_name';\n    const value = await this.executeAtom(atom, [frame]);\n    if (_.isNull(value) || _.isUndefined(value.WINDOW)) {\n      throw new errors.NoSuchFrameError();\n    }\n    this.log.debug(`Entering new web frame: '${value.WINDOW}'`);\n    this.curWebFrames.unshift(value.WINDOW);\n  }\n};\n\ncommands.getCssProperty = async function getCssProperty (propertyName, el) {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  const atomsElement = this.getAtomsElement(el);\n  return await this.executeAtom('get_value_of_css_property', [atomsElement, propertyName]);\n};\n\ncommands.submit = async function submit (el) {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  const atomsElement = this.getAtomsElement(el);\n  await this.executeAtom('submit', [atomsElement]);\n};\n\ncommands.refresh = async function refresh () {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  await this.executeAtom('refresh', []);\n};\n\ncommands.getUrl = async function getUrl () {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  return await this.remote.execute('window.location.href');\n};\n\ncommands.title = async function title () {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  return await this.executeAtom('title', [], true);\n};\n\ncommands.getCookies = async function getCookies () {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  this.log.debug('Retrieving all cookies');\n\n  let script = 'return document.cookie';\n  let jsCookies = await this.executeAtom('execute_script', [script, []]);\n\n  let cookies = [];\n  try {\n    for (let [name, value] of _.toPairs(cookieUtils.createJWPCookie(undefined, jsCookies))) {\n      cookies.push({name, value});\n    }\n    return cookies;\n  } catch (err) {\n    this.log.error(err);\n    throw new errors.UnknownError(`Error parsing cookies from result: '${jsCookies}'`);\n  }\n};\n\ncommands.setCookie = async function setCookie (cookie) {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  cookie = _.clone(cookie);\n\n  // if `path` field is not specified, Safari will not update cookies as expected; eg issue #1708\n  if (!cookie.path) {\n    cookie.path = '/';\n  }\n\n  const jsCookie = cookieUtils.createJSCookie(cookie.name, cookie.value, {\n    expires: _.isNumber(cookie.expiry) ? (new Date(cookie.expiry * 1000)).toUTCString() :\n      cookie.expiry,\n    path: cookie.path,\n    domain: cookie.domain,\n    httpOnly: cookie.httpOnly,\n    secure: cookie.secure\n  });\n  let script = `document.cookie = ${JSON.stringify(jsCookie)}`;\n  await this.executeAtom('execute_script', [script, []]);\n};\n\ncommands.deleteCookie = async function deleteCookie (cookieName) {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  // check cookie existence\n  let cookies = await this.getCookies();\n  if (_.indexOf(_.map(cookies, 'name'), cookieName) === -1) {\n    this.log.debug(`Cookie '${cookieName}' not found. Ignoring.`);\n    return true;\n  }\n\n  return await this._deleteCookie(cookieName);\n};\n\ncommands.deleteCookies = async function deleteCookies () {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  let cookies = await this.getCookies();\n  if (cookies.length) {\n    for (let cookie of cookies) {\n      await this._deleteCookie(cookie.name);\n    }\n  }\n  return true;\n};\n\nhelpers._deleteCookie = async function _deleteCookie (cookieName) {\n  this.log.debug(`Deleting cookie '${cookieName}'`);\n  let webCookie = cookieUtils.expireCookie(cookieName, {path: '/'});\n  let script = `document.cookie = ${JSON.stringify(webCookie)}`;\n  await this.executeAtom('execute_script', [script, []]);\n};\n\nhelpers.cacheWebElement = function cacheWebElement (el) {\n  if (!_.isPlainObject(el)) {\n    return el;\n  }\n  const elId = util.unwrapElement(el);\n  if (!isValidElementIdentifier(elId)) {\n    return el;\n  }\n  // In newer debugger releases element identifiers look like `:wdc:1628151649325`\n  // We assume it is safe to use these to identify cached elements\n  const cacheId = _.includes(elId, ':') ? elId : util.uuidV4();\n  this.webElementsCache.set(cacheId, elId);\n  return util.wrapElement(cacheId);\n};\n\nhelpers.cacheWebElements = function cacheWebElements (response) {\n  const toCached = (v) => _.isArray(v) || _.isPlainObject(v)\n    ? this.cacheWebElements(v)\n    : v;\n\n  if (_.isArray(response)) {\n    return response.map(toCached);\n  } else if (_.isPlainObject(response)) {\n    const result = {...response, ...(this.cacheWebElement(response))};\n    return _.toPairs(result).reduce(\n      (acc, [key, value]) => {\n        acc[key] = toCached(value);\n        return acc;\n      }, {}\n    );\n  }\n  return response;\n};\n\nextensions.findWebElementOrElements = async function findWebElementOrElements (strategy, selector, many, ctx) {\n  const contextElement = _.isNil(ctx) ? null : this.getAtomsElement(ctx);\n  let element;\n  let doFind = async () => {\n    element = await this.executeAtom(`find_element${many ? 's' : ''}`, [strategy, selector, contextElement]);\n    return !_.isNull(element);\n  };\n  try {\n    await this.implicitWaitForCondition(doFind);\n  } catch (err) {\n    if (err.message && _.isFunction(err.message.match) && err.message.match(/Condition unmet/)) {\n      // condition was not met setting res to empty array\n      element = [];\n    } else {\n      throw err;\n    }\n  }\n\n  if (many) {\n    return this.cacheWebElements(element);\n  }\n  if (_.isEmpty(element)) {\n    throw new errors.NoSuchElementError();\n  }\n  return this.cacheWebElements(element);\n};\n\nextensions.clickWebCoords = async function clickWebCoords () {\n  let coords = await this.translateWebCoords(this.curWebCoords);\n  await this.clickCoords(coords);\n};\n\nhelpers.executeAtom = async function executeAtom (atom, args, alwaysDefaultFrame = false) {\n  let frames = alwaysDefaultFrame === true ? [] : this.curWebFrames;\n  let promise = this.remote.executeAtom(atom, args, frames);\n  return await this.waitForAtom(promise);\n};\n\nhelpers.executeAtomAsync = async function executeAtomAsync (atom, args, responseUrl) {\n  // save the resolve and reject methods of the promise to be waited for\n  let promise = new B((resolve, reject) => {\n    this.asyncPromise = {resolve, reject};\n  });\n  await this.remote.executeAtomAsync(atom, args, this.curWebFrames, responseUrl);\n  return await this.waitForAtom(promise);\n};\n\nhelpers.getAtomsElement = function getAtomsElement (elOrId) {\n  const elId = util.unwrapElement(elOrId);\n  if (!this.webElementsCache.has(elId)) {\n    throw new errors.StaleElementReferenceError();\n  }\n  return {ELEMENT: this.webElementsCache.get(elId)};\n};\n\nhelpers.convertElementsForAtoms = function convertElementsForAtoms (args = []) {\n  return args.map((arg) => {\n    if (helpers.hasElementId(arg)) {\n      try {\n        return this.getAtomsElement(arg);\n      } catch (err) {\n        if (!isErrorType(err, errors.StaleElementReferenceError)) {\n          throw err;\n        }\n      }\n      return arg;\n    }\n    return _.isArray(arg) ? this.convertElementsForAtoms(arg) : arg;\n  });\n};\n\nhelpers.getElementId = function getElementId (element) {\n  return element.ELEMENT || element[W3C_WEB_ELEMENT_IDENTIFIER];\n};\n\nhelpers.hasElementId = function hasElementId (element) {\n  return util.hasValue(element) && (util.hasValue(element.ELEMENT) || util.hasValue(element[W3C_WEB_ELEMENT_IDENTIFIER]));\n};\n\nextensions.getSafariIsIphone = async function getSafariIsIphone () {\n  if (_.isBoolean(this._isSafariIphone)) {\n    return this._isSafariIphone;\n  }\n  try {\n    const userAgent = await this.execute('return navigator.userAgent');\n    this._isSafariIphone = userAgent.toLowerCase().includes('iphone');\n  } catch (err) {\n    this.log.warn(`Unable to find device type from useragent. Assuming iPhone`);\n    this.log.debug(`Error: ${err.message}`);\n  }\n  return this._isSafariIphone ?? true;\n};\n\nextensions.getSafariDeviceSize = async function getSafariDeviceSize () {\n  const script = 'return {height: window.screen.availHeight * window.devicePixelRatio, width: window.screen.availWidth * window.devicePixelRatio};';\n  const {width, height} = await this.execute(script);\n  const [normHeight, normWidth] = height > width ? [height, width] : [width, height];\n  return {\n    width: normWidth,\n    height: normHeight,\n  };\n};\n\nextensions.getSafariIsNotched = async function getSafariIsNotched () {\n  if (_.isBoolean(this._isSafariNotched)) {\n    return this._isSafariNotched;\n  }\n\n  try {\n    const {width, height} = await this.getSafariDeviceSize();\n    for (const device of NOTCHED_DEVICE_SIZES) {\n      if (device.w === width && device.h === height) {\n        this._isSafariNotched = true;\n      }\n    }\n  } catch (err) {\n    this.log.warn(`Unable to find device type from dimensions. Assuming the device is not notched`);\n    this.log.debug(`Error: ${err.message}`);\n  }\n  return this._isSafariNotched ?? false;\n};\n\nextensions.getExtraTranslateWebCoordsOffset = async function getExtraTranslateWebCoordsOffset (wvPos, realDims) {\n  let topOffset = 0;\n  let bottomOffset = 0;\n\n  const isIphone = await this.getSafariIsIphone();\n\n  // No need to check whether the Smart App Banner or Tab Bar is visible or not\n  // if already defined by nativeWebTapTabBarVisibility or nativeWebTapSmartAppBannerVisibility in settings.\n  const {\n    nativeWebTapTabBarVisibility,\n    nativeWebTapSmartAppBannerVisibility,\n    safariTabBarPosition = util.compareVersions(this.opts.platformVersion, '>=', '15.0') && isIphone\n      ? TAB_BAR_POSITION_BOTTOM : TAB_BAR_POSITION_TOP,\n  } = await this.settings.getSettings();\n  let tabBarVisibility = _.lowerCase(nativeWebTapTabBarVisibility);\n  let bannerVisibility = _.lowerCase(nativeWebTapSmartAppBannerVisibility);\n  const tabBarPosition = _.lowerCase(safariTabBarPosition);\n\n  if (!VISIBILITIES.includes(tabBarVisibility)) {\n    tabBarVisibility = DETECT;\n  }\n  if (!VISIBILITIES.includes(bannerVisibility)) {\n    bannerVisibility = DETECT;\n  }\n\n  if (!TAB_BAR_POSSITIONS.includes(tabBarPosition)) {\n    throw new errors.InvalidArgumentError(\n      `${safariTabBarPosition} is invalid as Safari tab bar position. Available positions are ${TAB_BAR_POSSITIONS}.`);\n  }\n\n  const isNotched = isIphone && await this.getSafariIsNotched();\n\n  const orientation = realDims.h > realDims.w ? 'PORTRAIT' : 'LANDSCAPE';\n\n  const notchOffset = isNotched\n    ? util.compareVersions(this.opts.platformVersion, '=', '13.0')\n      ? IPHONE_X_NOTCH_OFFSET_IOS_13\n      : IPHONE_X_NOTCH_OFFSET_IOS\n    : 0;\n\n  const isScrolled = await this.execute('return document.documentElement.scrollTop > 0');\n  if (isScrolled) {\n    topOffset = IPHONE_SCROLLED_TOP_BAR_HEIGHT + notchOffset;\n\n    if (isNotched) {\n      topOffset -= IPHONE_X_SCROLLED_OFFSET;\n    }\n\n    // If the iPhone is landscape then there is no top bar\n    if (orientation === 'LANDSCAPE' && isIphone) {\n      topOffset = 0;\n    }\n  } else {\n    topOffset = tabBarPosition === TAB_BAR_POSITION_BOTTOM ? 0 : IPHONE_TOP_BAR_HEIGHT;\n    topOffset += notchOffset;\n    this.log.debug(`tabBarPosition and topOffset: ${tabBarPosition}, ${topOffset}`);\n\n    if (isIphone) {\n      if (orientation === 'PORTRAIT') {\n        // The bottom bar is only visible when portrait\n        bottomOffset = IPHONE_BOTTOM_BAR_OFFSET;\n      } else {\n        topOffset = IPHONE_LANDSCAPE_TOP_BAR_HEIGHT;\n      }\n    }\n\n    if (orientation === 'LANDSCAPE' || !isIphone) {\n      if (tabBarVisibility === VISIBLE) {\n        topOffset += TAB_BAR_OFFSET;\n      } else if (tabBarVisibility === DETECT) {\n        // Tabs only appear if the device is landscape or if it's an iPad so we only check visibility in this case\n        // Assume that each tab bar is a WebView\n        const contextsAndViews = await this.getContextsAndViews();\n        const tabs = contextsAndViews.filter((ctx) => ctx.id.startsWith('WEBVIEW_'));\n\n        if (tabs.length > 1) {\n          this.log.debug(`Found ${tabs.length} tabs. Assuming the tab bar is visible`);\n          topOffset += TAB_BAR_OFFSET;\n        }\n      }\n    }\n  }\n\n  topOffset += await this.getExtraNativeWebTapOffset(isIphone, bannerVisibility);\n\n  wvPos.y += topOffset;\n  realDims.h -= (topOffset + bottomOffset);\n};\n\nextensions.getExtraNativeWebTapOffset = async function getExtraNativeWebTapOffset (isIphone, bannerVisibility) {\n  let offset = 0;\n\n  if (bannerVisibility === VISIBLE) {\n    offset += isIphone ?\n      IPHONE_WEB_COORD_SMART_APP_BANNER_OFFSET :\n      IPAD_WEB_COORD_SMART_APP_BANNER_OFFSET;\n  } else if (bannerVisibility === DETECT) {\n    // try to see if there is an Smart App Banner\n    const banners = await this.findNativeElementOrElements('accessibility id', 'Close app download offer', true);\n    if (banners.length > 0) {\n      offset += isIphone ?\n        IPHONE_WEB_COORD_SMART_APP_BANNER_OFFSET :\n        IPAD_WEB_COORD_SMART_APP_BANNER_OFFSET;\n    }\n  }\n\n  this.log.debug(`Additional native web tap offset computed: ${offset}`);\n  return offset;\n};\n\nasync function tapWebElementNatively (driver, atomsElement) {\n  // try to get the text of the element, which will be accessible in the\n  // native context\n  try {\n    let text = await driver.executeAtom('get_text', [atomsElement]);\n    if (!text) {\n      text = await driver.executeAtom('get_attribute_value', [atomsElement, 'value']);\n    }\n\n    if (text) {\n      const els = await driver.findNativeElementOrElements('accessibility id', text, true);\n      if (els.length === 1 || els.length === 2) {\n        const el = els[0];\n        // use tap because on iOS 11.2 and below `nativeClick` crashes WDA\n        const rect = await driver.proxyCommand(`/element/${util.unwrapElement(el)}/rect`, 'GET');\n        if (els.length === 2) {\n          const el2 = els[1];\n          const rect2 = await driver.proxyCommand(`/element/${util.unwrapElement(el2)}/rect`, 'GET');\n\n          if ((rect.x !== rect2.x || rect.y !== rect2.y) ||\n          (rect.width !== rect2.width || rect.height !== rect2.height)) {\n            // These 2 native elements are not referring to the same web element\n            return false;\n          }\n        }\n        const coords = {\n          x: Math.round(rect.x + rect.width / 2),\n          y: Math.round(rect.y + rect.height / 2),\n        };\n        await driver.clickCoords(coords);\n        return true;\n      }\n    }\n  } catch (err) {\n    // any failure should fall through and trigger the more elaborate\n    // method of clicking\n    driver.log.warn(`Error attempting to click: ${err.message}`);\n  }\n  return false;\n}\n\nextensions.nativeWebTap = async function nativeWebTap (el) {\n  const atomsElement = this.getAtomsElement(el);\n\n  // if strict native tap, do not try to do it with WDA directly\n  if (!(await this.settings.getSettings()).nativeWebTapStrict && await tapWebElementNatively(this, atomsElement)) {\n    return;\n  }\n  this.log.warn('Unable to do simple native web tap. Attempting to convert coordinates');\n\n  // `get_top_left_coordinates` returns the wrong value sometimes,\n  // unless we pre-call both of these functions before the actual calls\n  await B.Promise.all([\n    this.executeAtom('get_size', [atomsElement]),\n    this.executeAtom('get_top_left_coordinates', [atomsElement]),\n  ]);\n\n  const [size, coordinates] = await B.Promise.all([\n    this.executeAtom('get_size', [atomsElement]),\n    this.executeAtom('get_top_left_coordinates', [atomsElement]),\n  ]);\n  const {width, height} = size;\n  let {x, y} = coordinates;\n  x += width / 2;\n  y += height / 2;\n\n  this.curWebCoords = {x, y};\n  await this.clickWebCoords();\n};\n\nextensions.clickCoords = async function clickCoords (coords) {\n  await this.performTouch([\n    {\n      action: 'tap',\n      options: coords,\n    },\n  ]);\n};\n\nextensions.translateWebCoords = async function translateWebCoords (coords) {\n  this.log.debug(`Translating coordinates (${JSON.stringify(coords)}) to web coordinates`);\n\n  // absolutize web coords\n  let webview;\n  try {\n    webview = await retryInterval(5, 100, async () => await this.findNativeElementOrElements('class name', 'XCUIElementTypeWebView', false));\n  } catch (ign) {}\n\n  if (!webview) {\n    throw new Error(`No WebView found. Unable to translate web coordinates for native web tap.`);\n  }\n\n  webview = util.unwrapElement(webview);\n\n  const rect = await this.proxyCommand(`/element/${webview}/rect`, 'GET');\n  const wvPos = {x: rect.x, y: rect.y};\n  const realDims = {w: rect.width, h: rect.height};\n\n  const cmd = '(function () { return {w: window.innerWidth, h: window.innerHeight}; })()';\n  const wvDims = await this.remote.execute(cmd);\n\n  // keep track of implicit wait, and set locally to 0\n  // https://github.com/appium/appium/issues/14988\n  const implicitWaitMs = this.implicitWaitMs;\n  await this.setImplicitWait(0);\n  try {\n    await this.getExtraTranslateWebCoordsOffset(wvPos, realDims);\n  } finally {\n    await this.setImplicitWait(implicitWaitMs);\n  }\n\n  if (wvDims && realDims && wvPos) {\n    let xRatio = realDims.w / wvDims.w;\n    let yRatio = realDims.h / wvDims.h;\n    let newCoords = {\n      x: wvPos.x + Math.round(xRatio * coords.x),\n      y: wvPos.y + Math.round(yRatio * coords.y),\n    };\n\n    // additional logging for coordinates, since it is sometimes broken\n    //   see https://github.com/appium/appium/issues/9159\n    this.log.debug(`Converted coordinates: ${JSON.stringify(newCoords)}`);\n    this.log.debug(`    rect: ${JSON.stringify(rect)}`);\n    this.log.debug(`    wvPos: ${JSON.stringify(wvPos)}`);\n    this.log.debug(`    realDims: ${JSON.stringify(realDims)}`);\n    this.log.debug(`    wvDims: ${JSON.stringify(wvDims)}`);\n    this.log.debug(`    xRatio: ${JSON.stringify(xRatio)}`);\n    this.log.debug(`    yRatio: ${JSON.stringify(yRatio)}`);\n\n    this.log.debug(`Converted web coords ${JSON.stringify(coords)} ` +\n      `into real coords ${JSON.stringify(newCoords)}`);\n    return newCoords;\n  }\n};\n\nextensions.checkForAlert = async function checkForAlert () {\n  return _.isString(await this.getAlertText());\n};\n\nextensions.waitForAtom = async function waitForAtom (promise) {\n  const timer = new timing.Timer().start();\n\n  // need to check for alert while the atom is being executed.\n  // so notify ourselves when it happens\n  const timedAtomPromise = B.resolve(promise).timeout(ATOM_WAIT_TIMEOUT_MS);\n  const handlePromiseError = async (p) => {\n    try {\n      return await p;\n    } catch (err) {\n      const originalError = (err instanceof B.AggregateError) ? err[0] : err;\n      this.log.debug(`Error received while executing atom: ${originalError.message}`);\n      if (originalError instanceof B.TimeoutError) {\n        throw new Error(`Did not get any response for atom execution after ` +\n          `${timer.getDuration().asMilliSeconds.toFixed(0)}ms`);\n      }\n      throw originalError;\n    }\n  };\n  // if the atom promise is fulfilled within ATOM_INITIAL_WAIT_MS\n  // then we don't need to check for an alert presence\n  await handlePromiseError(B.any([B.delay(ATOM_INITIAL_WAIT_MS), timedAtomPromise]));\n  if (timedAtomPromise.isFulfilled()) {\n    return await timedAtomPromise;\n  }\n\n  // ...otherwise make sure there is no unexpected alert covering the element\n  if (!_.isPlainObject(this._waitingAtoms)) {\n    this._waitingAtoms = {\n      count: 0,\n      alertNotifier: new EventEmitter(),\n      alertMonitor: B.resolve(),\n    };\n  }\n  this._waitingAtoms.count++;\n\n  let onAlertCallback;\n  try {\n    // only restart the monitor if it is not running already\n    if (this._waitingAtoms.alertMonitor.isResolved()) {\n      this._waitingAtoms.alertMonitor = B.resolve((async () => {\n        while (this._waitingAtoms.count > 0) {\n          try {\n            if (await this.checkForAlert()) {\n              this._waitingAtoms.alertNotifier.emit(ON_OBSTRUCTING_ALERT_EVENT);\n            }\n          } catch (ign) {}\n          await B.delay(ATOM_INITIAL_WAIT_MS / 2);\n        }\n      })());\n    }\n\n    return await new B((resolve, reject) => {\n      onAlertCallback = () => reject(new errors.UnexpectedAlertOpenError());\n      this._waitingAtoms.alertNotifier.once(ON_OBSTRUCTING_ALERT_EVENT, onAlertCallback);\n      handlePromiseError(timedAtomPromise)\n        // eslint-disable-next-line promise/prefer-await-to-then\n        .then(resolve)\n        .catch(reject);\n    });\n  } finally {\n    if (onAlertCallback) {\n      this._waitingAtoms.alertNotifier.removeListener(ON_OBSTRUCTING_ALERT_EVENT, onAlertCallback);\n    }\n    this._waitingAtoms.count--;\n  }\n};\n\nextensions.mobileWebNav = async function mobileWebNav (navType) {\n  this.remote.allowNavigationWithoutReload = true;\n  try {\n    await this.executeAtom('execute_script', [`history.${navType}();`, null]);\n  } finally {\n    this.remote.allowNavigationWithoutReload = false;\n  }\n};\n\n/**\n * @typedef {Object} SafariOpts\n * @property {object} preferences An object containing Safari settings to be updated.\n * The list of available setting names and their values could be retrieved by\n * changing the corresponding Safari settings in the UI and then inspecting\n * 'Library/Preferences/com.apple.mobilesafari.plist' file inside of\n * com.apple.mobilesafari app container.\n * The full path to the Mobile Safari's container could be retrieved from\n * `xcrun simctl get_app_container <sim_udid> com.apple.mobilesafari data`\n * command output.\n * Use the `xcrun simctl spawn <sim_udid> defaults read <path_to_plist>` command\n * to print the plist content to the Terminal.\n */\n\n/**\n * Updates preferences of Mobile Safari on Simulator\n *\n * @param {SafariOpts} opts\n */\ncommands.mobileUpdateSafariPreferences = async function mobileUpdateSafariPreferences (opts = {}) {\n  if (!this.isSimulator()) {\n    throw new Error('This extension is only available for Simulator');\n  }\n  const { preferences } = opts;\n  if (!_.isPlainObject(preferences)) {\n    throw new errors.InvalidArgumentError('\"preferences\" argument must be a valid object');\n  }\n\n  this.log.debug(`About to update Safari preferences: ${JSON.stringify(preferences)}`);\n  await this.opts.device.updateSafariSettings(preferences);\n};\n\nObject.assign(commands, extensions, helpers);\n\nexport default commands;\n"],"mappings":";;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,MAAMA,qBAAqB,GAAG,EAAE;AAChC,MAAMC,8BAA8B,GAAG,EAAE;AACzC,MAAMC,wBAAwB,GAAG,EAAE;AACnC,MAAMC,yBAAyB,GAAG,EAAE;AACpC,MAAMC,4BAA4B,GAAG,EAAE;AAEvC,MAAMC,+BAA+B,GAAG,EAAE;AAC1C,MAAMC,wBAAwB,GAAG,EAAE;AACnC,MAAMC,cAAc,GAAG,EAAE;AACzB,MAAMC,wCAAwC,GAAG,EAAE;AACnD,MAAMC,sCAAsC,GAAG,EAAE;AAEjD,MAAMC,oBAAoB,GAAG,CAC3B;EAACC,CAAC,EAAE,IAAI;EAAEC,CAAC,EAAE;AAAI,CAAC,EAClB;EAACD,CAAC,EAAE,GAAG;EAAEC,CAAC,EAAE;AAAI,CAAC,EACjB;EAACD,CAAC,EAAE,IAAI;EAAEC,CAAC,EAAE;AAAI,CAAC,CACnB;AAED,MAAM;EAAEC;AAA2B,CAAC,GAAGC,aAAI;AAE3C,MAAMC,oBAAoB,GAAG,CAAC,GAAG,KAAK;AACtC,MAAMC,oBAAoB,GAAG,IAAI;AAEjC,MAAMC,0BAA0B,GAAG,OAAO;AAE1C,MAAMC,OAAO,GAAG,SAAS;AACzB,MAAMC,SAAS,GAAG,WAAW;AAC7B,MAAMC,MAAM,GAAG,QAAQ;AACvB,MAAMC,YAAY,GAAG,CAACH,OAAO,EAAEC,SAAS,EAAEC,MAAM,CAAC;AAIjD,MAAME,oBAAoB,GAAG,KAAK;AAClC,MAAMC,uBAAuB,GAAG,QAAQ;AACxC,MAAMC,kBAAkB,GAAG,CAACF,oBAAoB,EAAEC,uBAAuB,CAAC;AAE1E,MAAME,QAAQ,GAAG,CAAC,CAAC;EAAEC,OAAO,GAAG,CAAC,CAAC;EAAEC,UAAU,GAAG,CAAC,CAAC;AAElD,SAASC,wBAAwB,CAAEC,EAAE,EAAE;EACrC,IAAI,CAACC,eAAC,CAACC,QAAQ,CAACF,EAAE,CAAC,IAAI,CAACC,eAAC,CAACE,QAAQ,CAACH,EAAE,CAAC,EAAE;IACtC,OAAO,KAAK;EACd;EACA,IAAIC,eAAC,CAACC,QAAQ,CAACF,EAAE,CAAC,IAAIC,eAAC,CAACG,OAAO,CAACJ,EAAE,CAAC,EAAE;IACnC,OAAO,KAAK;EACd;EACA,IAAIC,eAAC,CAACE,QAAQ,CAACH,EAAE,CAAC,IAAIK,KAAK,CAACL,EAAE,CAAC,EAAE;IAC/B,OAAO,KAAK;EACd;EACA,OAAO,IAAI;AACb;AAEAJ,QAAQ,CAACU,QAAQ,GAAG,eAAeA,QAAQ,CAAEC,KAAK,EAAE;EAClD,IAAI,CAAC,IAAI,CAACC,YAAY,EAAE,EAAE;IACxB,MAAM,IAAIC,cAAM,CAACC,mBAAmB,EAAE;EACxC;EAEA,IAAIT,eAAC,CAACU,MAAM,CAACJ,KAAK,CAAC,EAAE;IACnB,IAAI,CAACK,YAAY,GAAG,EAAE;IACtB,IAAI,CAACC,GAAG,CAACC,KAAK,CAAC,qDAAqD,CAAC;IACrE;EACF;EAEA,IAAIjB,OAAO,CAACkB,YAAY,CAACR,KAAK,CAAC,EAAE;IAC/B,MAAMS,YAAY,GAAG,IAAI,CAACC,eAAe,CAACV,KAAK,CAAC;IAChD,MAAMW,KAAK,GAAG,MAAM,IAAI,CAACC,WAAW,CAAC,kBAAkB,EAAE,CAACH,YAAY,CAAC,CAAC;IACxE,IAAI,CAACH,GAAG,CAACC,KAAK,CAAE,4BAA2BI,KAAK,CAACE,MAAO,GAAE,CAAC;IAC3D,IAAI,CAACR,YAAY,CAACS,OAAO,CAACH,KAAK,CAACE,MAAM,CAAC;EACzC,CAAC,MAAM;IACL,MAAME,IAAI,GAAGrB,eAAC,CAACE,QAAQ,CAACI,KAAK,CAAC,GAAG,gBAAgB,GAAG,qBAAqB;IACzE,MAAMW,KAAK,GAAG,MAAM,IAAI,CAACC,WAAW,CAACG,IAAI,EAAE,CAACf,KAAK,CAAC,CAAC;IACnD,IAAIN,eAAC,CAACU,MAAM,CAACO,KAAK,CAAC,IAAIjB,eAAC,CAACsB,WAAW,CAACL,KAAK,CAACE,MAAM,CAAC,EAAE;MAClD,MAAM,IAAIX,cAAM,CAACe,gBAAgB,EAAE;IACrC;IACA,IAAI,CAACX,GAAG,CAACC,KAAK,CAAE,4BAA2BI,KAAK,CAACE,MAAO,GAAE,CAAC;IAC3D,IAAI,CAACR,YAAY,CAACS,OAAO,CAACH,KAAK,CAACE,MAAM,CAAC;EACzC;AACF,CAAC;AAEDxB,QAAQ,CAAC6B,cAAc,GAAG,eAAeA,cAAc,CAAEC,YAAY,EAAEC,EAAE,EAAE;EACzE,IAAI,CAAC,IAAI,CAACnB,YAAY,EAAE,EAAE;IACxB,MAAM,IAAIC,cAAM,CAACC,mBAAmB,EAAE;EACxC;EAEA,MAAMM,YAAY,GAAG,IAAI,CAACC,eAAe,CAACU,EAAE,CAAC;EAC7C,OAAO,MAAM,IAAI,CAACR,WAAW,CAAC,2BAA2B,EAAE,CAACH,YAAY,EAAEU,YAAY,CAAC,CAAC;AAC1F,CAAC;AAED9B,QAAQ,CAACgC,MAAM,GAAG,eAAeA,MAAM,CAAED,EAAE,EAAE;EAC3C,IAAI,CAAC,IAAI,CAACnB,YAAY,EAAE,EAAE;IACxB,MAAM,IAAIC,cAAM,CAACC,mBAAmB,EAAE;EACxC;EAEA,MAAMM,YAAY,GAAG,IAAI,CAACC,eAAe,CAACU,EAAE,CAAC;EAC7C,MAAM,IAAI,CAACR,WAAW,CAAC,QAAQ,EAAE,CAACH,YAAY,CAAC,CAAC;AAClD,CAAC;AAEDpB,QAAQ,CAACiC,OAAO,GAAG,eAAeA,OAAO,GAAI;EAC3C,IAAI,CAAC,IAAI,CAACrB,YAAY,EAAE,EAAE;IACxB,MAAM,IAAIC,cAAM,CAACC,mBAAmB,EAAE;EACxC;EAEA,MAAM,IAAI,CAACS,WAAW,CAAC,SAAS,EAAE,EAAE,CAAC;AACvC,CAAC;AAEDvB,QAAQ,CAACkC,MAAM,GAAG,eAAeA,MAAM,GAAI;EACzC,IAAI,CAAC,IAAI,CAACtB,YAAY,EAAE,EAAE;IACxB,MAAM,IAAIC,cAAM,CAACC,mBAAmB,EAAE;EACxC;EAEA,OAAO,MAAM,IAAI,CAACqB,MAAM,CAACC,OAAO,CAAC,sBAAsB,CAAC;AAC1D,CAAC;AAEDpC,QAAQ,CAACqC,KAAK,GAAG,eAAeA,KAAK,GAAI;EACvC,IAAI,CAAC,IAAI,CAACzB,YAAY,EAAE,EAAE;IACxB,MAAM,IAAIC,cAAM,CAACC,mBAAmB,EAAE;EACxC;EAEA,OAAO,MAAM,IAAI,CAACS,WAAW,CAAC,OAAO,EAAE,EAAE,EAAE,IAAI,CAAC;AAClD,CAAC;AAEDvB,QAAQ,CAACsC,UAAU,GAAG,eAAeA,UAAU,GAAI;EACjD,IAAI,CAAC,IAAI,CAAC1B,YAAY,EAAE,EAAE;IACxB,MAAM,IAAIC,cAAM,CAACC,mBAAmB,EAAE;EACxC;EAEA,IAAI,CAACG,GAAG,CAACC,KAAK,CAAC,wBAAwB,CAAC;EAExC,IAAIqB,MAAM,GAAG,wBAAwB;EACrC,IAAIC,SAAS,GAAG,MAAM,IAAI,CAACjB,WAAW,CAAC,gBAAgB,EAAE,CAACgB,MAAM,EAAE,EAAE,CAAC,CAAC;EAEtE,IAAIE,OAAO,GAAG,EAAE;EAChB,IAAI;IACF,KAAK,IAAI,CAACC,IAAI,EAAEpB,KAAK,CAAC,IAAIjB,eAAC,CAACsC,OAAO,CAACC,gBAAW,CAACC,eAAe,CAACC,SAAS,EAAEN,SAAS,CAAC,CAAC,EAAE;MACtFC,OAAO,CAACM,IAAI,CAAC;QAACL,IAAI;QAAEpB;MAAK,CAAC,CAAC;IAC7B;IACA,OAAOmB,OAAO;EAChB,CAAC,CAAC,OAAOO,GAAG,EAAE;IACZ,IAAI,CAAC/B,GAAG,CAACgC,KAAK,CAACD,GAAG,CAAC;IACnB,MAAM,IAAInC,cAAM,CAACqC,YAAY,CAAE,uCAAsCV,SAAU,GAAE,CAAC;EACpF;AACF,CAAC;AAEDxC,QAAQ,CAACmD,SAAS,GAAG,eAAeA,SAAS,CAAEC,MAAM,EAAE;EACrD,IAAI,CAAC,IAAI,CAACxC,YAAY,EAAE,EAAE;IACxB,MAAM,IAAIC,cAAM,CAACC,mBAAmB,EAAE;EACxC;EAEAsC,MAAM,GAAG/C,eAAC,CAACgD,KAAK,CAACD,MAAM,CAAC;EAGxB,IAAI,CAACA,MAAM,CAACE,IAAI,EAAE;IAChBF,MAAM,CAACE,IAAI,GAAG,GAAG;EACnB;EAEA,MAAMC,QAAQ,GAAGX,gBAAW,CAACY,cAAc,CAACJ,MAAM,CAACV,IAAI,EAAEU,MAAM,CAAC9B,KAAK,EAAE;IACrEmC,OAAO,EAAEpD,eAAC,CAACE,QAAQ,CAAC6C,MAAM,CAACM,MAAM,CAAC,GAAI,IAAIC,IAAI,CAACP,MAAM,CAACM,MAAM,GAAG,IAAI,CAAC,CAAEE,WAAW,EAAE,GACjFR,MAAM,CAACM,MAAM;IACfJ,IAAI,EAAEF,MAAM,CAACE,IAAI;IACjBO,MAAM,EAAET,MAAM,CAACS,MAAM;IACrBC,QAAQ,EAAEV,MAAM,CAACU,QAAQ;IACzBC,MAAM,EAAEX,MAAM,CAACW;EACjB,CAAC,CAAC;EACF,IAAIxB,MAAM,GAAI,qBAAoByB,IAAI,CAACC,SAAS,CAACV,QAAQ,CAAE,EAAC;EAC5D,MAAM,IAAI,CAAChC,WAAW,CAAC,gBAAgB,EAAE,CAACgB,MAAM,EAAE,EAAE,CAAC,CAAC;AACxD,CAAC;AAEDvC,QAAQ,CAACkE,YAAY,GAAG,eAAeA,YAAY,CAAEC,UAAU,EAAE;EAC/D,IAAI,CAAC,IAAI,CAACvD,YAAY,EAAE,EAAE;IACxB,MAAM,IAAIC,cAAM,CAACC,mBAAmB,EAAE;EACxC;EAGA,IAAI2B,OAAO,GAAG,MAAM,IAAI,CAACH,UAAU,EAAE;EACrC,IAAIjC,eAAC,CAAC+D,OAAO,CAAC/D,eAAC,CAACgE,GAAG,CAAC5B,OAAO,EAAE,MAAM,CAAC,EAAE0B,UAAU,CAAC,KAAK,CAAC,CAAC,EAAE;IACxD,IAAI,CAAClD,GAAG,CAACC,KAAK,CAAE,WAAUiD,UAAW,wBAAuB,CAAC;IAC7D,OAAO,IAAI;EACb;EAEA,OAAO,MAAM,IAAI,CAACG,aAAa,CAACH,UAAU,CAAC;AAC7C,CAAC;AAEDnE,QAAQ,CAACuE,aAAa,GAAG,eAAeA,aAAa,GAAI;EACvD,IAAI,CAAC,IAAI,CAAC3D,YAAY,EAAE,EAAE;IACxB,MAAM,IAAIC,cAAM,CAACC,mBAAmB,EAAE;EACxC;EAEA,IAAI2B,OAAO,GAAG,MAAM,IAAI,CAACH,UAAU,EAAE;EACrC,IAAIG,OAAO,CAAC+B,MAAM,EAAE;IAClB,KAAK,IAAIpB,MAAM,IAAIX,OAAO,EAAE;MAC1B,MAAM,IAAI,CAAC6B,aAAa,CAAClB,MAAM,CAACV,IAAI,CAAC;IACvC;EACF;EACA,OAAO,IAAI;AACb,CAAC;AAEDzC,OAAO,CAACqE,aAAa,GAAG,eAAeA,aAAa,CAAEH,UAAU,EAAE;EAChE,IAAI,CAAClD,GAAG,CAACC,KAAK,CAAE,oBAAmBiD,UAAW,GAAE,CAAC;EACjD,IAAIM,SAAS,GAAG7B,gBAAW,CAAC8B,YAAY,CAACP,UAAU,EAAE;IAACb,IAAI,EAAE;EAAG,CAAC,CAAC;EACjE,IAAIf,MAAM,GAAI,qBAAoByB,IAAI,CAACC,SAAS,CAACQ,SAAS,CAAE,EAAC;EAC7D,MAAM,IAAI,CAAClD,WAAW,CAAC,gBAAgB,EAAE,CAACgB,MAAM,EAAE,EAAE,CAAC,CAAC;AACxD,CAAC;AAEDtC,OAAO,CAAC0E,eAAe,GAAG,SAASA,eAAe,CAAE5C,EAAE,EAAE;EACtD,IAAI,CAAC1B,eAAC,CAACuE,aAAa,CAAC7C,EAAE,CAAC,EAAE;IACxB,OAAOA,EAAE;EACX;EACA,MAAM8C,IAAI,GAAGxF,aAAI,CAACyF,aAAa,CAAC/C,EAAE,CAAC;EACnC,IAAI,CAAC5B,wBAAwB,CAAC0E,IAAI,CAAC,EAAE;IACnC,OAAO9C,EAAE;EACX;EAGA,MAAMgD,OAAO,GAAG1E,eAAC,CAAC2E,QAAQ,CAACH,IAAI,EAAE,GAAG,CAAC,GAAGA,IAAI,GAAGxF,aAAI,CAAC4F,MAAM,EAAE;EAC5D,IAAI,CAACC,gBAAgB,CAACC,GAAG,CAACJ,OAAO,EAAEF,IAAI,CAAC;EACxC,OAAOxF,aAAI,CAAC+F,WAAW,CAACL,OAAO,CAAC;AAClC,CAAC;AAED9E,OAAO,CAACoF,gBAAgB,GAAG,SAASA,gBAAgB,CAAEC,QAAQ,EAAE;EAC9D,MAAMC,QAAQ,GAAIC,CAAC,IAAKnF,eAAC,CAACoF,OAAO,CAACD,CAAC,CAAC,IAAInF,eAAC,CAACuE,aAAa,CAACY,CAAC,CAAC,GACtD,IAAI,CAACH,gBAAgB,CAACG,CAAC,CAAC,GACxBA,CAAC;EAEL,IAAInF,eAAC,CAACoF,OAAO,CAACH,QAAQ,CAAC,EAAE;IACvB,OAAOA,QAAQ,CAACjB,GAAG,CAACkB,QAAQ,CAAC;EAC/B,CAAC,MAAM,IAAIlF,eAAC,CAACuE,aAAa,CAACU,QAAQ,CAAC,EAAE;IACpC,MAAMI,MAAM,GAAG;MAAC,GAAGJ,QAAQ;MAAE,GAAI,IAAI,CAACX,eAAe,CAACW,QAAQ;IAAE,CAAC;IACjE,OAAOjF,eAAC,CAACsC,OAAO,CAAC+C,MAAM,CAAC,CAACC,MAAM,CAC7B,CAACC,GAAG,EAAE,CAACC,GAAG,EAAEvE,KAAK,CAAC,KAAK;MACrBsE,GAAG,CAACC,GAAG,CAAC,GAAGN,QAAQ,CAACjE,KAAK,CAAC;MAC1B,OAAOsE,GAAG;IACZ,CAAC,EAAE,CAAC,CAAC,CACN;EACH;EACA,OAAON,QAAQ;AACjB,CAAC;AAEDpF,UAAU,CAAC4F,wBAAwB,GAAG,eAAeA,wBAAwB,CAAEC,QAAQ,EAAEC,QAAQ,EAAEC,IAAI,EAAEC,GAAG,EAAE;EAC5G,MAAMC,cAAc,GAAG9F,eAAC,CAAC+F,KAAK,CAACF,GAAG,CAAC,GAAG,IAAI,GAAG,IAAI,CAAC7E,eAAe,CAAC6E,GAAG,CAAC;EACtE,IAAIG,OAAO;EACX,IAAIC,MAAM,GAAG,YAAY;IACvBD,OAAO,GAAG,MAAM,IAAI,CAAC9E,WAAW,CAAE,eAAc0E,IAAI,GAAG,GAAG,GAAG,EAAG,EAAC,EAAE,CAACF,QAAQ,EAAEC,QAAQ,EAAEG,cAAc,CAAC,CAAC;IACxG,OAAO,CAAC9F,eAAC,CAACU,MAAM,CAACsF,OAAO,CAAC;EAC3B,CAAC;EACD,IAAI;IACF,MAAM,IAAI,CAACE,wBAAwB,CAACD,MAAM,CAAC;EAC7C,CAAC,CAAC,OAAOtD,GAAG,EAAE;IACZ,IAAIA,GAAG,CAACwD,OAAO,IAAInG,eAAC,CAACoG,UAAU,CAACzD,GAAG,CAACwD,OAAO,CAACE,KAAK,CAAC,IAAI1D,GAAG,CAACwD,OAAO,CAACE,KAAK,CAAC,iBAAiB,CAAC,EAAE;MAE1FL,OAAO,GAAG,EAAE;IACd,CAAC,MAAM;MACL,MAAMrD,GAAG;IACX;EACF;EAEA,IAAIiD,IAAI,EAAE;IACR,OAAO,IAAI,CAACZ,gBAAgB,CAACgB,OAAO,CAAC;EACvC;EACA,IAAIhG,eAAC,CAACG,OAAO,CAAC6F,OAAO,CAAC,EAAE;IACtB,MAAM,IAAIxF,cAAM,CAAC8F,kBAAkB,EAAE;EACvC;EACA,OAAO,IAAI,CAACtB,gBAAgB,CAACgB,OAAO,CAAC;AACvC,CAAC;AAEDnG,UAAU,CAAC0G,cAAc,GAAG,eAAeA,cAAc,GAAI;EAC3D,IAAIC,MAAM,GAAG,MAAM,IAAI,CAACC,kBAAkB,CAAC,IAAI,CAACC,YAAY,CAAC;EAC7D,MAAM,IAAI,CAACC,WAAW,CAACH,MAAM,CAAC;AAChC,CAAC;AAED5G,OAAO,CAACsB,WAAW,GAAG,eAAeA,WAAW,CAAEG,IAAI,EAAEuF,IAAI,EAAEC,kBAAkB,GAAG,KAAK,EAAE;EACxF,IAAIC,MAAM,GAAGD,kBAAkB,KAAK,IAAI,GAAG,EAAE,GAAG,IAAI,CAAClG,YAAY;EACjE,IAAIoG,OAAO,GAAG,IAAI,CAACjF,MAAM,CAACZ,WAAW,CAACG,IAAI,EAAEuF,IAAI,EAAEE,MAAM,CAAC;EACzD,OAAO,MAAM,IAAI,CAACE,WAAW,CAACD,OAAO,CAAC;AACxC,CAAC;AAEDnH,OAAO,CAACqH,gBAAgB,GAAG,eAAeA,gBAAgB,CAAE5F,IAAI,EAAEuF,IAAI,EAAEM,WAAW,EAAE;EAEnF,IAAIH,OAAO,GAAG,IAAII,iBAAC,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;IACvC,IAAI,CAACC,YAAY,GAAG;MAACF,OAAO;MAAEC;IAAM,CAAC;EACvC,CAAC,CAAC;EACF,MAAM,IAAI,CAACvF,MAAM,CAACmF,gBAAgB,CAAC5F,IAAI,EAAEuF,IAAI,EAAE,IAAI,CAACjG,YAAY,EAAEuG,WAAW,CAAC;EAC9E,OAAO,MAAM,IAAI,CAACF,WAAW,CAACD,OAAO,CAAC;AACxC,CAAC;AAEDnH,OAAO,CAACoB,eAAe,GAAG,SAASA,eAAe,CAAEuG,MAAM,EAAE;EAC1D,MAAM/C,IAAI,GAAGxF,aAAI,CAACyF,aAAa,CAAC8C,MAAM,CAAC;EACvC,IAAI,CAAC,IAAI,CAAC1C,gBAAgB,CAAC2C,GAAG,CAAChD,IAAI,CAAC,EAAE;IACpC,MAAM,IAAIhE,cAAM,CAACiH,0BAA0B,EAAE;EAC/C;EACA,OAAO;IAACC,OAAO,EAAE,IAAI,CAAC7C,gBAAgB,CAAC8C,GAAG,CAACnD,IAAI;EAAC,CAAC;AACnD,CAAC;AAED5E,OAAO,CAACgI,uBAAuB,GAAG,SAASA,uBAAuB,CAAEhB,IAAI,GAAG,EAAE,EAAE;EAC7E,OAAOA,IAAI,CAAC5C,GAAG,CAAE6D,GAAG,IAAK;IACvB,IAAIjI,OAAO,CAACkB,YAAY,CAAC+G,GAAG,CAAC,EAAE;MAC7B,IAAI;QACF,OAAO,IAAI,CAAC7G,eAAe,CAAC6G,GAAG,CAAC;MAClC,CAAC,CAAC,OAAOlF,GAAG,EAAE;QACZ,IAAI,CAAC,IAAAmF,mBAAW,EAACnF,GAAG,EAAEnC,cAAM,CAACiH,0BAA0B,CAAC,EAAE;UACxD,MAAM9E,GAAG;QACX;MACF;MACA,OAAOkF,GAAG;IACZ;IACA,OAAO7H,eAAC,CAACoF,OAAO,CAACyC,GAAG,CAAC,GAAG,IAAI,CAACD,uBAAuB,CAACC,GAAG,CAAC,GAAGA,GAAG;EACjE,CAAC,CAAC;AACJ,CAAC;AAEDjI,OAAO,CAACmI,YAAY,GAAG,SAASA,YAAY,CAAE/B,OAAO,EAAE;EACrD,OAAOA,OAAO,CAAC0B,OAAO,IAAI1B,OAAO,CAACjH,0BAA0B,CAAC;AAC/D,CAAC;AAEDa,OAAO,CAACkB,YAAY,GAAG,SAASA,YAAY,CAAEkF,OAAO,EAAE;EACrD,OAAOhH,aAAI,CAACgJ,QAAQ,CAAChC,OAAO,CAAC,KAAKhH,aAAI,CAACgJ,QAAQ,CAAChC,OAAO,CAAC0B,OAAO,CAAC,IAAI1I,aAAI,CAACgJ,QAAQ,CAAChC,OAAO,CAACjH,0BAA0B,CAAC,CAAC,CAAC;AACzH,CAAC;AAEDc,UAAU,CAACoI,iBAAiB,GAAG,eAAeA,iBAAiB,GAAI;EACjE,IAAIjI,eAAC,CAACkI,SAAS,CAAC,IAAI,CAACC,eAAe,CAAC,EAAE;IACrC,OAAO,IAAI,CAACA,eAAe;EAC7B;EACA,IAAI;IACF,MAAMC,SAAS,GAAG,MAAM,IAAI,CAACrG,OAAO,CAAC,4BAA4B,CAAC;IAClE,IAAI,CAACoG,eAAe,GAAGC,SAAS,CAACC,WAAW,EAAE,CAAC1D,QAAQ,CAAC,QAAQ,CAAC;EACnE,CAAC,CAAC,OAAOhC,GAAG,EAAE;IACZ,IAAI,CAAC/B,GAAG,CAAC0H,IAAI,CAAE,4DAA2D,CAAC;IAC3E,IAAI,CAAC1H,GAAG,CAACC,KAAK,CAAE,UAAS8B,GAAG,CAACwD,OAAQ,EAAC,CAAC;EACzC;EACA,OAAO,IAAI,CAACgC,eAAe,IAAI,IAAI;AACrC,CAAC;AAEDtI,UAAU,CAAC0I,mBAAmB,GAAG,eAAeA,mBAAmB,GAAI;EACrE,MAAMrG,MAAM,GAAG,kIAAkI;EACjJ,MAAM;IAACsG,KAAK;IAAEC;EAAM,CAAC,GAAG,MAAM,IAAI,CAAC1G,OAAO,CAACG,MAAM,CAAC;EAClD,MAAM,CAACwG,UAAU,EAAEC,SAAS,CAAC,GAAGF,MAAM,GAAGD,KAAK,GAAG,CAACC,MAAM,EAAED,KAAK,CAAC,GAAG,CAACA,KAAK,EAAEC,MAAM,CAAC;EAClF,OAAO;IACLD,KAAK,EAAEG,SAAS;IAChBF,MAAM,EAAEC;EACV,CAAC;AACH,CAAC;AAED7I,UAAU,CAAC+I,kBAAkB,GAAG,eAAeA,kBAAkB,GAAI;EACnE,IAAI5I,eAAC,CAACkI,SAAS,CAAC,IAAI,CAACW,gBAAgB,CAAC,EAAE;IACtC,OAAO,IAAI,CAACA,gBAAgB;EAC9B;EAEA,IAAI;IACF,MAAM;MAACL,KAAK;MAAEC;IAAM,CAAC,GAAG,MAAM,IAAI,CAACF,mBAAmB,EAAE;IACxD,KAAK,MAAMO,MAAM,IAAIlK,oBAAoB,EAAE;MACzC,IAAIkK,MAAM,CAACjK,CAAC,KAAK2J,KAAK,IAAIM,MAAM,CAAChK,CAAC,KAAK2J,MAAM,EAAE;QAC7C,IAAI,CAACI,gBAAgB,GAAG,IAAI;MAC9B;IACF;EACF,CAAC,CAAC,OAAOlG,GAAG,EAAE;IACZ,IAAI,CAAC/B,GAAG,CAAC0H,IAAI,CAAE,gFAA+E,CAAC;IAC/F,IAAI,CAAC1H,GAAG,CAACC,KAAK,CAAE,UAAS8B,GAAG,CAACwD,OAAQ,EAAC,CAAC;EACzC;EACA,OAAO,IAAI,CAAC0C,gBAAgB,IAAI,KAAK;AACvC,CAAC;AAEDhJ,UAAU,CAACkJ,gCAAgC,GAAG,eAAeA,gCAAgC,CAAEC,KAAK,EAAEC,QAAQ,EAAE;EAC9G,IAAIC,SAAS,GAAG,CAAC;EACjB,IAAIC,YAAY,GAAG,CAAC;EAEpB,MAAMC,QAAQ,GAAG,MAAM,IAAI,CAACnB,iBAAiB,EAAE;EAI/C,MAAM;IACJoB,4BAA4B;IAC5BC,oCAAoC;IACpCC,oBAAoB,GAAGvK,aAAI,CAACwK,eAAe,CAAC,IAAI,CAACC,IAAI,CAACC,eAAe,EAAE,IAAI,EAAE,MAAM,CAAC,IAAIN,QAAQ,GAC5F3J,uBAAuB,GAAGD;EAChC,CAAC,GAAG,MAAM,IAAI,CAACmK,QAAQ,CAACC,WAAW,EAAE;EACrC,IAAIC,gBAAgB,GAAG7J,eAAC,CAAC8J,SAAS,CAACT,4BAA4B,CAAC;EAChE,IAAIU,gBAAgB,GAAG/J,eAAC,CAAC8J,SAAS,CAACR,oCAAoC,CAAC;EACxE,MAAMU,cAAc,GAAGhK,eAAC,CAAC8J,SAAS,CAACP,oBAAoB,CAAC;EAExD,IAAI,CAAChK,YAAY,CAACoF,QAAQ,CAACkF,gBAAgB,CAAC,EAAE;IAC5CA,gBAAgB,GAAGvK,MAAM;EAC3B;EACA,IAAI,CAACC,YAAY,CAACoF,QAAQ,CAACoF,gBAAgB,CAAC,EAAE;IAC5CA,gBAAgB,GAAGzK,MAAM;EAC3B;EAEA,IAAI,CAACI,kBAAkB,CAACiF,QAAQ,CAACqF,cAAc,CAAC,EAAE;IAChD,MAAM,IAAIxJ,cAAM,CAACyJ,oBAAoB,CAClC,GAAEV,oBAAqB,mEAAkE7J,kBAAmB,GAAE,CAAC;EACpH;EAEA,MAAMwK,SAAS,GAAGd,QAAQ,KAAI,MAAM,IAAI,CAACR,kBAAkB,EAAE;EAE7D,MAAMuB,WAAW,GAAGlB,QAAQ,CAACnK,CAAC,GAAGmK,QAAQ,CAACpK,CAAC,GAAG,UAAU,GAAG,WAAW;EAEtE,MAAMuL,WAAW,GAAGF,SAAS,GACzBlL,aAAI,CAACwK,eAAe,CAAC,IAAI,CAACC,IAAI,CAACC,eAAe,EAAE,GAAG,EAAE,MAAM,CAAC,GAC1DpL,4BAA4B,GAC5BD,yBAAyB,GAC3B,CAAC;EAEL,MAAMgM,UAAU,GAAG,MAAM,IAAI,CAACtI,OAAO,CAAC,+CAA+C,CAAC;EACtF,IAAIsI,UAAU,EAAE;IACdnB,SAAS,GAAG/K,8BAA8B,GAAGiM,WAAW;IAExD,IAAIF,SAAS,EAAE;MACbhB,SAAS,IAAI9K,wBAAwB;IACvC;IAGA,IAAI+L,WAAW,KAAK,WAAW,IAAIf,QAAQ,EAAE;MAC3CF,SAAS,GAAG,CAAC;IACf;EACF,CAAC,MAAM;IACLA,SAAS,GAAGc,cAAc,KAAKvK,uBAAuB,GAAG,CAAC,GAAGvB,qBAAqB;IAClFgL,SAAS,IAAIkB,WAAW;IACxB,IAAI,CAACxJ,GAAG,CAACC,KAAK,CAAE,iCAAgCmJ,cAAe,KAAId,SAAU,EAAC,CAAC;IAE/E,IAAIE,QAAQ,EAAE;MACZ,IAAIe,WAAW,KAAK,UAAU,EAAE;QAE9BhB,YAAY,GAAG3K,wBAAwB;MACzC,CAAC,MAAM;QACL0K,SAAS,GAAG3K,+BAA+B;MAC7C;IACF;IAEA,IAAI4L,WAAW,KAAK,WAAW,IAAI,CAACf,QAAQ,EAAE;MAC5C,IAAIS,gBAAgB,KAAKzK,OAAO,EAAE;QAChC8J,SAAS,IAAIzK,cAAc;MAC7B,CAAC,MAAM,IAAIoL,gBAAgB,KAAKvK,MAAM,EAAE;QAGtC,MAAMgL,gBAAgB,GAAG,MAAM,IAAI,CAACC,mBAAmB,EAAE;QACzD,MAAMC,IAAI,GAAGF,gBAAgB,CAACG,MAAM,CAAE5E,GAAG,IAAKA,GAAG,CAAC9F,EAAE,CAAC2K,UAAU,CAAC,UAAU,CAAC,CAAC;QAE5E,IAAIF,IAAI,CAACrG,MAAM,GAAG,CAAC,EAAE;UACnB,IAAI,CAACvD,GAAG,CAACC,KAAK,CAAE,SAAQ2J,IAAI,CAACrG,MAAO,wCAAuC,CAAC;UAC5E+E,SAAS,IAAIzK,cAAc;QAC7B;MACF;IACF;EACF;EAEAyK,SAAS,IAAI,MAAM,IAAI,CAACyB,0BAA0B,CAACvB,QAAQ,EAAEW,gBAAgB,CAAC;EAE9Ef,KAAK,CAAC4B,CAAC,IAAI1B,SAAS;EACpBD,QAAQ,CAACnK,CAAC,IAAKoK,SAAS,GAAGC,YAAa;AAC1C,CAAC;AAEDtJ,UAAU,CAAC8K,0BAA0B,GAAG,eAAeA,0BAA0B,CAAEvB,QAAQ,EAAEW,gBAAgB,EAAE;EAC7G,IAAIc,MAAM,GAAG,CAAC;EAEd,IAAId,gBAAgB,KAAK3K,OAAO,EAAE;IAChCyL,MAAM,IAAIzB,QAAQ,GAChB1K,wCAAwC,GACxCC,sCAAsC;EAC1C,CAAC,MAAM,IAAIoL,gBAAgB,KAAKzK,MAAM,EAAE;IAEtC,MAAMwL,OAAO,GAAG,MAAM,IAAI,CAACC,2BAA2B,CAAC,kBAAkB,EAAE,0BAA0B,EAAE,IAAI,CAAC;IAC5G,IAAID,OAAO,CAAC3G,MAAM,GAAG,CAAC,EAAE;MACtB0G,MAAM,IAAIzB,QAAQ,GAChB1K,wCAAwC,GACxCC,sCAAsC;IAC1C;EACF;EAEA,IAAI,CAACiC,GAAG,CAACC,KAAK,CAAE,8CAA6CgK,MAAO,EAAC,CAAC;EACtE,OAAOA,MAAM;AACf,CAAC;AAED,eAAeG,qBAAqB,CAAEC,MAAM,EAAElK,YAAY,EAAE;EAG1D,IAAI;IACF,IAAImK,IAAI,GAAG,MAAMD,MAAM,CAAC/J,WAAW,CAAC,UAAU,EAAE,CAACH,YAAY,CAAC,CAAC;IAC/D,IAAI,CAACmK,IAAI,EAAE;MACTA,IAAI,GAAG,MAAMD,MAAM,CAAC/J,WAAW,CAAC,qBAAqB,EAAE,CAACH,YAAY,EAAE,OAAO,CAAC,CAAC;IACjF;IAEA,IAAImK,IAAI,EAAE;MACR,MAAMC,GAAG,GAAG,MAAMF,MAAM,CAACF,2BAA2B,CAAC,kBAAkB,EAAEG,IAAI,EAAE,IAAI,CAAC;MACpF,IAAIC,GAAG,CAAChH,MAAM,KAAK,CAAC,IAAIgH,GAAG,CAAChH,MAAM,KAAK,CAAC,EAAE;QACxC,MAAMzC,EAAE,GAAGyJ,GAAG,CAAC,CAAC,CAAC;QAEjB,MAAMC,IAAI,GAAG,MAAMH,MAAM,CAACI,YAAY,CAAE,YAAWrM,aAAI,CAACyF,aAAa,CAAC/C,EAAE,CAAE,OAAM,EAAE,KAAK,CAAC;QACxF,IAAIyJ,GAAG,CAAChH,MAAM,KAAK,CAAC,EAAE;UACpB,MAAMmH,GAAG,GAAGH,GAAG,CAAC,CAAC,CAAC;UAClB,MAAMI,KAAK,GAAG,MAAMN,MAAM,CAACI,YAAY,CAAE,YAAWrM,aAAI,CAACyF,aAAa,CAAC6G,GAAG,CAAE,OAAM,EAAE,KAAK,CAAC;UAE1F,IAAKF,IAAI,CAACI,CAAC,KAAKD,KAAK,CAACC,CAAC,IAAIJ,IAAI,CAACR,CAAC,KAAKW,KAAK,CAACX,CAAC,IAC5CQ,IAAI,CAAC5C,KAAK,KAAK+C,KAAK,CAAC/C,KAAK,IAAI4C,IAAI,CAAC3C,MAAM,KAAK8C,KAAK,CAAC9C,MAAO,EAAE;YAE5D,OAAO,KAAK;UACd;QACF;QACA,MAAMjC,MAAM,GAAG;UACbgF,CAAC,EAAEC,IAAI,CAACC,KAAK,CAACN,IAAI,CAACI,CAAC,GAAGJ,IAAI,CAAC5C,KAAK,GAAG,CAAC,CAAC;UACtCoC,CAAC,EAAEa,IAAI,CAACC,KAAK,CAACN,IAAI,CAACR,CAAC,GAAGQ,IAAI,CAAC3C,MAAM,GAAG,CAAC;QACxC,CAAC;QACD,MAAMwC,MAAM,CAACtE,WAAW,CAACH,MAAM,CAAC;QAChC,OAAO,IAAI;MACb;IACF;EACF,CAAC,CAAC,OAAO7D,GAAG,EAAE;IAGZsI,MAAM,CAACrK,GAAG,CAAC0H,IAAI,CAAE,8BAA6B3F,GAAG,CAACwD,OAAQ,EAAC,CAAC;EAC9D;EACA,OAAO,KAAK;AACd;AAEAtG,UAAU,CAAC8L,YAAY,GAAG,eAAeA,YAAY,CAAEjK,EAAE,EAAE;EACzD,MAAMX,YAAY,GAAG,IAAI,CAACC,eAAe,CAACU,EAAE,CAAC;EAG7C,IAAI,CAAC,CAAC,MAAM,IAAI,CAACiI,QAAQ,CAACC,WAAW,EAAE,EAAEgC,kBAAkB,KAAI,MAAMZ,qBAAqB,CAAC,IAAI,EAAEjK,YAAY,CAAC,GAAE;IAC9G;EACF;EACA,IAAI,CAACH,GAAG,CAAC0H,IAAI,CAAC,uEAAuE,CAAC;EAItF,MAAMnB,iBAAC,CAAC0E,OAAO,CAACC,GAAG,CAAC,CAClB,IAAI,CAAC5K,WAAW,CAAC,UAAU,EAAE,CAACH,YAAY,CAAC,CAAC,EAC5C,IAAI,CAACG,WAAW,CAAC,0BAA0B,EAAE,CAACH,YAAY,CAAC,CAAC,CAC7D,CAAC;EAEF,MAAM,CAACgL,IAAI,EAAEC,WAAW,CAAC,GAAG,MAAM7E,iBAAC,CAAC0E,OAAO,CAACC,GAAG,CAAC,CAC9C,IAAI,CAAC5K,WAAW,CAAC,UAAU,EAAE,CAACH,YAAY,CAAC,CAAC,EAC5C,IAAI,CAACG,WAAW,CAAC,0BAA0B,EAAE,CAACH,YAAY,CAAC,CAAC,CAC7D,CAAC;EACF,MAAM;IAACyH,KAAK;IAAEC;EAAM,CAAC,GAAGsD,IAAI;EAC5B,IAAI;IAACP,CAAC;IAAEZ;EAAC,CAAC,GAAGoB,WAAW;EACxBR,CAAC,IAAIhD,KAAK,GAAG,CAAC;EACdoC,CAAC,IAAInC,MAAM,GAAG,CAAC;EAEf,IAAI,CAAC/B,YAAY,GAAG;IAAC8E,CAAC;IAAEZ;EAAC,CAAC;EAC1B,MAAM,IAAI,CAACrE,cAAc,EAAE;AAC7B,CAAC;AAED1G,UAAU,CAAC8G,WAAW,GAAG,eAAeA,WAAW,CAAEH,MAAM,EAAE;EAC3D,MAAM,IAAI,CAACyF,YAAY,CAAC,CACtB;IACEC,MAAM,EAAE,KAAK;IACbC,OAAO,EAAE3F;EACX,CAAC,CACF,CAAC;AACJ,CAAC;AAED3G,UAAU,CAAC4G,kBAAkB,GAAG,eAAeA,kBAAkB,CAAED,MAAM,EAAE;EACzE,IAAI,CAAC5F,GAAG,CAACC,KAAK,CAAE,4BAA2B8C,IAAI,CAACC,SAAS,CAAC4C,MAAM,CAAE,sBAAqB,CAAC;EAGxF,IAAI4F,OAAO;EACX,IAAI;IACFA,OAAO,GAAG,MAAM,IAAAC,uBAAa,EAAC,CAAC,EAAE,GAAG,EAAE,YAAY,MAAM,IAAI,CAACtB,2BAA2B,CAAC,YAAY,EAAE,wBAAwB,EAAE,KAAK,CAAC,CAAC;EAC1I,CAAC,CAAC,OAAOuB,GAAG,EAAE,CAAC;EAEf,IAAI,CAACF,OAAO,EAAE;IACZ,MAAM,IAAIG,KAAK,CAAE,2EAA0E,CAAC;EAC9F;EAEAH,OAAO,GAAGpN,aAAI,CAACyF,aAAa,CAAC2H,OAAO,CAAC;EAErC,MAAMhB,IAAI,GAAG,MAAM,IAAI,CAACC,YAAY,CAAE,YAAWe,OAAQ,OAAM,EAAE,KAAK,CAAC;EACvE,MAAMpD,KAAK,GAAG;IAACwC,CAAC,EAAEJ,IAAI,CAACI,CAAC;IAAEZ,CAAC,EAAEQ,IAAI,CAACR;EAAC,CAAC;EACpC,MAAM3B,QAAQ,GAAG;IAACpK,CAAC,EAAEuM,IAAI,CAAC5C,KAAK;IAAE1J,CAAC,EAAEsM,IAAI,CAAC3C;EAAM,CAAC;EAEhD,MAAM+D,GAAG,GAAG,2EAA2E;EACvF,MAAMC,MAAM,GAAG,MAAM,IAAI,CAAC3K,MAAM,CAACC,OAAO,CAACyK,GAAG,CAAC;EAI7C,MAAME,cAAc,GAAG,IAAI,CAACA,cAAc;EAC1C,MAAM,IAAI,CAACC,eAAe,CAAC,CAAC,CAAC;EAC7B,IAAI;IACF,MAAM,IAAI,CAAC5D,gCAAgC,CAACC,KAAK,EAAEC,QAAQ,CAAC;EAC9D,CAAC,SAAS;IACR,MAAM,IAAI,CAAC0D,eAAe,CAACD,cAAc,CAAC;EAC5C;EAEA,IAAID,MAAM,IAAIxD,QAAQ,IAAID,KAAK,EAAE;IAC/B,IAAI4D,MAAM,GAAG3D,QAAQ,CAACpK,CAAC,GAAG4N,MAAM,CAAC5N,CAAC;IAClC,IAAIgO,MAAM,GAAG5D,QAAQ,CAACnK,CAAC,GAAG2N,MAAM,CAAC3N,CAAC;IAClC,IAAIgO,SAAS,GAAG;MACdtB,CAAC,EAAExC,KAAK,CAACwC,CAAC,GAAGC,IAAI,CAACC,KAAK,CAACkB,MAAM,GAAGpG,MAAM,CAACgF,CAAC,CAAC;MAC1CZ,CAAC,EAAE5B,KAAK,CAAC4B,CAAC,GAAGa,IAAI,CAACC,KAAK,CAACmB,MAAM,GAAGrG,MAAM,CAACoE,CAAC;IAC3C,CAAC;IAID,IAAI,CAAChK,GAAG,CAACC,KAAK,CAAE,0BAAyB8C,IAAI,CAACC,SAAS,CAACkJ,SAAS,CAAE,EAAC,CAAC;IACrE,IAAI,CAAClM,GAAG,CAACC,KAAK,CAAE,aAAY8C,IAAI,CAACC,SAAS,CAACwH,IAAI,CAAE,EAAC,CAAC;IACnD,IAAI,CAACxK,GAAG,CAACC,KAAK,CAAE,cAAa8C,IAAI,CAACC,SAAS,CAACoF,KAAK,CAAE,EAAC,CAAC;IACrD,IAAI,CAACpI,GAAG,CAACC,KAAK,CAAE,iBAAgB8C,IAAI,CAACC,SAAS,CAACqF,QAAQ,CAAE,EAAC,CAAC;IAC3D,IAAI,CAACrI,GAAG,CAACC,KAAK,CAAE,eAAc8C,IAAI,CAACC,SAAS,CAAC6I,MAAM,CAAE,EAAC,CAAC;IACvD,IAAI,CAAC7L,GAAG,CAACC,KAAK,CAAE,eAAc8C,IAAI,CAACC,SAAS,CAACgJ,MAAM,CAAE,EAAC,CAAC;IACvD,IAAI,CAAChM,GAAG,CAACC,KAAK,CAAE,eAAc8C,IAAI,CAACC,SAAS,CAACiJ,MAAM,CAAE,EAAC,CAAC;IAEvD,IAAI,CAACjM,GAAG,CAACC,KAAK,CAAE,wBAAuB8C,IAAI,CAACC,SAAS,CAAC4C,MAAM,CAAE,GAAE,GAC7D,oBAAmB7C,IAAI,CAACC,SAAS,CAACkJ,SAAS,CAAE,EAAC,CAAC;IAClD,OAAOA,SAAS;EAClB;AACF,CAAC;AAEDjN,UAAU,CAACkN,aAAa,GAAG,eAAeA,aAAa,GAAI;EACzD,OAAO/M,eAAC,CAACC,QAAQ,CAAC,MAAM,IAAI,CAAC+M,YAAY,EAAE,CAAC;AAC9C,CAAC;AAEDnN,UAAU,CAACmH,WAAW,GAAG,eAAeA,WAAW,CAAED,OAAO,EAAE;EAC5D,MAAMkG,KAAK,GAAG,IAAIC,eAAM,CAACC,KAAK,EAAE,CAACC,KAAK,EAAE;EAIxC,MAAMC,gBAAgB,GAAGlG,iBAAC,CAACC,OAAO,CAACL,OAAO,CAAC,CAACuG,OAAO,CAACrO,oBAAoB,CAAC;EACzE,MAAMsO,kBAAkB,GAAG,MAAOC,CAAC,IAAK;IACtC,IAAI;MACF,OAAO,MAAMA,CAAC;IAChB,CAAC,CAAC,OAAO7K,GAAG,EAAE;MACZ,MAAM8K,aAAa,GAAI9K,GAAG,YAAYwE,iBAAC,CAACuG,cAAc,GAAI/K,GAAG,CAAC,CAAC,CAAC,GAAGA,GAAG;MACtE,IAAI,CAAC/B,GAAG,CAACC,KAAK,CAAE,wCAAuC4M,aAAa,CAACtH,OAAQ,EAAC,CAAC;MAC/E,IAAIsH,aAAa,YAAYtG,iBAAC,CAACwG,YAAY,EAAE;QAC3C,MAAM,IAAIpB,KAAK,CAAE,oDAAmD,GACjE,GAAEU,KAAK,CAACW,WAAW,EAAE,CAACC,cAAc,CAACC,OAAO,CAAC,CAAC,CAAE,IAAG,CAAC;MACzD;MACA,MAAML,aAAa;IACrB;EACF,CAAC;EAGD,MAAMF,kBAAkB,CAACpG,iBAAC,CAAC4G,GAAG,CAAC,CAAC5G,iBAAC,CAAC6G,KAAK,CAAC9O,oBAAoB,CAAC,EAAEmO,gBAAgB,CAAC,CAAC,CAAC;EAClF,IAAIA,gBAAgB,CAACY,WAAW,EAAE,EAAE;IAClC,OAAO,MAAMZ,gBAAgB;EAC/B;EAGA,IAAI,CAACrN,eAAC,CAACuE,aAAa,CAAC,IAAI,CAAC2J,aAAa,CAAC,EAAE;IACxC,IAAI,CAACA,aAAa,GAAG;MACnBC,KAAK,EAAE,CAAC;MACRC,aAAa,EAAE,IAAIC,oBAAY,EAAE;MACjCC,YAAY,EAAEnH,iBAAC,CAACC,OAAO;IACzB,CAAC;EACH;EACA,IAAI,CAAC8G,aAAa,CAACC,KAAK,EAAE;EAE1B,IAAII,eAAe;EACnB,IAAI;IAEF,IAAI,IAAI,CAACL,aAAa,CAACI,YAAY,CAACE,UAAU,EAAE,EAAE;MAChD,IAAI,CAACN,aAAa,CAACI,YAAY,GAAGnH,iBAAC,CAACC,OAAO,CAAC,CAAC,YAAY;QACvD,OAAO,IAAI,CAAC8G,aAAa,CAACC,KAAK,GAAG,CAAC,EAAE;UACnC,IAAI;YACF,IAAI,MAAM,IAAI,CAACpB,aAAa,EAAE,EAAE;cAC9B,IAAI,CAACmB,aAAa,CAACE,aAAa,CAACK,IAAI,CAACtP,0BAA0B,CAAC;YACnE;UACF,CAAC,CAAC,OAAOmN,GAAG,EAAE,CAAC;UACf,MAAMnF,iBAAC,CAAC6G,KAAK,CAAC9O,oBAAoB,GAAG,CAAC,CAAC;QACzC;MACF,CAAC,GAAG,CAAC;IACP;IAEA,OAAO,MAAM,IAAIiI,iBAAC,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;MACtCkH,eAAe,GAAG,MAAMlH,MAAM,CAAC,IAAI7G,cAAM,CAACkO,wBAAwB,EAAE,CAAC;MACrE,IAAI,CAACR,aAAa,CAACE,aAAa,CAACO,IAAI,CAACxP,0BAA0B,EAAEoP,eAAe,CAAC;MAClFhB,kBAAkB,CAACF,gBAAgB,CAAC,CAEjCuB,IAAI,CAACxH,OAAO,CAAC,CACbyH,KAAK,CAACxH,MAAM,CAAC;IAClB,CAAC,CAAC;EACJ,CAAC,SAAS;IACR,IAAIkH,eAAe,EAAE;MACnB,IAAI,CAACL,aAAa,CAACE,aAAa,CAACU,cAAc,CAAC3P,0BAA0B,EAAEoP,eAAe,CAAC;IAC9F;IACA,IAAI,CAACL,aAAa,CAACC,KAAK,EAAE;EAC5B;AACF,CAAC;AAEDtO,UAAU,CAACkP,YAAY,GAAG,eAAeA,YAAY,CAAEC,OAAO,EAAE;EAC9D,IAAI,CAAClN,MAAM,CAACmN,4BAA4B,GAAG,IAAI;EAC/C,IAAI;IACF,MAAM,IAAI,CAAC/N,WAAW,CAAC,gBAAgB,EAAE,CAAE,WAAU8N,OAAQ,KAAI,EAAE,IAAI,CAAC,CAAC;EAC3E,CAAC,SAAS;IACR,IAAI,CAAClN,MAAM,CAACmN,4BAA4B,GAAG,KAAK;EAClD;AACF,CAAC;AAqBDtP,QAAQ,CAACuP,6BAA6B,GAAG,eAAeA,6BAA6B,CAAEzF,IAAI,GAAG,CAAC,CAAC,EAAE;EAChG,IAAI,CAAC,IAAI,CAAC0F,WAAW,EAAE,EAAE;IACvB,MAAM,IAAI5C,KAAK,CAAC,gDAAgD,CAAC;EACnE;EACA,MAAM;IAAE6C;EAAY,CAAC,GAAG3F,IAAI;EAC5B,IAAI,CAACzJ,eAAC,CAACuE,aAAa,CAAC6K,WAAW,CAAC,EAAE;IACjC,MAAM,IAAI5O,cAAM,CAACyJ,oBAAoB,CAAC,+CAA+C,CAAC;EACxF;EAEA,IAAI,CAACrJ,GAAG,CAACC,KAAK,CAAE,uCAAsC8C,IAAI,CAACC,SAAS,CAACwL,WAAW,CAAE,EAAC,CAAC;EACpF,MAAM,IAAI,CAAC3F,IAAI,CAACX,MAAM,CAACuG,oBAAoB,CAACD,WAAW,CAAC;AAC1D,CAAC;AAEDE,MAAM,CAACC,MAAM,CAAC5P,QAAQ,EAAEE,UAAU,EAAED,OAAO,CAAC;AAAC,eAE9BD,QAAQ;AAAA"}