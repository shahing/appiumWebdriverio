"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.SafariNetworkLog = void 0;
require("source-map-support/register");
var _lodash = _interopRequireDefault(require("lodash"));
var _url = _interopRequireDefault(require("url"));
var _support = require("appium/support");
var _rotatingLog = require("./rotating-log");
class SafariNetworkLog extends _rotatingLog.RotatingLog {
  constructor(showLogs) {
    super(showLogs, 'SafariNetwork');
  }
  getEntry(requestId) {
    let outputEntry;
    while (this.logs.length >= _rotatingLog.MAX_LOG_ENTRIES_COUNT) {
      const entry = this.logs.shift();
      if (entry && entry.requestId === requestId) {
        outputEntry = entry;
        this.logs.push(outputEntry);
        continue;
      }
      if (this.logIdxSinceLastRequest > 0) {
        this.logIdxSinceLastRequest--;
      }
    }
    if (!outputEntry) {
      for (let i = this.logs.length - 1; i >= 0; i--) {
        if (this.logs[i].requestId === requestId) {
          outputEntry = this.logs[i];
          this.logs.splice(i, 1);
          break;
        }
      }
      if (!outputEntry) {
        outputEntry = {
          requestId,
          logs: []
        };
      }
      this.logs.push(outputEntry);
    }
    return outputEntry;
  }
  addLogLine(method, out) {
    if (!this.isCapturing && !this.showLogs) {
      return;
    }
    if (['Network.dataReceived'].includes(method)) {
      return;
    }
    const outputEntry = this.getEntry(out.requestId);
    if (this.isCapturing) {
      outputEntry.logs = outputEntry.logs || [];
      outputEntry.logs.push(out);
    }
    if (!this.showLogs) {
      return;
    }
    if (method === 'Network.loadingFinished' || method === 'Network.loadingFailed') {
      this.printLogLine(outputEntry);
    }
  }
  getLogDetails(outputEntry) {
    const record = outputEntry.logs.reduce(function getRecord(record, entry) {
      record.requestId = entry.requestId;
      if (entry.response) {
        const url = _url.default.parse(entry.response.url);
        record.name = `${_lodash.default.last(url.pathname.split('/'))}${url.search ? `?${url.search}` : ''}` || url.host;
        record.status = entry.response.status;
        if (entry.response.timing) {
          record.time = entry.response.timing.receiveHeadersEnd || entry.response.timing.responseStart || 0;
        }
        record.source = entry.response.source;
      }
      if (entry.type) {
        record.type = entry.type;
      }
      if (entry.initiator) {
        record.initiator = entry.initiator;
      }
      if (entry.metrics) {
        record.size = entry.metrics.responseBodyBytesReceived || 0;
      }
      if (entry.errorText) {
        record.errorText = entry.errorText;
        record.cancelled = entry.canceled;
      }
      return record;
    }, {});
    return record;
  }
  printLogLine(outputEntry) {
    const {
      requestId,
      name,
      status,
      type,
      initiator = {},
      size = 0,
      time = 0,
      source,
      errorText,
      cancelled = false
    } = this.getLogDetails(outputEntry);
    this.log.debug(`Network event:`);
    this.log.debug(`  Id: ${requestId}`);
    this.log.debug(`  Name: ${name}`);
    this.log.debug(`  Status: ${status}`);
    this.log.debug(`  Type: ${type}`);
    this.log.debug(`  Initiator: ${initiator.type}`);
    for (const line of initiator.stackTrace || []) {
      const functionName = line.functionName || '(anonymous)';
      const url = !line.url || line.url === '[native code]' ? '' : `@${_lodash.default.last((_url.default.parse(line.url).pathname || '').split('/'))}:${line.lineNumber}`;
      this.log.debug(`    ${_lodash.default.padEnd(_lodash.default.truncate(functionName, {
        length: 20
      }), 21)} ${url}`);
    }
    const sizeStr = source.includes('cache') ? ` (from ${source.replace('-', ' ')})` : `${size}B`;
    this.log.debug(`  Size: ${sizeStr}`);
    this.log.debug(`  Time: ${Math.round(time)}ms`);
    if (errorText) {
      this.log.debug(`  Error: ${errorText}`);
    }
    if (_support.util.hasValue(cancelled)) {
      this.log.debug(`  Cancelled: ${cancelled}`);
    }
  }
  async getLogs() {
    const logs = await super.getLogs();
    return logs.map(function adjustEntry(entry) {
      return Object.assign({}, entry, {
        level: 'INFO',
        timestamp: Date.now(),
        message: JSON.stringify(entry)
      });
    });
  }
}
exports.SafariNetworkLog = SafariNetworkLog;
var _default = SafariNetworkLog;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTYWZhcmlOZXR3b3JrTG9nIiwiUm90YXRpbmdMb2ciLCJjb25zdHJ1Y3RvciIsInNob3dMb2dzIiwiZ2V0RW50cnkiLCJyZXF1ZXN0SWQiLCJvdXRwdXRFbnRyeSIsImxvZ3MiLCJsZW5ndGgiLCJNQVhfTE9HX0VOVFJJRVNfQ09VTlQiLCJlbnRyeSIsInNoaWZ0IiwicHVzaCIsImxvZ0lkeFNpbmNlTGFzdFJlcXVlc3QiLCJpIiwic3BsaWNlIiwiYWRkTG9nTGluZSIsIm1ldGhvZCIsIm91dCIsImlzQ2FwdHVyaW5nIiwiaW5jbHVkZXMiLCJwcmludExvZ0xpbmUiLCJnZXRMb2dEZXRhaWxzIiwicmVjb3JkIiwicmVkdWNlIiwiZ2V0UmVjb3JkIiwicmVzcG9uc2UiLCJ1cmwiLCJVUkwiLCJwYXJzZSIsIm5hbWUiLCJfIiwibGFzdCIsInBhdGhuYW1lIiwic3BsaXQiLCJzZWFyY2giLCJob3N0Iiwic3RhdHVzIiwidGltaW5nIiwidGltZSIsInJlY2VpdmVIZWFkZXJzRW5kIiwicmVzcG9uc2VTdGFydCIsInNvdXJjZSIsInR5cGUiLCJpbml0aWF0b3IiLCJtZXRyaWNzIiwic2l6ZSIsInJlc3BvbnNlQm9keUJ5dGVzUmVjZWl2ZWQiLCJlcnJvclRleHQiLCJjYW5jZWxsZWQiLCJjYW5jZWxlZCIsImxvZyIsImRlYnVnIiwibGluZSIsInN0YWNrVHJhY2UiLCJmdW5jdGlvbk5hbWUiLCJsaW5lTnVtYmVyIiwicGFkRW5kIiwidHJ1bmNhdGUiLCJzaXplU3RyIiwicmVwbGFjZSIsIk1hdGgiLCJyb3VuZCIsInV0aWwiLCJoYXNWYWx1ZSIsImdldExvZ3MiLCJtYXAiLCJhZGp1c3RFbnRyeSIsIk9iamVjdCIsImFzc2lnbiIsImxldmVsIiwidGltZXN0YW1wIiwiRGF0ZSIsIm5vdyIsIm1lc3NhZ2UiLCJKU09OIiwic3RyaW5naWZ5Il0sInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL2RldmljZS1sb2cvc2FmYXJpLW5ldHdvcmstbG9nLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgVVJMIGZyb20gJ3VybCc7XG5pbXBvcnQgeyB1dGlsIH0gZnJvbSAnYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IHsgUm90YXRpbmdMb2csIE1BWF9MT0dfRU5UUklFU19DT1VOVCB9IGZyb20gJy4vcm90YXRpbmctbG9nJztcblxuXG5jbGFzcyBTYWZhcmlOZXR3b3JrTG9nIGV4dGVuZHMgUm90YXRpbmdMb2cge1xuICBjb25zdHJ1Y3RvciAoc2hvd0xvZ3MpIHtcbiAgICBzdXBlcihzaG93TG9ncywgJ1NhZmFyaU5ldHdvcmsnKTtcbiAgfVxuXG4gIGdldEVudHJ5IChyZXF1ZXN0SWQpIHtcbiAgICBsZXQgb3V0cHV0RW50cnk7XG4gICAgd2hpbGUgKHRoaXMubG9ncy5sZW5ndGggPj0gTUFYX0xPR19FTlRSSUVTX0NPVU5UKSB7XG4gICAgICAvLyBwdWxsIHRoZSBmaXJzdCBlbnRyeSwgd2hpY2ggaXMgdGhlIG9sZGVzdFxuICAgICAgY29uc3QgZW50cnkgPSB0aGlzLmxvZ3Muc2hpZnQoKTtcbiAgICAgIGlmIChlbnRyeSAmJiBlbnRyeS5yZXF1ZXN0SWQgPT09IHJlcXVlc3RJZCkge1xuICAgICAgICAvLyB3ZSBhcmUgYWRkaW5nIHRvIGFuIGV4aXN0aW5nIGVudHJ5LCBhbmQgaXQgd2FzIGFsbW9zdCByZW1vdmVkXG4gICAgICAgIC8vIGFkZCB0byB0aGUgZW5kIG9mIHRoZSBsaXN0IGFuZCB0cnkgYWdhaW5cbiAgICAgICAgb3V0cHV0RW50cnkgPSBlbnRyeTtcbiAgICAgICAgdGhpcy5sb2dzLnB1c2gob3V0cHV0RW50cnkpO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIC8vIHdlJ3ZlIHJlbW92ZWQgYW4gZWxlbWVudCwgc28gdGhlIGNvdW50IGlzIGRvd24gb25lXG4gICAgICBpZiAodGhpcy5sb2dJZHhTaW5jZUxhc3RSZXF1ZXN0ID4gMCkge1xuICAgICAgICB0aGlzLmxvZ0lkeFNpbmNlTGFzdFJlcXVlc3QtLTtcbiAgICAgIH1cbiAgICB9XG5cblxuICAgIGlmICghb3V0cHV0RW50cnkpIHtcbiAgICAgIC8vIHdlIGRvIG5vdCB5ZXMgaGF2ZSBhbiBlbnRyeSB0byBhc3NvY2lhdGUgdGhpcyBiaXQgb2Ygb3V0cHV0IHdpdGhcbiAgICAgIC8vIG1vc3QgbGlrZWx5IHRoZSBlbnRyeSB3aWxsIGJlIGF0IHRoZSBlbmQgb2YgdGhlIGxpc3QsIHNvIHN0YXJ0IHRoZXJlXG4gICAgICBmb3IgKGxldCBpID0gdGhpcy5sb2dzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgIGlmICh0aGlzLmxvZ3NbaV0ucmVxdWVzdElkID09PSByZXF1ZXN0SWQpIHtcbiAgICAgICAgICAvLyBmb3VuZCBpdCFcbiAgICAgICAgICBvdXRwdXRFbnRyeSA9IHRoaXMubG9nc1tpXTtcbiAgICAgICAgICAvLyB0aGlzIGlzIG5vdyB0aGUgbW9zdCBjdXJyZW50IGVudHJ5LCBzbyByZW1vdmUgaXQgZnJvbSB0aGUgbGlzdFxuICAgICAgICAgIC8vIHRvIGJlIGFkZGVkIHRvIHRoZSBlbmQgYmVsb3dcbiAgICAgICAgICB0aGlzLmxvZ3Muc3BsaWNlKGksIDEpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIG5vdGhpbmcgaGFzIGJlZW4gZm91bmQsIHNvIGNyZWF0ZSBhIG5ldyBlbnRyeVxuICAgICAgaWYgKCFvdXRwdXRFbnRyeSkge1xuICAgICAgICBvdXRwdXRFbnRyeSA9IHtcbiAgICAgICAgICByZXF1ZXN0SWQsXG4gICAgICAgICAgbG9nczogW10sXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIGZpbmFsbHksIGFkZCB0aGUgZW50cnkgdG8gdGhlIGVuZCBvZiB0aGUgbGlzdFxuICAgICAgdGhpcy5sb2dzLnB1c2gob3V0cHV0RW50cnkpO1xuICAgIH1cblxuICAgIHJldHVybiBvdXRwdXRFbnRyeTtcbiAgfVxuXG4gIGFkZExvZ0xpbmUgKG1ldGhvZCwgb3V0KSB7XG4gICAgaWYgKCF0aGlzLmlzQ2FwdHVyaW5nICYmICF0aGlzLnNob3dMb2dzKSB7XG4gICAgICAvLyBuZWl0aGVyIGNhcHR1cmluZyBub3IgZGlzcGxheWluZywgc28gZG8gbm90aGluZ1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChbJ05ldHdvcmsuZGF0YVJlY2VpdmVkJ10uaW5jbHVkZXMobWV0aG9kKSkge1xuICAgICAgLy8gc3RhdHVzIHVwZGF0ZSwgbm8gbmVlZCB0byBoYW5kbGVcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBldmVudHMgd2UgY2FyZSBhYm91dDpcbiAgICAvLyAgIE5ldHdvcmsucmVxdWVzdFdpbGxCZVNlbnRcbiAgICAvLyAgIE5ldHdvcmsucmVzcG9uc2VSZWNlaXZlZFxuICAgIC8vICAgTmV0d29yay5sb2FkaW5nRmluaXNoZWRcbiAgICAvLyAgIE5ldHdvcmsubG9hZGluZ0ZhaWxlZFxuXG4gICAgY29uc3Qgb3V0cHV0RW50cnkgPSB0aGlzLmdldEVudHJ5KG91dC5yZXF1ZXN0SWQpO1xuICAgIGlmICh0aGlzLmlzQ2FwdHVyaW5nKSB7XG4gICAgICAvLyBub3cgYWRkIHRoZSBvdXRwdXQgd2UganVzdCByZWNlaXZlZCB0byB0aGUgbG9ncyBmb3IgdGhpcyBwYXJ0aWN1bGFyIGVudHJ5XG4gICAgICBvdXRwdXRFbnRyeS5sb2dzID0gb3V0cHV0RW50cnkubG9ncyB8fCBbXTtcblxuICAgICAgb3V0cHV0RW50cnkubG9ncy5wdXNoKG91dCk7XG4gICAgfVxuXG4gICAgLy8gaWYgd2UgYXJlIG5vdCBkaXNwbGF5aW5nIHRoZSBsb2dzLFxuICAgIC8vIG9yIHdlIGFyZSBub3QgZmluaXNoZWQgZ2V0dGluZyBldmVudHMgZm9yIHRoaXMgbmV0d29yayBjYWxsLFxuICAgIC8vIHdlIGFyZSBkb25lXG4gICAgaWYgKCF0aGlzLnNob3dMb2dzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKG1ldGhvZCA9PT0gJ05ldHdvcmsubG9hZGluZ0ZpbmlzaGVkJyB8fCBtZXRob2QgPT09ICdOZXR3b3JrLmxvYWRpbmdGYWlsZWQnKSB7XG4gICAgICB0aGlzLnByaW50TG9nTGluZShvdXRwdXRFbnRyeSk7XG4gICAgfVxuICB9XG5cbiAgZ2V0TG9nRGV0YWlscyAob3V0cHV0RW50cnkpIHtcbiAgICAvLyBleHRyYWN0IHRoZSBkYXRhXG4gICAgY29uc3QgcmVjb3JkID0gb3V0cHV0RW50cnkubG9ncy5yZWR1Y2UoZnVuY3Rpb24gZ2V0UmVjb3JkIChyZWNvcmQsIGVudHJ5KSB7XG4gICAgICByZWNvcmQucmVxdWVzdElkID0gZW50cnkucmVxdWVzdElkO1xuICAgICAgaWYgKGVudHJ5LnJlc3BvbnNlKSB7XG4gICAgICAgIGNvbnN0IHVybCA9IFVSTC5wYXJzZShlbnRyeS5yZXNwb25zZS51cmwpO1xuICAgICAgICAvLyBnZXQgdGhlIGxhc3QgcGFydCBvZiB0aGUgdXJsLCBhbG9uZyB3aXRoIHRoZSBxdWVyeSBzdHJpbmcsIGlmIHBvc3NpYmxlXG4gICAgICAgIHJlY29yZC5uYW1lID0gYCR7Xy5sYXN0KHVybC5wYXRobmFtZS5zcGxpdCgnLycpKX0ke3VybC5zZWFyY2ggPyBgPyR7dXJsLnNlYXJjaH1gIDogJyd9YCB8fCB1cmwuaG9zdDtcbiAgICAgICAgcmVjb3JkLnN0YXR1cyA9IGVudHJ5LnJlc3BvbnNlLnN0YXR1cztcbiAgICAgICAgaWYgKGVudHJ5LnJlc3BvbnNlLnRpbWluZykge1xuICAgICAgICAgIHJlY29yZC50aW1lID0gZW50cnkucmVzcG9uc2UudGltaW5nLnJlY2VpdmVIZWFkZXJzRW5kXG4gICAgICAgICAgICB8fCBlbnRyeS5yZXNwb25zZS50aW1pbmcucmVzcG9uc2VTdGFydFxuICAgICAgICAgICAgfHwgMDtcbiAgICAgICAgfVxuICAgICAgICByZWNvcmQuc291cmNlID0gZW50cnkucmVzcG9uc2Uuc291cmNlO1xuICAgICAgfVxuICAgICAgaWYgKGVudHJ5LnR5cGUpIHtcbiAgICAgICAgcmVjb3JkLnR5cGUgPSBlbnRyeS50eXBlO1xuICAgICAgfVxuICAgICAgaWYgKGVudHJ5LmluaXRpYXRvcikge1xuICAgICAgICByZWNvcmQuaW5pdGlhdG9yID0gZW50cnkuaW5pdGlhdG9yO1xuICAgICAgfVxuICAgICAgaWYgKGVudHJ5Lm1ldHJpY3MpIHtcbiAgICAgICAgLy8gU2FmYXJpIGhhcyBhIGBtZXRyaWNzYCBvYmplY3Qgb24gaXQncyBgTmV0d29yay5sb2FkaW5nRmluaXNoZWRgIGV2ZW50XG4gICAgICAgIHJlY29yZC5zaXplID0gZW50cnkubWV0cmljcy5yZXNwb25zZUJvZHlCeXRlc1JlY2VpdmVkIHx8IDA7XG4gICAgICB9XG4gICAgICBpZiAoZW50cnkuZXJyb3JUZXh0KSB7XG4gICAgICAgIHJlY29yZC5lcnJvclRleHQgPSBlbnRyeS5lcnJvclRleHQ7XG4gICAgICAgIC8vIFdoZW4gYSBuZXR3b3JrIGNhbGwgaXMgY2FuY2VsbGVkLCBTYWZhcmkgcmV0dXJucyBgY2FuY2VsbGVkYCBhcyBlcnJvciB0ZXh0XG4gICAgICAgIC8vIGJ1dCBoYXMgYSBib29sZWFuIGBjYW5jZWxlZGAuIE5vcm1hbGl6ZSB0aGUgdHdvIHNwZWxsaW5ncyBpbiBmYXZvciBvZlxuICAgICAgICAvLyB0aGUgdGV4dCwgd2hpY2ggd2lsbCBhbHNvIGJlIGRpc3BsYXllZFxuICAgICAgICByZWNvcmQuY2FuY2VsbGVkID0gZW50cnkuY2FuY2VsZWQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVjb3JkO1xuICAgIH0sIHt9KTtcblxuICAgIHJldHVybiByZWNvcmQ7XG4gIH1cblxuICBwcmludExvZ0xpbmUgKG91dHB1dEVudHJ5KSB7XG4gICAgY29uc3Qge1xuICAgICAgcmVxdWVzdElkLFxuICAgICAgbmFtZSxcbiAgICAgIHN0YXR1cyxcbiAgICAgIHR5cGUsXG4gICAgICBpbml0aWF0b3IgPSB7fSxcbiAgICAgIHNpemUgPSAwLFxuICAgICAgdGltZSA9IDAsXG4gICAgICBzb3VyY2UsXG4gICAgICBlcnJvclRleHQsXG4gICAgICBjYW5jZWxsZWQgPSBmYWxzZSxcbiAgICB9ID0gdGhpcy5nZXRMb2dEZXRhaWxzKG91dHB1dEVudHJ5KTtcblxuICAgIC8vIHByaW50IG91dCB0aGUgcmVjb3JkLCBmb3JtYXR0ZWQgYXBwcm9wcmlhdGVseVxuICAgIHRoaXMubG9nLmRlYnVnKGBOZXR3b3JrIGV2ZW50OmApO1xuICAgIHRoaXMubG9nLmRlYnVnKGAgIElkOiAke3JlcXVlc3RJZH1gKTtcbiAgICB0aGlzLmxvZy5kZWJ1ZyhgICBOYW1lOiAke25hbWV9YCk7XG4gICAgdGhpcy5sb2cuZGVidWcoYCAgU3RhdHVzOiAke3N0YXR1c31gKTtcbiAgICB0aGlzLmxvZy5kZWJ1ZyhgICBUeXBlOiAke3R5cGV9YCk7XG4gICAgdGhpcy5sb2cuZGVidWcoYCAgSW5pdGlhdG9yOiAke2luaXRpYXRvci50eXBlfWApO1xuICAgIGZvciAoY29uc3QgbGluZSBvZiAoaW5pdGlhdG9yLnN0YWNrVHJhY2UgfHwgW10pKSB7XG4gICAgICBjb25zdCBmdW5jdGlvbk5hbWUgPSBsaW5lLmZ1bmN0aW9uTmFtZSB8fCAnKGFub255bW91cyknO1xuXG4gICAgICBjb25zdCB1cmwgPSAoIWxpbmUudXJsIHx8IGxpbmUudXJsID09PSAnW25hdGl2ZSBjb2RlXScpXG4gICAgICAgID8gJydcbiAgICAgICAgOiBgQCR7Xy5sYXN0KChVUkwucGFyc2UobGluZS51cmwpLnBhdGhuYW1lIHx8ICcnKS5zcGxpdCgnLycpKX06JHtsaW5lLmxpbmVOdW1iZXJ9YDtcbiAgICAgIHRoaXMubG9nLmRlYnVnKGAgICAgJHtfLnBhZEVuZChfLnRydW5jYXRlKGZ1bmN0aW9uTmFtZSwge2xlbmd0aDogMjB9KSwgMjEpfSAke3VybH1gKTtcbiAgICB9XG4gICAgLy8gZ2V0IGBtZW1vcnktY2FjaGVgIG9yIGBkaXNrLWNhY2hlYCwgZXRjLiwgcmlnaHRcbiAgICBjb25zdCBzaXplU3RyID0gc291cmNlLmluY2x1ZGVzKCdjYWNoZScpID8gYCAoZnJvbSAke3NvdXJjZS5yZXBsYWNlKCctJywgJyAnKX0pYCA6IGAke3NpemV9QmA7XG4gICAgdGhpcy5sb2cuZGVidWcoYCAgU2l6ZTogJHtzaXplU3RyfWApO1xuICAgIHRoaXMubG9nLmRlYnVnKGAgIFRpbWU6ICR7TWF0aC5yb3VuZCh0aW1lKX1tc2ApO1xuICAgIGlmIChlcnJvclRleHQpIHtcbiAgICAgIHRoaXMubG9nLmRlYnVnKGAgIEVycm9yOiAke2Vycm9yVGV4dH1gKTtcbiAgICB9XG4gICAgaWYgKHV0aWwuaGFzVmFsdWUoY2FuY2VsbGVkKSkge1xuICAgICAgdGhpcy5sb2cuZGVidWcoYCAgQ2FuY2VsbGVkOiAke2NhbmNlbGxlZH1gKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRMb2dzICgpIHtcbiAgICBjb25zdCBsb2dzID0gYXdhaXQgc3VwZXIuZ2V0TG9ncygpO1xuICAgIC8vIGluIG9yZGVyIHRvIHNhdGlzZnkgY2VydGFpbiBjbGllbnRzLCB3ZSBuZWVkIHRvIGhhdmUgYSBiYXNpYyBzdHJ1Y3R1cmVcbiAgICAvLyB0byB0aGUgcmVzdWx0cywgd2l0aCBgbGV2ZWxgLCBgdGltZXN0YW1wYCwgYW5kIGBtZXNzYWdlYCwgd2hpY2ggaXNcbiAgICAvLyBhbGwgdGhlIGluZm9ybWF0aW9uIHN0cmluZ2lmaWVkXG4gICAgcmV0dXJuIGxvZ3MubWFwKGZ1bmN0aW9uIGFkanVzdEVudHJ5IChlbnRyeSkge1xuICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIGVudHJ5LCB7XG4gICAgICAgIGxldmVsOiAnSU5GTycsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgbWVzc2FnZTogSlNPTi5zdHJpbmdpZnkoZW50cnkpLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IHsgU2FmYXJpTmV0d29ya0xvZyB9O1xuZXhwb3J0IGRlZmF1bHQgU2FmYXJpTmV0d29ya0xvZztcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNB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