{"version":3,"file":"ios-log.js","names":["MAX_LOG_ENTRIES_COUNT","IOSLog","EventEmitter","constructor","logs","logIdxSinceLastRequest","maxBufferSize","startCapture","Error","stopCapture","isCapturing","broadcast","logLine","logObj","timestamp","Date","now","level","message","push","emit","length","shift","getLogs","result","slice","getAllLogs"],"sources":["../../../lib/device-log/ios-log.js"],"sourcesContent":["import { EventEmitter } from 'events';\n\n// We keep only the most recent log entries to avoid out of memory error\nconst MAX_LOG_ENTRIES_COUNT = 10000;\n\nclass IOSLog extends EventEmitter {\n\n  constructor () {\n    super();\n    this.logs = [];\n    this.logIdxSinceLastRequest = -1;\n    this.maxBufferSize = MAX_LOG_ENTRIES_COUNT;\n  }\n\n  async startCapture () { // eslint-disable-line require-await\n    throw new Error(`Sub-classes need to implement a 'startCapture' function`);\n  }\n\n  async stopCapture () { // eslint-disable-line require-await\n    throw new Error(`Sub-classes need to implement a 'stopCapture' function`);\n  }\n\n  get isCapturing () {\n    throw new Error(`Sub-classes need to implement a 'isCapturing' function`);\n  }\n\n  broadcast (logLine) {\n    const logObj = {\n      timestamp: Date.now(),\n      level: 'ALL',\n      message: logLine\n    };\n    this.logs.push(logObj);\n    this.emit('output', logObj);\n    if (this.logs.length > this.maxBufferSize) {\n      this.logs.shift();\n      if (this.logIdxSinceLastRequest > 0) {\n        --this.logIdxSinceLastRequest;\n      }\n    }\n  }\n\n  getLogs () {\n    if (this.logs.length && this.logIdxSinceLastRequest < this.logs.length) {\n      let result = this.logs;\n      if (this.logIdxSinceLastRequest > 0) {\n        result = result.slice(this.logIdxSinceLastRequest);\n      }\n      this.logIdxSinceLastRequest = this.logs.length;\n      return result;\n    }\n    return [];\n  }\n\n  getAllLogs () {\n    return this.logs;\n  }\n}\n\nexport { IOSLog };\nexport default IOSLog;\n"],"mappings":";;;;;;;AAAA;AAGA,MAAMA,qBAAqB,GAAG,KAAK;AAEnC,MAAMC,MAAM,SAASC,oBAAY,CAAC;EAEhCC,WAAW,GAAI;IACb,KAAK,EAAE;IACP,IAAI,CAACC,IAAI,GAAG,EAAE;IACd,IAAI,CAACC,sBAAsB,GAAG,CAAC,CAAC;IAChC,IAAI,CAACC,aAAa,GAAGN,qBAAqB;EAC5C;EAEA,MAAMO,YAAY,GAAI;IACpB,MAAM,IAAIC,KAAK,CAAE,yDAAwD,CAAC;EAC5E;EAEA,MAAMC,WAAW,GAAI;IACnB,MAAM,IAAID,KAAK,CAAE,wDAAuD,CAAC;EAC3E;EAEA,IAAIE,WAAW,GAAI;IACjB,MAAM,IAAIF,KAAK,CAAE,wDAAuD,CAAC;EAC3E;EAEAG,SAAS,CAAEC,OAAO,EAAE;IAClB,MAAMC,MAAM,GAAG;MACbC,SAAS,EAAEC,IAAI,CAACC,GAAG,EAAE;MACrBC,KAAK,EAAE,KAAK;MACZC,OAAO,EAAEN;IACX,CAAC;IACD,IAAI,CAACR,IAAI,CAACe,IAAI,CAACN,MAAM,CAAC;IACtB,IAAI,CAACO,IAAI,CAAC,QAAQ,EAAEP,MAAM,CAAC;IAC3B,IAAI,IAAI,CAACT,IAAI,CAACiB,MAAM,GAAG,IAAI,CAACf,aAAa,EAAE;MACzC,IAAI,CAACF,IAAI,CAACkB,KAAK,EAAE;MACjB,IAAI,IAAI,CAACjB,sBAAsB,GAAG,CAAC,EAAE;QACnC,EAAE,IAAI,CAACA,sBAAsB;MAC/B;IACF;EACF;EAEAkB,OAAO,GAAI;IACT,IAAI,IAAI,CAACnB,IAAI,CAACiB,MAAM,IAAI,IAAI,CAAChB,sBAAsB,GAAG,IAAI,CAACD,IAAI,CAACiB,MAAM,EAAE;MACtE,IAAIG,MAAM,GAAG,IAAI,CAACpB,IAAI;MACtB,IAAI,IAAI,CAACC,sBAAsB,GAAG,CAAC,EAAE;QACnCmB,MAAM,GAAGA,MAAM,CAACC,KAAK,CAAC,IAAI,CAACpB,sBAAsB,CAAC;MACpD;MACA,IAAI,CAACA,sBAAsB,GAAG,IAAI,CAACD,IAAI,CAACiB,MAAM;MAC9C,OAAOG,MAAM;IACf;IACA,OAAO,EAAE;EACX;EAEAE,UAAU,GAAI;IACZ,OAAO,IAAI,CAACtB,IAAI;EAClB;AACF;AAAC;AAAA,eAGcH,MAAM;AAAA"}