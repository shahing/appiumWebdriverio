"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
require("source-map-support/register");
var _support = require("appium/support");
var _path = _interopRequireDefault(require("path"));
var _appiumIosDevice = require("appium-ios-device");
var _bluebird = _interopRequireDefault(require("bluebird"));
var _logger = _interopRequireDefault(require("./logger"));
var _lodash = _interopRequireDefault(require("lodash"));
var _teen_process = require("teen_process");
var _appUtils = require("./app-utils");
var _iosFsHelpers = require("./ios-fs-helpers");
const APPLICATION_INSTALLED_NOTIFICATION = 'com.apple.mobile.application_installed';
const INSTALLATION_STAGING_DIR = 'PublicStaging';
const APPLICATION_NOTIFICATION_TIMEOUT_MS = 30 * 1000;
const IOS_DEPLOY_TIMEOUT_MS = 4 * 60 * 1000;
const IOS_DEPLOY = 'ios-deploy';
const APP_INSTALL_STRATEGY = Object.freeze({
  SERIAL: 'serial',
  PARALLEL: 'parallel',
  IOS_DEPLOY
});
class IOSDeploy {
  constructor(udid) {
    this.udid = udid;
  }
  async remove(bundleId) {
    const service = await _appiumIosDevice.services.startInstallationProxyService(this.udid);
    try {
      await service.uninstallApplication(bundleId);
    } finally {
      service.close();
    }
  }
  async removeApp(bundleId) {
    await this.remove(bundleId);
  }
  async install(app, timeout, strategy = null) {
    if (strategy && !_lodash.default.values(APP_INSTALL_STRATEGY).includes(_lodash.default.toLower(strategy))) {
      throw new Error(`App installation strategy '${strategy}' is unknown. ` + `Only the following strategies are supported: ${_lodash.default.values(APP_INSTALL_STRATEGY)}`);
    }
    _logger.default.debug(`Using '${strategy ?? APP_INSTALL_STRATEGY.SERIAL}' app deployment strategy. ` + `You could change it by providing another value to the 'appInstallStrategy' capability`);
    const installWithIosDeploy = async () => {
      try {
        await _support.fs.which(IOS_DEPLOY);
      } catch (err) {
        throw new Error(`'${IOS_DEPLOY}' utility has not been found in PATH. Is it installed?`);
      }
      try {
        await (0, _teen_process.exec)(IOS_DEPLOY, ['--id', this.udid, '--bundle', app], {
          timeout: timeout ?? IOS_DEPLOY_TIMEOUT_MS
        });
      } catch (err) {
        throw new Error(err.stderr || err.stdout || err.message);
      }
    };
    const timer = new _support.timing.Timer().start();
    if (_lodash.default.toLower(strategy) === APP_INSTALL_STRATEGY.IOS_DEPLOY) {
      await installWithIosDeploy();
    } else {
      const afcService = await _appiumIosDevice.services.startAfcService(this.udid);
      try {
        const bundleId = await (0, _appUtils.extractBundleId)(app);
        const bundlePathOnPhone = _path.default.join(INSTALLATION_STAGING_DIR, bundleId);
        await (0, _iosFsHelpers.pushFolder)(afcService, app, bundlePathOnPhone, {
          timeoutMs: timeout,
          enableParallelPush: _lodash.default.toLower(strategy) === APP_INSTALL_STRATEGY.PARALLEL
        });
        await this.installOrUpgradeApplication(bundlePathOnPhone, await this.isAppInstalled(bundleId));
      } catch (err) {
        _logger.default.warn(`Error installing app '${app}': ${err.message}`);
        if (err instanceof _bluebird.default.TimeoutError) {
          _logger.default.warn(`Consider increasing the value of 'appPushTimeout' capability`);
        }
        _logger.default.warn(`Falling back to '${IOS_DEPLOY}' usage`);
        try {
          await installWithIosDeploy();
        } catch (err1) {
          throw new Error(`Could not install '${app}':\n` + `  - ${err.message}\n` + `  - ${err1.message}`);
        }
      } finally {
        afcService.close();
      }
    }
    _logger.default.info(`App installation succeeded after ${timer.getDuration().asMilliSeconds.toFixed(0)}ms`);
  }
  async installOrUpgradeApplication(bundlePathOnPhone, isUpgrade = false) {
    const notificationService = await _appiumIosDevice.services.startNotificationProxyService(this.udid);
    const installationService = await _appiumIosDevice.services.startInstallationProxyService(this.udid);
    const appInstalledNotification = new _bluebird.default(resolve => {
      notificationService.observeNotification(APPLICATION_INSTALLED_NOTIFICATION, {
        notification: resolve
      });
    });
    const clientOptions = {
      PackageType: 'Developer'
    };
    try {
      if (isUpgrade) {
        _logger.default.debug(`An upgrade of the existing application is going to be performed`);
        await installationService.upgradeApplication(bundlePathOnPhone, clientOptions);
      } else {
        _logger.default.debug(`A new application installation is going to be performed`);
        await installationService.installApplication(bundlePathOnPhone, clientOptions);
      }
      try {
        await appInstalledNotification.timeout(APPLICATION_NOTIFICATION_TIMEOUT_MS, `Could not get the application installed notification within ` + `${APPLICATION_NOTIFICATION_TIMEOUT_MS}ms but we will continue`);
      } catch (e) {
        _logger.default.warn(`Failed to receive the notification. Error: ${e.message}`);
      }
    } finally {
      installationService.close();
      notificationService.close();
    }
  }
  async installApp(...args) {
    return await this.install(...args);
  }
  async isAppInstalled(bundleId) {
    const service = await _appiumIosDevice.services.startInstallationProxyService(this.udid);
    try {
      const applications = await service.lookupApplications({
        bundleIds: bundleId
      });
      return !!applications[bundleId];
    } finally {
      service.close();
    }
  }
  async terminateApp(bundleId) {
    let instrumentService;
    let installProxyService;
    try {
      installProxyService = await _appiumIosDevice.services.startInstallationProxyService(this.udid);
      const apps = await installProxyService.listApplications();
      if (!apps[bundleId]) {
        _logger.default.info(`The bundle id '${bundleId}' did not exist`);
        return false;
      }
      const executableName = apps[bundleId].CFBundleExecutable;
      _logger.default.debug(`The executable name for the bundle id '${bundleId}' was '${executableName}'`);
      instrumentService = await _appiumIosDevice.services.startInstrumentService(this.udid);
      const processes = await instrumentService.callChannel(_appiumIosDevice.INSTRUMENT_CHANNEL.DEVICE_INFO, 'runningProcesses');
      const process = processes.selector.find(process => process.name === executableName);
      if (!process) {
        _logger.default.info(`The process of the bundle id '${bundleId}' was not running`);
        return false;
      }
      await instrumentService.callChannel(_appiumIosDevice.INSTRUMENT_CHANNEL.PROCESS_CONTROL, 'killPid:', `${process.pid}`);
      return true;
    } catch (err) {
      _logger.default.warn(`Failed to kill '${bundleId}'. Original error: ${err.stderr || err.message}`);
      return false;
    } finally {
      if (installProxyService) {
        installProxyService.close();
      }
      if (instrumentService) {
        instrumentService.close();
      }
    }
  }
  async getUserInstalledBundleIdsByBundleName(bundleName) {
    const service = await _appiumIosDevice.services.startInstallationProxyService(this.udid);
    try {
      const applications = await service.listApplications({
        applicationType: 'User'
      });
      return _lodash.default.reduce(applications, (acc, {
        CFBundleName
      }, key) => {
        if (CFBundleName === bundleName) {
          acc.push(key);
        }
        return acc;
      }, []);
    } finally {
      service.close();
    }
  }
  async getPlatformVersion() {
    return await _appiumIosDevice.utilities.getOSVersion(this.udid);
  }
}
var _default = IOSDeploy;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJBUFBMSUNBVElPTl9JTlNUQUxMRURfTk9USUZJQ0FUSU9OIiwiSU5TVEFMTEFUSU9OX1NUQUdJTkdfRElSIiwiQVBQTElDQVRJT05fTk9USUZJQ0FUSU9OX1RJTUVPVVRfTVMiLCJJT1NfREVQTE9ZX1RJTUVPVVRfTVMiLCJJT1NfREVQTE9ZIiwiQVBQX0lOU1RBTExfU1RSQVRFR1kiLCJPYmplY3QiLCJmcmVlemUiLCJTRVJJQUwiLCJQQVJBTExFTCIsIklPU0RlcGxveSIsImNvbnN0cnVjdG9yIiwidWRpZCIsInJlbW92ZSIsImJ1bmRsZUlkIiwic2VydmljZSIsInNlcnZpY2VzIiwic3RhcnRJbnN0YWxsYXRpb25Qcm94eVNlcnZpY2UiLCJ1bmluc3RhbGxBcHBsaWNhdGlvbiIsImNsb3NlIiwicmVtb3ZlQXBwIiwiaW5zdGFsbCIsImFwcCIsInRpbWVvdXQiLCJzdHJhdGVneSIsIl8iLCJ2YWx1ZXMiLCJpbmNsdWRlcyIsInRvTG93ZXIiLCJFcnJvciIsImxvZyIsImRlYnVnIiwiaW5zdGFsbFdpdGhJb3NEZXBsb3kiLCJmcyIsIndoaWNoIiwiZXJyIiwiZXhlYyIsInN0ZGVyciIsInN0ZG91dCIsIm1lc3NhZ2UiLCJ0aW1lciIsInRpbWluZyIsIlRpbWVyIiwic3RhcnQiLCJhZmNTZXJ2aWNlIiwic3RhcnRBZmNTZXJ2aWNlIiwiZXh0cmFjdEJ1bmRsZUlkIiwiYnVuZGxlUGF0aE9uUGhvbmUiLCJwYXRoIiwiam9pbiIsInB1c2hGb2xkZXIiLCJ0aW1lb3V0TXMiLCJlbmFibGVQYXJhbGxlbFB1c2giLCJpbnN0YWxsT3JVcGdyYWRlQXBwbGljYXRpb24iLCJpc0FwcEluc3RhbGxlZCIsIndhcm4iLCJCIiwiVGltZW91dEVycm9yIiwiZXJyMSIsImluZm8iLCJnZXREdXJhdGlvbiIsImFzTWlsbGlTZWNvbmRzIiwidG9GaXhlZCIsImlzVXBncmFkZSIsIm5vdGlmaWNhdGlvblNlcnZpY2UiLCJzdGFydE5vdGlmaWNhdGlvblByb3h5U2VydmljZSIsImluc3RhbGxhdGlvblNlcnZpY2UiLCJhcHBJbnN0YWxsZWROb3RpZmljYXRpb24iLCJyZXNvbHZlIiwib2JzZXJ2ZU5vdGlmaWNhdGlvbiIsIm5vdGlmaWNhdGlvbiIsImNsaWVudE9wdGlvbnMiLCJQYWNrYWdlVHlwZSIsInVwZ3JhZGVBcHBsaWNhdGlvbiIsImluc3RhbGxBcHBsaWNhdGlvbiIsImUiLCJpbnN0YWxsQXBwIiwiYXJncyIsImFwcGxpY2F0aW9ucyIsImxvb2t1cEFwcGxpY2F0aW9ucyIsImJ1bmRsZUlkcyIsInRlcm1pbmF0ZUFwcCIsImluc3RydW1lbnRTZXJ2aWNlIiwiaW5zdGFsbFByb3h5U2VydmljZSIsImFwcHMiLCJsaXN0QXBwbGljYXRpb25zIiwiZXhlY3V0YWJsZU5hbWUiLCJDRkJ1bmRsZUV4ZWN1dGFibGUiLCJzdGFydEluc3RydW1lbnRTZXJ2aWNlIiwicHJvY2Vzc2VzIiwiY2FsbENoYW5uZWwiLCJJTlNUUlVNRU5UX0NIQU5ORUwiLCJERVZJQ0VfSU5GTyIsInByb2Nlc3MiLCJzZWxlY3RvciIsImZpbmQiLCJuYW1lIiwiUFJPQ0VTU19DT05UUk9MIiwicGlkIiwiZ2V0VXNlckluc3RhbGxlZEJ1bmRsZUlkc0J5QnVuZGxlTmFtZSIsImJ1bmRsZU5hbWUiLCJhcHBsaWNhdGlvblR5cGUiLCJyZWR1Y2UiLCJhY2MiLCJDRkJ1bmRsZU5hbWUiLCJrZXkiLCJwdXNoIiwiZ2V0UGxhdGZvcm1WZXJzaW9uIiwidXRpbGl0aWVzIiwiZ2V0T1NWZXJzaW9uIl0sInNvdXJjZXMiOlsiLi4vLi4vbGliL2lvcy1kZXBsb3kuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZnMsIHRpbWluZyB9IGZyb20gJ2FwcGl1bS9zdXBwb3J0JztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgc2VydmljZXMsIHV0aWxpdGllcywgSU5TVFJVTUVOVF9DSEFOTkVMIH0gZnJvbSAnYXBwaXVtLWlvcy1kZXZpY2UnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgeyBleHRyYWN0QnVuZGxlSWQgfSBmcm9tICcuL2FwcC11dGlscyc7XG5pbXBvcnQgeyBwdXNoRm9sZGVyIH0gZnJvbSAnLi9pb3MtZnMtaGVscGVycyc7XG5cbmNvbnN0IEFQUExJQ0FUSU9OX0lOU1RBTExFRF9OT1RJRklDQVRJT04gPSAnY29tLmFwcGxlLm1vYmlsZS5hcHBsaWNhdGlvbl9pbnN0YWxsZWQnO1xuY29uc3QgSU5TVEFMTEFUSU9OX1NUQUdJTkdfRElSID0gJ1B1YmxpY1N0YWdpbmcnO1xuY29uc3QgQVBQTElDQVRJT05fTk9USUZJQ0FUSU9OX1RJTUVPVVRfTVMgPSAzMCAqIDEwMDA7XG5jb25zdCBJT1NfREVQTE9ZX1RJTUVPVVRfTVMgPSA0ICogNjAgKiAxMDAwO1xuY29uc3QgSU9TX0RFUExPWSA9ICdpb3MtZGVwbG95JztcbmNvbnN0IEFQUF9JTlNUQUxMX1NUUkFURUdZID0gT2JqZWN0LmZyZWV6ZSh7XG4gIFNFUklBTDogJ3NlcmlhbCcsXG4gIFBBUkFMTEVMOiAncGFyYWxsZWwnLFxuICBJT1NfREVQTE9ZLFxufSk7XG5cblxuY2xhc3MgSU9TRGVwbG95IHtcblxuICBjb25zdHJ1Y3RvciAodWRpZCkge1xuICAgIHRoaXMudWRpZCA9IHVkaWQ7XG4gIH1cblxuICBhc3luYyByZW1vdmUgKGJ1bmRsZUlkKSB7XG4gICAgY29uc3Qgc2VydmljZSA9IGF3YWl0IHNlcnZpY2VzLnN0YXJ0SW5zdGFsbGF0aW9uUHJveHlTZXJ2aWNlKHRoaXMudWRpZCk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHNlcnZpY2UudW5pbnN0YWxsQXBwbGljYXRpb24oYnVuZGxlSWQpO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBzZXJ2aWNlLmNsb3NlKCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgcmVtb3ZlQXBwIChidW5kbGVJZCkge1xuICAgIGF3YWl0IHRoaXMucmVtb3ZlKGJ1bmRsZUlkKTtcbiAgfVxuXG4gIGFzeW5jIGluc3RhbGwgKGFwcCwgdGltZW91dCwgc3RyYXRlZ3kgPSBudWxsKSB7XG4gICAgaWYgKHN0cmF0ZWd5ICYmICFfLnZhbHVlcyhBUFBfSU5TVEFMTF9TVFJBVEVHWSkuaW5jbHVkZXMoXy50b0xvd2VyKHN0cmF0ZWd5KSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQXBwIGluc3RhbGxhdGlvbiBzdHJhdGVneSAnJHtzdHJhdGVneX0nIGlzIHVua25vd24uIGAgK1xuICAgICAgICBgT25seSB0aGUgZm9sbG93aW5nIHN0cmF0ZWdpZXMgYXJlIHN1cHBvcnRlZDogJHtfLnZhbHVlcyhBUFBfSU5TVEFMTF9TVFJBVEVHWSl9YCk7XG4gICAgfVxuICAgIGxvZy5kZWJ1ZyhgVXNpbmcgJyR7c3RyYXRlZ3kgPz8gQVBQX0lOU1RBTExfU1RSQVRFR1kuU0VSSUFMfScgYXBwIGRlcGxveW1lbnQgc3RyYXRlZ3kuIGAgK1xuICAgICAgYFlvdSBjb3VsZCBjaGFuZ2UgaXQgYnkgcHJvdmlkaW5nIGFub3RoZXIgdmFsdWUgdG8gdGhlICdhcHBJbnN0YWxsU3RyYXRlZ3knIGNhcGFiaWxpdHlgKTtcblxuICAgIGNvbnN0IGluc3RhbGxXaXRoSW9zRGVwbG95ID0gYXN5bmMgKCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZnMud2hpY2goSU9TX0RFUExPWSk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGAnJHtJT1NfREVQTE9ZfScgdXRpbGl0eSBoYXMgbm90IGJlZW4gZm91bmQgaW4gUEFUSC4gSXMgaXQgaW5zdGFsbGVkP2ApO1xuICAgICAgfVxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZXhlYyhJT1NfREVQTE9ZLCBbXG4gICAgICAgICAgJy0taWQnLCB0aGlzLnVkaWQsXG4gICAgICAgICAgJy0tYnVuZGxlJywgYXBwLFxuICAgICAgICBdLCB7dGltZW91dDogdGltZW91dCA/PyBJT1NfREVQTE9ZX1RJTUVPVVRfTVN9KTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyLnN0ZGVyciB8fCBlcnIuc3Rkb3V0IHx8IGVyci5tZXNzYWdlKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3QgdGltZXIgPSBuZXcgdGltaW5nLlRpbWVyKCkuc3RhcnQoKTtcbiAgICBpZiAoXy50b0xvd2VyKHN0cmF0ZWd5KSA9PT0gQVBQX0lOU1RBTExfU1RSQVRFR1kuSU9TX0RFUExPWSkge1xuICAgICAgYXdhaXQgaW5zdGFsbFdpdGhJb3NEZXBsb3koKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgYWZjU2VydmljZSA9IGF3YWl0IHNlcnZpY2VzLnN0YXJ0QWZjU2VydmljZSh0aGlzLnVkaWQpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYnVuZGxlSWQgPSBhd2FpdCBleHRyYWN0QnVuZGxlSWQoYXBwKTtcbiAgICAgICAgY29uc3QgYnVuZGxlUGF0aE9uUGhvbmUgPSBwYXRoLmpvaW4oSU5TVEFMTEFUSU9OX1NUQUdJTkdfRElSLCBidW5kbGVJZCk7XG4gICAgICAgIGF3YWl0IHB1c2hGb2xkZXIoYWZjU2VydmljZSwgYXBwLCBidW5kbGVQYXRoT25QaG9uZSwge1xuICAgICAgICAgIHRpbWVvdXRNczogdGltZW91dCxcbiAgICAgICAgICBlbmFibGVQYXJhbGxlbFB1c2g6IF8udG9Mb3dlcihzdHJhdGVneSkgPT09IEFQUF9JTlNUQUxMX1NUUkFURUdZLlBBUkFMTEVMLFxuICAgICAgICB9KTtcbiAgICAgICAgYXdhaXQgdGhpcy5pbnN0YWxsT3JVcGdyYWRlQXBwbGljYXRpb24oYnVuZGxlUGF0aE9uUGhvbmUsIGF3YWl0IHRoaXMuaXNBcHBJbnN0YWxsZWQoYnVuZGxlSWQpKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBsb2cud2FybihgRXJyb3IgaW5zdGFsbGluZyBhcHAgJyR7YXBwfSc6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICAgIGlmIChlcnIgaW5zdGFuY2VvZiBCLlRpbWVvdXRFcnJvcikge1xuICAgICAgICAgIGxvZy53YXJuKGBDb25zaWRlciBpbmNyZWFzaW5nIHRoZSB2YWx1ZSBvZiAnYXBwUHVzaFRpbWVvdXQnIGNhcGFiaWxpdHlgKTtcbiAgICAgICAgfVxuICAgICAgICBsb2cud2FybihgRmFsbGluZyBiYWNrIHRvICcke0lPU19ERVBMT1l9JyB1c2FnZWApO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IGluc3RhbGxXaXRoSW9zRGVwbG95KCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycjEpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENvdWxkIG5vdCBpbnN0YWxsICcke2FwcH0nOlxcbmAgK1xuICAgICAgICAgICAgYCAgLSAke2Vyci5tZXNzYWdlfVxcbmAgK1xuICAgICAgICAgICAgYCAgLSAke2VycjEubWVzc2FnZX1gKTtcbiAgICAgICAgfVxuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgYWZjU2VydmljZS5jbG9zZSgpO1xuICAgICAgfVxuICAgIH1cbiAgICBsb2cuaW5mbyhgQXBwIGluc3RhbGxhdGlvbiBzdWNjZWVkZWQgYWZ0ZXIgJHt0aW1lci5nZXREdXJhdGlvbigpLmFzTWlsbGlTZWNvbmRzLnRvRml4ZWQoMCl9bXNgKTtcbiAgfVxuXG4gIGFzeW5jIGluc3RhbGxPclVwZ3JhZGVBcHBsaWNhdGlvbiAoYnVuZGxlUGF0aE9uUGhvbmUsIGlzVXBncmFkZSA9IGZhbHNlKSB7XG4gICAgY29uc3Qgbm90aWZpY2F0aW9uU2VydmljZSA9IGF3YWl0IHNlcnZpY2VzLnN0YXJ0Tm90aWZpY2F0aW9uUHJveHlTZXJ2aWNlKHRoaXMudWRpZCk7XG4gICAgY29uc3QgaW5zdGFsbGF0aW9uU2VydmljZSA9IGF3YWl0IHNlcnZpY2VzLnN0YXJ0SW5zdGFsbGF0aW9uUHJveHlTZXJ2aWNlKHRoaXMudWRpZCk7XG4gICAgY29uc3QgYXBwSW5zdGFsbGVkTm90aWZpY2F0aW9uID0gbmV3IEIoKHJlc29sdmUpID0+IHtcbiAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2Uub2JzZXJ2ZU5vdGlmaWNhdGlvbihBUFBMSUNBVElPTl9JTlNUQUxMRURfTk9USUZJQ0FUSU9OLCB7XG4gICAgICAgIG5vdGlmaWNhdGlvbjogcmVzb2x2ZVxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgY29uc3QgY2xpZW50T3B0aW9ucyA9IHtQYWNrYWdlVHlwZTogJ0RldmVsb3Blcid9O1xuICAgIHRyeSB7XG4gICAgICBpZiAoaXNVcGdyYWRlKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgQW4gdXBncmFkZSBvZiB0aGUgZXhpc3RpbmcgYXBwbGljYXRpb24gaXMgZ29pbmcgdG8gYmUgcGVyZm9ybWVkYCk7XG4gICAgICAgIGF3YWl0IGluc3RhbGxhdGlvblNlcnZpY2UudXBncmFkZUFwcGxpY2F0aW9uKGJ1bmRsZVBhdGhPblBob25lLCBjbGllbnRPcHRpb25zKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgQSBuZXcgYXBwbGljYXRpb24gaW5zdGFsbGF0aW9uIGlzIGdvaW5nIHRvIGJlIHBlcmZvcm1lZGApO1xuICAgICAgICBhd2FpdCBpbnN0YWxsYXRpb25TZXJ2aWNlLmluc3RhbGxBcHBsaWNhdGlvbihidW5kbGVQYXRoT25QaG9uZSwgY2xpZW50T3B0aW9ucyk7XG4gICAgICB9XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBhcHBJbnN0YWxsZWROb3RpZmljYXRpb24udGltZW91dChBUFBMSUNBVElPTl9OT1RJRklDQVRJT05fVElNRU9VVF9NUyxcbiAgICAgICAgICBgQ291bGQgbm90IGdldCB0aGUgYXBwbGljYXRpb24gaW5zdGFsbGVkIG5vdGlmaWNhdGlvbiB3aXRoaW4gYCArXG4gICAgICAgICAgYCR7QVBQTElDQVRJT05fTk9USUZJQ0FUSU9OX1RJTUVPVVRfTVN9bXMgYnV0IHdlIHdpbGwgY29udGludWVgKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgbG9nLndhcm4oYEZhaWxlZCB0byByZWNlaXZlIHRoZSBub3RpZmljYXRpb24uIEVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgICAgIH1cbiAgICB9IGZpbmFsbHkge1xuICAgICAgaW5zdGFsbGF0aW9uU2VydmljZS5jbG9zZSgpO1xuICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5jbG9zZSgpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGluc3RhbGxBcHAgKC4uLmFyZ3MpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5pbnN0YWxsKC4uLmFyZ3MpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiBhbiBhcHBsaWNhdGlvbiBvYmplY3QgaWYgdGVzdCBhcHAgaGFzICdidW5kbGVpZCcuXG4gICAqIFRoZSB0YXJnZXQgYnVuZGxlaWQgY2FuIGJlIFVzZXIgYW5kIFN5c3RlbSBhcHBzLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSWQgVGhlIGJ1bmRsZUlkIHRvIGVuc3VyZSBpdCBpcyBpbnN0YWxsZWRcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gUmV0dXJucyBUcnVlIGlmIHRoZSBidW5kbGVpZCBleGlzdHMgaW4gdGhlIHJlc3VsdCBvZiAnbGlzdEFwcGxpY2F0aW9ucycgbGlrZTpcbiAgICogeyBcImNvbS5hcHBsZS5QcmVmZXJlbmNlc1wiOntcbiAgICogICBcIlVJUmVxdWlyZWREZXZpY2VDYXBhYmlsaXRpZXNcIjpbXCJhcm02NFwiXSxcbiAgICogICBcIlVJUmVxdWlyZXNGdWxsU2NyZWVuXCI6dHJ1ZSxcbiAgICogICBcIkNGQnVuZGxlSW5mb0RpY3Rpb25hcnlWZXJzaW9uXCI6XCI2LjBcIixcbiAgICogICBcIkVudGl0bGVtZW50c1wiOlxuICAgKiAgICAge1wiY29tLmFwcGxlLmZyb250Ym9hcmQuZGVsZXRlLWFwcGxpY2F0aW9uLXNuYXBzaG90c1wiOnRydWUsLi5cbiAgICovXG4gIGFzeW5jIGlzQXBwSW5zdGFsbGVkIChidW5kbGVJZCkge1xuICAgIGNvbnN0IHNlcnZpY2UgPSBhd2FpdCBzZXJ2aWNlcy5zdGFydEluc3RhbGxhdGlvblByb3h5U2VydmljZSh0aGlzLnVkaWQpO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhcHBsaWNhdGlvbnMgPSBhd2FpdCBzZXJ2aWNlLmxvb2t1cEFwcGxpY2F0aW9ucyh7IGJ1bmRsZUlkczogYnVuZGxlSWQgfSk7XG4gICAgICByZXR1cm4gISFhcHBsaWNhdGlvbnNbYnVuZGxlSWRdO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBzZXJ2aWNlLmNsb3NlKCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgdGVybWluYXRlQXBwIChidW5kbGVJZCkge1xuICAgIGxldCBpbnN0cnVtZW50U2VydmljZTtcbiAgICBsZXQgaW5zdGFsbFByb3h5U2VydmljZTtcbiAgICB0cnkge1xuICAgICAgaW5zdGFsbFByb3h5U2VydmljZSA9IGF3YWl0IHNlcnZpY2VzLnN0YXJ0SW5zdGFsbGF0aW9uUHJveHlTZXJ2aWNlKHRoaXMudWRpZCk7XG4gICAgICBjb25zdCBhcHBzID0gYXdhaXQgaW5zdGFsbFByb3h5U2VydmljZS5saXN0QXBwbGljYXRpb25zKCk7XG4gICAgICBpZiAoIWFwcHNbYnVuZGxlSWRdKSB7XG4gICAgICAgIGxvZy5pbmZvKGBUaGUgYnVuZGxlIGlkICcke2J1bmRsZUlkfScgZGlkIG5vdCBleGlzdGApO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBjb25zdCBleGVjdXRhYmxlTmFtZSA9IGFwcHNbYnVuZGxlSWRdLkNGQnVuZGxlRXhlY3V0YWJsZTtcbiAgICAgIGxvZy5kZWJ1ZyhgVGhlIGV4ZWN1dGFibGUgbmFtZSBmb3IgdGhlIGJ1bmRsZSBpZCAnJHtidW5kbGVJZH0nIHdhcyAnJHtleGVjdXRhYmxlTmFtZX0nYCk7XG4gICAgICBpbnN0cnVtZW50U2VydmljZSA9IGF3YWl0IHNlcnZpY2VzLnN0YXJ0SW5zdHJ1bWVudFNlcnZpY2UodGhpcy51ZGlkKTtcbiAgICAgIGNvbnN0IHByb2Nlc3NlcyA9IGF3YWl0IGluc3RydW1lbnRTZXJ2aWNlLmNhbGxDaGFubmVsKElOU1RSVU1FTlRfQ0hBTk5FTC5ERVZJQ0VfSU5GTywgJ3J1bm5pbmdQcm9jZXNzZXMnKTtcbiAgICAgIGNvbnN0IHByb2Nlc3MgPSBwcm9jZXNzZXMuc2VsZWN0b3IuZmluZCgocHJvY2VzcykgPT4gcHJvY2Vzcy5uYW1lID09PSBleGVjdXRhYmxlTmFtZSk7XG4gICAgICBpZiAoIXByb2Nlc3MpIHtcbiAgICAgICAgbG9nLmluZm8oYFRoZSBwcm9jZXNzIG9mIHRoZSBidW5kbGUgaWQgJyR7YnVuZGxlSWR9JyB3YXMgbm90IHJ1bm5pbmdgKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgYXdhaXQgaW5zdHJ1bWVudFNlcnZpY2UuY2FsbENoYW5uZWwoSU5TVFJVTUVOVF9DSEFOTkVMLlBST0NFU1NfQ09OVFJPTCwgJ2tpbGxQaWQ6JywgYCR7cHJvY2Vzcy5waWR9YCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy53YXJuKGBGYWlsZWQgdG8ga2lsbCAnJHtidW5kbGVJZH0nLiBPcmlnaW5hbCBlcnJvcjogJHtlcnIuc3RkZXJyIHx8IGVyci5tZXNzYWdlfWApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBpZiAoaW5zdGFsbFByb3h5U2VydmljZSkge1xuICAgICAgICBpbnN0YWxsUHJveHlTZXJ2aWNlLmNsb3NlKCk7XG4gICAgICB9XG4gICAgICBpZiAoaW5zdHJ1bWVudFNlcnZpY2UpIHtcbiAgICAgICAgaW5zdHJ1bWVudFNlcnZpY2UuY2xvc2UoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZU5hbWUgVGhlIG5hbWUgb2YgQ0ZCdW5kbGVOYW1lIGluIEluZm8ucGxpc3RcbiAgICpcbiAgICogQHJldHVybnMge0FycmF5PHN0cmluZz59IEEgbGlzdCBvZiBVc2VyIGxldmVsIGFwcHMnIGJ1bmRsZSBpZHMgd2hpY2ggaGFzXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAnQ0ZCdW5kbGVOYW1lJyBhdHRyaWJ1dGUgYXMgJ2J1bmRsZU5hbWUnLlxuICAgKi9cbiAgYXN5bmMgZ2V0VXNlckluc3RhbGxlZEJ1bmRsZUlkc0J5QnVuZGxlTmFtZSAoYnVuZGxlTmFtZSkge1xuICAgIGNvbnN0IHNlcnZpY2UgPSBhd2FpdCBzZXJ2aWNlcy5zdGFydEluc3RhbGxhdGlvblByb3h5U2VydmljZSh0aGlzLnVkaWQpO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhcHBsaWNhdGlvbnMgPSBhd2FpdCBzZXJ2aWNlLmxpc3RBcHBsaWNhdGlvbnMoe2FwcGxpY2F0aW9uVHlwZTogJ1VzZXInfSk7XG4gICAgICByZXR1cm4gXy5yZWR1Y2UoYXBwbGljYXRpb25zLCAoYWNjLCB7Q0ZCdW5kbGVOYW1lfSwga2V5KSA9PiB7XG4gICAgICAgIGlmIChDRkJ1bmRsZU5hbWUgPT09IGJ1bmRsZU5hbWUpIHtcbiAgICAgICAgICBhY2MucHVzaChrZXkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgICB9LCBbXSk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHNlcnZpY2UuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRQbGF0Zm9ybVZlcnNpb24gKCkge1xuICAgIHJldHVybiBhd2FpdCB1dGlsaXRpZXMuZ2V0T1NWZXJzaW9uKHRoaXMudWRpZCk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgSU9TRGVwbG95O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBLE1BQU1BLGtDQUFrQyxHQUFHLHdDQUF3QztBQUNuRixNQUFNQyx3QkFBd0IsR0FBRyxlQUFlO0FBQ2hELE1BQU1DLG1DQUFt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