{"version":3,"file":"execute.js","names":["ExecuteMixin","Base","ExecuteCommands","executeMethod","script","protoArgs","_","isArray","length","errors","InvalidArgumentError","JSON","stringify","args","isPlainObject","Driver","constructor","availableScripts","keys","executeMethodMap","commandMetadata","UnsupportedOperationError","join","argsToApply","params","required","optional","checkParams","makeArgs","command"],"sources":["../../../../lib/basedriver/commands/execute.js"],"sourcesContent":["import _ from 'lodash';\nimport {errors, makeArgs, checkParams} from '../../protocol';\n\n/**\n * @param {SessionBase} Base\n * @returns {ExecuteBase}\n */\nexport function ExecuteMixin(Base) {\n  /**\n   * @implements {IExecuteCommands}\n   */\n  class ExecuteCommands extends Base {\n    /**\n     * @param {string} script\n     * @param {[Record<string, any>]|[]} protoArgs\n     */\n    async executeMethod(script, protoArgs) {\n      // the w3c protocol will give us an array of arguments to apply to a javascript function.\n      // that's not what we're doing. we're going to look for a JS object as the first arg, so we\n      // can perform validation on it. we'll ignore everything else.\n      if (!protoArgs || !_.isArray(protoArgs) || protoArgs.length > 1) {\n        throw new errors.InvalidArgumentError(\n          `Did not get correct format of arguments for execute method. Expected zero or one ` +\n            `arguments to execute script and instead received: ${JSON.stringify(protoArgs)}`\n        );\n      }\n      let args = protoArgs[0] ?? {};\n      if (!_.isPlainObject(args)) {\n        throw new errors.InvalidArgumentError(\n          `Did not receive an appropriate execute method parameters object. It needs to be ` +\n            `deserializable as a plain JS object`\n        );\n      }\n\n      const Driver = /** @type {DriverClass} */ (this.constructor);\n      const availableScripts = _.keys(Driver.executeMethodMap);\n      const commandMetadata = Driver.executeMethodMap[script];\n      if (!commandMetadata) {\n        throw new errors.UnsupportedOperationError(\n          `Unsupported execute method '${script}'. Available methods ` +\n            `are: ${availableScripts.join(', ')}`\n        );\n      }\n      let argsToApply = [];\n      if (!commandMetadata.params) {\n        commandMetadata.params = {required: [], optional: []};\n      } else {\n        commandMetadata.params.required ??= [];\n        commandMetadata.params.optional ??= [];\n        checkParams(commandMetadata.params, args, null);\n      }\n      argsToApply = makeArgs({}, args, commandMetadata.params, null);\n      return await this[Driver.executeMethodMap[script].command](...argsToApply);\n    }\n  }\n  return ExecuteCommands;\n}\n\n/**\n * @typedef {import('@appium/types').ExecuteCommands} IExecuteCommands\n * @typedef {import('@appium/types').Driver} Driver\n * @typedef {import('@appium/types').DriverClass} DriverClass\n * @typedef {import('./session').SessionBase} SessionBase\n * @typedef {import('../driver').BaseDriverBase<import('@appium/types').TimeoutCommands & import('@appium/types').EventCommands & import('@appium/types').FindCommands & import('@appium/types').LogCommands & import('@appium/types').SettingsCommands & import('@appium/types').SessionCommands & IExecuteCommands>} ExecuteBase\n */\n"],"mappings":";;;;;;;;;AAAA;;AACA;;;;AAMO,SAASA,YAAT,CAAsBC,IAAtB,EAA4B;EAIjC,MAAMC,eAAN,SAA8BD,IAA9B,CAAmC;IAKd,MAAbE,aAAa,CAACC,MAAD,EAASC,SAAT,EAAoB;MAIrC,IAAI,CAACA,SAAD,IAAc,CAACC,eAAA,CAAEC,OAAF,CAAUF,SAAV,CAAf,IAAuCA,SAAS,CAACG,MAAV,GAAmB,CAA9D,EAAiE;QAC/D,MAAM,IAAIC,gBAAA,CAAOC,oBAAX,CACH,mFAAD,GACG,qDAAoDC,IAAI,CAACC,SAAL,CAAeP,SAAf,CAA0B,EAF7E,CAAN;MAID;;MACD,IAAIQ,IAAI,GAAGR,SAAS,CAAC,CAAD,CAAT,IAAgB,EAA3B;;MACA,IAAI,CAACC,eAAA,CAAEQ,aAAF,CAAgBD,IAAhB,CAAL,EAA4B;QAC1B,MAAM,IAAIJ,gBAAA,CAAOC,oBAAX,CACH,kFAAD,GACG,qCAFC,CAAN;MAID;;MAED,MAAMK,MAAM,GAA+B,KAAKC,WAAhD;;MACA,MAAMC,gBAAgB,GAAGX,eAAA,CAAEY,IAAF,CAAOH,MAAM,CAACI,gBAAd,CAAzB;;MACA,MAAMC,eAAe,GAAGL,MAAM,CAACI,gBAAP,CAAwBf,MAAxB,CAAxB;;MACA,IAAI,CAACgB,eAAL,EAAsB;QACpB,MAAM,IAAIX,gBAAA,CAAOY,yBAAX,CACH,+BAA8BjB,MAAO,uBAAtC,GACG,QAAOa,gBAAgB,CAACK,IAAjB,CAAsB,IAAtB,CAA4B,EAFlC,CAAN;MAID;;MACD,IAAIC,WAAW,GAAG,EAAlB;;MACA,IAAI,CAACH,eAAe,CAACI,MAArB,EAA6B;QAC3BJ,eAAe,CAACI,MAAhB,GAAyB;UAACC,QAAQ,EAAE,EAAX;UAAeC,QAAQ,EAAE;QAAzB,CAAzB;MACD,CAFD,MAEO;QAAA;;QACL,yBAAAN,eAAe,CAACI,MAAhB,EAAuBC,QAAvB,2BAAuBA,QAAvB,GAAoC,EAApC;QACA,0BAAAL,eAAe,CAACI,MAAhB,EAAuBE,QAAvB,4BAAuBA,QAAvB,GAAoC,EAApC;QACA,IAAAC,qBAAA,EAAYP,eAAe,CAACI,MAA5B,EAAoCX,IAApC,EAA0C,IAA1C;MACD;;MACDU,WAAW,GAAG,IAAAK,kBAAA,EAAS,EAAT,EAAaf,IAAb,EAAmBO,eAAe,CAACI,MAAnC,EAA2C,IAA3C,CAAd;MACA,OAAO,MAAM,KAAKT,MAAM,CAACI,gBAAP,CAAwBf,MAAxB,EAAgCyB,OAArC,EAA8C,GAAGN,WAAjD,CAAb;IACD;;EA1CgC;;EA4CnC,OAAOrB,eAAP;AACD"}