{"version":3,"file":"protocol-converter.js","names":["COMMAND_URLS_CONFLICTS","commandNames","jsonwpConverter","url","replace","includes","w3cConverter","test","w3cUrl","w3cPropertyRegex","jsonwpUrl","MJSONWP","W3C","PROTOCOLS","DEFAULT_LOG","logger","getLogger","ProtocolConverter","constructor","proxyFunc","log","_downstreamProtocol","_log","downstreamProtocol","value","getTimeoutRequestObjects","body","_","has","typeToW3C","x","type","ms","typeToJSONWP","toPairs","filter","pair","map","proxySetTimeouts","method","response","resBody","timeoutRequestObjects","debug","JSON","stringify","timeoutObj","statusCode","proxySetWindow","bodyObj","util","safeJsonParse","isPlainObject","name","handle","proxySetValue","hasValue","text","isString","isArray","join","Object","assign","proxySetFrame","id","duplicateKeys","MJSONWP_ELEMENT_KEY","W3C_ELEMENT_KEY","proxyPerformActions","proxyReleaseActions","convertAndProxy","commandName","rewrittenUrl","info"],"sources":["../../../lib/jsonwp-proxy/protocol-converter.js"],"sourcesContent":["import _ from 'lodash';\nimport {logger, util} from '@appium/support';\nimport {duplicateKeys} from '../basedriver/helpers';\nimport {MJSONWP_ELEMENT_KEY, W3C_ELEMENT_KEY, PROTOCOLS} from '../constants';\n\nexport const COMMAND_URLS_CONFLICTS = [\n  {\n    commandNames: ['execute', 'executeAsync'],\n    jsonwpConverter: (url) =>\n      url.replace(/\\/execute.*/, url.includes('async') ? '/execute_async' : '/execute'),\n    w3cConverter: (url) =>\n      url.replace(/\\/execute.*/, url.includes('async') ? '/execute/async' : '/execute/sync'),\n  },\n  {\n    commandNames: ['getElementScreenshot'],\n    jsonwpConverter: (url) => url.replace(/\\/element\\/([^/]+)\\/screenshot$/, '/screenshot/$1'),\n    w3cConverter: (url) => url.replace(/\\/screenshot\\/([^/]+)/, '/element/$1/screenshot'),\n  },\n  {\n    commandNames: ['getWindowHandles', 'getWindowHandle'],\n    jsonwpConverter(url) {\n      return /\\/window$/.test(url)\n        ? url.replace(/\\/window$/, '/window_handle')\n        : url.replace(/\\/window\\/handle(s?)$/, '/window_handle$1');\n    },\n    w3cConverter(url) {\n      return /\\/window_handle$/.test(url)\n        ? url.replace(/\\/window_handle$/, '/window')\n        : url.replace(/\\/window_handles$/, '/window/handles');\n    },\n  },\n  {\n    commandNames: ['getProperty'],\n    jsonwpConverter: (w3cUrl) => {\n      const w3cPropertyRegex = /\\/element\\/([^/]+)\\/property\\/([^/]+)/;\n      const jsonwpUrl = w3cUrl.replace(w3cPropertyRegex, '/element/$1/attribute/$2');\n      return jsonwpUrl;\n    },\n    w3cConverter: (jsonwpUrl) => jsonwpUrl, // Don't convert JSONWP URL to W3C. W3C accepts /attribute and /property\n  },\n];\nconst {MJSONWP, W3C} = PROTOCOLS;\nconst DEFAULT_LOG = logger.getLogger('Protocol Converter');\n\nclass ProtocolConverter {\n  constructor(proxyFunc, log = null) {\n    this.proxyFunc = proxyFunc;\n    this._downstreamProtocol = null;\n    this._log = log;\n  }\n\n  get log() {\n    return this._log ?? DEFAULT_LOG;\n  }\n\n  set downstreamProtocol(value) {\n    this._downstreamProtocol = value;\n  }\n\n  get downstreamProtocol() {\n    return this._downstreamProtocol;\n  }\n\n  /**\n   * W3C /timeouts can take as many as 3 timeout types at once, MJSONWP /timeouts only takes one\n   * at a time. So if we're using W3C and proxying to MJSONWP and there's more than one timeout type\n   * provided in the request, we need to do 3 proxies and combine the result\n   *\n   * @param {Object} body Request body\n   * @return {Array} Array of W3C + MJSONWP compatible timeout objects\n   */\n  getTimeoutRequestObjects(body) {\n    if (this.downstreamProtocol === W3C && _.has(body, 'ms') && _.has(body, 'type')) {\n      const typeToW3C = (x) => (x === 'page load' ? 'pageLoad' : x);\n      return [\n        {\n          [typeToW3C(body.type)]: body.ms,\n        },\n      ];\n    }\n\n    if (this.downstreamProtocol === MJSONWP && (!_.has(body, 'ms') || !_.has(body, 'type'))) {\n      const typeToJSONWP = (x) => (x === 'pageLoad' ? 'page load' : x);\n      return (\n        _.toPairs(body)\n          // Only transform the entry if ms value is a valid positive float number\n          .filter((pair) => /^\\d+(?:[.,]\\d*?)?$/.test(`${pair[1]}`))\n          .map(function (pair) {\n            return {\n              type: typeToJSONWP(pair[0]),\n              ms: pair[1],\n            };\n          })\n      );\n    }\n\n    return [body];\n  }\n\n  /**\n   * Proxy an array of timeout objects and merge the result\n   * @param {String} url Endpoint url\n   * @param {String} method Endpoint method\n   * @param {Object} body Request body\n   */\n  async proxySetTimeouts(url, method, body) {\n    let response, resBody;\n\n    const timeoutRequestObjects = this.getTimeoutRequestObjects(body);\n    this.log.debug(\n      `Will send the following request bodies to /timeouts: ${JSON.stringify(\n        timeoutRequestObjects\n      )}`\n    );\n    for (const timeoutObj of timeoutRequestObjects) {\n      [response, resBody] = await this.proxyFunc(url, method, timeoutObj);\n\n      // If we got a non-MJSONWP response, return the result, nothing left to do\n      if (this.downstreamProtocol !== MJSONWP) {\n        return [response, resBody];\n      }\n\n      // If we got an error, return the error right away\n      if (response.statusCode >= 400) {\n        return [response, resBody];\n      }\n\n      // ...Otherwise, continue to the next timeouts call\n    }\n    return [response, resBody];\n  }\n\n  async proxySetWindow(url, method, body) {\n    const bodyObj = util.safeJsonParse(body);\n    if (_.isPlainObject(bodyObj)) {\n      if (this.downstreamProtocol === W3C && _.has(bodyObj, 'name') && !_.has(bodyObj, 'handle')) {\n        this.log.debug(`Copied 'name' value '${bodyObj.name}' to 'handle' as per W3C spec`);\n        return await this.proxyFunc(url, method, {\n          ...bodyObj,\n          handle: bodyObj.name,\n        });\n      }\n      if (\n        this.downstreamProtocol === MJSONWP &&\n        _.has(bodyObj, 'handle') &&\n        !_.has(bodyObj, 'name')\n      ) {\n        this.log.debug(`Copied 'handle' value '${bodyObj.handle}' to 'name' as per JSONWP spec`);\n        return await this.proxyFunc(url, method, {\n          ...bodyObj,\n          name: bodyObj.handle,\n        });\n      }\n    }\n\n    return await this.proxyFunc(url, method, body);\n  }\n\n  async proxySetValue(url, method, body) {\n    const bodyObj = util.safeJsonParse(body);\n    if (_.isPlainObject(bodyObj) && (util.hasValue(bodyObj.text) || util.hasValue(bodyObj.value))) {\n      let {text, value} = bodyObj;\n      if (util.hasValue(text) && !util.hasValue(value)) {\n        value = _.isString(text) ? [...text] : _.isArray(text) ? text : [];\n        this.log.debug(\n          `Added 'value' property ${JSON.stringify(value)} to 'setValue' request body`\n        );\n      } else if (!util.hasValue(text) && util.hasValue(value)) {\n        text = _.isArray(value) ? value.join('') : _.isString(value) ? value : '';\n        this.log.debug(`Added 'text' property ${JSON.stringify(text)} to 'setValue' request body`);\n      }\n      return await this.proxyFunc(\n        url,\n        method,\n        Object.assign({}, bodyObj, {\n          text,\n          value,\n        })\n      );\n    }\n\n    return await this.proxyFunc(url, method, body);\n  }\n\n  async proxySetFrame(url, method, body) {\n    const bodyObj = util.safeJsonParse(body);\n    return _.has(bodyObj, 'id') && _.isPlainObject(bodyObj.id)\n      ? await this.proxyFunc(url, method, {\n          ...bodyObj,\n          id: duplicateKeys(bodyObj.id, MJSONWP_ELEMENT_KEY, W3C_ELEMENT_KEY),\n        })\n      : await this.proxyFunc(url, method, body);\n  }\n\n  async proxyPerformActions(url, method, body) {\n    const bodyObj = util.safeJsonParse(body);\n    return _.isPlainObject(bodyObj)\n      ? await this.proxyFunc(\n          url,\n          method,\n          duplicateKeys(bodyObj, MJSONWP_ELEMENT_KEY, W3C_ELEMENT_KEY)\n        )\n      : await this.proxyFunc(url, method, body);\n  }\n\n  async proxyReleaseActions(url, method) {\n    return await this.proxyFunc(url, method);\n  }\n\n  /**\n   * Handle \"crossing\" endpoints for the case\n   * when upstream and downstream drivers operate different protocols\n   *\n   * @param {string} commandName\n   * @param {string} url\n   * @param {string} method\n   * @param {?string|object} body\n   * @returns The proxyfying result as [response, responseBody] tuple\n   */\n  async convertAndProxy(commandName, url, method, body) {\n    if (!this.downstreamProtocol) {\n      return await this.proxyFunc(url, method, body);\n    }\n\n    // Same url, but different arguments\n    switch (commandName) {\n      case 'timeouts':\n        return await this.proxySetTimeouts(url, method, body);\n      case 'setWindow':\n        return await this.proxySetWindow(url, method, body);\n      case 'setValue':\n        return await this.proxySetValue(url, method, body);\n      case 'performActions':\n        return await this.proxyPerformActions(url, method, body);\n      case 'releaseActions':\n        return await this.proxyReleaseActions(url, method);\n      case 'setFrame':\n        return await this.proxySetFrame(url, method, body);\n      default:\n        break;\n    }\n\n    // Same arguments, but different URLs\n    for (const {commandNames, jsonwpConverter, w3cConverter} of COMMAND_URLS_CONFLICTS) {\n      if (!commandNames.includes(commandName)) {\n        continue;\n      }\n\n      const rewrittenUrl =\n        this.downstreamProtocol === MJSONWP ? jsonwpConverter(url) : w3cConverter(url);\n      if (rewrittenUrl === url) {\n        this.log.debug(\n          `Did not know how to rewrite the original URL '${url}' ` +\n            `for ${this.downstreamProtocol} protocol`\n        );\n        break;\n      }\n      this.log.info(\n        `Rewrote the original URL '${url}' to '${rewrittenUrl}' ` +\n          `for ${this.downstreamProtocol} protocol`\n      );\n      return await this.proxyFunc(rewrittenUrl, method, body);\n    }\n\n    // No matches found. Proceed normally\n    return await this.proxyFunc(url, method, body);\n  }\n}\n\nexport default ProtocolConverter;\n"],"mappings":"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"}